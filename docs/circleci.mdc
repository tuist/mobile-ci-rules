---
title: CircleCI Complete Pipeline Reference
provider: CircleCI
generated_at: 2025-07-08T13:26:26.971Z
pages_included: 9
---

# CircleCI Complete Pipeline Reference

This comprehensive guide contains all pipeline, workflow, and build configuration documentation for CircleCI.

## Table of Contents


1. [Configuration reference](#section-1)
2. [Sample config.yml Files](#section-2)
3. [Workflow orchestration](#section-3)
4. [Jobs and steps](#section-4)
5. [Orbs overview](#section-5)
6. [Execution environments overview](#section-6)
7. [Testing iOS applications on macOS](#section-7)
8. [Page Not Found](#section-8)
9. [Test splitting and parallelism](#section-9)


---


## 1. Configuration reference {#section-1}

*Source: [https://circleci.com/docs/configuration-reference/](https://circleci.com/docs/configuration-reference/)*

[Docs](https://circleci.com/docs/)

[Start Building for Free](https://circleci.com/signup/)

[Home](https://circleci.com/developer/) [Docs](https://circleci.com/docs/) [Orbs](https://circleci.com/developer/orbs/) [Images](https://circleci.com/developer/images/)

[CircleCI.com](https://circleci.com/)[Academy](https://circleci.com/training/)[Blog](https://circleci.com/blog/)[Community](https://discuss.circleci.com/)[Support](https://support.circleci.com/hc/en-us/)

# Configuration reference

[1 month ago](https://github.com/circleci/circleci-docs/commits/master/jekyll/_cci2/configuration-reference.adoc)

Last updated • Read time

Cloud

This document is applicable to CircleCI Cloud

Server v4+

This document is applicable to CircleCI Server v4+

##### Helpful Resources

[6 config optimization tips](https://circleci.com/blog/six-optimization-tips-for-your-config)

[Intro to dynamic config](https://discuss.circleci.com/t/intro-to-dynamic-config-via-setup-workflows/39868)

[Using dynamic config](https://circleci.com/blog/building-cicd-pipelines-using-dynamic-config)

[Validate your config using local CLI](https://support.circleci.com/hc/en-us/articles/360006735753?input_string=configuration+error)

[How to trigger a single job](https://support.circleci.com/hc/en-us/articles/360041503393?input_string=changes+in+v2+api)

##### On This Page

- [version](https://circleci.com/docs/configuration-reference/#version)
- [setup](https://circleci.com/docs/configuration-reference/#setup)
- [orbs](https://circleci.com/docs/configuration-reference/#orbs)
- [commands](https://circleci.com/docs/configuration-reference/#commands)
- [parameters](https://circleci.com/docs/configuration-reference/#parameters-pipeline)
- [executors](https://circleci.com/docs/configuration-reference/#executors)
- [jobs](https://circleci.com/docs/configuration-reference/#jobs)
- [<job\_name>](https://circleci.com/docs/configuration-reference/#job-name)
- [type](https://circleci.com/docs/configuration-reference/#job-type)
- [environment](https://circleci.com/docs/configuration-reference/#environment)
- [parallelism](https://circleci.com/docs/configuration-reference/#parallelism)
- [parameters](https://circleci.com/docs/configuration-reference/#parameters-job)
- [Executor docker / machine / macos](https://circleci.com/docs/configuration-reference/#executor-job)
- [docker](https://circleci.com/docs/configuration-reference/#docker)
- [Docker registry authentication](https://circleci.com/docs/configuration-reference/#docker-auth)
- [AWS authentication](https://circleci.com/docs/configuration-reference/#aws-authentication)
- [Use OIDC](https://circleci.com/docs/configuration-reference/#oidc)
- [Use environment variables](https://circleci.com/docs/configuration-reference/#env-vars)
- [machine](https://circleci.com/docs/configuration-reference/#machine)
- [Linux machine images](https://circleci.com/docs/configuration-reference/#available-linux-machine-images-cloud)
- [Linux machine images on server](https://circleci.com/docs/configuration-reference/#available-linux-machine-images-server)
- [Linux GPU machine images](https://circleci.com/docs/configuration-reference/#available-linux-gpu-images)
- [Android machine images](https://circleci.com/docs/configuration-reference/#available-android-machine-images)
- [Windows machine images](https://circleci.com/docs/configuration-reference/#available-windows-machine-images-cloud)
- [Windows machine images on server](https://circleci.com/docs/configuration-reference/#available-windows-machine-images-server)
- [Windows GPU machine image](https://circleci.com/docs/configuration-reference/#available-windows-gpu-image)
- [macos](https://circleci.com/docs/configuration-reference/#macos)
- [branches - DEPRECATED](https://circleci.com/docs/configuration-reference/#branches-deprecated)
- [resource\_class](https://circleci.com/docs/configuration-reference/#resourceclass)
- [Self-hosted runner](https://circleci.com/docs/configuration-reference/#self-hosted-runner)
- [Docker execution environment](https://circleci.com/docs/configuration-reference/#docker-execution-environment)
- [x86](https://circleci.com/docs/configuration-reference/#x86)
- [Arm](https://circleci.com/docs/configuration-reference/#arm)
- [LinuxVM execution environment](https://circleci.com/docs/configuration-reference/#linuxvm-execution-environment)
- [macOS execution environment](https://circleci.com/docs/configuration-reference/#macos-execution-environment)
- [macOS execution environment on server](https://circleci.com/docs/configuration-reference/#macos-server)
- [Windows execution environment](https://circleci.com/docs/configuration-reference/#windows-execution-environment)
- [GPU execution environment (Linux)](https://circleci.com/docs/configuration-reference/#gpu-execution-environment-linux)
- [GPU execution-environment (Windows)](https://circleci.com/docs/configuration-reference/#gpu-execution-environment-windows)
- [Arm VM execution-environment](https://circleci.com/docs/configuration-reference/#arm-execution-environment-linux)
- [steps](https://circleci.com/docs/configuration-reference/#steps)
- [run](https://circleci.com/docs/configuration-reference/#run)
- [Default shell options](https://circleci.com/docs/configuration-reference/#default-shell-options)
- [-e](https://circleci.com/docs/configuration-reference/#e)
- [-o pipefail](https://circleci.com/docs/configuration-reference/#o-pipefail)
- [Background commands](https://circleci.com/docs/configuration-reference/#background-commands)
- [Shorthand syntax](https://circleci.com/docs/configuration-reference/#shorthand-syntax)
- [The when attribute](https://circleci.com/docs/configuration-reference/#the-when-attribute)
- [Ending a job from within a step](https://circleci.com/docs/configuration-reference/#ending-a-job-from-within-a-step)
- [The when step](https://circleci.com/docs/configuration-reference/#the-when-step)
- [checkout](https://circleci.com/docs/configuration-reference/#checkout)
- [setup\_remote\_docker](https://circleci.com/docs/configuration-reference/#setupremotedocker)
- [save\_cache](https://circleci.com/docs/configuration-reference/#savecache)
- [restore\_cache](https://circleci.com/docs/configuration-reference/#restorecache)
- [deploy - DEPRECATED](https://circleci.com/docs/configuration-reference/#deploy-deprecated)
- [store\_artifacts](https://circleci.com/docs/configuration-reference/#storeartifacts)
- [store\_test\_results](https://circleci.com/docs/configuration-reference/#storetestresults)
- [persist\_to\_workspace](https://circleci.com/docs/configuration-reference/#persisttoworkspace)
- [attach\_workspace](https://circleci.com/docs/configuration-reference/#attachworkspace)
- [add\_ssh\_keys](https://circleci.com/docs/configuration-reference/#add-ssh-keys)
- [Using pipeline values](https://circleci.com/docs/configuration-reference/#using-pipeline-values)
- [circleci\_ip\_ranges](https://circleci.com/docs/configuration-reference/#circleciipranges)
- [workflows](https://circleci.com/docs/configuration-reference/#workflows)
- [version](https://circleci.com/docs/configuration-reference/#workflow-version)
- [<workflow\_name>](https://circleci.com/docs/configuration-reference/#workflowname)
- [triggers](https://circleci.com/docs/configuration-reference/#triggers)
- [schedule](https://circleci.com/docs/configuration-reference/#schedule)
- [cron](https://circleci.com/docs/configuration-reference/#cron)
- [filters](https://circleci.com/docs/configuration-reference/#filters)
- [branches](https://circleci.com/docs/configuration-reference/#schedule-branches)
- [Using when in workflows](https://circleci.com/docs/configuration-reference/#using-when-in-workflows)
- [jobs](https://circleci.com/docs/configuration-reference/#jobs-in-workflow)
- [<job\_name>](https://circleci.com/docs/configuration-reference/#job-name-in-workflow)
- [override-with](https://circleci.com/docs/configuration-reference/#override-with)
- [serial-group](https://circleci.com/docs/configuration-reference/#serial-group)
- [requires](https://circleci.com/docs/configuration-reference/#requires)
- [name](https://circleci.com/docs/configuration-reference/#name)
- [context](https://circleci.com/docs/configuration-reference/#context)
- [type](https://circleci.com/docs/configuration-reference/#type)
- [filters](https://circleci.com/docs/configuration-reference/#jobfilters)
- [Expression-based job filters](https://circleci.com/docs/configuration-reference/#expression-based-job-filters)
- [branches](https://circleci.com/docs/configuration-reference/#branches)
- [tags](https://circleci.com/docs/configuration-reference/#tags)
- [matrix](https://circleci.com/docs/configuration-reference/#matrix)
- [Excluding sets of parameters from a matrix](https://circleci.com/docs/configuration-reference/#excluding-sets-of-parameters-from-a-matrix)
- [Dependencies and matrix jobs](https://circleci.com/docs/configuration-reference/#dependencies-and-matrix-jobs)
- [pre-steps and post-steps](https://circleci.com/docs/configuration-reference/#pre-steps-and-post-steps)
- [Logic statements](https://circleci.com/docs/configuration-reference/#logic-statements)
- [Logic statement examples](https://circleci.com/docs/configuration-reference/#logic-statement-examples)
- [Example full configuration](https://circleci.com/docs/configuration-reference/#example-full-configuration)

This document is a reference for the CircleCI 2.x configuration keys that are used in the `.circleci/config.yml` file.

You can see a complete `config.yml` in our [full example](https://circleci.com/docs/configuration-reference/#example-full-configuration).

* * *

## **`version`**

The `version` field is intended to be used in order to issue warnings for deprecation or breaking changes.

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `version` | Y | String | `2`, `2.0`, or `2.1` See the [Reusable configuration](https://circleci.com/docs/reusing-config/) page for an overview of 2.1 keys available to simplify your `.circleci/config.yml` file, reuse, and parameterized jobs. |

**Example:**

```yaml
version: 2.1
```

* * *

## **`setup`**

The `setup` field enables you to conditionally trigger configurations from outside the primary `.circleci` parent directory, update pipeline parameters, or generate customized configurations.

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `setup` | N | Boolean | Designates the `config.yaml` for use of CircleCI’s [dynamic configuration](https://circleci.com/docs/dynamic-config/) feature. |

**Example:**

```yaml
version: 2.1

setup: true
```

* * *

## **`orbs`**

|     |     |
| --- | --- |
|  | The `orbs` key is supported in `version: 2.1` configuration |

Use the `orbs` key to reference or define reusable configuration blocks (orbs) for use in your configuration.

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `orbs` | N | Map | A map of user-selected names to either: orb references (strings) or orb definitions (maps). Orb definitions must be the orb-relevant subset of 2.1 config. See the [Creating Orbs](https://circleci.com/docs/creating-orbs/) documentation for details. |
| `executors` | N | Map | A map of strings to executor definitions. See the [**`executors`**](https://circleci.com/docs/configuration-reference/#executors) section below. |
| `commands` | N | Map | A map of command names to command definitions. See the [**`commands`**](https://circleci.com/docs/configuration-reference/#commands) section below. |

The following example uses the `node` orb that exists in the certified `circleci` namespace. Refer to the Node orb page in the [Orb Registry](https://circleci.com/developer/orbs/orb/circleci/node) for more examples and information.

**Example:**

```yaml
version: 2.1

orbs:
  node: circleci/node@x.y

jobs:
  install-node-example:
    docker:
      - image: cimg/base:stable
    steps:
      - checkout
      - node/install:
          install-yarn: true
          node-version: '16.13'
      - run: node --version
workflows:
  test_my_app:
    jobs:
      - install-node-example
```

Documentation is available for orbs in the following sections:

- [Using Orbs](https://circleci.com/docs/orb-intro/)

- [Authoring Orbs](https://circleci.com/docs/orb-author/).


Public orbs are listed in the [Orb Registry](https://circleci.com/developer/orbs).

* * *

## **`commands`**

|     |     |
| --- | --- |
|  | The `commands` key is supported in `version: 2.1` configuration |

A `command` defines a sequence of steps as a map to be executed in a job, enabling you to reuse a single command definition across multiple jobs. For more information see the [Reusable Config Reference Guide](https://circleci.com/docs/reusing-config/).

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `steps` | Y | Sequence | A sequence of steps run inside the calling job of the command. |
| `parameters` | N | Map | A map of parameter keys. See the [Parameter Syntax](https://circleci.com/docs/reusing-config/#parameter-syntax) section of the [Reusing Config](https://circleci.com/docs/reusing-config/) document for details. |
| `description` | N | String | A string that describes the purpose of the command. |

**Example:**

```yaml
version: 2.1

commands:
  sayhello:
    description: "A very simple command for demonstration purposes"
    parameters:
      to:
        type: string
        default: "Hello World"
    steps:
      - run: echo << parameters.to >>
```

* * *

## **`parameters`**

|     |     |
| --- | --- |
|  | The pipeline `parameters` key is supported in `version: 2.1` configuration |

Use the `parameters` key at the top level of your config to declare _pipeline parameters_ for use in the configuration. See [Pipeline Values and Parameters](https://circleci.com/docs/pipeline-variables/#pipeline-parameters-in-configuration) for usage details.

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `parameters` | N | Map | A map of parameter keys. Supports `string`, `boolean`, `integer` and `enum` types. See [Parameter Syntax](https://circleci.com/docs/reusing-config/#parameter-syntax) for details. |

**Example:**

This example declares a pipeline parameter named `image-tag` with a type of `string` and a default value of `current`.

```yaml
version: 2.1

parameters:
  image-tag:
    type: string
    default: "current"
```

Once you have declared a pipeline parameter, you can pass a pipelines parameter value when triggering a pipeline via the API or from the CircleCI web app. '''

## **`executors`**

|     |     |
| --- | --- |
|  | The `executors` key is supported in `version: 2.1` configuration |

Executors define the execution environment in which the steps of a job will be run, allowing you to reuse a single executor definition across multiple jobs.

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `docker` | Y (1) | List | Options for [Docker executor](https://circleci.com/docs/configuration-reference/#docker) |
| `resource_class` | N | String | Amount of CPU and RAM allocated to each container in a job. |
| `machine` | Y (1) | Map | Options for [machine executor](https://circleci.com/docs/configuration-reference/#machine) |
| `macos` | Y (1) | Map | Options for [macOS executor](https://circleci.com/docs/configuration-reference/#macos) |
| `windows` | Y (1) | Map | [Windows executor](https://circleci.com/docs/configuration-reference/#windows-execution-environment) currently working with orbs. Check out [the orb](https://circleci.com/developer/orbs/orb/circleci/windows). |
| `shell` | N | String | Shell to use for execution command in all steps. Can be overridden by `shell` in each step (default: See [Default Shell Options](https://circleci.com/docs/configuration-reference/#default-shell-options)) |
| `working_directory` | N | String | In which directory to run the steps. Will be interpreted as an absolute path. |
| `environment` | N | Map | A map of environment variable names and values. |

(1) One executor type should be specified per job. If more than one is set you will receive an error.

**Example:**

```yaml
version: 2.1
executors:
  my-executor:
    docker:
      - image: cimg/ruby:3.0.3-browsers

jobs:
  my-job:
    executor: my-executor
    steps:
      - run: echo "Hello executor!"
```

See the [Using Parameters in Executors](https://circleci.com/docs/reusing-config/#using-parameters-in-executors) section of the [Reusing config](https://circleci.com/docs/reusing-config/) page for examples of parameterized executors.

* * *

## **`jobs`**

A Workflow is comprised of one or more uniquely named jobs. Jobs are specified in the `jobs` map, see [Sample config.yml](https://circleci.com/docs/sample-config/) for two examples of a `job` map. The name of the job is the key in the map, and the value is a map describing the job.

Jobs have a maximum runtime based on pricing plan, as follows:

- 1 hour (Free)

- 3 hours (Performance)

- 5 hours (Scale)


If your jobs are timing out, consider the following:

- A larger [**`resource_class`**](https://circleci.com/docs/configuration-reference/#resourceclass).

- Using [parallelism](https://circleci.com/docs/parallelism-faster-jobs/).

- Run some of your jobs concurrently using [workflows](https://circleci.com/docs/workflows/).

- You can upgrade your pricing plan.


**Example:**

```yaml
version: 2.1

jobs:
  my-job:
    docker:
      - image: cimg/base:2024.12
    resource_class: xlarge
    steps:
      ... // other config
```

* * *

### **< `job_name` >**

Each job consists of the job’s name as a key and a map as a value. A name should be case insensitive unique within a current `jobs` list. The value map has the following attributes:

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `type` | N | String | Job type, can be `build`, `release`, `no-op`, or `approval`. If not specified, defaults to `build`. |
| `docker` | Y (1) | List | Options for the [Docker executor](https://circleci.com/docs/configuration-reference/#docker) |
| `machine` | Y (1) | Map | Options for the [machine executor](https://circleci.com/docs/configuration-reference/#machine) |
| `macos` | Y (1) | Map | Options for the [macOS executor](https://circleci.com/docs/configuration-reference/#macos) |
| `shell` | N | String | Shell to use for execution command in all steps. Can be overridden by `shell` in each step (default: See [Default Shell Options](https://circleci.com/docs/configuration-reference/#default-shell-options)) |
| `parameters` | N | Map | [Parameters](https://circleci.com/docs/configuration-reference/#parameters-job) for making a `job` explicitly configurable in a `workflow`. |
| `steps` | Y | List | A list of [steps](https://circleci.com/docs/configuration-reference/#steps) to be performed |
| `working_directory` | N | String | In which directory to run the steps. Will be interpreted as an absolute path. Default: `~/project` (where `project` is a literal string, not the name of your specific project). Processes run during the job can use the `$CIRCLE_WORKING_DIRECTORY` environment variable to refer to this directory. **Note:** Paths written in your YAML configuration file will _not_ be expanded; if your `store_test_results.path` is `$CIRCLE_WORKING_DIRECTORY/tests`, then CircleCI will attempt to store the `test` subdirectory of the directory literally named `$CIRCLE_WORKING_DIRECTORY`, dollar sign `$` and all. `working_directory` will be created automatically if it doesn’t exist. |
| `parallelism` | N | Integer | Number of parallel instances of this job to run (default: 1) |
| `environment` | N | Map | A map of environment variable names and values. |
| `branches` | N | Map | This key is deprecated. Use [workflows filtering](https://circleci.com/docs/configuration-reference/#jobfilters) to control which jobs run for which branches. |
| `resource_class` | N | String | Amount of CPU and RAM allocated to each container in a job. |

(1) One executor type should be specified per job. If more than one is set you will receive an error.

**Example:**

In this example the job name is `my-job`.

```yaml
version: 2.1

jobs:
  my-job:
```

* * *

#### `type`

Configure a job type. Options are `release`, `approval`, `no-op`, `build` (default).

If a type is not specified, the job defaults to a `build` type.

**Example** of a job with a `build` type. `build` is the default type and does not need to be configured:

```yaml
jobs:
  my-job:
    docker:
      - image: cimg/base:2024.12
    resource_class: xlarge
    steps:
      ... // other config
```

Jobs with the `release` type are used to [connect your pipeline configuration](https://circleci.com/docs/deploy/configure-your-kubernetes-components/#link-release) to a deployment in the CircleCI deploys UI. For full details, see the [Deploys overview](https://circleci.com/docs/deploy/deploys-overview/) page.

**Example** of a job with a `release` type:

```yaml
jobs:
  release-my-service:
    type: release
    plan_name: <my-service-release>
```

The `no-op` type is used to configure a job that performs no actions and consumes no credits. `no-op` is commonly used to organise the order of operations within a workflow and make it easier to maintain. Only the `type` is required for a `no-op` type job, no further job configuration is required. For some examples of using no-op jobs, see the [Orchestration cookbook](https://circleci.com/docs/orchestration-cookbook/#use-no-op-jobs-to-create-a-cleaner-workflow-graph)

**Example** of a job with a `no-op` type:

```yaml
jobs:
  my-no-op-job:
    type: no-op
```

The `approval` type is used to configure a manual approval step. No `job` configuration is required or allowed for an `approval` type job. The `approval` type is most commonly configured within a workflow rather than under the top-level `jobs` key. Only `approval` type jobs can have their `type` configured under `workflows`. See [type under workflows section](https://circleci.com/docs/configuration-reference/#type) for full details.

**Example** of a job with an `approval` type, configured under `workflows`:

```yaml
workflows:
  my-workflow:
    jobs:
      - build
      - test:
          requires:
            - build
      - hold:
          type: approval
          requires:
            - test
      - deploy:
          requires:
            - hold
```

* * *

#### `environment`

A map of environment variable names and values. For more information on defining and using environment variables, and the order of precedence governing the various ways they can be set, see the [Environment variables](https://circleci.com/docs/env-vars/) page.

**Example** to show setting an environment variable named `FOO` with a value of `bar` for use in a job.

```yaml
version: 2.1

jobs:
  build:
    docker:
      - image: cimg/base:2022.04-20.04
    environment:
      FOO: bar
```

* * *

#### `parallelism`

This feature is used to optimize test steps. If `parallelism` is set to N > 1, then N independent executors will be set up and each will run the steps of that job in parallel.

You can use the CircleCI CLI to split your test suite across parallel containers so the job completes in a shorter time.

- Read more about splitting tests across parallel execution environments on the [Parallelism and test splitting](https://circleci.com/docs/parallelism-faster-jobs/) page.

- Refer to the [Use the CircleCI CLI to split tests](https://circleci.com/docs/use-the-circleci-cli-to-split-tests/) how-to guide.

- Follow the [Test splitting tutorial](https://circleci.com/docs/test-splitting-tutorial/).


**Example:**

```yaml
jobs:
  build:
    docker:
      - image: cimg/base:2024.12
    environment:
      FOO: bar
    parallelism: 3
    resource_class: large
    working_directory: ~/my-app
    steps:
      - run: go list ./... | circleci tests run --command "xargs gotestsum --junitfile junit.xml --format testname --" --split-by=timings --timings-type=name
```

* * *

#### `parameters`

Job-level `parameters` can be used when [calling a `job` in a `workflow`](https://circleci.com/docs/configuration-reference/#jobs-in-workflow).

Reserved parameter-names:

- `name`

- `requires`

- `context`

- `type`

- `filters`

- `matrix`


See [Parameter Syntax](https://circleci.com/docs/reusing-config/#parameter-syntax) for definition details.

**Example** to show using a job parameter to set the parallelism for a job when a workflow is run.

```yaml
version: 2.1

jobs:
  build:
    parameters:
      my-parameter:
        type: integer
        default: 1
    parallelism: << parameters.p >>
    docker:
      - image: cimg/base:2023.11
    steps:
      - checkout

workflows:
  workflow:
    jobs:
      - build:
          my-parameter: 2
```

* * *

#### Executor **`docker`** / **`machine`** / **`macos`**

CircleCI offers several execution environments in which to run your jobs. To specify an execution environment choose an _executor_, then specify and image and a resource class. An executor defines the underlying technology, environment, and operating system in which to run a job.

Set up your jobs to run using the `docker` (Linux), `machine` (LinuxVM, Windows, GPU, Arm), or `macos` executor, then specify an image with the tools and packages you need, and a resource class.

Learn more about execution environments and executors in the [Introduction to Execution Environments](https://circleci.com/docs/executor-intro/).

* * *

#### `docker`

Configure a job to use the Docker execution environment using the `docker` key which takes a list of maps:

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `image` | Y | String | The name of a custom Docker image to use. The first `image` listed under a job defines the job’s own primary container image where all steps will run. |
| `name` | N | String | `name` defines the hostname for the container (the default is `localhost`), which is used for reaching secondary (service) containers. By default, all services are exposed directly on `localhost`. This field is useful if you would rather have a different hostname instead of `localhost`, for example, if you are starting multiple versions of the same service. |
| `entrypoint` | N | String or List | The command used as executable when launching the container. `entrypoint` overrides the image’s [`ENTRYPOINT`](https://docs.docker.com/engine/reference/builder/#entrypoint). |
| `command` | N | String or List | The command used as PID 1 (or arguments for entrypoint) when launching the container. `command` overrides the image’s `COMMAND`. It will be used as arguments to the image `ENTRYPOINT` if it has one, or as the executable if the image has no `ENTRYPOINT`. |
| `user` | N | String | Which user to run commands as within the Docker container |
| `environment` | N | Map | A map of environment variable names and values. The `environment` settings apply to the entrypoint/command run by the Docker container, not the job steps. |
| `auth` | N | Map | Authentication for registries using standard `docker login` credentials |
| `aws_auth` | N | Map | Authentication for AWS Elastic Container Registry (ECR) |

For a [primary container](https://circleci.com/docs/glossary/#primary-container), (the first container in the list) if neither `command` nor `entrypoint` is specified in the configuration, then any `ENTRYPOINT` and `COMMAND` in the image are ignored. The primary container is typically only used for running the `steps` and not for its `ENTRYPOINT`, and an `ENTRYPOINT` may consume significant resources or exit prematurely.

A [custom image](https://circleci.com/docs/custom-images/#adding-an-entrypoint) may disable this behavior and force the `ENTRYPOINT` to run.

You can specify image versions using tags or digest. You can use any public images from any public Docker registry (defaults to Docker Hub). Learn more about specifying images on the [Using the Docker Execution Environment](https://circleci.com/docs/using-docker/) page.

**Example:**

```yaml
version: 2.1

jobs:
  hello-job:
    docker:
      - image: cimg/node:17.2.0 # the primary container, where your job's commands are run
    steps:
      - checkout # check out the code in the project directory
      - run: echo "hello world" # run the `echo` command

workflows:
  my-workflow:
    jobs:
      - hello-job
```

* * *

##### Docker registry authentication

Some registries, Docker Hub, for example, may rate limit anonymous Docker pulls. We recommend that you authenticate to pull private and public images. The username and password can be specified in the `auth` field. See [Using Docker Authenticated Pulls](https://circleci.com/docs/private-images/) for details.

**Example:**

```yaml
jobs:
  build:
    docker:
      - image: buildpack-deps:trusty # primary container
        auth:
          username: mydockerhub-user
          password: $DOCKERHUB_PASSWORD  # context / project UI env-var reference
        environment:
          ENV: CI

      - image: mongo:2.6.8
        auth:
          username: mydockerhub-user
          password: $DOCKERHUB_PASSWORD  # context / project UI env-var reference
        command: [--smallfiles]

      - image: postgres:14.2
        auth:
          username: mydockerhub-user
          password: $DOCKERHUB_PASSWORD  # context / project UI env-var reference
        environment:
          POSTGRES_USER: user

      - image: redis@sha256:54057dd7e125ca41afe526a877e8bd35ec2cdd33b9217e022ed37bdcf7d09673
        auth:
          username: mydockerhub-user
          password: $DOCKERHUB_PASSWORD  # context / project UI env-var reference

      - image: acme-private/private-image:321
        auth:
          username: mydockerhub-user
          password: $DOCKERHUB_PASSWORD  # context / project UI env-var reference
```

* * *

##### AWS authentication

Using an image hosted on [AWS ECR](https://aws.amazon.com/ecr/) requires authentication using AWS credentials. The two configuration options are described in the following sections.

###### Use OIDC

Authenticate using OpenID Connect (OIDC) using the `oidc_role_arn` field, as follows:

**Example:**

```yaml
jobs:
  job_name:
    docker:
      - image: <your-image-arn>
        aws_auth:
          oidc_role_arn: <your-iam-role-arn>
```

For steps to get set up with OIDC to pull images from AWS ECR, see the [Pull and image from AWS ECR with OIDC](https://circleci.com/docs/pull-an-image-from-aws-ecr-with-oidc/) page.

###### Use environment variables

By default, CircleCI uses the AWS credentials you provide by setting the `AWS_ACCESS_KEY_ID` and `AWS_SECRET_ACCESS_KEY` project environment variables. It is also possible to set the credentials by using the `aws_auth` field as in the following example:

**Example:**

```yaml
jobs:
  build:
    docker:
      - image: account-id.dkr.ecr.us-east-1.amazonaws.com/org/repo:0.1
        aws_auth:
          aws_access_key_id: AKIAQWERVA  # can specify string literal values
          aws_secret_access_key: $ECR_AWS_SECRET_ACCESS_KEY  # or project UI envar reference
```

* * *

#### **`machine`**

|     |     |
| --- | --- |
|  | **Using CircleCI cloud?** The use of `machine: true` is deprecated. You must specify an image to use. |

The machine executor is configured using the `machine` key, which takes a map:

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `image` | Y | String | The virtual machine image to use. View [available images](https://circleci.com/developer/images?imageType=machine). **Note:** This key is **not** supported for Linux VMs on installations of CircleCI server. For information about customizing `machine` executor images on CircleCI installed on your servers, see our [Machine provisioner documentation](https://circleci.com/docs/server/latest/operator/manage-virtual-machines-with-machine-provisioner/). |
| `docker_layer_caching` | N | Boolean | Set this to `true` to enable [Docker layer caching](https://circleci.com/docs/docker-layer-caching/). |

**Example:**

CloudServer

```yml
jobs:
  build: # name of your job
    machine: # executor type
      image: ubuntu-2004:current # recommended linux image

    steps:
      # Commands run in a Linux virtual machine environment
```

* * *

##### Linux `machine` images

**Specifying an image in your configuration file is strongly recommended.** CircleCI supports multiple Linux machine images that can be specified in the `image` field. For a full list of supported image tags, refer to the following pages in the Developer Hub:

- [Ubuntu-2004](https://circleci.com/developer/machine/image/ubuntu-2004)

- [Ubuntu-2204](https://circleci.com/developer/machine/image/ubuntu-2204)


More information on the software available in each image can be found in our [Discuss forum](https://discuss.circleci.com/tag/machine-images).

The machine executor supports [Docker Layer Caching](https://circleci.com/docs/docker-layer-caching/), which is useful when you are building Docker images during your job or Workflow.

* * *

##### Linux `machine` images on server

If you are using CircleCI server, contact your system administrator for details of available Linux machine images.

* * *

##### Linux GPU `machine` images

When using the Linux [GPU executor](https://circleci.com/docs/using-gpu/), the available images are:

- `linux-cuda-11:default` v11.4, v11.6, v11.8 (default), Docker v20.10.24

- `linux-cuda-12:default` v12.0, v12.1 (default), Docker v20.10.24


* * *

##### Android `machine` images

CircleCI supports running jobs on Android for testing and deploying Android applications.

To use the [Android image](https://circleci.com/developer/machine/image/android) directly with the machine executor, add the following to your job:

```yaml
version: 2.1

jobs:
  build:
    machine:
      image: android:2024.11.1
```

The Android image can also be accessed using the [Android orb](https://circleci.com/developer/orbs/orb/circleci/android).

For examples, refer to the [Using Android Images with the Machine Executor](https://circleci.com/docs/android-machine-image/) page.

* * *

##### Windows `machine` images

**Specifying an image in your configuration file is strongly recommended.** CircleCI supports multiple Windows machine images that can be specified in the `image` field.

For a full list of supported images, refer to one of the following:

- [`windows-server-2022-gui` image](https://circleci.com/developer/machine/image/windows-server-2022-gui)

- [`windows-server-2019` image](https://circleci.com/developer/machine/image/windows-server-2019)


More information on what software is available in each image can be found in our [Discuss forum](https://discuss.circleci.com/c/ecosystem/circleci-images/).

Alternatively, use the [Windows orb](https://circleci.com/developer/orbs/orb/circleci/windows) to manage your Windows execution environment. For examples, see the [Using the Windows Execution Environment](https://circleci.com/docs/using-windows/) page.

* * *

##### Windows `machine` images on server

If you are using CircleCI server, contact your system administrator for details of available Windows machine images.

* * *

##### Windows GPU `machine` image

When using the Windows [GPU executor](https://circleci.com/docs/using-gpu/), the available image is:

- [`windows-server-2019-cuda`](https://circleci.com/developer/machine/image/windows-server-2019-cuda)


**Example:**

```yaml
version: 2.1

jobs:
  build:
    machine:
      image: windows-server-2019-cuda:current
```

* * *

#### **`macos`**

CircleCI supports running jobs on [macOS](https://developer.apple.com/macos/), to allow you to build, test, and deploy apps for macOS, [iOS](https://developer.apple.com/ios/), [tvOS](https://developer.apple.com/tvos/) and [watchOS](https://developer.apple.com/watchos/). To run a job on a macOS virtual machine, add the `macos` key to the top-level configuration for your job and specify the version of Xcode to use.

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `xcode` | Y | String | The version of Xcode that is installed on the virtual machine, see the [Supported Xcode Versions section of the Testing iOS](https://circleci.com/docs/using-macos/#supported-xcode-versions) document for the complete list. |

**Example:** Use a macOS virtual machine with Xcode version 14.2.0:

```yaml
jobs:
  build:
    macos:
      xcode: "14.2.0"
```

* * *

#### **`branches` \- DEPRECATED**

This key is deprecated. Use [workflows filtering](https://circleci.com/docs/configuration-reference/#jobfilters) to control which jobs run for which branches.

* * *

#### **`resource_class`**

The `resource_class` feature allows you to configure CPU and RAM resources for each job. Resource classes are available for each execution environment, as described in the tables below.

We implement soft concurrency limits for each resource class to ensure our system remains stable for all customers. If you are on a Performance or Custom Plan and experience queuing for certain resource classes, it is possible you are hitting these limits. [Contact CircleCI support](https://support.circleci.com/hc/en-us/requests/new) to request a raise on these limits for your account.

If you do not specify a resource class, CircleCI will use a default value that is subject to change. It is best practice to specify a resource class as opposed to relying on a default.

|     |     |
| --- | --- |
|  | Java, Erlang and any other languages that introspect the `/proc` directory for information about CPU count may require additional configuration to prevent them from slowing down when using the CircleCI resource class feature. Programs with this issue may request 32 CPU cores and run slower than they would when requesting one core. Users of languages with this issue should pin their CPU count to their guaranteed CPU resources. |

|     |     |
| --- | --- |
|  | If you want to confirm how much memory you have been allocated, you can check the cgroup memory hierarchy limit with `grep hierarchical_memory_limit /sys/fs/cgroup/memory/memory.stat`. |

* * *

##### Self-hosted runner

Use the `resource_class` key to configure a [self-hosted runner instance](https://circleci.com/docs/runner-overview/).

For example:

```yaml
jobs:
  job_name:
    machine: true
    resource_class: <my-namespace>/<my-runner>
```

* * *

##### Docker execution environment

**Example:**

```yaml
jobs:
  build:
    docker:
      - image: cimg/base:2024.12
    resource_class: xlarge
    steps:
      ... // other config
```

###### x86

|     |     |
| --- | --- |
|  | For credit and access information, see the [Resource classes page](https://circleci.com/product/features/resource-classes). Resource class access is dependent on your [Plan](https://circleci.com/docs/plan-overview/). |

| Class | vCPUs | RAM | Cloud | Server |
| --- | --- | --- | --- | --- |
| `small` | 1 | 2GB |  |  |
| `medium` | 2 | 4GB |  |  |
| `medium+` | 3 | 6GB |  |  |
| `large` | 4 | 8GB |  |  |
| `xlarge` | 8 | 16GB |  |  |
| `2xlarge` | 16 | 32GB |  |  |
| `2xlarge+` | 20 | 40GB |  |  |

###### Arm

|     |     |
| --- | --- |
|  | **Arm on Docker** For credit and access information see the [Resource classes page](https://circleci.com/product/features/resource-classes). Resource class access is dependent on your [Plan](https://circleci.com/docs/plan-overview/)<br>To find out which CircleCI Docker convenience images support Arm resource classes, you can refer to [Docker hub](https://hub.docker.com/u/cimg):<br>1. Select the image (for example, `cimg/python`).<br>   <br>2. Select the **tags** tab.<br>   <br>3. View what is supported under **OS/ARCH** for the latest tags. For example, `cimg/python` has `linux/amd64` and `linux/arm64`, which means Arm **is** supported. |

| Class | vCPUs | RAM | Cloud | Server |
| --- | --- | --- | --- | --- |
| `arm.medium` | 2 | 8 GB |  |  |
| `arm.large` | 4 | 16 GB |  |  |
| `arm.xlarge` | 8 | 32 GB |  |  |
| `arm.2xlarge` | 16 | 64 GB |  |  |

* * *

##### LinuxVM execution environment

| Class | vCPUs | RAM | Disk Size | Cloud | Server |
| --- | --- | --- | --- | --- | --- |
| `medium` | 2 | 7.5 GB | 150GB |  |  |
| `large` | 4 | 15 GB | 150GB |  |  |
| `xlarge` | 8 | 32 GB | 150GB |  |  |
| `2xlarge` | 16 | 64 GB | 150GB |  |  |
| `2xlarge+` | 32 | 64 GB | 150GB |  |  |

**Example:**

CloudServer

```yaml
jobs:
  build:
    machine:
      image: ubuntu-2004:2024.01.2 # recommended linux image
    resource_class: large
    steps:
      ... // other config
```

* * *

##### macOS execution environment

| Class | vCPUs | RAM | Cloud | Server |
| --- | --- | --- | --- | --- |
| `m4pro.medium` | 6 @ 4.51 GHz | 28GB |  |  |
| `m4pro.large` | 12 @ 4.51 GHz | 56GB |  |  |
| `m2pro.medium` | 4 @ 3.49 GHz | 8GB |  |  |
| `m2pro.large` | 8 @ 3.49 GHz | 16GB |  |  |
| `macos.m1.medium.gen1` | 4 @ 3.2 GHz | 6GB |  |  |
| `macos.m1.large.gen1` | 8 @ 3.2 GHz | 12GB |  |  |

|     |     |
| --- | --- |
|  | **We have deprecated support for all Intel-based macOS resources.**<br>The `macos.x86.medium.gen2` resource class was deprecated on June 28, 2024.<br>See our [announcement](https://discuss.circleci.com/t/macos-intel-support-deprecation-in-january-2024/48718) for more details. |

**Example:**

```yaml
jobs:
  build:
    macos:
      xcode: "15.4.0"
    resource_class: m2pro.medium
    steps:
      ... // other config
```

* * *

##### macOS execution environment on server

If you are working on CircleCI server you can access the macOS execution environment using [self-hosted runner](https://circleci.com/docs/runner-overview/).

* * *

##### Windows execution environment

| Class | vCPUs | RAM | Disk Size | Cloud | Server |
| --- | --- | --- | --- | --- | --- |
| `windows.medium` (default) | 4 | 15GB | 200 GB |  |  |
| `windows.large` | 8 | 30GB | 200 GB |  |  |
| `windows.xlarge` | 16 | 60GB | 200 GB |  |  |
| `windows.2xlarge` | 32 | 128GB | 200 GB |  |  |

|     |     |
| --- | --- |
|  | **Using server?** Check with your systems administrator whether you have access to the Windows execution environment. |

**Example:**

CloudServer

```yaml
version: 2.1

jobs:
  build: # name of your job
    resource_class: 'windows.medium'
    machine:
      image: 'windows-server-2022-gui:current'
      shell: 'powershell.exe -ExecutionPolicy Bypass'
    steps:
      # Commands are run in a Windows virtual machine environment
      - checkout
      - run: Write-Host 'Hello, Windows'
```

* * *

##### GPU execution environment (Linux)

| Class | vCPUs | RAM | GPUs | GPU model | GPU Memory (GiB) | Disk Size (GiB) | Cloud | Server |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| `gpu.nvidia.small` | 4 | 16 | 1 | NVIDIA Tesla P4 | 16 | 150 |  |  |
| `gpu.nvidia.small.gen2` | 4 | 16 | 1 | NVIDIA A10G | 24 | 150 |  |  |
| `gpu.nvidia.small.multi` | 4 | 15 | 2 | NVIDIA Tesla T4 | 16 | 150 |  |  |
| `gpu.nvidia.medium.multi` | 8 | 30 | 4 | NVIDIA Tesla T4 | 16 | 150 |  |  |
| `gpu.nvidia.medium` | 8 | 30 | 1 | NVIDIA Tesla T4 | 16 | 150 |  |  |
| `gpu.nvidia.large` | 8 | 30 | 1 | NVIDIA Tesla V100 | 16 | 150 |  |  |

**Example:**

```yaml
version: 2.1

jobs:
  build:
    machine:
      image: linux-cuda-12:default
    resource_class: gpu.nvidia.medium
    steps:
      - run: nvidia-smi
      - run: docker run --gpus all nvidia/cuda:9.0-base nvidia-smi
```

See the [Available Linux GPU images](https://circleci.com/docs/configuration-reference/#available-linux-gpu-images) section for the full list of available images.

* * *

##### GPU execution-environment (Windows)

| Class | vCPUs | RAM | GPUs | GPU model | GPU Memory (GiB) | Disk Size (GiB) | Cloud | Server |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| `windows.gpu.nvidia.medium` | 16 | 60 | 1 | NVIDIA Tesla T4 | 16 | 200 |  |  |

**Example:**

```yaml
version: 2.1

orbs:
  win: circleci/windows@5.0.0

jobs:
  build:
    executor: win/server-2019-cuda
    steps:
      - checkout
      - run: '&"C:\Program Files\NVIDIA Corporation\NVSMI\nvidia-smi.exe"'
```

(2) _This resource requires review by our support team. [Open a support ticket](https://support.circleci.com/hc/en-us/requests/new) if you would like to request access._

* * *

##### Arm VM execution-environment

| Class | vCPUs | RAM | Disk Size | Cloud | Server |
| --- | --- | --- | --- | --- | --- |
| `arm.medium` (default) | 2 | 8GB | 100 GB |  |  |
| `arm.large` | 4 | 16GB | 100 GB |  |  |
| `arm.xlarge` | 8 | 32GB | 100 GB |  |  |
| `arm.2xlarge` | 16 | 64GB | 100 GB |  |  |

|     |     |
| --- | --- |
|  | **Using server?** Check with your systems administrator whether you have access to the Arm execution environment. |

**Example:**

CloudServer

```yaml
jobs:
  my-job:
    machine:
      image: ubuntu-2004:2024.01.2
    resource_class: arm.medium
    steps:
      - run: uname -a
      - run: echo "Hello, Arm!"
```

* * *

#### **`steps`**

The `steps` setting in a job should be a list of single key/value pairs, the key of which indicates the step type. The value may be either a configuration map or a string (depending on what that type of step requires). For example, using a map:

```yaml
jobs:
  build:
    docker:
      - image: cimg/base:2024.01
    working_directory: ~/canary-python
    environment:
      FOO: bar
    steps:
      - run:
          name: Running tests
          command: make test
```

Here `run` is a step type. The `name` attribute is used by the UI for display purposes. The `command` attribute is specific for `run` step and defines command to execute.

Some steps may implement a shorthand semantic. For example, `run` may be also be called like this:

```yml
jobs:
  build:
    docker:
      - image: cimg/base:2024.01
    steps:
      - run: make test
```

In its short form, the `run` step allows us to directly specify which `command` to execute as a string value. In this case step itself provides default suitable values for other attributes ( `name` here will have the same value as `command`, for example).

Another shorthand, which is possible for some steps, is to use the step name as a string instead of a key/value pair:

```yml
jobs:
  build:
    docker:
      - image: cimg/base:2024.01
    steps:
      - checkout
```

In this case, the `checkout` step will check out project source code into the job’s [`working_directory`](https://circleci.com/docs/configuration-reference/#jobs).

In general all steps can be described as:

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `<step_type>` | Y | Map or String | A configuration map for the step or some string whose semantics are defined by the step. |

Each built-in step is described in detail below.

* * *

##### **`run`**

The `run` step is used to invoke command-line programs. The `run` step takes either a map of configuration values, or, when called in its short-form, a string that will be used as both the `command` and `name`. Run commands are executed using non-login shells by default, so you must explicitly source any `dotfiles` as part of the command.

|     |     |
| --- | --- |
|  | the `run` step replaces the deprecated `deploy` step. If your job has a parallelism of 1, the deprecated `deploy` step can be swapped out directly for the `run` step. If your job has parallelism `> 1`, see [Migrate from deploy to run](https://circleci.com/docs/migrate-from-deploy-to-run/). |

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `command` | Y | String | Command to run via the shell |
| `name` | N | String | Title of the step to be shown in the CircleCI UI (default: full `command`) |
| `shell` | N | String | Shell to use for execution command (default: See [Default Shell Options](https://circleci.com/docs/configuration-reference/#default-shell-options)) |
| `environment` | N | Map | Additional environment variables, locally scoped to command |
| `background` | N | Boolean | Whether or not this step should run in the background (default: false) |
| `working_directory` | N | String | In which directory to run this step. Will be interpreted relative to the [`working_directory`](https://circleci.com/docs/configuration-reference/#jobs) of the job). (default: `.`) |
| `no_output_timeout` | N | String | Elapsed time the command can run without output. The string is a decimal with unit suffix, such as "20m", "1.25h", "5s". The default is 10 minutes and the maximum is governed by the [maximum time a job is allowed to run](https://circleci.com/docs/configuration-reference/#jobs). |
| `when` | N | String | [Specify when to enable or disable the step](https://circleci.com/docs/configuration-reference/#the-when-attribute). Takes the following values: `always`, `on_success`, `on_fail` (default: `on_success`) |

Each `run` declaration represents a new shell. It is possible to specify a multi-line `command`, each line of which will be run in the same shell.

**Example:**

```yml
jobs:
  my-job:
    docker:
      - image: cimg/base:2024.12
    resource_class: xlarge
    steps:
      - run:
          command: |
            echo Running test
            mkdir -p /tmp/test-results
            make test
```

You can also configure commands to run [in the background](https://circleci.com/docs/configuration-reference/#background-commands) if you do not want to wait for the step to complete before moving on to subsequent run steps.

* * *

###### _Default shell options_

For jobs that run on **Linux**, the default value of the `shell` option is `/bin/bash -eo pipefail` if `/bin/bash` is present in the build container. Otherwise it is `/bin/sh -eo pipefail`. The default shell is not a login shell ( `--login` or `-l` are not specified). Hence, the shell will **not** source your `~/.bash_profile`, `~/.bash_login`, `~/.profile` files.

For jobs that run on **macOS**, the default shell is `/bin/bash --login -eo pipefail`. The shell is a non-interactive login shell. The shell will execute `/etc/profile/` followed by `~/.bash_profile` before every step.

For more information about which files are executed when Bash is invocated, [see the `INVOCATION` section of the `bash` manpage](https://linux.die.net/man/1/bash).

Descriptions of the `-eo pipefail` options are provided below.

###### `-e`

Exit immediately if any of the following exits with a non-zero status:

- A pipeline (which may consist of a single simple command).

- A subshell command enclosed in parentheses.

- One of the commands executed as part of a command list enclosed by braces.


In the previous example, `mkdir` failed to create a directory and returned a non-zero status, then command execution would be terminated, and the whole step would be marked as failed. If you desire the opposite behaviour, you need to add `set +e` in your `command` or override the default `shell` in your configuration map of `run`. For example:

**Example:**

```yml
- run:
    command: |
      echo Running test
      set +e
      mkdir -p /tmp/test-results
      make test

- run:
    shell: /bin/sh
    command: |
      echo Running test
      mkdir -p /tmp/test-results
      make test
```

###### `-o pipefail`

If `pipefail` is enabled, the pipeline’s return status is the value of the last (rightmost) command to exit with a non-zero status, or zero if all commands exit successfully. The shell waits for all commands in the pipeline to terminate before returning a value.

**Example:**

```yml
- run: make test | tee test-output.log
```

If `make test` fails, the `-o pipefail` option will cause the whole step to fail. Without `-o pipefail`, the step will always run successfully because the result of the whole pipeline is determined by the last command ( `tee test-output.log`), which will always return a zero status.

|     |     |
| --- | --- |
|  | If `make test` fails the rest of pipeline will be executed. |

If you want to avoid this behaviour, you can specify `set +o pipefail` in the command or override the whole `shell` (see example above).

In general, we recommend using the default options ( `-eo pipefail`) because they show errors in intermediate commands and simplify debugging job failures. For convenience, the UI displays the used shell and all active options for each `run` step.

For more information, see the [Using Shell Scripts](https://circleci.com/docs/using-shell-scripts/) document.

* * *

###### _Background commands_

The `background` attribute enables you to configure commands to run in the background. Job execution will immediately proceed to the next step rather than waiting for return of a command with the `background` attribute set to `true`. The following example shows the configuration for running the X virtual framebuffer in the background which is commonly required to run Selenium tests.

**Example:**

```yml
- run:
    name: Running X virtual framebuffer
    command: Xvfb :99 -screen 0 1280x1024x24
    background: true

- run: make test
```

* * *

###### _Shorthand syntax_

`run` has a very convenient shorthand syntax.

**Example:**

```yml
- run: make test

# shorthanded command can also have multiple lines
- run: |
    mkdir -p /tmp/test-results
    make test
```

In this case, `command` and `name` become the string value of `run`, and the rest of the config map for that `run` have their default values.

* * *

###### The `when` attribute

By default, CircleCI will execute job steps one at a time, in the order that they are defined in `config.yml`, until a step fails (returns a non-zero exit code). After a command fails, no further job steps will be executed.

Adding the `when` attribute to a job step allows you to override this default behaviour, and selectively run or skip steps depending on the status of the job.

The `when` attribute accepts the following values:

`on_success`

The step will run only if all of the previous steps have been successful (returned exit code 0). `on_success` is the default value.

`always`

The step will run regardless of the exit status of previous steps. `always` is useful if you have a task that you want to run regardless of whether the previous steps are successful or not. For example, you might have a job step that needs to upload logs or code-coverage data somewhere.

`on_fail`

The step will run only if one of the preceding steps has failed (returns a non-zero exit code). A common use of `on_fail` is to store some diagnostic data to help debug test failures, or to run custom notifications about the failure, such as sending emails or triggering alerts.

|     |     |
| --- | --- |
|  | Some steps, such as `store_artifacts` and `store_test_results` will always run, even if a **step has failed** (returned a non-zero exit code) previously. The `when` attribute, `store_artifacts` and `store_test_results` are not run if the job has been **killed** by a cancel request or has reached the runtime timeout limit. |

**Example:**

```yml
- run:
    name: Upload CodeCov.io Data
    command: bash <(curl -s https://codecov.io/bash) -F unittests
    when: always # Uploads code coverage results, pass or fail
```

* * *

###### Ending a job from within a `step`

A job can exit without failing by using `run: circleci-agent step halt`. However, if a step within the job is already failing then the job will continue to fail. This can be useful in situations where jobs need to conditionally execute.

**Example:** `halt` is used to avoid running a job on the `develop` branch:

```yml
- run: |
    if [ "$CIRCLE_BRANCH" = "develop" ]; then
        circleci-agent step halt
    fi
```

* * *

##### **The `when` step**

|     |     |
| --- | --- |
|  | The `when` and `unless` steps are supported in `version: 2.1` configuration |

A conditional step consists of a step with the key `when` or `unless`. Under the `when` key are the subkeys `condition` and `steps`. The purpose of the `when` step is customizing commands and job configuration to run on custom conditions (determined at config-compile time) that are checked before a workflow runs. See the [Conditional Steps section of the reusable configuration reference](https://circleci.com/docs/reusing-config/#defining-conditional-steps) for more details.

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `condition` | Y | Logic | [A logic statement](https://circleci.com/docs/configuration-reference/#logic-statements) |
| `steps` | Y | Sequence | A list of steps to execute when the condition is true |

**Example:**

```yml
version: 2.1

jobs: # conditional steps may also be defined in `commands:`
  job_with_optional_custom_checkout:
    parameters:
      custom_checkout:
        type: string
        default: ""
    machine:
      image: ubuntu-2004:2024.11.1
    steps:
      - when:
          condition: <<parameters.custom_checkout>>
          steps:
            - run: echo "my custom checkout"
      - unless:
          condition: <<parameters.custom_checkout>>
          steps:
            - checkout
workflows:
  build-test-deploy:
    jobs:
      - job_with_optional_custom_checkout:
          custom_checkout: "any non-empty string is truthy"
      - job_with_optional_custom_checkout
```

* * *

##### **`checkout`**

|     |     |
| --- | --- |
|  | **Blobless clones**<br>A "blobless" strategy is being rolled out to help improve the performance of code checkouts from Git source code hosts.<br>Blobless clones reduce the amount of data fetched from the remote, by asking the remote to filter out objects that are not attached to the current commit.<br>While this improves performance in most cases, if a downstream step requires those objects to exist for scanning or comparisons, it can cause failures. To work around these potential problems, a fetch directly after a checkout will ensure the required data is available:<br>```yml<br>jobs:<br>  build:<br>    docker:<br>      - image: cimg/go:1.24.2<br>    steps:<br>      - checkout<br>      - run: git fetch<br>``` |

A special step used to check out source code to the configured `path` (defaults to the `working_directory`). The reason this is a special step is because it is more of a helper function designed to simplify the process of checking out code. If you require doing git over HTTPS you should not use this step as it configures git to checkout over SSH.

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `path` | N | String | Checkout directory. Will be interpreted relative to the [`working_directory`](https://circleci.com/docs/configuration-reference/#jobs) of the job). (default: `.`) |

If `path` already exists and is:

- A git repository - step will not clone whole repository, instead will fetch origin

- NOT a git repository - step will fail.


In the case of `checkout`, the step type is just a string with no additional attributes.

**Example:**

```yml
jobs:
  build:
    docker:
      - image: cimg/go:1.24.2
    steps:
      - checkout
```

The checkout command automatically adds the required authenticity keys for interacting with GitHub and Bitbucket over SSH. These keys are detailed further in the [integration guide](https://circleci.com/docs/github-integration/#establish-the-authenticity-of-an-ssh-host). This guide is also helpful if you wish to implement a custom checkout command.

CircleCI does not check out submodules. If your project requires submodules, add `run` steps with appropriate commands as shown in the following example:

```yml
jobs:
  build:
    docker:
      - image: cimg/go:1.24.2
    steps:
      - checkout
      - run: git submodule sync
      - run: git submodule update --init
```

|     |     |
| --- | --- |
|  | The `checkout` step will configure Git to skip automatic garbage collection. If you are caching your `.git` directory with [**`restore_cache`**](https://circleci.com/docs/configuration-reference/#restorecache) and would like to use garbage collection to reduce its size, you may wish to use a [**`run`**](https://circleci.com/docs/configuration-reference/#run) step with command `git gc` before doing so. |

* * *

##### **`setup_remote_docker`**

|     |     |
| --- | --- |
|  | - `setup_remote_docker` is not compatible with the `machine` executor. See [Docker Layer Caching in Machine Executor](https://circleci.com/docs/docker-layer-caching/#machine-executor) for information on how to enable DLC with the `machine` executor.<br>  <br>- The `version` key is not currently supported on CircleCI server. Contact your system administrator for information about the Docker version installed in your remote Docker environment. If you are on server 4.x, you can find the default AWS AMI [here](https://circleci.com/docs/server/latest/operator/manage-virtual-machines-with-machine-provisioner/#x86-ami-list). |

Allows Docker commands to be run locally. See [Running Docker commands](https://circleci.com/docs/building-docker-images/) for details.

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `docker_layer_caching` | N | boolean | Set this to `true` to enable [Docker Layer Caching](https://circleci.com/docs/docker-layer-caching/) in the Remote Docker Environment (default: `false`) |
| `version` | N | String | Version string of Docker you would like to use (default: `24.0.9`). View the list of supported Docker versions [here](https://circleci.com/docs/building-docker-images/#docker-version). |

**Example:**

```yaml
jobs:
  build:
    docker:
      - image: cimg/base:2024.06
    steps:
      # ... steps for building/testing app ...
      - setup_remote_docker:
          version: default
```

* * *

##### **`save_cache`**

Generates and stores a cache of a file or directory of files such as dependencies or source code. Caches are stored in CircleCI’s object storage. Later jobs can [restore this cache](https://circleci.com/docs/configuration-reference/#restorecache). Learn more on the [Caching dependencies](https://circleci.com/docs/caching/) page.

Cache retention can be customized on the [CircleCI web app](https://app.circleci.com/) by navigating to **Usage Controls**.

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `paths` | Y | List | List of directories which should be added to the cache |
| `key` | Y | String | Unique identifier for this cache |
| `name` | N | String | Title of the step to be shown in the CircleCI UI (default: "Saving Cache") |
| `when` | N | String | [Specify when to enable or disable the step](https://circleci.com/docs/configuration-reference/#the-when-attribute). Takes the following values: `always`, `on_success`, `on_fail` (default: `on_success`) |

The cache for a specific `key` is immutable and cannot be changed once written. If the cache for the given `key` already exists it will not be modified, and job execution will proceed to the next step.

When storing a new cache, the `key` value may contain special, templated, values for your convenience:

| Template | Description |
| --- | --- |
| `{{ .Branch }}` | The VCS branch currently being built. |
| `{{ .BuildNum }}` | The CircleCI build number for this build. |
| `{{ .Revision }}` | The VCS revision currently being built. |
| `{{ .CheckoutKey }}` | The SSH key used to checkout the repository. |
| `{{ .Environment.variableName }}` | The environment variable `variableName` (supports any environment variable [exported by CircleCI](https://circleci.com/docs/env-vars/) or added to a specific [context](https://circleci.com/docs/contexts/)--not any arbitrary environment variable). |
| `{{ checksum "filename" }}` | A base64 encoded SHA256 hash of the given filename’s contents. This should be a file committed in your repository and may also be referenced as a path that is absolute or relative from the current working directory. Good candidates are dependency manifests, such as `package-lock.json`, `pom.xml` or `project.clj`. It is important that this file does not change between `restore_cache` and `save_cache`, otherwise the cache will be saved under a cache key different than the one used at `restore_cache` time. |
| `{{ epoch }}` | The current time in seconds since the UNIX epoch. |
| `{{ arch }}` | The OS and CPU information. Useful when caching compiled binaries that depend on OS and CPU architecture, for example, `darwin amd64` versus `linux i386/32-bit`. |

During step execution, the templates above will be replaced by runtime values and the resultant string is used as the `key`.

**Template examples:**

`myapp-{{ checksum "package-lock.json" }}`

cache will be regenerated every time something is changed in `package-lock.json` file, different branches of this project will generate the same cache key.

`myapp-{{ .Branch }}-{{ checksum "package-lock.json" }}`

same as the previous one, but each branch will generate separate cache

`myapp-{{ epoch }}`

every run of a job will generate a separate cache

While choosing suitable templates for your cache `key`, keep in mind the following:

- Cache saving is not a free operation. See the billing section on the [FAQ](https://circleci.com/docs/faq/#calculate-monthly-storage-and-network-costs) page.

- It takes time to upload the cache.

- Best practice is to have a `key` that generates a new cache only if something actually changed and avoid generating a new one every time a job is run.

- Given the immutability of caches, it might be helpful to start all your cache keys with a version prefix `v1-...`. That way you will be able to regenerate all your caches just by incrementing the version in this prefix.


**Examples:**

```yml
- save_cache:
    key: v1-myapp-{{ arch }}-{{ checksum "project.clj" }}
    paths:
      - /home/ubuntu/.m2
```

```yml
- save_cache:
    key: v1-{{ checksum "yarn.lock" }}
    paths:
      - node_modules/workspace-a
      - node_modules/workspace-c
```

|     |     |
| --- | --- |
|  | Wildcards are not currently supported in `save_cache` paths. Visit the [Ideas board](https://ideas.circleci.com/cloud-feature-requests/p/support-wildcards-in-savecachepaths) and vote for this feature if it would be useful for you or your organization. |

* * *

##### **`restore_cache`**

Restores a previously saved cache based on a `key`. Cache needs to have been saved first for this key using the [`save_cache` step](https://circleci.com/docs/configuration-reference/#savecache). Learn more in [the caching documentation](https://circleci.com/docs/caching/).

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `key` | Y (1) | String | Single cache key to restore |
| `keys` | Y (1) | List | List of cache keys to lookup for a cache to restore. Only first existing key will be restored. |
| `name` | N | String | Title of the step to be shown in the CircleCI UI (default: "Restoring Cache") |

(1) at least one attribute has to be present. If `key` and `keys` are both given, `key` will be checked first, and then `keys`.

A key is searched against existing keys as a prefix.

|     |     |
| --- | --- |
|  | When there are multiple matches, the **most recent match** will be used, even if there is a more precise match. |

**Example:**

```yml
steps:
  - save_cache:
      key: v1-myapp-cache
      paths:
        - ~/d1

  - save_cache:
      key: v1-myapp-cache-new
      paths:
        - ~/d2

  - run: rm -f ~/d1 ~/d2

  - restore_cache:
      key: v1-myapp-cache
```

In this case cache `v1-myapp-cache-new` will be restored because it’s the most recent match with `v1-myapp-cache` prefix even if the first key ( `v1-myapp-cache`) has exact match.

For more information on key formatting, see the `key` section of [`save_cache` step](https://circleci.com/docs/configuration-reference/#savecache).

When CircleCI encounters a list of `keys`, the cache will be restored from the first key matching an existing cache. We recommend you use a more specific key first (for example, cache for exact version of `package-lock.json`) and more generic keys after (for example, any cache for this project). If no key has a cache that exists, the step will be skipped with a warning.

A path is not required here because the cache will be restored to the location from which it was originally saved.

**Example:**

```yml
- restore_cache:
    keys:
      - v1-myapp-{{ arch }}-{{ checksum "project.clj" }}
      # if cache for exact version of `project.clj` is not present then load any most recent one
      - v1-myapp-

# ... Steps building and testing your application ...

# cache will be saved only once for each version of `project.clj`
- save_cache:
    key: v1-myapp-{{ arch }}-{{ checksum "project.clj" }}
    paths:
      - /foo
```

* * *

##### **`deploy` \- DEPRECATED**

See [**`run`**](https://circleci.com/docs/configuration-reference/#run) for current processes. If you have parallelism `> 1` in your job, see the [Migrate from deploy to run](https://circleci.com/docs/migrate-from-deploy-to-run/) guide.

* * *

##### **`store_artifacts`**

Step to store artifacts (for example logs, binaries, etc) to be available in the web app or through the API. See the [Uploading Artifacts](https://circleci.com/docs/artifacts/) page for more information.

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `path` | Y | String | Directory in the primary container to save as job artifacts |
| `destination` | N | String | Prefix added to the artifact paths in the artifacts API (default: the directory of the file specified in `path`) |

There can be multiple `store_artifacts` steps in a job. Using a unique prefix for each step prevents them from overwriting files.

Artifact storage retention can be customized on the [CircleCI web app](https://app.circleci.com/) by navigating to **Usage Controls**.

**Example:**

```yml
- run:
    name: Build the Jekyll site
    command: bundle exec jekyll build --source jekyll --destination jekyll/_site/docs/
- store_artifacts:
    path: jekyll/_site/docs/
    destination: circleci-docs
```

* * *

##### **`store_test_results`**

Special step used to upload and store test results for a build. Test results are visible on the CircleCI web application under each build’s **Test Summary** section. Storing test results is useful for timing analysis of your test suites. For more information on storing test results, see the [Collecting Test Data](https://circleci.com/docs/collect-test-data/) page.

You can also store test results as build artifacts. For steps, refer to [the `store_artifacts` step](https://circleci.com/docs/configuration-reference/#storeartifacts) section.

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `path` | Y | String | Path (absolute, or relative to your `working_directory`) to directory containing `JUnit` XML test metadata files, or to a single test file. |

**Example:**

Directory structure:

```shell
test-results
├── jest
│   └── results.xml
├── mocha
│   └── results.xml
└── rspec
    └── results.xml
```

`config.yml` syntax:

```yml
- store_test_results:
    path: test-results
```

* * *

##### **`persist_to_workspace`**

Special step used to persist a temporary file to be used by another job in the workflow. For more information on using workspaces, see the [Using Workspaces to Share Data Between Jobs](https://circleci.com/docs/workspaces/) page.

`persist_to_workspace` adopts the storage settings from the storage customization controls on the CircleCI web app. If no custom setting is provided, `persist_to_workspace` defaults to 15 days.

Workspace storage retention can be customized on the [CircleCI web app](https://app.circleci.com/) by navigating to **Usage Controls**.

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `root` | Y | String | Either an absolute path or a path relative to `working_directory` |
| `paths` | Y | List | Glob identifying file(s), or a non-glob path to a directory to add to the shared workspace. Interpreted as relative to the workspace root. Must not be the workspace root itself. |

The root key is a directory on the container which is taken to be the root directory of the workspace. The path values are all relative to the root.

**Example for root Key:**

For example, the following step syntax persists the specified paths from `/tmp/dir` into the workspace, relative to the directory `/tmp/dir`.

```yml
- persist_to_workspace:
    root: /tmp/dir
    paths:
      - foo/bar
      - baz
```

After this step completes, the following directories are added to the workspace:

```
/tmp/dir/foo/bar
/tmp/dir/baz
```

**Example for paths Key:**

```yml
- persist_to_workspace:
    root: /tmp/workspace
    paths:
      - target/application.jar
      - build/*
```

The `paths` list uses `Glob` from Go, and the pattern matches [filepath.Match](https://golang.org/pkg/path/filepath/#Match).

```none
pattern:
        { term }
term:
        '*' matches any sequence of non-Separator characters
        '?' matches any single non-Separator character
        '[' [ '^' ] { character-range }\
        ']' character class (must be non-empty)
        c matches character c (c != '*', '?', '\\', '[')\
        '\\' c matches character c\
character-range:\
        c matches character c (c != '\\', '-', ']')
        '\\' c matches character c
        lo '-' hi matches character c for lo <= c <= hi
```

The Go documentation states that the pattern may describe hierarchical names such as `/usr/*/bin/ed` (assuming the Separator is '/').

|     |     |
| --- | --- |
|  | Everything must be relative to the work space root directory. |

* * *

##### **`attach_workspace`**

Special step used to attach the workflow’s workspace to the current container. The full contents of the workspace are downloaded and copied into the directory the workspace is being attached at. For more information on using workspaces, see the [Using workspaces](https://circleci.com/docs/workspaces/) page.

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `at` | Y | String | Directory to attach the workspace to. |

Workspace storage retention can be customized on the [CircleCI web app](https://app.circleci.com/) by navigating to **Usage Controls**.

**Example:**

```yml
- attach_workspace:
    at: /tmp/workspace
```

|     |     |
| --- | --- |
|  | The lifetime of artifacts, workspaces, and caches can be customized on the [CircleCI web app](https://app.circleci.com/) by navigating to **Usage Controls**. Here you can control the storage retention periods for these objects. If no storage period is set, the default storage retention period of artifacts is 30 days, while the default storage retention period of workspaces and caches is 15 days. |

* * *

##### **`add_ssh_keys`**

Special step that adds SSH keys from a project’s settings to a container. Also configures SSH to use these keys. For more information on SSH keys see the [Create additional GitHub SSH keys](https://circleci.com/docs/github-integration/#create-additional-github-ssh-keys) page.

|     |     |
| --- | --- |
|  | **Using server?** only MD5 fingerprints are supported. In CircleCI in **SSH keys** **Additional SSH keys** the MD5 fingerprint will be visible. SHA256 support is planned for an upcoming server release. |

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `fingerprints` | N | List | List of fingerprints corresponding to the keys to be added (default: all keys added) |

```yaml
steps:
  - add_ssh_keys:
      fingerprints:
        - "b7:35:a6:4e:9b:0d:6d:d4:78:1e:9a:97:2a:66:6b:be"
        - "SHA256:NPj4IcXxqQEKGXOghi/QbG2sohoNfvZ30JwCcdSSNM0"
```

|     |     |
| --- | --- |
|  | Even though CircleCI uses `ssh-agent` to sign all added SSH keys, you **must** use the `add_ssh_keys` key to actually add keys to a container. |

* * *

##### Using `pipeline` values

Pipeline values are available to all pipeline configurations and can be used without previous declaration. For a list of pipeline values, see the [Pipeline values and parameters](https://circleci.com/docs/pipeline-variables/) page.

**Example:**

```yaml
version: 2.1
jobs:
  build:
    docker:
      - image: cimg/node:20.18.1
    environment:
      IMAGETAG: latest
    working_directory: ~/main
    steps:
      - run: echo "This is pipeline ID << pipeline.id >>"
```

* * *

#### **`circleci_ip_ranges`**

|     |     |
| --- | --- |
|  | A paid account on a [Performance or Scale Plan](https://circleci.com/pricing) is required to access IP ranges. |

Enables jobs to go through a set of well-defined IP address ranges. See [IP ranges](https://circleci.com/docs/ip-ranges/) for details.

**Example:**

```yaml
version: 2.1

jobs:
  build:
    circleci_ip_ranges: true # opts the job into the IP ranges feature
    docker:
      - image: curlimages/curl
    steps:
      - run: echo “Hello World”
workflows:
  build-workflow:
    jobs:
      - build
```

* * *

## **`workflows`**

Used for orchestrating all jobs. Each workflow consists of the workflow name as a key and a map as a value. A name should be unique within the current `config.yml`. The top-level keys for the Workflows configuration are `version` and `jobs`. For more information, see the [Using Workflows to Orchestrate Jobs](https://circleci.com/docs/workflows/) page.

* * *

### **`version`**

|     |     |
| --- | --- |
|  | The workflows `version` key is **not** required for `version: 2.1` configuration |

The Workflows `version` field is used to issue warnings for deprecation or breaking changes.

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `version` | Y if config version is `2` | String | Should currently be `2` |

```yml
workflows:
  version: 2
  my-workflow:
    jobs:
      - my-job
```

* * *

### **< `workflow_name` >**

A unique name for your workflow.

```yml
workflows:
  my-workflow:
    jobs:
      - my-job
```

* * *

#### **`triggers`**

Specifies which triggers will cause this workflow to be executed. Default behavior is to trigger the workflow when pushing to a branch.

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `triggers` | N | Array | Should currently be `schedule`. |

```yml
workflows:
   nightly:
     triggers:
       - schedule:
           cron: "0 0 * * *"
           filters:
             branches:
               only:
                 - main
                 - beta
     jobs:
       - test
```

* * *

##### **`schedule`**

|     |     |
| --- | --- |
|  | Scheduled workflows are not available for projects integrated through the GitHub App, GitLab or Bitbucket Data Center. |

|     |     |
| --- | --- |
|  | The scheduled workflows feature is set to be deprecated. Using **scheduled pipelines** rather than scheduled workflows offers several benefits. Visit the scheduled pipelines [migration guide](https://circleci.com/docs/migrate-scheduled-workflows-to-scheduled-pipelines/) to find out how to migrate existing scheduled workflows to scheduled pipelines. If you would like to set up scheduled pipelines from scratch, visit the [Scheduled pipelines](https://circleci.com/docs/scheduled-pipelines/) page. |

A workflow may have a `schedule` indicating it runs at a certain time, for example a nightly build that runs every day at 12am UTC:

```yml
workflows:
   nightly:
     triggers:
       - schedule:
           cron: "0 0 * * *"
           filters:
             branches:
               only:
                 - main
                 - beta
     jobs:
       - test
```

* * *

###### **`cron`**

The `cron` key is defined using POSIX `crontab` syntax.

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `cron` | Y | String | See the [`crontab` man page](https://pubs.opengroup.org/onlinepubs/7908799/xcu/crontab.html). |

```yml
workflows:
   nightly:
     triggers:
       - schedule:
           cron: "0 0 * * *"
           filters:
             branches:
               only:
                 - main
                 - beta
     jobs:
       - test
```

* * *

###### **`filters`**

Trigger filters can have the key `branches`.

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `filters` | Y | Map | A map defining rules for execution on specific branches |

```yml
workflows:
   nightly:
     triggers:
       - schedule:
           cron: "0 0 * * *"
           filters:
             branches:
               only:
                 - main
                 - beta
     jobs:
       - test
```

* * *

###### **`branches`**

The `branches` key controls whether the _current_ branch should have a schedule trigger created for it, where _current_ branch is the branch containing the `config.yml` file with the `trigger` stanza. That is, a push on the `main` branch will only schedule a [workflow](https://circleci.com/docs/workflows/#using-filters-in-your-workflows) for the `main` branch.

Branches can have the keys `only` and `ignore` which each map to a single string naming a branch. You may also use regular expressions to match against branches by enclosing them with \`/’s, or map to a list of such strings. Regular expressions must match the **entire** string.

- Any branches that match `only` will run the job.

- Any branches that match `ignore` will not run the job.

- If neither `only` nor `ignore` are specified then all branches will run the job. If both `only` and `ignore` are specified, the `only` is used and `ignore` will have no effect.


```yaml
workflows:
  commit:
    jobs:
      - test
      - deploy
  nightly:
    triggers:
      - schedule:
          cron: "0 0 * * *"
          filters:
            branches:
              only:
                - main
                - /^release\/.*/
    jobs:
      - coverage
```

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `branches` | Y | Map | A map defining rules for execution on specific branches |
| `only` 1 | N | String, or List of Strings | Either a single branch specifier, or a list of branch specifiers |
| `ignore` 1 | N | String, or List of Strings | Either a single branch specifier, or a list of branch specifiers |

1: One of either `only` or `ignore` branch filters must be specified. If both are present, `only` is used.

* * *

#### **Using `when` in workflows**

|     |     |
| --- | --- |
|  | Using `when` or `unless` under `workflows` is supported in `version: 2.1` configuration. Workflows are always run unless there is a when or unless filter that prevents the workflow from being run. If you want a workflow to run in every pipeline, do not add a when or unless filter. |

You may use a `when` clause (the inverse clause `unless` is also supported) under a workflow declaration with a [logic statement](https://circleci.com/docs/configuration-reference/#logic-statements) to determine whether or not to run that workflow.

The example configuration below uses a pipeline parameter, `run_integration_tests` to drive the `integration_tests` workflow.

```yaml
version: 2.1

workflows:
  integration_tests:
    when: pipeline.git.branch == "main"
    jobs:
      - mytestjob

jobs:
...
```

This example prevents the workflow `integration_tests` from running unless the pipeline is triggered on the `main` branch.

Refer to the [Workflows](https://circleci.com/docs/workflows/) for more examples and conceptual information.

* * *

#### **`jobs`**

A job can have the keys `requires`, `name`, `context`, `type`, and `filters`.

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `jobs` | Y | List | A list of jobs to run with their dependencies |

* * *

##### **< `job_name` >**

A job name that exists in your `config.yml`.

```ym
version: 2.1

jobs:
  my-job:
    docker:
      - image: cimg/node:20.18.1
    steps:
      - run: echo "Hello World"

workflows:
  my-workflow:
    jobs:
      - my-job
```

* * *

###### **`override-with`**

The `override-with` key is used to override the job configuration with a job from the referenced orb.

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `override-with` | N | String | The orb job name that will be used to override the existing job configuration. (Both URL-based and registry orbs are supported) |

**Example:**

```yml
version: 2.1

orbs:
  my-orb: << url-ref >>

jobs:
  build:
    steps:
      - run: task build
  test:
    steps:
      - run: task test
  deploy:
    steps:
      - run: ccc deploy

workflows:
  - build-test-deploy:
      jobs:
        - build
        - test:
            override-with: my-orb/my-test
            requires: build
        - deploy:
            requires: test
```

In the example above, the `test` job in the workflow is being overridden with the orb job `my-orb/my-test`. The `my-orb/my-test` job might be defined with a different resource class or execution steps.

If the `my-orb/my-test` job is not defined inside the orb, the `test` job will compile using the local job definition.

* * *

###### `serial-group`

The `serial-group` key is used to add a property to a job to allow a group of jobs to run in series, rather than concurrently, across an organization. Serial groups control the orchestration of jobs across an organization, not just within projects and pipelines.

The `serial-group` key is configurable per job. It is not possible to configure the key for a group of jobs at this time.

The value of the `serial-group` key is a string that is used to group jobs together to run one after another. The key must meet the following requirements:

- Must be less than or equal to (≤) 512 characters, once compiled.

- Must not be blank.

- Must consist of alphanumeric characters plus, `.`, `-`, `_`, `/`.


Note the following features of serial groups:

- You can use pipeline values and parameters in the `serial-group` key.

- Serial groups will wait for five hours. After this jobs waiting in the group will be cancelled. This does not affect the standard limits that apply to a [job’s runtime](https://circleci.com/docs/configuration-reference/#jobs).


|     |     |
| --- | --- |
|  | **Pipeline order protection in serial groups**<br>Jobs in a serial group follow an order protection mechanism, as follows:<br>- Jobs start in the order they join the queue, but are _accepted_ based on pipeline number.<br>  <br>- If a group is waiting/running and another job in the same project attempts to join the queue with a lower pipeline number, the job is skipped.<br>  <br>- This immediate skip process exists to maintain order integrity, which is a safety process to avoid unexpected work in a build, for example, a deployment job running a previous version unexpectedly.<br>  <br>If there are no serial groups waiting/running, a pipeline with a lower number can start, such as restoring back to a previous pipeline via a rerun workflow. |

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `serial-group` | N | String | A string that is used across an org to group jobs together to run one after another. Can include pipeline values and parameters. Use this same serial group across multiple pipelines to control the orchestration of jobs across an organization. |

**Example:**

```yml
# Creating multiple pipelines at the same time with the below config will results in
# all pipelines running test and build but only a single pipeline will run deploy at a time.

workflows:
  main-workflow:
    jobs:
      - test
      - build
      - deploy:
          serial-group: << pipeline.project.slug >>/deploy-group
          requires:
            - test
            - build
```

For more information, see the [Controlling serial execution across your organization](https://circleci.com/docs/controlling-serial-execution-across-your-organization/) page.

* * *

###### **`requires`**

Jobs are run concurrently by default, so you must explicitly require any dependencies by their job name if you need some jobs to run sequentially.

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `requires` | N | List | A list of jobs that must succeed or attain a specified status for the job to start. **Note**: When jobs in the current workflow that are listed as dependencies are not executed (due to a filter function for example), their requirement as a dependency for other jobs will be ignored by the requires option. However, if all dependencies of a job are filtered, then that job will not be executed either.<br>Possible types of `requires` items:<br>- Job name (a required job that must succeed for the job to start)<br>  <br>- Map of job name to status (a required job that must attain the specified status for the job to start)<br>  <br>- Map of job name to a list of statuses (a required job that must attain one of the specified status for the job to start)<br>  <br>The possible **status** values are: `success`, `failed` and `canceled`. |

```yml
workflows:
  my-workflow:
    jobs:
      - build
      - test:
          requires:
            - build
      - deploy:
          requires:
            - build
            - test
      - notify-build-canceled:
          requires:
            - build: canceled
      - cleanup:
          requires:
            - deploy:
              - failed
              - canceled
```

* * *

###### **`name`**

The `name` key can be used to invoke reusable jobs across any number of workflows. Using the name key ensures numbers are not appended to your job name (for example, sayhello-1 , sayhello-2, etc.). The name you assign to the `name` key needs to be unique, otherwise the numbers will still be appended to the job name.

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `name` | N | String | A replacement for the job name. Useful when calling a job multiple times. If you want to invoke the same job multiple times, and a job requires one of the duplicate jobs, this key is required. (2.1 only) |

```yml
workflows:
  my-workflow:
    jobs:
      - my-job:
          name: my-alternative-job-name
```

* * *

###### **`context`**

Jobs may be configured to use global environment variables set for an organization, see the [Contexts](https://circleci.com/docs/contexts/) document for adding a context in the application settings.

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `context` | N | String/List | The name of the context(s). The initial default name is `org-global`. Each context name must be unique. If using CircleCI server, only a single context per workflow is supported. **Note:** A maximum of 100 unique contexts across all workflows is allowed. |

```yml
workflows:
  my-workflow:
    jobs:
      - my-job:
          context: org-global
```

It is also possible to use a list of contexts, as follows:

```yml
workflows:
  my-workflow:
    jobs:
      - my-job:
          context:
            - org-global
            - project-global
```

* * *

###### **`type`**

A job may have a `type` of `approval` indicating it must be manually approved before downstream jobs may proceed. For more information see the [Using workflows to orchestrate jobs](https://circleci.com/docs/workflows/#holding-a-workflow-for-a-manual-approval) page.

Jobs run in the dependency order until the workflow processes a job with the `type: approval` key followed by a job on which it depends, for example:

```yml
workflows:
  my-workflow:
    jobs:
      - build
      - test:
          requires:
            - build
      - hold:
          type: approval
          requires:
            - test
      - deploy:
          requires:
            - hold
```

An approval job can have any name. In the example above the approval job is named `hold`. The name you choose for an approval job should not be used to define a job in the main configuration. An approval job only exists as a workflow orchestration devise.

* * *

###### **`filters`**

Filter job execution within a workflow based on the following:

- Branch

- Tag

- Expression-based condition


Job filters can have the keys `branches` or `tags`.

|     |     |
| --- | --- |
|  | Workflows will ignore job-level branching. If you use job-level branching and later add workflows, you must remove the branching at the job level and instead declare it in the workflows section of your `config.yml`. |

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `filters` | N | Map | A map or string to define rules for job execution. Branch and tag filters require a map. Expression-based filters require a string. |

The following is an example of how the CircleCI documentation project uses a regular expression to filter running a job in a workflow only on a specific branch:

```yaml
# ...
workflows:
  build-deploy:
    jobs:
      - js_build
      - build_server_pdfs: # << the job to conditionally run based on the filter-by-branch-name.
          filters:
            branches:
              only: /server\/.*/ # the job build_server_pdfs will only run when the branch being built starts with server/
```

You can read more about using regular expressions in your config in the [Using workflows to schedule jobs](https://circleci.com/docs/workflows/#using-regular-expressions-to-filter-tags-and-branches) page.

* * *

###### Expression-based job filters

Expression-based job filters allow you to conditionally run jobs based on the following:

- [Pipeline values](https://circleci.com/docs/variables/#pipeline-values)

- [Pipeline parameters](https://circleci.com/docs/pipeline-variables/#pipeline-parameters-in-configuration)


An expression-based job filter is a rule that is evaluated against pipeline values and parameters to decide whether a job should run.

Using expression-based job filters is one way to optimize your pipelines. Optimizations include the following:

- Lower costs.

- Decrease time to feedback.

- Run specific jobs based on the context of the source of change.


```yml
workflows:
  deploy:
    jobs:
      - init-service
      - test-service
      - build-service-image:
          requires:
            - init-service
      - dry-run-service:
          requires:
            - init-service
          filters: pipeline.git.branch != "main" and pipeline.git.branch != "canary"
      - publish-service:
          requires:
            - build-service-image
            - test-service
          filters: pipeline.git.branch == "main" or pipeline.git.tag starts-with "release"
      - deploy-service:
          context:
            - org-global
          requires:
            - publish-service
          filters: pipeline.git.branch == "main" and pipeline.parameters.my-custom-param starts-with "DEPLOY:"
```

**Examples:**

Only run the job on the project’s `main` branch:

```yml
filters: pipeline.git.branch == "main"
```

Only run the job on the project’s `main` branch, or branches starting with `integration-test`:

```yml
filters: pipeline.git.branch == "main" or pipeline.git.branch starts-with "integration-test"
```

Only run the job on the `main` branch, and disallow use with pipelines [triggered with unversioned configuration](https://circleci.com/docs/vs-code-extension-overview/#test-run-your-config-from-vs-code):

```yml
filters: pipeline.git.branch == "main" and not (pipeline.trigger_source starts-with "api")
```

Use pipeline parameters and the pipeline value `pipeline.git.branch` to run a job only on specific branches **or** when triggered via the API with a pipeline parameter set to true:

```yml
version: 2.1

parameters:
  run-storybook-tests:
    type: boolean
    default: false

...
# jobs configuration ommitted for brevity

workflows:
  build:
    jobs:
      - setup
      - storybook-tests:
          requires:
            - setup
          filters: |
            pipeline.parameters.run-storybook-tests
            or pipeline.git.branch == "dry-run-deploy"
            or pipeline.git.branch starts-with "deploy"
```

You can use the API to trigger a pipeline with a pipeline parameter set to true:

|     |     |
| --- | --- |
|  | **Using server?** If you are using CircleCI server, replace `https://circleci.com` with your server hostname when interacting with the CircleCI API. |

```yml
curl -X POST https://circleci.com/api/v2/project/circleci/<org-id>/<project-id>/pipeline/run \
  --header "Circle-Token: $CIRCLE_TOKEN" \
  --header "content-type: application/json" \
  --data {
  "definition_id": "<pipeline-definition-id>",
  "config": {"branch": "<your-branch-name>"},
  "checkout": {"branch": "<your-branch-name>"},
  "parameters": {"run-storybook-tests": "true"}
  }
```

**Operators**

The operators you can use for expression-based job filters are described in the following table. You can also group sub-expressions with parentheses `(`, `)`. as in the examples above.

| Operator type | Operators | Description |
| --- | --- | --- |
| Logical | `and`, `or` | These are short-circuiting boolean operators. |
| Equality | `==`, `!=` | String, numeric, and boolean equality. If the operands are of different types then `==` will evaluate `false`, and `!=` will evaluate `true`. |
| Equality | `starts-with` | String prefix equality, `"hello world" starts-with "hello"` evaluates as `true`. It is an error to use a non-string type as an operand. |
| Numeric comparison | `>=`, `>`, `⇐`, `<` | Numeric comparisons. It is an error to use a non-numeric type as an operand. |
| Negation | `not` | Boolean negation.<br>Note that `not` has very high precedence and so binds very tightly. Use sub-expressions to apply `not` to more complex expressions. For example, with `foo` being `true` and `bar` being `false`:<br>- `not foo and bar` evaluates to `false`<br>  <br>- `not (foo and bar)` evaluates to `true` |

* * *

###### **`branches`**

The branches filter can have the keys `only` and `ignore`, which map to a single string naming a branch. You may also use regular expressions to match against branches by enclosing them with slashes, or map to a list of such strings. Regular expressions must match the **entire** string.

- Any branches that match `only` will run the job.

- Any branches that match `ignore` will not run the job.

- If neither `only` nor `ignore` are specified then all branches will run the job.

- If both `only` and `ignore` are specified the `only` is considered before `ignore`.


| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `branches` | N | Map | A map defining rules for execution on specific branches. |
| `only` | N | String, or list of strings | Either a single branch specifier, or a list of branch specifiers. |
| `ignore` | N | String, or list of strings | Either a single branch specifier, or a list of branch specifiers. |

```yaml
workflows:
  dev_stage_pre-prod:
    jobs:
      - test_dev:
          filters:  # using regex filters requires the entire branch to match
            branches:
              only:  # only branches matching the below regex filters will run
                - dev
                - /user-.*/
      - test_stage:
          filters:
            branches:
              only: stage
      - test_pre-prod:
          filters:
            branches:
              only: /pre-prod(?:-.+)?$/
```

* * *

###### **`tags`**

CircleCI does not run workflows for tags unless you explicitly specify tag filters. If a job requires any other jobs (directly or indirectly), you must specify tag filters for those jobs.

Tags can have the keys `only` and `ignore`. You may also use regular expressions to match against tags by enclosing them with slashes, or map to a list of such strings. Regular expressions must match the **entire** string. Both lightweight and annotated tags are supported.

- Any tags that match `only` will run the job.

- Any tags that match `ignore` will not run the job.

- If neither `only` nor `ignore` are specified then the job is skipped for all tags.

- If both `only` and `ignore` are specified the `only` is considered before `ignore`.


| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `tags` | N | Map | A map defining rules for execution on specific tags |
| `only` | N | String, or List of Strings | Either a single tag specifier, or a list of tag specifiers |
| `ignore` | N | String, or List of Strings | Either a single tag specifier, or a list of tag specifiers |

For more information, see the [Executing workflows for a git tag](https://circleci.com/docs/workflows/#executing-workflows-for-a-git-tag) section of the Workflows page.

```yaml
workflows:
  untagged-build:
    jobs:
      - build
  tagged-build:
    jobs:
      - build:
          filters:
            tags:
              only: /^v.*/
```

* * *

###### **`matrix`**

|     |     |
| --- | --- |
|  | The `matrix` key is supported in `version: 2.1` configuration |

The `matrix` stanza allows you to run a parameterized job multiple times with different arguments. For more information see the how-to guide on [Using Matrix Jobs](https://circleci.com/docs/using-matrix-jobs/). In order to use the `matrix` stanza, you must use parameterized jobs.

| Key | Required | Type | Description |
| --- | --- | --- | --- |
| `parameters` | Y | Map | A map of parameter names to every value the job should be called with |
| `exclude` | N | List | A list of argument maps that should be excluded from the matrix |
| `alias` | N | String | An alias for the matrix, usable from another job’s `requires` stanza. Defaults to the name of the job being executed |

**Example:**

The following is a basic example of using matrix jobs.

```yaml
workflows:
  workflow:
    jobs:
      - build:
          matrix:
            parameters:
              version: ["0.1", "0.2", "0.3"]
              platform: ["macos", "windows", "linux"]
```

This expands to 9 different `build` jobs, and could be equivalently written as:

```yaml
workflows:
  workflow:
    jobs:
      - build:
          name: build-macos-0.1
          version: "0.1"
          platform: macos
      - build:
          name: build-macos-0.2
          version: "0.2"
          platform: macos
      - build:
          name: build-macos-0.3
          version: "0.3"
          platform: macos
      - build:
          name: build-windows-0.1
          version: "0.1"
          platform: windows
      - ...
```

* * *

###### Excluding sets of parameters from a matrix

Sometimes you may wish to run a job with every combination of arguments _except_ some value or values. You can use an `exclude` stanza to achieve this:

```yaml
workflows:
  workflow:
    jobs:
      - build:
          matrix:
            parameters:
              a: [1, 2, 3]
              b: [4, 5, 6]
            exclude:
              - a: 3
                b: 5
```

The matrix above would expand into 8 jobs: every combination of the parameters `a` and `b`, excluding `{a: 3, b: 5}`

* * *

###### Dependencies and matrix jobs

To require an entire matrix (every job within the matrix), use its `alias`. The `alias` defaults to the name of the job being invoked.

```yaml
workflows:
  workflow:
    jobs:
      - deploy:
          matrix:
            parameters:
              version: ["0.1", "0.2"]
      - another-job:
          requires:
            - deploy
```

This means that `another-job` will require both deploy jobs in the matrix to finish before it runs.

Matrix jobs expose their parameter values via `<< matrix.* >>` which can be used to generate more complex workflows. For example, here is a `deploy` matrix where each job waits for its respective `build` job in another matrix.

```yaml
workflows:
  workflow:
    jobs:
      - build:
          name: build-v<< matrix.version >>
          matrix:
            parameters:
              version: ["0.1", "0.2"]
      - deploy:
          name: deploy-v<< matrix.version >>
          matrix:
            parameters:
              version: ["0.1", "0.2"]
          requires:
            - build-v<< matrix.version >>
```

This workflow will expand to:

```yaml
workflows:
  workflow:
    jobs:
      - build:
          name: build-v0.1
          version: "0.1"
      - build:
          name: build-v0.2
          version: "0.2"
      - deploy:
          name: deploy-v0.1
          version: "0.1"
          requires:
            - build-v0.1
      - deploy:
          name: deploy-v0.2
          version: "0.2"
          requires:
            - build-v0.2
```

* * *

###### **`pre-steps`** and **`post-steps`**

|     |     |
| --- | --- |
|  | Pre-steps and post-steps are supported in `version: 2.1` configuration |

Every job invocation in a workflow may optionally accept two special arguments: `pre-steps` and `post-steps`.

Steps under `pre-steps` are executed before any of the other steps in the job. The steps under `post-steps` are executed after all of the other steps.

Pre and post steps allow you to execute steps in a given job without modifying the job. Pre and post steps are useful, for example, to run custom setup steps before job execution.

```yaml
version: 2.1

jobs:
  bar:
    machine:
      image: ubuntu-2004:2024.05.1
    steps:
      - checkout
      - run:
          command: echo "building"
      - run:
          command: echo "testing"

workflows:
  build:
    jobs:
      - bar:
          pre-steps: # steps to run before steps defined in the job bar
            - run:
                command: echo "install custom dependency"
          post-steps: # steps to run after steps defined in the job bar
            - run:
                command: echo "upload artifact to s3"
```

* * *

## Logic statements

Certain dynamic configuration features accept logic statements as arguments. Logic statements are evaluated to boolean values at configuration compilation time, that is, before the workflow is run. The group of logic statements includes:

| Type | Arguments | `true` if | Example |
| --- | --- | --- | --- |
| YAML literal | None | is truthy | `true`/ `42`/ `"a string"` |
| YAML alias | None | resolves to a truthy value | \*my-alias |
| [Pipeline Value](https://circleci.com/docs/pipeline-variables/#pipeline-values) | None | resolves to a truthy value | `<< pipeline.git.branch >>` |
| [Pipeline Parameter](https://circleci.com/docs/pipeline-variables/#pipeline-parameters-in-configuration) | None | resolves to a truthy value | `<< pipeline.parameters.my-parameter >>` |
| `and` | N logic statements | all arguments are truthy | `and: [ true, true, false ]` |
| `or` | N logic statements | any argument is truthy | `or: [ false, true, false ]` |
| `not` | 1 logic statement | the argument is not truthy | `not: true` |
| `equal` | N values | all arguments evaluate to equal values | `equal: [ 42, << pipeline.number >>]` |
| `matches` | `pattern` and `value` | `value` matches the `pattern` | `matches: { pattern: "^feature-.$", value: << pipeline.git.branch >> }+` |

The following logic values are considered falsy:

- false

- null

- 0

- NaN

- empty strings ("")

- statements with no arguments


All other values are truthy. Also note that using logic with an empty list will cause a validation error.

Logic statements always evaluate to a boolean value at the top level, and coerce as necessary. They can be nested in an arbitrary fashion, according to their argument specifications, and to a maximum depth of 100 levels.

`matches` uses [Java regular expressions](https://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html) for its `pattern`. A full match pattern must be provided, prefix matching is not an option. Though, it is recommended to enclose a pattern in `^` and `$` to avoid accidental partial matches.

|     |     |
| --- | --- |
|  | When using logic statements at the workflow level, do not include the `condition:` key (the `condition` key is only needed for `job` level logic statements). |

**Example:**

```yaml
workflows:
  my-workflow:
    when:
      or:
        - equal: [ main, << pipeline.git.branch >> ]
        - equal: [ staging, << pipeline.git.branch >> ]
```

### Logic statement examples

You can find usage examples on the ["Orchestration cookbook"](https://circleci.com/docs/orchestration-cookbook/) page.

## Example full configuration

|     |     |
| --- | --- |
|  | **Using Docker?** Authenticating Docker pulls from image registries is recommended when using the Docker execution environment. Authenticated pulls allow access to private Docker images, and may also grant higher rate limits, depending on your registry provider. For further information see [Using Docker authenticated pulls](https://circleci.com/docs/private-images/). |

```yaml
version: 2.1
jobs:
  build:
    docker:
      - image: ubuntu:23.04

      - image: mongo:6.0.14
        command: [mongod, --smallfiles]

      - image: postgres:14.12
        # some containers require setting environment variables
        environment:
          POSTGRES_USER: user

      - image: redis@sha256:54057dd7e125ca41afe526a877e8bd35ec2cdd33b9217e022ed37bdcf7d09673

      - image: rabbitmq:3.12.12

    environment:
      TEST_REPORTS: /tmp/test-reports

    working_directory: ~/my-project

    steps:
      - checkout

      - run:
          command: echo 127.0.0.1 devhost | sudo tee -a /etc/hosts

      # Create Postgres users and database
      # Note the YAML heredoc '|' for nicer formatting
      - run: |
          sudo -u root createuser -h localhost --superuser ubuntu &&
          sudo createdb -h localhost test_db

      - restore_cache:
          keys:
            - v1-my-project-{{ checksum "project.clj" }}
            - v1-my-project-

      - run:
          environment:
            SSH_TARGET: "localhost"
            TEST_ENV: "linux"
          command: |
            set -xu
            mkdir -p ${TEST_REPORTS}
            run-tests.sh
            cp out/tests/*.xml ${TEST_REPORTS}

      - run: |
          set -xu
          mkdir -p /tmp/artifacts
          create_jars.sh << pipeline.number >>
          cp *.jar /tmp/artifacts

      - save_cache:
          key: v1-my-project-{{ checksum "project.clj" }}
          paths:
            - ~/.m2

      # Save artifacts
      - store_artifacts:
          path: /tmp/artifacts
          destination: build

      # Upload test results
      - store_test_results:
          path: /tmp/test-reports

  deploy-stage:
    docker:
      - image: ubuntu:23.04
    working_directory: /tmp/my-project
    steps:
      - run:
          name: Deploy if tests pass and branch is Staging
          command: ansible-playbook site.yml -i staging

  deploy-prod:
    docker:
      - image: ubuntu:23.04
    working_directory: /tmp/my-project
    steps:
      - run:
          name: Deploy if tests pass and branch is Main
          command: ansible-playbook site.yml -i production

workflows:
  build-deploy:
    jobs:
      - build:
          filters:
            branches:
              ignore:
                - develop
                - /feature-.*/
      - deploy-stage:
          requires:
            - build
          filters:
            branches:
              only: staging
      - deploy-prod:
          requires:
            - build
          filters:
            branches:
              only: main
```

* * *

#### Suggest an edit to this page

[Make a contribution](https://github.com/circleci/circleci-docs/blob/master/jekyll/_cci2/configuration-reference.adoc)[Learn how to contribute](https://github.com/circleci/circleci-docs/blob/master/docs/CONTRIBUTING.md#contributing-to-circleci-docs)

#### Still need help?

[Ask the CircleCI community](https://discuss.circleci.com/)[Join the research community](https://circleci.com/research)[Visit our Support site](https://support.circleci.com/)

reCAPTCHA

Recaptcha requires verification.

[Privacy](https://www.google.com/intl/en/policies/privacy/) \- [Terms](https://www.google.com/intl/en/policies/terms/)

protected by **reCAPTCHA**

[Privacy](https://www.google.com/intl/en/policies/privacy/) \- [Terms](https://www.google.com/intl/en/policies/terms/)

---


## 2. Sample config.yml Files {#section-2}

*Source: [https://circleci.com/docs/sample-config/](https://circleci.com/docs/sample-config/)*

[Docs](https://circleci.com/docs/)

[Start Building for Free](https://circleci.com/signup/)

[Home](https://circleci.com/developer/) [Docs](https://circleci.com/docs/) [Orbs](https://circleci.com/developer/orbs/) [Images](https://circleci.com/developer/images/)

[CircleCI.com](https://circleci.com/)[Academy](https://circleci.com/training/)[Blog](https://circleci.com/blog/)[Community](https://discuss.circleci.com/)[Support](https://support.circleci.com/hc/en-us/)

# Sample config.yml Files

[3 months ago](https://github.com/circleci/circleci-docs/commits/master/jekyll/_cci2/sample-config.adoc)6 min read

Last updated • Read time

Cloud

This document is applicable to CircleCI Cloud

Server v4+

This document is applicable to CircleCI Server v4+

##### On This Page

- [Tools for editing configuration files](https://circleci.com/docs/sample-config/#tools-for-editing-configuration-files)
- [Simple configuration examples](https://circleci.com/docs/sample-config/#simple-configuration-examples)
- [Concurrent workflow](https://circleci.com/docs/sample-config/#concurrent-workflow)
- [Sequential workflow](https://circleci.com/docs/sample-config/#sequential-workflow)
- [Approval job](https://circleci.com/docs/sample-config/#approval-job)
- [Hello world](https://circleci.com/docs/sample-config/#hello-world)
- [Sample configuration with sequential workflow and secondary Docker container](https://circleci.com/docs/sample-config/#sample-configuration-with-sequential-workflow)
- [Sample configuration with fan-in/fan-out workflow](https://circleci.com/docs/sample-config/#sample-configuration-with-fan-infan-out-workflow)
- [Sample configuration with multiple executor types](https://circleci.com/docs/sample-config/#sample-configuration-with-multiple-executor-types)
- [See also](https://circleci.com/docs/sample-config/#see-also)

This document provides sample `.circleci/config.yml` files that you can use as a starting point when setting up projects, or to better understand different ways to orchestrate jobs using workflows and filters. For information on all configuration elements available to you, see the [Configuration reference](https://circleci.com/docs/configuration-reference/) page.

If you would like to get set up quickly, see our language-specific quickstart guides:

- [Node](https://circleci.com/docs/language-javascript/)

- [Python](https://circleci.com/docs/language-python/)

- [Go](https://circleci.com/docs/language-go/)


## Tools for editing configuration files

CircleCI has created an [extension for Visual Studio Code](https://circleci.com/docs/vs-code-extension-overview/) that reduces context switching between the web app and VS Code through a set of helpful features.

The VS Code extension reduces the time to create, modify, and troubleshoot configuration files through real-time syntax validation, highlighting, and autocomplete suggestions. Authenticating the extension with your CircleCI account will also allow you to visualize and manage your CircleCI pipelines directly from your code editor, and be notified of workflow status changes.

The CircleCI VS Code extension is available to download on the [VS Code marketplace](https://marketplace.visualstudio.com/items?itemName=circleci.circleci).

## Simple configuration examples

|     |     |
| --- | --- |
|  | **Using Docker?** Authenticating Docker pulls from image registries is recommended when using the Docker execution environment. Authenticated pulls allow access to private Docker images, and may also grant higher rate limits, depending on your registry provider. For further information see [Using Docker authenticated pulls](https://circleci.com/docs/private-images/). |

### Concurrent workflow

The configuration example below shows a concurrent workflow in which the `build` and `test` jobs run at the same time. Both jobs are run in Docker containers using the base image provided by CircleCI.

- Refer to the [Workflows](https://circleci.com/docs/workflows/) document for complete details about orchestrating job runs with concurrent, sequential, and manual approval workflows.

- Refer to the [Developer Hub convenience images](https://circleci.com/developer/images?imageType=docker) page to find out about available Docker images for running your jobs.


This image shows the workflow view for the following configuration example:

![Concurrent Workflow Graph](https://circleci.com/docs/assets/img/docs/concurrent-workflow-map.png)

```yaml
version: 2.1

# Define the jobs we want to run for this project
jobs:
  build:
    docker:
      - image: cimg/base:2023.03
    steps:
      - checkout
      - run: echo "this is the build job"
  test:
    docker:
      - image: cimg/base:2023.03
    steps:
      - checkout
      - run: echo "this is the test job"

# Orchestrate our job run sequence
workflows:
  build_and_test:
    jobs:
      - build
      - test
```

### Sequential workflow

The configuration example below shows a sequential workflow where the `build` job runs, and then the `test` job runs once `build` has completed. Configure sequential workflows using the [`requires` key](https://circleci.com/docs/configuration-reference/#requires), and specifying the `test` job "requires" the `build` job in order to run. Both jobs are run in Docker containers using the base image provided by CircleCI.

- Refer to the [Workflows](https://circleci.com/docs/workflows/) document for complete details about orchestrating job runs with concurrent, sequential, and manual approval workflows.

- Refer to the [developer hub convenience images](https://circleci.com/developer/images?imageType=docker) page to find out about available Docker images for running your jobs.


This image shows the workflow view for the following configuration example, in which jobs run sequentially (one after the other):

![Sequential Workflow Graph](https://circleci.com/docs/assets/img/docs/sequential-workflow-map.png)

```yaml
version: 2.1

# Define the jobs we want to run for this project
jobs:
  build:
    docker:
      - image: cimg/base:2023.03
    steps:
      - checkout
      - run: echo "this is the build job"
  test:
    docker:
      - image: cimg/base:2023.03
    steps:
      - checkout
      - run: echo "this is the test job"

# Orchestrate our job run sequence
workflows:
  build_and_test:
    jobs:
      - build
      - test:
          requires:
            - build
```

### Approval job

The example below shows a sequential workflow with an [approval job](https://circleci.com/docs/configuration-reference/#type). Use an approval job to require manual approval before downstream jobs may proceed.

```yaml
version: 2.1

executors: # Define an executor
  my-executor:
    docker:
      - image: cimg/base:2024.01
# Define the jobs we want to run for this project
jobs:
  build:
    executor: my-executor
    steps:
      - checkout
      - run: echo "build"
  test:
    executor: my-executor
    steps:
      - checkout
      - run: echo "test"
  deploy:
    executor: my-executor
    steps:
      - checkout
      - run: echo "deploy"

# Orchestrate our job run sequence
workflows:
  build_and_test:
    jobs:
      - build
      - test:
          requires:
            - build
      - hold:
          type: approval
          requires:
            - build
      - deploy:
          requires:
            - hold
```

The workflow runs as follows:

1. `build` job runs

2. `test` job runs

3. `hold` job, with `type: approval` ensures the workflow waits for manual approval in the CircleCI web app

4. Once `hold` job is approved the `deploy` job runs


An approval job can have any name. In the example above the approval job is named `hold`. The name you choose for an approval job should not be used to define a job in the main configuration. An approval job only exists as a workflow orchestration devise.

The image below shows the workflow view for the following configuration example. This image has three parts to show:

- The workflow graph with the `hold` job paused

- The "Needs Approval" popup that appears when you click on a hold job

- The workflow view again once the `hold` job has been approved and the `deploy` job has run


![Approval Workflow Graph](https://circleci.com/docs/assets/img/docs/approval-workflow-map.png)

- Refer to the [Workflows](https://circleci.com/docs/workflows/) document for complete details about orchestrating job runs with concurrent, sequential, and manual approval workflows.

- Refer to the [developer hub convenience images](https://circleci.com/developer/images?imageType=docker) page to find out about available Docker images for running your jobs.


### Hello world

```yml
# Use the latest 2.1 version of CircleCI pipeline process engine.
# See: https://circleci.com/docs/configuration-reference
version: 2.1

# Define a job to be invoked later in a workflow.
# See: https://circleci.com/docs/jobs-steps/#jobs-overview & https://circleci.com/docs/configuration-reference/#jobs
jobs:
  say-hello:
    # Specify the execution environment. You can specify an image from Docker Hub or use one of our convenience images from CircleCI's Developer Hub.
    # See: https://circleci.com/docs/executor-intro/ & https://circleci.com/docs/configuration-reference/#executor-job
    docker:
      # Specify the version you desire here
      # See: https://circleci.com/developer/images/image/cimg/base
      - image: cimg/base:current

    # Add steps to the job
    # See: https://circleci.com/docs/jobs-steps/#steps-overview & https://circleci.com/docs/configuration-reference/#steps
    steps:
      # Checkout the code as the first step.
      - checkout
      - run:
          name: "Say hello"
          command: "echo Hello, World!"

# Orchestrate jobs using workflows
# See: https://circleci.com/docs/workflows/ & https://circleci.com/docs/configuration-reference/#workflows
workflows:
  say-hello-workflow: # This is the name of the workflow, feel free to change it to better match your workflow.
    # Inside the workflow, you define the jobs you want to run.
    jobs:
      - say-hello
```

## Sample configuration with sequential workflow and secondary Docker container

Following is a sample `.circleci/config.yml` file using the following configuration features:

- A sequential workflow

- An orb

- A secondary services container

- Workspaces

- Storing artifacts


```yaml
version: 2.1

orbs:
  node: circleci/node@3.0.0

jobs:
  build:
    working_directory: ~/mern-starter
    # Reuse Docker container specification given by the node Orb
    executor: node/default
    steps:
      - checkout
      # Install the latest npm - the node Orb takes care of it
      - node/install-npm
      # Install dependencies - the node Orb take care of installation and dependency caching
      - node/install-packages:
          app-dir: ~/mern-starter
          cache-path: node_modules
          override-ci-command: npm i
      # Save workspace for subsequent jobs (i.e. test)
      - persist_to_workspace:
          root: .
          paths:
            - .

  test:
    docker:
      # The primary container is an instance of the first image listed. The job's commands run in this container.
      - image: cimg/node:current
      # The secondary container is an instance of the second listed image which is run in a common network where ports exposed on the primary container are available on localhost.
      - image: mongo:4.2
    steps:
      # Reuse the workspace from the build job
      - attach_workspace:
          at: .
      - run:
          name: Demonstrate that Mongo DB is available as localhost
          command: |
            curl -sSJL https://www.mongodb.org/static/pgp/server-4.2.asc | sudo apt-key add -
            echo "deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.2 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-4.2.list
            sudo apt update
            sudo apt install mongodb-org
            mongo localhost --eval "db.serverStatus()"
      - run:
          name: Test
          command: npm test
      - run:
          name: Generate code coverage
          command: './node_modules/.bin/nyc report --reporter=text-lcov'
      # You can specify either a single file or a directory to store as artifacts
      - store_artifacts:
          path: test-results.xml
          destination: deliverable.xml
      - store_artifacts:
          path: coverage
          destination: coverage

workflows:
  build_and_test:
    jobs:
      - build
      - test:
          requires:
            - build
```

This example shows a sequential workflow with the `test` job configured to run only on the main branch. Refer to the [Workflows](https://circleci.com/docs/workflows/) document for complete details about orchestrating job runs with concurrent, sequential, and manual approval workflows.

## Sample configuration with fan-in/fan-out workflow

Below are two sample configurations for a Fan-in/Fan-out workflow.

![Fan-in-out](https://circleci.com/docs/assets/img/docs/fan-in-out-example.png)

```yaml
version: 2.1

orbs:
    docker: circleci/docker@1.0.1

jobs:
    prepare-dependencies:
        docker:
            - image: node:current-alpine
        steps:
            - checkout
            - run:
                  name: Compute version number
                  command: echo "0.0.${CIRCLE_BUILD_NUM}-${CIRCLE_SHA1:0:7}" | tee version.txt
            - restore_cache:
                  keys:
                      - yarn-deps-{{ checksum "yarn.lock" }}
                      - yarn-deps
            - run:
                  name: yarn install
                  command: yarn install
            - save_cache:
                  paths:
                      - node_modules
                  key: yarn-deps-{{ checksum "yarn.lock" }}-{{ epoch }}
            - store_artifacts:
                  path: yarn.lock
            - persist_to_workspace:
                  root: .
                  paths:
                      - .

    build-production:
        docker:
            - image: node:current-alpine
        steps:
            - attach_workspace:
                  at: .
            - run:
                  name: Production build
                  command: |
                      export __BUILD_VERSION="$(cat version.txt)"
                      yarn build
            - store_artifacts:
                  path: dist/server.js
            - persist_to_workspace:
                  root: .
                  paths:
                      - .

    build-docker-image:
        machine:
            # The image uses the current tag, which always points to the most recent
            # supported release. If stability and determinism are crucial for your CI
            # pipeline, use a release date tag with your image, e.g. ubuntu-2004:202201-02
            image: ubuntu-2004:current
        steps:
            - attach_workspace:
                  at: .
            - run:
                  name: Setup __BUILD_VERSION envvar
                  command: |
                      echo 'export __BUILD_VERSION="$(cat version.txt)"' >> "$BASH_ENV"
            - docker/check:
                  registry: $DOCKER_REGISTRY
            - docker/build:
                  image: $DOCKER_IMAGE_NAME
                  tag: $__BUILD_VERSION
                  registry: $DOCKER_REGISTRY
            - docker/push:
                  image: $DOCKER_IMAGE_NAME
                  tag: $__BUILD_VERSION
                  registry: $DOCKER_REGISTRY

    test:
        docker:
            - image: node:current-alpine
        parallelism: 2
        steps:
            - attach_workspace:
                  at: .
            - run:
                  name: Run tests
                  command: |
                      circleci tests glob '**/*.test.ts' | circleci tests split --split-by timings | xargs yarn test:ci
            - store_artifacts:
                  path: test-results
            - store_test_results:
                  path: test-results

    deploy-docker-image:
        machine:
            image: ubuntu-2004:current
        steps:
            - attach_workspace:
                  at: .
            - run:
                  name: Setup __BUILD_VERSION envvar
                  command: |
                      echo 'export __BUILD_VERSION="$(cat version.txt)"' >> "$BASH_ENV"
            - docker/check:
                  registry: $DOCKER_REGISTRY
            - docker/pull:
                  images: $DOCKER_REGISTRY/$DOCKER_IMAGE_NAME:$__BUILD_VERSION
            - run:
                  name: Tag the image as latest
                  command: docker tag $DOCKER_REGISTRY/$DOCKER_IMAGE_NAME:$__BUILD_VERSION $DOCKER_REGISTRY/$DOCKER_IMAGE_NAME:latest
            - docker/push:
                  image: $DOCKER_IMAGE_NAME
                  tag: latest
                  registry: $DOCKER_REGISTRY

workflows:
    build-test-deploy:
        jobs:
            - prepare-dependencies
            - build-production:
                  requires:
                      - prepare-dependencies
            - build-docker-image:
                  context: docker-hub
                  requires:
                      - build-production
            - test:
                  requires:
                      - prepare-dependencies
            - deploy-docker-image:
                  context: docker-hub
                  requires:
                      - build-docker-image
                      - test
```

|     |     |
| --- | --- |
|  | A job can only run when its dependencies are satisfied therefore it requires the dependencies of all upstream jobs. This means only the immediate upstream dependencies need to be specified in the `requires:` blocks. |

## Sample configuration with multiple executor types

It is possible to use multiple [executor types](https://circleci.com/docs/executor-intro/) in the same workflow.

In `Example-1` each push will build and test the project on Linux, Windows and macOS.

In `Example-2` each push of an iOS project will be built on macOS, and additional iOS tools ([SwiftLint](https://github.com/realm/SwiftLint) and [Danger](https://github.com/danger/danger)) will be run in Docker.

Example 1Example 2

```yaml
version: 2.1

orbs:
  github-release: haskell-works/github-release@1.3.3

parameters:
  src-repo-url:
    type: string
    default: https://github.com/esnet/iperf.git
  branch-name:
    type: string
    default: "3.8.1"
  common-build-params:
    type: string
    default: "--disable-shared --disable-static"

jobs:
  build-linux:
    docker:
      - image: archlinux/base
    parameters:
      label:
        type: string
        default: iperf3-linux
    steps:
      - run:
          name: Install dependencies
          command: pacman -Syu --noconfirm openssl git gcc make awk tar
      - run:
          name: Clone iperf3
          command: git clone << pipeline.parameters.src-repo-url >> -b << pipeline.parameters.branch-name >>
      - run:
          name: Build iperf3
          working_directory: iperf
          command: |
            CIRCLE_WORKING_DIRECTORY=$(eval "echo $CIRCLE_WORKING_DIRECTORY")
            IPERF3_MAKE_PREFIX=$CIRCLE_WORKING_DIRECTORY/<< parameters.label >>
            ./configure --prefix=$IPERF3_MAKE_PREFIX << pipeline.parameters.common-build-params >>
            make
            mkdir -p $IPERF3_MAKE_PREFIX
            make install
      - run:
          name: Create a tarball
          command: tar -cJf << parameters.label >>.tar.xz << parameters.label >>
      - persist_to_workspace:
          root: .
          paths:
            - << parameters.label >>.tar.xz
      - store_artifacts:
          path: << parameters.label >>.tar.xz

  build-windows:
    machine:
      image: windows-server-2019-vs2019:stable
      shell: powershell.exe
    resource_class: windows.medium
    parameters:
      label:
        type: string
        default: iperf3-cygwin64
    steps:
      - run:
          name: Download Cygwin installer
          shell: bash.exe
          command: |
            curl -sSJOL https://cygwin.com/setup-x86_64.exe
      - run:
          name: Install Cygwin and required packages
          command: .\setup-x86_64.exe -q -s https://mirrors.kernel.org/sourceware/cygwin/ -P libssl-devel,git,gcc-core,make
      - run:
          name: Build iperf3 with Cygwin
          shell: C:\\cygwin64\\bin\\bash.exe --login -eo pipefail
          command: |
            CIRCLE_WORKING_DIRECTORY=$(eval "echo $CIRCLE_WORKING_DIRECTORY")
            IPERF3_MAKE_PREFIX=$CIRCLE_WORKING_DIRECTORY/<< parameters.label >>
            cd $CIRCLE_WORKING_DIRECTORY
            git clone << pipeline.parameters.src-repo-url >> -b << pipeline.parameters.branch-name >>
            cd iperf
            ./configure --prefix=$IPERF3_MAKE_PREFIX << pipeline.parameters.common-build-params >>
            make
            mkdir -p $IPERF3_MAKE_PREFIX
            make install
            cp /usr/bin/cygwin1.dll /usr/bin/cygcrypto-1.1.dll /usr/bin/cygz.dll -t $IPERF3_MAKE_PREFIX/bin
      - run:
          name: Create a Zip file
          command: |
            $ProgressPreference = "SilentlyContinue"
            Compress-Archive .\\<< parameters.label >> .\\<< parameters.label >>.zip
      - persist_to_workspace:
          root: .
          paths:
            - << parameters.label >>.zip
      - store_artifacts:
          path: << parameters.label >>.zip

  build-macos:
    macos:
      xcode: 14.2.0
    parameters:
      label:
        type: string
        default: iperf3-macos
    steps:
      - run:
          name: Clone iperf3
          command: git clone << pipeline.parameters.src-repo-url >> -b << pipeline.parameters.branch-name >>
      - run:
          name: Build iperf3
          working_directory: iperf
          command: |
            CIRCLE_WORKING_DIRECTORY=$(eval "echo $CIRCLE_WORKING_DIRECTORY")
            IPERF3_MAKE_PREFIX=$CIRCLE_WORKING_DIRECTORY/<< parameters.label >>
            ./configure --prefix=$IPERF3_MAKE_PREFIX --with-openssl=$(brew --prefix openssl) << pipeline.parameters.common-build-params >>
            make
            mkdir -p $IPERF3_MAKE_PREFIX
            make install
            # Postruns
            cd $IPERF3_MAKE_PREFIX/bin
            # Copy linked OpenSSL libraris to the current directory
            # and tell the linker to refer to them
            otool -L iperf3 | grep openssl | awk '{ print $1 }' | while read dylib
            do
              name=$(basename $dylib)
              cp $dylib ./
              chmod u+w $name
              install_name_tool -change $dylib @executable_path/$name iperf3
            done
            # Modify libssl as well
            otool -L libssl.1.1.dylib | grep openssl | awk '{ print $1 }' | while read dylib
            do
              install_name_tool -change $dylib @executable_path/$(basename $dylib) libssl.1.1.dylib
            done
      - run:
          name: Create a Zip file
          command: zip -r << parameters.label >>.zip << parameters.label >>
      - persist_to_workspace:
          root: .
          paths:
            - << parameters.label >>.zip
      - store_artifacts:
          path: << parameters.label >>.zip

  test-linux:
    docker:
      - image: cimg/base:stable
    parameters:
      label:
        type: string
        default: iperf3-linux
    steps:
      - attach_workspace:
          at: ./
      - run:
          name: Extract << parameters.label >>.tar.xz
          command: tar -xf << parameters.label >>.tar.xz
      - run:
          name: Test executable
          command: << parameters.label >>/bin/iperf3 -v
      - run:
          name: Run as a server
          command: << parameters.label >>/bin/iperf3 -s
          background: true
      - run:
          name: Run as a client
          command: << parameters.label >>/bin/iperf3 -c localhost -R

  test-windows:
    machine:
      image: windows-server-2019-vs2019:stable
      shell: powershell.exe
    resource_class: windows.medium
    parameters:
      label:
        type: string
        default: iperf3-cygwin64
    steps:
      - attach_workspace:
          at: .
      - run:
          name: Extract iperf3-cygwin64.zip
          command: |
            $ProgressPreference = "SilentlyContinue"
            Expand-Archive .\\<< parameters.label >>.zip .
      - run:
          name: Test executable
          command: .\\<< parameters.label >>\bin\iperf3.exe -v
      - run:
          name: Run as a server
          command: .\\<< parameters.label >>\bin\iperf3.exe -s
          background: true
      - run:
          name: Run as a client
          command: .\\<< parameters.label >>\bin\iperf3.exe -c localhost -R

  test-macos:
    macos:
      xcode: 14.2.0
    parameters:
      label:
        type: string
        default: iperf3-macos
    steps:
      - attach_workspace:
          at: .
      - run:
          name: Uninstall pre-installed OpenSSL
          command: brew uninstall --ignore-dependencies openssl
      - run:
          name: Extract << parameters.label >>
          command: unzip << parameters.label >>
      - run:
          name: Test executable
          command: << parameters.label >>/bin/iperf3 -v
      - run:
          name: Run as a server
          command: << parameters.label >>/bin/iperf3 -s
          background: true
      - run:
          name: Run as a client
          command: << parameters.label >>/bin/iperf3 -c localhost -R

  release:
    executor: github-release/default
    steps:
      - attach_workspace:
          at: .
      - run:
          name: Compute version number
          command: |
            echo 'export IPERF3_BUILD_VERSION="<< pipeline.parameters.branch-name>>-${CIRCLE_BUILD_NUM}-${CIRCLE_SHA1:0:7}"' | tee -a "$BASH_ENV"
      - github-release/release:
          tag: v$IPERF3_BUILD_VERSION
          title: $IPERF3_BUILD_VERSION
          artefacts-folder: .

workflows:
  build-test-release:
    jobs:
      - build-linux
      - build-windows
      - build-macos
      - test-linux:
          requires:
            - build-linux
      - test-windows:
          requires:
            - build-windows
      - test-macos:
          requires:
            - build-macos
      - release:
          requires:
            - test-linux
            - test-windows
            - test-macos
          context: github
          filters:
            branches:
              only: main
```

## See also

- See the [Concepts document](https://circleci.com/docs/concepts/#configuration) and [Workflows](https://circleci.com/docs/workflows/) for more details of the concepts covered in this example.

- See the [Configuration Reference](https://circleci.com/docs/configuration-reference/) document for full details of each individual configuration key.

- See the [Example Public Repos](https://circleci.com/docs/example-configs/) document for a list of public projects that use CircleCI.


* * *

#### Suggest an edit to this page

[Make a contribution](https://github.com/circleci/circleci-docs/blob/master/jekyll/_cci2/sample-config.adoc)[Learn how to contribute](https://github.com/circleci/circleci-docs/blob/master/docs/CONTRIBUTING.md#contributing-to-circleci-docs)

#### Still need help?

[Ask the CircleCI community](https://discuss.circleci.com/)[Join the research community](https://circleci.com/research)[Visit our Support site](https://support.circleci.com/)

reCAPTCHA

Recaptcha requires verification.

[Privacy](https://www.google.com/intl/en/policies/privacy/) \- [Terms](https://www.google.com/intl/en/policies/terms/)

protected by **reCAPTCHA**

[Privacy](https://www.google.com/intl/en/policies/privacy/) \- [Terms](https://www.google.com/intl/en/policies/terms/)

---


## 3. Workflow orchestration {#section-3}

*Source: [https://circleci.com/docs/workflows/](https://circleci.com/docs/workflows/)*

[Docs](https://circleci.com/docs/)

[Start Building for Free](https://circleci.com/signup/)

[Home](https://circleci.com/developer/) [Docs](https://circleci.com/docs/) [Orbs](https://circleci.com/developer/orbs/) [Images](https://circleci.com/developer/images/)

[CircleCI.com](https://circleci.com/)[Academy](https://circleci.com/training/)[Blog](https://circleci.com/blog/)[Community](https://discuss.circleci.com/)[Support](https://support.circleci.com/hc/en-us/)

# Workflow orchestration

[1 month ago](https://github.com/circleci/circleci-docs/commits/master/jekyll/_cci2/workflows.adoc)16 min read

Last updated • Read time

Cloud

This document is applicable to CircleCI Cloud

Server v4+

This document is applicable to CircleCI Server v4+

##### On This Page

- [Overview](https://circleci.com/docs/workflows/#overview)
- [Workflows configuration examples](https://circleci.com/docs/workflows/#workflows-configuration-examples)
- [Concurrent job execution](https://circleci.com/docs/workflows/#concurrent-job-execution)
- [Sequential job execution](https://circleci.com/docs/workflows/#sequential-job-execution)
- [Fan-out/fan-in workflow](https://circleci.com/docs/workflows/#fan-outfan-in-workflow)
- [Flexible job dependency](https://circleci.com/docs/workflows/#flexible-job-dependency)
- [Hold a workflow for a manual approval](https://circleci.com/docs/workflows/#holding-a-workflow-for-a-manual-approval)
- [Configure an approval job](https://circleci.com/docs/workflows/#configure-an-approval-job)
- [Approve a job](https://circleci.com/docs/workflows/#approve-a-job)
- [Identify the user who approved a job](https://circleci.com/docs/workflows/#identify-the-user-who-approved-a-job)
- [Cancel a job](https://circleci.com/docs/workflows/#cancel-a-job)
- [Scheduling a workflow](https://circleci.com/docs/workflows/#scheduling-a-workflow)
- [Build every night](https://circleci.com/docs/workflows/#nightly-example)
- [Specifying a valid schedule](https://circleci.com/docs/workflows/#specifying-a-valid-schedule)
- [Using contexts to share and secure environment variables](https://circleci.com/docs/workflows/#using-job-contexts-to-share-environment-variables)
- [Use conditional logic in workflows](https://circleci.com/docs/workflows/#use-conditional-logic-in-workflows)
- [Using filters in your workflows](https://circleci.com/docs/workflows/#using-filters-in-your-workflows)
- [Branch-level job execution](https://circleci.com/docs/workflows/#branch-level-job-execution)
- [Executing workflows for a git tag](https://circleci.com/docs/workflows/#executing-workflows-for-a-git-tag)
- [Using regular expressions to filter tags and branches](https://circleci.com/docs/workflows/#using-regular-expressions-to-filter-tags-and-branches)
- [Using workspaces to share data between jobs](https://circleci.com/docs/workflows/#using-workspaces-to-share-data-between-jobs)
- [Rerunning a workflow’s failed jobs](https://circleci.com/docs/workflows/#rerunning-a-workflows-failed-jobs)
- [Workflow states](https://circleci.com/docs/workflows/#states)
- [Troubleshooting](https://circleci.com/docs/workflows/#troubleshooting)
- [Workflow and subsequent jobs do not trigger](https://circleci.com/docs/workflows/#workflow-and-subsequent-jobs-do-not-trigger)
- [Rerunning workflows fails](https://circleci.com/docs/workflows/#rerunning-workflows-fails)
- [Workflows waiting for status in GitHub](https://circleci.com/docs/workflows/#workflows-waiting-for-status-in-github)
- [See also](https://circleci.com/docs/workflows/#see-also)

Workflows in CircleCI are used to orchestrate jobs. Workflows have options to control run order, scheduling, and access to resources. This page explains how to configure workflows to suit your project. Optimizing your workflows can increase the speed of your software development through faster feedback, shorter reruns, and more efficient use of resources.

## Overview

A **workflow** is a set of rules for defining a collection of jobs and their run order. Create workflows to orchestrate your jobs using the options described on this page.

With workflows, you can:

- Run and troubleshoot jobs independently with real-time status feedback.

- Schedule workflows for jobs that should only run periodically.

- Fan-out to run multiple jobs concurrently for efficient version testing.

- Fan-in to deploy to multiple platforms.

- Catch failures in real-time and rerun only failed jobs.


## Workflows configuration examples

|     |     |
| --- | --- |
|  | For a full specification of the `workflows` key, see the [Workflows](https://circleci.com/docs/configuration-reference/#workflows) section of the configuration reference. |

### Concurrent job execution

The example in this section shows the default workflow orchestration model of concurrent jobs. Concurrent jobs are defined as follows:

- Use the `workflows` key.

- Name the workflow, in this case, `build_and_test`.

- Nest the `jobs` key with a list of job names that are defined in the configuration file. In this example the jobs have no dependencies defined, so they run concurrently.


|     |     |
| --- | --- |
|  | **Using Docker?** Authenticating Docker pulls from image registries is recommended when using the Docker execution environment. Authenticated pulls allow access to private Docker images, and may also grant higher rate limits, depending on your registry provider. For further information see [Using Docker authenticated pulls](https://circleci.com/docs/private-images/). |

```yaml
jobs:
  build:
    docker:
      - image: cimg/base:2023.06
    steps:
      - checkout
      - run: <command>
  test:
    docker:
      - image: cimg/base:2023.06
    steps:
      - checkout
      - run: <command>
workflows:
  build_and_test:
    jobs:
      - build
      - test
```

See the [Sample concurrent workflow config](https://github.com/CircleCI-Public/circleci-demo-workflows/blob/parallel-jobs/.circleci/config.yml) for a full example.

When using workflows, note the following best practices:

- Move the quickest jobs up to the start of your workflow. For example, lint or syntax checking should happen before longer-running, more computationally expensive jobs.

- Using a "setup" job at the _start_ of a workflow can be helpful to do some preflight checks and populate a workspace for all the following jobs.


|     |     |
| --- | --- |
|  | Refer to the [Optimization reference](https://circleci.com/docs/optimizations/) for tips to improve your configuration. |

### Sequential job execution

This example shows a workflow with four sequential jobs. Each job waits to start until the "required" job finishes successfully, as illustrated in the following diagram:

![Sequential Job Execution Workflow](https://circleci.com/docs/assets/img/docs/sequential_workflow.png)

This configuration snippet is an example of a workflow configured for sequential jobs:

```yaml
workflows:
  build-test-and-deploy:
    jobs:
      - build
      - test1:
          requires:
            - build
      - test2:
          requires:
            - test1
      - deploy:
          requires:
            - test2
```

Define job dependencies using the `requires` key. A job must wait until all upstream jobs in the dependency graph have run. In this example, the `deploy` job runs when the `build`, `test1` and `test2` jobs complete successfully:

- The `deploy` job waits for the `test2` job

- The `test2` job waits for the `test1` job

- The `test1` job waits for the `build` job


See the [Sample Sequential Workflow config](https://github.com/CircleCI-Public/circleci-demo-workflows/blob/sequential-branch-filter/.circleci/config.yml) for a full example.

### Fan-out/fan-in workflow

This example workflow has a fan-out/fan-in structure, as follows:

- A common build job is run.

- The workflow fans-out to run a set of acceptance test jobs concurrently.

- The workflow fans-in to run a common deploy job.


![Fan-out and Fan-in Workflow](https://circleci.com/docs/assets/img/docs/fan-out-in.png)

This configuration snippet is an example of a workflow configured for fan-out/fan-in job execution:

```yaml
workflows:
  build_accept_deploy:
    jobs:
      - build
      - acceptance_test_1:
          requires:
            - build
      - acceptance_test_2:
          requires:
            - build
      - acceptance_test_3:
          requires:
            - build
      - acceptance_test_4:
          requires:
            - build
      - deploy:
          requires:
            - acceptance_test_1
            - acceptance_test_2
            - acceptance_test_3
            - acceptance_test_4
```

In this example, as soon as the `build` job finishes successfully, all four acceptance test jobs start. The `deploy` job waits for all four acceptance test jobs to succeed before it starts.

See the [Sample Fan-in/Fan-out Workflow config](https://github.com/CircleCI-Public/circleci-demo-workflows/tree/fan-in-fan-out) for a full example.

### Flexible job dependency

Using `requires`, you can build complex dependency maps and fan in/out scenarios.

The following example is a configuration snippet of a workflow with four sequential jobs. Each job waits until the "required" job attains a specified status:

```yaml
workflows:
  build-and-deploy:
    jobs:
      - build
      - deploy:
          requires:
            - build
      - release:
          requires:
            - deploy
      - rollback:
          requires:
            - release:
              - failed
              - canceled
```

A job must wait until all upstream jobs in the dependency graph have attained either of the statuses specified under the corresponding `requires` key. In this example, the following dependencies are configured:

- The `rollback` job waits for the `release` job, and only runs if the `release` job fails or is canceled.

- The `release` job waits for the `deploy` job, and only runs if the `deploy` job is successful.

- The `deploy` job waits for the `build` job, and only runs if the `build` job is successful.


![Flexible Job Execution Workflow - Example 1](https://circleci.com/docs/assets/img/docs/workflow-using-requires-example-1.png)

Figure 1. Workflow execution when the `release` job is successful

![Flexible Job Execution Workflow - Example 2](https://circleci.com/docs/assets/img/docs/workflow-using-requires-example-2.png)

Figure 2. Workflow execution when the `release` job fails:

|     |     |
| --- | --- |
|  | Refer to the [Requires](https://circleci.com/docs/configuration-reference/#requires) section of the configuration reference. |

## Hold a workflow for a manual approval

Use an `approval` job to configure a workflow to wait for manual approval before continuing. Anyone who has push access to the repository can approve the job to continue the workflow or cancel to end the workflow. Approve or Cancel either by using the buttons in the CircleCI web app, or via the API.

Some things to keep in mind when using manual approval in a workflow:

- `approval` is a special job type that is configured when listing jobs under the `workflows` key. You do not need to define an `approval` type job in the `jobs` section of your configuration. If you do configure steps for a job that is given the `approval` type in the workflows section, the steps for that job will not be run. An `approval` job is _only_ used to _hold_ the workflow for approval, not to run any work.

- The `approval` job name must be unique and not used by any other job in your configuration.

- The name of the approval job is arbitrary. For example, an approval job can be named `hold`, `wait`, `pause`, etc.

- All jobs that run _after_ a manual approval job **must** `require` the name of the `approval` job.

- Jobs run in the order defined in the workflow.

- When the workflow encounters a job with `type: approval`, the workflow pauses until action is taken to approve or cancel.

- If approval is granted the workflow continues to process jobs in the order defined in the configuration file.

- If cancel is granted the downstream jobs are not run.

- Jobs downstream of an `approval` job can be restricted by adding a [restricted context](https://circleci.com/docs/contexts/#approve-jobs-that-use-restricted-contexts) to those downstream jobs.


The following screenshot demonstrates:

- A workflow that needs approval.

- The approval popup.

- The workflow graph after approval.


![A three section image showing workflow graph with "Needs approval" job](https://circleci.com/docs/assets/img/docs/approval-workflow-map.png)

By clicking on the `approval` job’s name ( `hold`, in the screenshot above), an approval dialog box appears. You can approve, cancel, or close the popup without approving.

### Configure an approval job

To set up a manual approval workflow, add a job to the `jobs` list in your workflow with `type: approval`. For example:

```yaml
# ...
# << your config for the build, test1, test2, and deploy jobs >>
# ...

workflows:
  build-test-and-approval-deploy:
    jobs:
      - build  # your custom job from your config, that builds your code
      - test1: # your custom job; runs test suite 1
          requires: # test1 will not run until the `build` job is completed.
            - build
      - test2: # another custom job; runs test suite 2,
          requires: # test2 is dependent on the success of job `test1`
            - test1
      - hold: # <<< A job that will require manual approval in the CircleCI web application.
          type: approval # This key-value pair will set your workflow to a status of "Needs Approval"
          requires: # We only run the "hold" job when test2 has succeeded
           - test2
      # On approval of the `hold` job, any successive job that requires the `hold` job will run.
      # In this case, a user is manually triggering the deploy job.
      - deploy:
          requires:
            - hold
```

In this example, the `deploy` job will not run until the `hold` job is approved.

### Approve a job

To approve a job follow these steps:

CircleCI web appAPI

1. Select the `hold` job in the **Workflows** page of the CircleCI web app.

2. Select **Approve**.


### Identify the user who approved a job

To identify the user who approved a job, you can use the CircleCI web app or the API.

CircleCI web appAPI

- If the user signed up via GitHub, the (non-clickable) avatar of the GitHub user appears next to the approval job. Hovering over that avatar brings up a tooltip with the user’s name as specified in their GitHub/Bitbucket account settings.

- If the user signed up via email, the anonymous avatar appears next to the approval job; hovering over that avatar brings up a tooltip with the user’s email address.


### Cancel a job

To Cancel a job follow these steps:

CircleCI web appAPI

1. Select the `hold` job in the **Workflows** page of the CircleCI web app.

2. Select **Cancel**.


In this example, the purpose of the `hold` job is to wait for approval to begin deployment. A job can be approved for up to 90 days after it starts.

## Scheduling a workflow

|     |     |
| --- | --- |
|  | Scheduled workflows are not available for projects integrated through the GitHub App, GitLab or Bitbucket Data Center. |

|     |     |
| --- | --- |
|  | **The deprecation of the scheduled workflows feature is postponed**. Since the deprecation announcement went live, your feedback and feature requests have been monitored and it is clear there is more work for us to do to improve the existing scheduled pipelines experience, and also make migration easier for all. Updates on a new deprecation timeline will be announced here and on [CircleCI Discuss](https://discuss.circleci.com/). |

|     |     |
| --- | --- |
|  | The scheduled workflows feature does not support [Dynamic configuration](https://circleci.com/docs/dynamic-config/). If you use dynamic configuration you will need to use [Scheduled pipelines](https://circleci.com/docs/scheduled-pipelines/) for scheduling. More information can be found in this [support article](https://support.circleci.com/hc/en-us/articles/360060833331-Support-for-Scheduled-Workflows-in-Dynamic-Configurations-Setup-Workflows). |

By default, a workflow runs on every push, or based on the event rules you have set up for your trigger (**Triggers**). To trigger a workflow on a schedule, add the `triggers` key to the workflow and specify a `schedule`. Scheduled workflows use the `cron` syntax to represent Coordinated Universal Time (UTC).

Running a workflow for every commit for every branch can be inefficient and expensive. Scheduling a workflow is an alternative to building on every commit. You can _schedule_ a workflow to run at a certain time for a specific branch or branches. Consider scheduling workflows that are resource-intensive or that generate reports on a schedule rather than on every commit.

|     |     |
| --- | --- |
|  | A scheduled workflow will run on a schedule only. A scheduled workflow will **not** be run on commits to your code. |

If you do not configure any workflows in your `.circleci/config.yml`, an implicit workflow is used. If you configure a scheduled workflow the implicit workflow is no longer run. If you want to build on every commit you must add your workflow to your configuration file.

|     |     |
| --- | --- |
|  | When you schedule a workflow, the workflow will be counted as an individual user seat. |

### Build every night

In the example below, the `nightly` workflow is configured to run every day at 12:00am UTC. The `cron` key is specified using POSIX `crontab` syntax. See the [crontab man page](https://www.unix.com/man-page/POSIX/1posix/crontab/) for `cron` syntax basics. The workflow runs on the `main` and `beta` branches.

|     |     |
| --- | --- |
|  | Scheduled workflows may be delayed by up to 15 minutes. This delay is to maintain reliability during busy times, such as 12:00am UTC. Do not assume that scheduled workflows start with to-the-minute accuracy. |

```yaml
workflows:
  commit:
    jobs:
      - test
      - deploy
  nightly:
    triggers:
      - schedule:
          cron: "0 0 * * *"
          filters:
            branches:
              only:
                - main
                - /^release\/.*/
    jobs:
      - coverage
```

In the above example:

- The `commit` workflow has no `triggers` key and runs on every `git push`.

- The `nightly` workflow has a `triggers` key and runs on the specified `schedule`, which is daily, and only runs on the `main` branch, as well as any branch that starts `release/`.


### Specifying a valid schedule

A valid `schedule` requires:

- A `cron` key

- A `filters` key

- The `branches` filter must be present


The value of the `cron` key must be a [valid crontab entry](https://crontab.guru/).

The following are **not** supported:

- Cron step syntax (for example, `*/1`, `*/20`).

- Range elements within comma-separated lists of elements.

- Range elements for days (for example, `Tue-Sat`).


Use comma-separated digits instead.

Example **invalid** cron range syntax:

```yaml
    triggers:
      - schedule:
          cron: "5 4 * * 1,3-5,6" # < the range separator with `-` is invalid
          filters:
            branches:
              only:
                - main
```

Example **valid** cron range syntax:

```yaml
    triggers:
      - schedule:
          cron: "5 4 * * 1,3,4,5,6"
          filters:
            branches:
              only:
                - main
```

The value of the `filters` key must be a map that defines rules for execution on specific branches.

For more details, see the `branches` section of the [CircleCI configuration reference](https://circleci.com/docs/configuration-reference/#schedule-branches).

For a full configuration example, see the [Sample Scheduled Workflows configuration](https://github.com/CircleCI-Public/circleci-demo-workflows/blob/try-schedule-workflow/.circleci/config.yml).

## Using contexts to share and secure environment variables

In a workflow, you can use a context to securely provide environment variables to specific jobs. Contexts allow you to define environment variables at the organization level and control access to them through security restrictions. Using contexts, sensitive data like API keys or credentials are securely shared with only the jobs that require them. Sensitive data in contexts will not be exposed in your config file.

The following example shows a workflow with four sequential jobs that each use a context to access environment variables. See the [Contexts](https://circleci.com/docs/contexts/) page for detailed instructions on this setting in the application.

The following `config.yml` snippet is an example of a sequential job workflow configured to use the environment variables defined in the `org-global` context:

```yaml
workflows:
  build-test-and-deploy:
    jobs:
      - build
      - test1:
          requires:
            - build
          context: org-global
      - test2:
          requires:
            - test1
          context: org-global
      - deploy:
          requires:
            - test2
```

The `test1` and `test2` jobs have access to environment variables stored in the `org-global` context if the pipeline meets the restrictions set for the context, for example:

- Was the pipeline triggered by a user who [has access](https://circleci.com/docs/contexts/#security-group-restrictions) (is in the relevant org/security group etc.)?

- Does the [project have access](https://circleci.com/docs/contexts/#project-restrictions) to the context? By default all projects in an organization have access to contexts set for that organization, but restrictions on project access can be configured.

- Does the pipeline meet the requirements of any [expression restrictions](https://circleci.com/docs/contexts/#expression-restrictions) set up for the context?


## Use conditional logic in workflows

You may use a `when` clause (the inverse clause `unless` is also supported) under a workflow declaration with a [logic statement](https://circleci.com/docs/configuration-reference/#logic-statements) to determine whether or not to run that workflow.

Workflows are always run unless there is a `when` or `unless` filter that prevents the workflow from being run. If you want a workflow to run in **every** pipeline, do **not** add a when or unless filter.

The example configuration below uses a pipeline parameter, `run_integration_tests` to drive the `integration_tests` workflow.

```yaml
version: 2.1

parameters:
  run_integration_tests:
    type: boolean
    default: false

workflows:
  integration_tests:
    when: << pipeline.parameters.run_integration_tests >>
    jobs:
      - mytestjob

jobs:
```

This example prevents the workflow `integration_tests` from running unless the `run_integration_tests` pipeline parameter is `true`. For example, when the pipeline is triggered with the following in the `POST` body:

```json
{
    "parameters": {
        "run_integration_tests": true
    }
}
```

For more examples of using conditional logic in your workflows, see the [Orchestration cookbook](https://circleci.com/docs/orchestration-cookbook/).

|     |     |
| --- | --- |
|  | If you want to conditionally run workflows based on the type of event that triggers your pipeline, you can also consider splitting your workflows into separate YAML files and leveraging the different GitHub trigger event options.<br>For further details see the following guides:<br>- [Set up multiple configuration files for a project](https://circleci.com/docs/set-up-multiple-configuration-files-for-a-project/)<br>  <br>- [GitHub trigger event options](https://circleci.com/docs/github-trigger-event-options/) |

## Using filters in your workflows

The following sections provide examples for using filters in your workflows to manage job execution.

You can filter workflows by branch, git tag, or neither. Workflow filters for branches and tags have the keys `only` and `ignore`:

- Any branches/tags that match `only` will run the job.

- Any branches/tags that match `ignore` will not run the job.

- If neither `only` nor `ignore` are specified then the job is skipped for all branches/tags.

- If both `only` and `ignore` are specified the `only` is considered before `ignore`.


If **both branch and tag** filtering is configured and a push to your code includes both branch and tag information, the **branch** filters take precedence. In this scenario, if there are no branch filters configured, tag `ignore` filters are used, if they exist.

### Branch-level job execution

The following example has one workflow that is configured to run different sets of jobs for different branches:

- The `test_dev` job is run on the `dev` branch and any branch that begins `user-`

- The `test_stage` job is run on the `stage` branch

- The `test_pre-prod` job is run on any branch starting `pre-prod` including any suffix added to the branch name using a hyphen.


|     |     |
| --- | --- |
|  | Workflows ignore `branches` keys used in the `jobs` declaration. If you use the [deprecated job-level branches key](https://circleci.com/docs/configuration-reference/#branches), replace them with workflow filters. |

|     |     |
| --- | --- |
|  | This example shows how to provide strings and lists of strings when configuring workflow filters. |

```yaml
workflows:
  dev_stage_pre-prod:
    jobs:
      - test_dev:
          filters:  # using regex filters requires the entire branch to match
            branches:
              only:  # only branches matching the below regex filters will run
                - dev
                - /user-.*/
      - test_stage:
          filters:
            branches:
              only: stage
      - test_pre-prod:
          filters:
            branches:
              only: /pre-prod(?:-.+)?$/
```

This setup can be illustrated as follows:

![Branch-Level Job Execution](https://circleci.com/docs/assets/img/docs/branch_level.png)

For more information on regular expressions, see the [Using Regular Expressions to Filter Tags And Branches](https://circleci.com/docs/workflows/#using-regular-expressions-to-filter-tags-and-branches) section below.

For a full example of workflows, see the [configuration file](https://github.com/CircleCI-Public/circleci-demo-workflows/blob/sequential-branch-filter/.circleci/config.yml) for the Sample Sequential Workflow With Branching project.

### Executing workflows for a git tag

|     |     |
| --- | --- |
|  | Webhook payloads are capped at 25 MB and for some events a maximum of 3 tags. If you push several tags at once, CircleCI may not receive them all. |

CircleCI does not run workflows for tags unless you explicitly specify tag filters using regular expressions. Both lightweight and annotated tags are supported.

If you have configured a job to run on a git tag you must also specify tag filters for any dependent jobs. Use [regular expressions](https://circleci.com/docs/workflows/#using-regular-expressions-to-filter-tags-and-branches) to specify tag filters for a job.

* * *

In the example below, two workflows are defined:

- `untagged-build` runs the `build` job for all branches.

- `tagged-build` runs `build` for all branches **and** all tags starting with `v`.


```yaml
workflows:
  untagged-build:
    jobs:
      - build
  tagged-build:
    jobs:
      - build:
          filters:
            tags:
              only: /^v.*/
```

* * *

In the example below, two jobs are configured within the `build-deploy` workflow:

- The `build` job runs for all branches and all tags.

- The `deploy` job runs for all branches and only for tags starting with 'v'.


```yaml
workflows:
  build-deploy:
    jobs:
      - build:
          filters:  # required since `deploy` has tag filters AND requires `build`
            tags:
              only: /.*/
      - deploy:
          requires:
            - build
          filters:
            tags:
              only: /^v.*/
```

* * *

In the example below, three jobs are configured for the `build-test-deploy` workflow:

- The `build` job runs for all branches and only tags starting with 'config-test'.

- The `test` job runs once the `build` job completes for all branches and only tags starting with 'config-test'.

- The `deploy` job runs once the `test` job completes for no branches and only tags starting with 'config-test'.


```yaml
workflows:
  build-test-deploy:
    jobs:
      - build:
          filters:  # required since `test` has tag filters AND requires `build`
            tags:
              only: /^config-test.*/
      - test:
          requires:
            - build
          filters:  # required since `deploy` has tag filters AND requires `test`
            tags:
              only: /^config-test.*/
      - deploy:
          requires:
            - test
          filters:
            tags:
              only: /^config-test.*/
            branches:
              ignore: /.*/
```

* * *

In the example below, two jobs are defined ( `test` and `deploy`) and three workflows use those jobs:

- The `build` workflow runs for all branches except `main` and is not run on tags.

- The `staging` workflow will only run on the `main` branch and is not run on tags.

- The `production` workflow runs for no branches and only for tags starting with `v.`.


```yaml
workflows:
  build: # This workflow will run on all branches except 'main' and will not run on tags
    jobs:
      - test:
          filters:
            branches:
              ignore: main
  staging: # This workflow will only run on 'main' and will not run on tags
    jobs:
      - test:
          filters: &filters-staging # this yaml anchor is setting these values to "filters-staging"
            branches:
              only: main
      - deploy:
          requires:
            - test
          filters:
            <<: *filters-staging # this is calling the previously set yaml anchor
  production: # This workflow will only run on tags (specifically starting with 'v.') and will not run on branches
    jobs:
      - test:
          filters: &filters-production # this yaml anchor is setting these values to "filters-production"
            branches:
              ignore: /.*/
            tags:
              only: /^v.*/
      - deploy:
          requires:
            - test
          filters:
            <<: *filters-production # this is calling the previously set yaml anchor
```

### Using regular expressions to filter tags and branches

CircleCI branch and tag filters support the Java variant of regex pattern matching. When writing filters, CircleCI matches exact regular expressions.

For example, `only: /^config-test/` only matches the `config-test` tag. To match all tags starting with `config-test`, use `only: /^config-test.*/` instead.

Using tags for semantic versioning is a common use case. To match patch versions 3-7 of a 2.1 release, you can write `/^version-2\.1\.[3-7]/`.

For full details on pattern-matching rules, see the [`java.util.regex` documentation](https://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html).

## Using workspaces to share data between jobs

Each workflow has an associated [workspace](https://circleci.com/docs/configuration-reference/#persisttoworkspace) for transferring files to downstream jobs as a workflow progresses.

Configuration options are available to:

- [persist files to the workspace](https://circleci.com/docs/configuration-reference/#persisttoworkspace)





```yaml
- persist_to_workspace:
    root: /tmp/workspace
    paths:
      - target/application.jar
      - build/*
```

- [attach a workflow’s workspace](https://circleci.com/docs/configuration-reference/#attachworkspace) to a container.





```yaml
- attach_workspace:
    at: /tmp/workspace
```

For further information on workspaces and their configuration see the [Using Workspaces to Share Data Between Jobs](https://circleci.com/docs/workspaces/) doc.

## Rerunning a workflow’s failed jobs

Workflows help to speed up your ability to respond to failures. One way to do this is to only rerun failed jobs rather than a whole workflow. To rerun only a workflow’s _failed_ jobs, follow these steps:

1. In the [CircleCI web app](https://app.circleci.com/home/) select your organization.

2. Select **Pipelines** in the sidebar.

3. Use the filters to find your project and pipeline.

4. Find the row in the pipeline view for the workflow you would like to rerun from failed and select the **Rerun from failed** icon. This option is also available in the workflow view using the rerun dropdown menu, which you can access by clicking on the workflow name or badge.


Rerun from the pipelines pageRerun from the workflows page

![Rerun a workflow from failed from the pipelines page](https://circleci.com/docs/assets/img/docs/orchestrate-and-trigger/rerun-from-failed-pipelines-page.png)

|     |     |
| --- | --- |
|  | If you rerun a workflow containing a job that was previously re-run with SSH, the new workflow runs with SSH enabled for that job, even after SSH capability is disabled at the project level. |

### Workflow states

Workflows may have one of the following states:

| State | Description | Terminal state |
| --- | --- | --- |
| RUNNING | Workflow is in progress | No |
| NOT RUN | Workflow never started | Yes |
| CANCELED | Workflow canceled before it finished | Yes |
| FAILING | A job in the workflow failed, but others are still running or yet to be approved | No |
| FAILED | One or more jobs in the workflow failed | Yes |
| SUCCESS | All jobs in the workflow completed successfully | Yes |
| NEEDS APPROVAL (UI) / ON HOLD | A job in the workflow is waiting for approval | No |
| ERROR | We experienced an internal error starting a job in the workflow | Yes |
| UNAUTHORIZED | One or more of the jobs terminated with a `unauthorized` job status. The user who triggered the pipeline or approved an approval job does not have access to a required restricted context. | Yes |

|     |     |
| --- | --- |
|  | After 90 days non-terminal workflows are automatically by CircleCI. |

## Troubleshooting

This section describes common problems and solutions for workflows.

### Workflow and subsequent jobs do not trigger

If you do not see your workflows running, check for configuration errors that may be preventing the workflow from starting. Navigate to your [project’s pipelines](https://app.circleci.com/pipelines/) and find your workflow name to locate the failure.

### Rerunning workflows fails

Failures may happen before a workflow runs during pipeline processing. Re-running the in this case workflow will fail. Push a change to the project repository or use the trigger pipeline option to rerun the pipeline.

|     |     |
| --- | --- |
|  | You cannot rerun jobs and workflows that are >= 90 days. |

### Workflows waiting for status in GitHub

If you have workflows configured on a protected branch and the status check never completes, check the `ci/circleci` status key. `ci/circleci` is related to a deprecated check and should be and deselected.

![Uncheck GitHub Status Keys](https://circleci.com/docs/assets/img/docs/github_branches_status.png)

Go to **Branches** in GitHub and select **Edit** on the protected branch to deselect the settings, for example: `https://github.com/your-org/project/settings/branches`.

## See also

- See the [workflows](https://circleci.com/docs/faq/#workflows) section of the FAQ.

- For workflow configuration examples, see the [CircleCI Demo Workflows](https://github.com/CircleCI-Public/circleci-demo-workflows) page on GitHub.


* * *

#### Suggest an edit to this page

[Make a contribution](https://github.com/circleci/circleci-docs/blob/master/jekyll/_cci2/workflows.adoc)[Learn how to contribute](https://github.com/circleci/circleci-docs/blob/master/docs/CONTRIBUTING.md#contributing-to-circleci-docs)

#### Still need help?

[Ask the CircleCI community](https://discuss.circleci.com/)[Join the research community](https://circleci.com/research)[Visit our Support site](https://support.circleci.com/)

reCAPTCHA

Recaptcha requires verification.

[Privacy](https://www.google.com/intl/en/policies/privacy/) \- [Terms](https://www.google.com/intl/en/policies/terms/)

protected by **reCAPTCHA**

[Privacy](https://www.google.com/intl/en/policies/privacy/) \- [Terms](https://www.google.com/intl/en/policies/terms/)

---


## 4. Jobs and steps {#section-4}

*Source: [https://circleci.com/docs/jobs-steps/](https://circleci.com/docs/jobs-steps/)*

[Docs](https://circleci.com/docs/)

[Start Building for Free](https://circleci.com/signup/)

[Home](https://circleci.com/developer/) [Docs](https://circleci.com/docs/) [Orbs](https://circleci.com/developer/orbs/) [Images](https://circleci.com/developer/images/)

[CircleCI.com](https://circleci.com/)[Academy](https://circleci.com/training/)[Blog](https://circleci.com/blog/)[Community](https://discuss.circleci.com/)[Support](https://support.circleci.com/hc/en-us/)

# Jobs and steps

[3 months ago](https://github.com/circleci/circleci-docs/commits/master/jekyll/_cci2/jobs-steps.adoc)3 min read

Last updated • Read time

Cloud

This document is applicable to CircleCI Cloud

Server v4+

This document is applicable to CircleCI Server v4+

##### On This Page

- [Jobs overview](https://circleci.com/docs/jobs-steps/#jobs-overview)
- [Job naming](https://circleci.com/docs/jobs-steps/#job-naming)
- [Steps overview](https://circleci.com/docs/jobs-steps/#steps-overview)
- [Access jobs and steps in the CircleCI app](https://circleci.com/docs/jobs-steps/#access-jobs-and-steps-in-the-circleci-app)
- [Passing parameters to jobs](https://circleci.com/docs/jobs-steps/#passing-parameters-to-jobs)
- [Using a job from an orb](https://circleci.com/docs/jobs-steps/#using-a-job-from-an-orb)
- [Using a command from an orb in a job](https://circleci.com/docs/jobs-steps/#using-a-command-from-an-orb-in-a-job)
- [Next steps](https://circleci.com/docs/jobs-steps/#next-steps)

This page provides an overview of CircleCI jobs and steps.

## Jobs overview

A CircleCI job is a collection of steps. All of the steps in the job are executed in a single unit, either within a fresh container, or a virtual machine. Jobs are orchestrated using [workflows](https://circleci.com/docs/workflows/).

The following diagram illustrates how data flows between jobs:

- Workspaces persist data between jobs in a single workflow.

- Caching persists data between the same job in different workflows runs.

- Artifacts persist data after a workflow has finished.


![Jobs overview](https://circleci.com/docs/assets/img/docs/jobs-overview.png)

Jobs can be run in Docker containers, using the Docker executor, or in virtual machines using the `machine` executor, with Linux, macOS, or Windows images. Secondary containers or VMs can be configured to attach services, such as databases, to run alongside your jobs.

When using the Docker executor, images listed under the `docker` key specify the containers you want to start for your job. Any public Docker images can be used with the Docker executor, but CircleCI provides convenience images for a variety of use-cases. Full lists of available convenience and VM images are available in the [CircleCI Developer Hub](https://circleci.com/developer/images).

See the [Introduction to Execution Environments](https://circleci.com/docs/executor-intro/) document for a comparison of the different executor types, and links to further information for each option.

### Job naming

When you configure a job you will give it a name. This is its job property name:

```yml
version: 2.1

jobs:
  my-job: # the job property name
```

The job property name can be anything you like with the following restrictions:

- Must be unique within the `jobs` stanza.

- Only ASCII alphabet characters, underscores, and dashes.

- No spaces.


When you configure a job in a workflow you have the option to give it an [alternative name](https://circleci.com/docs/configuration-reference/#name). This alternative name can be useful if you want to call a job more than once in a workflow.

```yml
workflows:
  jobs:
    my-job: # the job property name
      name: My Job # the alternative job name within the workflow
```

The job name within the workflow can be anything you like _including_ spaces and special characters.

## Steps overview

Steps are collections of executable commands, which are run during a job.

The `checkout` key is required under `steps` to checkout your code. The `run` key enables addition of arbitrary, multi-line shell command scripting.

In addition to the `run` key, keys for `save_cache`, `restore_cache`, `store_artifacts`, `store_test_results`, and `add_ssh_keys` are nested under steps. For a full list of step options see the [Steps key](https://circleci.com/docs/configuration-reference/#steps) section of the Configuration Reference.

## Access jobs and steps in the CircleCI app

A pipeline is composed of workflows, which are composed of jobs. By navigating from a pipeline to a specific job, you can access your job output, timing information, test results, artifacts and resource usage information through several tabs (1).

The output of each job can be opened in a new tab (in either raw or formatted styling) with a unique link, making it shareable between team members. You can also use the search functionality to find specific lines of output (2).

![Job tab options in the CircleCI web app](https://circleci.com/docs/assets/img/docs/pipelines-job-step-test-artifact.png)

## Passing parameters to jobs

Using parameters allows you to run a single job multiple times for different scenarios, such as different package versions or execution environments. An extension of this functionality is [matrix jobs](https://circleci.com/docs/configuration-reference/#matrix). Below is a basic example of passing a parameter to a job when it is run.

|     |     |
| --- | --- |
|  | **Using Docker?** Authenticating Docker pulls from image registries is recommended when using the Docker execution environment. Authenticated pulls allow access to private Docker images, and may also grant higher rate limits, depending on your registry provider. For further information see [Using Docker authenticated pulls](https://circleci.com/docs/private-images/). |

```yml
version: 2.1
​
jobs:
  print-a-message:
    docker:
      - image: cimg/base:2022.03
    parameters:
      message:
        type: string
    steps:
      - run: echo << parameters.message >>
​
workflows:
  my-workflow:
    jobs:
      - print-a-message:
          message: Hello!
```

## Using a job from an orb

Orbs are packages or reusable configuration that you can use in your projects. Orbs usually contain commands that you can use in your jobs, as well as whole jobs that you can schedule in your workflows.

Take the [Slack orb](https://circleci.com/developer/orbs/orb/circleci/slack) as an example. This orb provides a job called [`on-hold`](https://circleci.com/developer/orbs/orb/circleci/slack#usage-on_hold_notification), which you can use in your workflows. This job pauses the workflow to require manual approval, and sends a Slack notification. To use this job, reference it in your workflow (see line 10):

```yml
version: 2.1

orbs:
  slack: circleci/slack@4.1

workflows:
  on-hold-example:
    jobs:
      - my_test_job
      - slack/on-hold:
          context: slack-secrets
          requires:
            - my_test_job
      - pause_workflow:
          requires:
            - my_test_job
            - slack/on-hold
          type: approval
      - my_deploy_job:
          requires:
            - pause_workflow
```

## Using a command from an orb in a job

Using the [Slack orb](https://circleci.com/developer/orbs/orb/circleci/slack) as an example again, this orb includes a command called `notify`, which is used to notify a specified Slack channel. You can reference this command in your job as follows (see line 16):

This example also uses the [Node orb](https://circleci.com/developer/orbs/orb/circleci/node).

```yml
version: 2.1

orbs:
  node: 'circleci/node:4.1'
  slack: circleci/slack@4.1

jobs:
  deploy:
    executor:
      name: node/default
    steps:
      - checkout
      - node/install-packages
      - run:
          command: npm run deploy
      - slack/notify:
          channel: ABCXYZ
          event: fail
          template: basic_fail_1

workflows:
  deploy_and_notify:
    jobs:
      - deploy:
          context: slack-secrets
```

## Next steps

- Read more about orchestrating jobs in the [Using Workflows to Schedule Jobs](https://circleci.com/docs/workflows/) page.

- Read more about passing data between jobs in the [Using Workspaces to Share Data between Jobs](https://circleci.com/docs/workspaces/) page.


* * *

#### Suggest an edit to this page

[Make a contribution](https://github.com/circleci/circleci-docs/blob/master/jekyll/_cci2/jobs-steps.adoc)[Learn how to contribute](https://github.com/circleci/circleci-docs/blob/master/docs/CONTRIBUTING.md#contributing-to-circleci-docs)

#### Still need help?

[Ask the CircleCI community](https://discuss.circleci.com/)[Join the research community](https://circleci.com/research)[Visit our Support site](https://support.circleci.com/)

reCAPTCHA

Recaptcha requires verification.

[Privacy](https://www.google.com/intl/en/policies/privacy/) \- [Terms](https://www.google.com/intl/en/policies/terms/)

protected by **reCAPTCHA**

[Privacy](https://www.google.com/intl/en/policies/privacy/) \- [Terms](https://www.google.com/intl/en/policies/terms/)

---


## 5. Orbs overview {#section-5}

*Source: [https://circleci.com/docs/orb-intro/](https://circleci.com/docs/orb-intro/)*

[Docs](https://circleci.com/docs/)

[Start Building for Free](https://circleci.com/signup/)

[Home](https://circleci.com/developer/) [Docs](https://circleci.com/docs/) [Orbs](https://circleci.com/developer/orbs/) [Images](https://circleci.com/developer/images/)

[CircleCI.com](https://circleci.com/)[Academy](https://circleci.com/training/)[Blog](https://circleci.com/blog/)[Community](https://discuss.circleci.com/)[Support](https://support.circleci.com/hc/en-us/)

# Orbs overview

[1 month ago](https://github.com/circleci/circleci-docs/commits/master/jekyll/_cci2/orb-intro.adoc)4 min read

Last updated • Read time

Cloud

This document is applicable to CircleCI Cloud

Server v4+

This document is applicable to CircleCI Server v4+

##### On This Page

- [Introduction](https://circleci.com/docs/orb-intro/#introduction)
- [Quickstart](https://circleci.com/docs/orb-intro/#quickstart)
- [Use a registry orb](https://circleci.com/docs/orb-intro/#use-an-orb)
- [Node example](https://circleci.com/docs/orb-intro/#node-example)
- [Use a URL orb](https://circleci.com/docs/orb-intro/#use-a-url-orb)
- [Benefits of using orbs](https://circleci.com/docs/orb-intro/#benefits-of-using-orbs)
- [The orb registry](https://circleci.com/docs/orb-intro/#the-orb-registry)
- [Registry orb designations](https://circleci.com/docs/orb-intro/#orb-designation)
- [Public or private](https://circleci.com/docs/orb-intro/#public-or-private)
- [Orbs page in the CircleCI app](https://circleci.com/docs/orb-intro/#orbs-view)
- [See also](https://circleci.com/docs/orb-intro/#see-also)

Use orbs to:

- Simplify CI/CD configuration.

- Automate repeated CI/CD processes.

- Accelerate project setup.

- Simplify integration with third-party tools.


## Introduction

Orbs are reusable packages of parameterizable configuration that can be used in any project. They are made up of reusable configuration elements, for example: \* [jobs](https://circleci.com/docs/reusing-config/#authoring-parameterized-jobs) \\* [commands](https://circleci.com/docs/reusing-config/#authoring-reusable-commands) \\* [executors](https://circleci.com/docs/reusing-config/#executor).

CircleCI supports two types of orbs:

**Registry orbs**

Orbs that are developed and published using the orb publishing process. SemVer-based versioning is used to manage the versions of registry orbs. Registry orbs are available from the [Orbs Registry](https://circleci.com/developer/orbs)

**URL orbs**

Orbs that are stored in a publicly accessible location (for example, a git repository or a public S3 object) and are not published to the orbs registry. URL orbs do not follow semantic versioning, and can be accessed directly using an `https` URL. An org-level allow list is used to manage the addresses of URL orbs that can be used in a project in that organization. Manage the allow list at **Orbs**. See the [Managing URL orb allow-lists](https://circleci.com/docs/managing-url-orbs-allow-lists/) guide for more information on scoping allowed URL orbs for your organization.

Orbs are available for many languages, platforms, services, and tools. Visit the [Orbs Registry](https://circleci.com/developer/orbs) to search for orbs to help simplify your configuration.

If you would like to author your own orb, read more on the [Introduction to Authoring Orbs](https://circleci.com/docs/orb-author/) page.

## Quickstart

- Follow our [Node.js project quickstart guide](https://circleci.com/docs/language-javascript/).

- Follow our [Python project quickstart guide](https://circleci.com/docs/language-python/).

- Set up notifications using the [Slack orb](https://circleci.com/docs/slack-orb-tutorial/).


## Use a registry orb

A registry orb is identified by its _slug_ which contains the _namespace_, and _orb name_. A namespace is a unique identifier referring to the organization authoring a set of orbs. The orb name will be followed by an `@` symbol and a [semantic version](https://circleci.com/docs/orb-concepts/#semantic-versioning) string, identifying which version of the orb is being used. For example: `<namespace>/<orb-name>@1.2.3`.

Each orb within the [registry](https://circleci.com/developer/orbs) provides a [quickstart guide](https://circleci.com/developer/orbs/orb/circleci/node#quick-start), which contains a sample code snippet for importing that specific orb, with its most recent version, into your `.circleci/config.yml`.

The example below shows how to import any orb into your CircleCI configuration file. Use the tabs to switch between a generic layout for importing any orb, and a specific example of importing the Node.JS orb:

NodeGeneric

```yaml
version: 2.1

orbs:
  node: circleci/node@5.0.3
```

After the orb has been imported into the configuration file, the elements provided by the orb are available as `<orb-name>/<element>`. Orb elements can include jobs, commands, and executors. The parameters available for each element are listed in the orb registry in a table under each element.

Most orbs will also include usage examples detailing common functionality, to further simplify the process of incorporating them into your projects. If you would like to contribute to an existing orb, or file an issue on the orb’s repository, many orb authors will include the git repository link.

Orb elements can be used in the same way as [reusable configuration](https://circleci.com/docs/reusing-config/) elements. The Node example below shows how to use an orb’s default executor, and an orb command.

### Node example

The Node orb provides a command, [`install-packages`](https://circleci.com/developer/orbs/orb/circleci/node#commands-install-packages), to install your node packages, automatically enable caching, and provide additional options through the use of parameters. To use the `install-packages` command, reference it in a job’s [steps](https://circleci.com/docs/configuration-reference/#steps).

```yaml
version: 2.1

orbs:
  node: circleci/node@x.y # replace orb version

jobs:
  test:
    executor: node/default # use the default executor specified by the orb
    steps:
      - checkout
      - node/install-packages # Use a command from the orb in a job's steps
```

## Use a URL orb

To use a URL orb in your configuration, add the orb to the `orbs` section of your configuration file using the `https` URL of the orb repository. The URL must point to a repository that is accessible to CircleCI and must be allowed by the organization’s allow list.

The following example shows how to import a URL orb named `platform` into your configuration file. To use this orb, the `https://raw.githubusercontent.com/my-org/` prefix must exist in your org’s allow list.

```yaml
version: 2.1

orbs:
  platform: https://raw.githubusercontent.com/my-org/orbs/refs/heads/main/platform-team.yaml
```

After the orb has been imported into the configuration file, the elements provided by the orb are available as `<orb-name>/<element>`. Orb elements can include jobs, commands, and executors.

## Benefits of using orbs

Orbs provide parameterizable configuration elements that can greatly simplify your configuration. To illustrate this, the following example shows the following:

- A typical configuration for testing a Node.js application using the Node.JS orb (using the `test` job provided by the [`circleci/node`](https://circleci.com/developer/orbs/orb/circleci/node) orb).

- Configuration required without using the orb (defining a job with the required steps for testing the application).


Orbs let you pull in pre-defined, parameterized configuration elements into your project configuration. Taking it a step further, authoring your own orb lets you define parameterized configuration elements once and utilize them across multiple similar projects.

With OrbsWithout orbs

```yaml
version: 2.1

orbs:
  node: circleci/node@x.y # replace orb version https://circleci.com/developer/orbs/orb/circleci/node#quick-start

workflows:
  test_my_app:
    jobs:
      - node/test:
          version: <node-version> # replace node version
```

## The orb registry

The [Orb Registry](https://circleci.com/developer/orbs) is an open repository of all published orbs. Find the orb for your stack or consider developing and [publishing your own orb](https://circleci.com/docs/orb-author/).

![Orb Registry](https://circleci.com/docs/assets/img/docs/orbs-registry.png)

### Registry orb designations

|     |     |
| --- | --- |
|  | In order to use uncertified registry orbs (partner or community), your organization’s administrator must opt-in to allow uncertified orb usage on the **Security** page for your org. |

Orbs in the registry will appear with one of three different namespace designations:

| Designation | Description |
| --- | --- |
| Certified | Written and tested by the CircleCI team |
| Partner | Written by our technology partners |
| Community | Written by the community |

### Public or private

Orbs can be published in one of two ways:

- **Public**: Searchable in the orb registry, and available for anyone to use

- **Private**: Only available to use within your organization, and only findable in the registry with a direct URL and when authenticated


To understand these concepts further, read the [Public Orbs vs Private Orbs](https://circleci.com/docs/orb-concepts/#private-orbs-vs-public-orbs) section of the Orb Concepts page.

## Orbs page in the CircleCI app

|     |     |
| --- | --- |
|  | The orbs page in the CircleCI web app is not currently available on CircleCI server. |

|     |     |
| --- | --- |
|  | Private orb details pages may only be viewed by logged-in members of your organization. Unpublished orbs will not have linked details pages. |

To access the orbs page in the web app, navigate to **Organization Settings** and select **Orbs** from the sidebar.

The orbs page lists orbs created within your organization. You can view:

- Orb type (public or private)

- Orb usage (how many times the orb is used across all configurations)

- Latest version

- Description


Full orb details, including orb source, are accessible by clicking on the orb name. The orb details page is similar to the CircleCI orb registry in that the details page provides the orb’s contents, commands, and usage examples.

The orbs page also includes your org’s allow list URLs for URL orbs.

## See also

- Refer to [Orbs Concepts](https://circleci.com/docs/orb-concepts/) for high-level information about CircleCI orbs.

- Refer to [Orbs FAQ](https://circleci.com/docs/orbs-faq/) for information on known issues and questions that have been addressed when using CircleCI orbs.

- Refer to [Reusable Configuration Reference](https://circleci.com/docs/reusing-config/) for examples of reusable orbs, commands, parameters, and executors.

- Refer to [Orb Testing Methodologies](https://circleci.com/docs/testing-orbs/) for information on how to test orbs you have created.

- Refer to [Managing URL orb allow-lists](https://circleci.com/docs/managing-url-orbs-allow-lists/) for information on how to manage URL orb allow-lists.

- See the [How to override config](https://circleci.com/docs/how-to-override-config/) guide for information on how to override a job using an orb.


* * *

#### Suggest an edit to this page

[Make a contribution](https://github.com/circleci/circleci-docs/blob/master/jekyll/_cci2/orb-intro.adoc)[Learn how to contribute](https://github.com/circleci/circleci-docs/blob/master/docs/CONTRIBUTING.md#contributing-to-circleci-docs)

#### Still need help?

[Ask the CircleCI community](https://discuss.circleci.com/)[Join the research community](https://circleci.com/research)[Visit our Support site](https://support.circleci.com/)

reCAPTCHA

Recaptcha requires verification.

[Privacy](https://www.google.com/intl/en/policies/privacy/) \- [Terms](https://www.google.com/intl/en/policies/terms/)

protected by **reCAPTCHA**

[Privacy](https://www.google.com/intl/en/policies/privacy/) \- [Terms](https://www.google.com/intl/en/policies/terms/)

---


## 6. Execution environments overview {#section-6}

*Source: [https://circleci.com/docs/executor-intro/](https://circleci.com/docs/executor-intro/)*

[Docs](https://circleci.com/docs/)

[Start Building for Free](https://circleci.com/signup/)

[Home](https://circleci.com/developer/) [Docs](https://circleci.com/docs/) [Orbs](https://circleci.com/developer/orbs/) [Images](https://circleci.com/developer/images/)

[CircleCI.com](https://circleci.com/)[Academy](https://circleci.com/training/)[Blog](https://circleci.com/blog/)[Community](https://discuss.circleci.com/)[Support](https://support.circleci.com/hc/en-us/)

# Execution environments overview

[1 month ago](https://github.com/circleci/circleci-docs/commits/master/jekyll/_cci2/executor-intro.adoc)3 min read

Last updated • Read time

Cloud

This document is applicable to CircleCI Cloud

Server v4+

This document is applicable to CircleCI Server v4+

##### On This Page

- [Executors](https://circleci.com/docs/executor-intro/#executors)
- [Images, containers, and virtual machines](https://circleci.com/docs/executor-intro/#images-containers-and-virtual-machines)
- [Resource class](https://circleci.com/docs/executor-intro/#resource-class)
- [Docker](https://circleci.com/docs/executor-intro/#docker)
- [Linux VM](https://circleci.com/docs/executor-intro/#linux-vm)
- [macOS](https://circleci.com/docs/executor-intro/#macos)
- [Windows](https://circleci.com/docs/executor-intro/#windows)
- [GPU](https://circleci.com/docs/executor-intro/#gpu)
- [Arm VM](https://circleci.com/docs/executor-intro/#arm)
- [Self-hosted runner](https://circleci.com/docs/executor-intro/#self-hosted-runner)
- [Port ranges](https://circleci.com/docs/executor-intro/#port-ranges)
- [Next steps](https://circleci.com/docs/executor-intro/#next-steps)

CircleCI offers several execution environments:

- Docker (x86 or Arm)

- Linux VM (virtual machine)

- macOS

- Windows

- GPU

- Arm VM


Each job defined in your project configuration is run in a separate execution environment, either a Docker container or a virtual machine.

## Executors

For each job in your project config you will specify an execution environment by assigning it an **executor**. An **executor** defines the underlying technology or environment in which to run a job, and which image to use to suit your job.

It is possible to specify a different executor and image for each job in your [.configuration file](https://circleci.com/docs/configuration-reference/).

### Images, containers, and virtual machines

An _image_ is a packaged system that has the instructions for creating a running environment.

A _container_ or _virtual machine_ is the term used for a running instance of an image.

For example:

- Jobs that require Docker images ( `docker`) may use an image for Node.js, Python etc. The [pre-built CircleCI Docker image](https://circleci.com/docs/circleci-images/) (convenience images) will help you get started. CircleCI convenience images are not a full operating system, so they generally make building your software more efficient.

- Jobs that require a complete Linux virtual machine (VM) image ( `machine`) may use an Ubuntu version supported by the [list of available machine images](https://circleci.com/docs/configuration-reference/#available-linux-machine-images-cloud).

- Jobs that require a macOS VM image ( `macos`) may use an Xcode version. A full list is available on the [Using macOS](https://circleci.com/docs/using-macos/#supported-xcode-versions) page.


### Resource class

When you configure an executor it is recommended that you also specify a resource class to specify compute resource size (CPU and RAM).

- For an overview of resource classes, see the [Resource class overview](https://circleci.com/docs/resource-class-overview/) page.

- For an overview of available resource classes per Plan, see the [Pricing page](https://circleci.com/pricing).


## Docker

|     |     |
| --- | --- |
|  | **Legacy images with the prefix "circleci/" were [deprecated](https://discuss.circleci.com/t/legacy-convenience-image-deprecation/41034)** on December 31, 2021. For faster builds, upgrade your projects with [next-generation convenience images](https://circleci.com/blog/announcing-our-next-generation-convenience-images-smaller-faster-more-deterministic). |

To access the Docker execution environment, use the `docker` executor and specify an image. For a full list of convenience images, which are built by CircleCI, see the [CircleCI Developer Hub](https://circleci.com/developer/images?imageType=docker)

```yml
jobs:
  build: # name of your job
    docker: # executor type
      - image: cimg/base:stable # primary container will run the latest, production-ready base image

    steps:
        # Commands run in the primary container
```

Find out more about the Docker execution environment on the [Using Docker](https://circleci.com/docs/using-docker/) page.

## Linux VM

|     |     |
| --- | --- |
|  | **CircleCI cloud** The use of `machine: true` is deprecated. You must specify an image to use. |

To access the Linux VM execution environment, use the `machine` executor and specify a Linux image. For a full list of `machine` images, see the [CircleCI Developer Hub](https://circleci.com/developer/images?imageType=machine)

CloudServer

```yml
jobs:
  build: # name of your job
    machine: # executor type
      image: ubuntu-2204:current

    steps:
        # Commands run in a Linux virtual machine environment
```

Find out more about the Linux VM execution environment in the [Using Linux Virtual Machines](https://circleci.com/docs/using-linuxvm/) page.

## macOS

To access the macOS execution environment, use the `macos` executor and specify an image using the `xcode` key. For a full list of macOS images, see the [CircleCI Developer Hub](https://circleci.com/developer/machine/image/macos).

|     |     |
| --- | --- |
|  | If you want to run a macOS build on CircleCI server, you will need to use [self-hosted runner](https://circleci.com/docs/runner-overview/). |

```yml
jobs:
  build: # name of your job
    macos: # executor type
      xcode: 14.2.0

    steps:
      # Commands run in a macOS virtual machine environment
      # with Xcode 14.2.0 installed
```

Find out more about the macOS execution environment on the [Using macOS](https://circleci.com/docs/using-macos/) page.

## Windows

To access the Windows execution environment, you can either:

- Use the Windows orb and specify one of the default executors.

- Use the `machine` executor and specify a Windows image.


For a full list of `machine` images, see the [CircleCI Developer Hub](https://circleci.com/developer/images?imageType=machine).

Cloud with orbCloudServer

```yml
version: 2.1

orbs:
  win: circleci/windows@4.1.1 # The Windows orb gives you everything you need to start using the Windows executor

jobs:
  build: # name of your job
    executor: win/server-2022 # use one of the executors defined within the windows orb

    steps:
      # Commands are run in a Windows virtual machine environment
      - checkout
      - run: Write-Host 'Hello, Windows'
```

Find out more about the Windows execution environment in the [Using the Windows Execution Environment](https://circleci.com/docs/using-windows/) page. See [the Windows orb page in the developer hub](https://circleci.com/developer/orbs/orb/circleci/windows) for the list of options available in the Windows orb.

## GPU

To access the GPU execution environment, use one of the following:

- The Windows orb and specify the GPU-enabled executor.

- The `machine` executor and specify a Linux or Windows GPU-enabled image.


For a full list of `machine` images, see the [CircleCI Developer Hub](https://circleci.com/developer/images?imageType=machine).

|     |     |
| --- | --- |
|  | It is not possible to run a GPU build on CircleCI server. |

LinuxWindows without orbWindows with orb

```yml
version: 2.1

jobs:
  build:
    machine:
      image: linux-cuda-12:default
    resource_class: gpu.nvidia.medium
    steps:
      - run: nvidia-smi
```

Find out more about the GPU execution environment on the [Using the GPU Execution Environment](https://circleci.com/docs/using-gpu/) page.

## Arm VM

To access the Arm VM execution environment, use the `machine` executor as detailed below, and specify either the `arm.medium` or the `arm.large` resource class. For a full list of `machine` images, see the [CircleCI Developer Hub](https://circleci.com/developer/images?imageType=machine).

CloudServer on AWS

```yml
# .circleci/config.yml
version: 2.1

jobs:
  build-medium:
    machine:
      image: ubuntu-2204:current
    resource_class: arm.medium
    steps:
      - run: uname -a
      - run: echo "Hello, Arm!"

  build-large:
    machine:
      image: ubuntu-2204:current
    resource_class: arm.large
    steps:
      - run: uname -a
      - run: echo "Hello, Arm!"

workflows:
  build:
    jobs:
      - build-medium
      - build-large
```

Find out more about the Arm VM execution environment in the [Using the Arm VM Execution Environment](https://circleci.com/docs/using-arm/) page. You can also use [Arm on Docker](https://circleci.com/docs/using-docker/#arm).

## Self-hosted runner

CircleCI provides the ability to have self-hosted runners:

- [Container runner](https://circleci.com/docs/container-runner/) using Kubernetes.

- [Machine runner](https://circleci.com/docs/runner-overview/#machine-runner-use-case) using Linux, Windows, and macOS virtual machines.


## Port ranges

When using a machine executor, if a port range is hard coded, the range in `/proc/sys/net/ipv4/ip_local_reserved_ports` should be avoided. Port range 32768 - 60999 is used by the TCP stack to allocate ephemeral ports for connections. Ports in that range may have already been allocated by a previous connection, so collisions are possible.

## Next steps

- Read more about [Pre-built CircleCI convenience images](https://circleci.com/docs/circleci-images/) for the Docker execution environment.


* * *

#### Suggest an edit to this page

[Make a contribution](https://github.com/circleci/circleci-docs/blob/master/jekyll/_cci2/executor-intro.adoc)[Learn how to contribute](https://github.com/circleci/circleci-docs/blob/master/docs/CONTRIBUTING.md#contributing-to-circleci-docs)

#### Still need help?

[Ask the CircleCI community](https://discuss.circleci.com/)[Join the research community](https://circleci.com/research)[Visit our Support site](https://support.circleci.com/)

reCAPTCHA

Recaptcha requires verification.

[Privacy](https://www.google.com/intl/en/policies/privacy/) \- [Terms](https://www.google.com/intl/en/policies/terms/)

protected by **reCAPTCHA**

[Privacy](https://www.google.com/intl/en/policies/privacy/) \- [Terms](https://www.google.com/intl/en/policies/terms/)

---


## 7. Testing iOS applications on macOS {#section-7}

*Source: [https://circleci.com/docs/ios-tutorial/](https://circleci.com/docs/ios-tutorial/)*

[Docs](https://circleci.com/docs/)

[Start Building for Free](https://circleci.com/signup/)

[Home](https://circleci.com/developer/) [Docs](https://circleci.com/docs/) [Orbs](https://circleci.com/developer/orbs/) [Images](https://circleci.com/developer/images/)

[CircleCI.com](https://circleci.com/)[Academy](https://circleci.com/training/)[Blog](https://circleci.com/blog/)[Community](https://discuss.circleci.com/)[Support](https://support.circleci.com/hc/en-us/)

# Testing iOS applications on macOS

[3 months ago](https://github.com/circleci/circleci-docs/commits/master/jekyll/_cci2/testing-ios.adoc)7 min read

Last updated • Read time

Cloud

This document is applicable to CircleCI Cloud

##### On This Page

- [Overview](https://circleci.com/docs/testing-ios/#overview)
- [Supported Xcode versions](https://circleci.com/docs/testing-ios/#supported-xcode-versions)
- [Supported Xcode versions for Apple silicon](https://circleci.com/docs/testing-ios/#supported-xcode-versions-silicon)
- [Getting started](https://circleci.com/docs/testing-ios/#getting-started)
- [Setting up your Xcode project](https://circleci.com/docs/testing-ios/#setting-up-your-xcode-project)
- [Using Fastlane](https://circleci.com/docs/testing-ios/#using-fastlane)
- [Adding a Gemfile](https://circleci.com/docs/testing-ios/#adding-a-gemfile)
- [Setting up Fastlane for use on CircleCI](https://circleci.com/docs/testing-ios/#setting-up-fastlane-for-use-on-circleci)
- [Example configuration for using Fastlane on CircleCI](https://circleci.com/docs/testing-ios/#example-configuration-for-using-fastlane-on-circleci)
- [Code signing with Fastlane Match](https://circleci.com/docs/testing-ios/#code-signing-with-fastlane-match)
- [Using Ruby](https://circleci.com/docs/testing-ios/#using-ruby)
- [Switching Rubies with the macOS orb](https://circleci.com/docs/testing-ios/#switching-rubies-with-the-macos-orb)
- [Switching Rubies manually](https://circleci.com/docs/testing-ios/#switching-rubies-manually)
- [Installing additional Ruby versions](https://circleci.com/docs/testing-ios/#installing-additional-ruby-versions)
- [Using custom versions of CocoaPods and other Ruby gems](https://circleci.com/docs/testing-ios/#using-custom-versions-of-cocoapods-and-other-ruby-gems)
- [Using NodeJS](https://circleci.com/docs/testing-ios/#using-nodejs)
- [Images using Xcode 13 and later](https://circleci.com/docs/testing-ios/#images-using-xcode-13-and-later)
- [Images using Xcode 12.5 and earlier](https://circleci.com/docs/testing-ios/#images-using-xcode-125-and-earlier)
- [Using Homebrew](https://circleci.com/docs/testing-ios/#using-homebrew)
- [Configuring deployment](https://circleci.com/docs/testing-ios/#configuring-deployment)
- [Troubleshooting](https://circleci.com/docs/testing-ios/#troubleshooting)
- [Next steps](https://circleci.com/docs/testing-ios/#next-steps)

This document describes how to set up and customize testing for an iOS application with CircleCI.

## Overview

CircleCI offers support for building, testing, and deploying iOS projects on macOS virtual machines. Each image provided has a set of common tools installed, such as Ruby and OpenJDK, alongside a version of Xcode. For more information about supplied images, refer to the [software manifest](https://circleci.com/docs/testing-ios/#supported-xcode-versions) for each Xcode image.

Refer to [iOS code signing projects](https://circleci.com/docs/ios-codesigning/) and [getting started on macOS](https://circleci.com/docs/hello-world-macos/) pages for further information.

## Supported Xcode versions

### Supported Xcode versions for Apple silicon

| Config | Xcode Version | macOS Version | Supported Resource Classes | VM Software Manifest | Release Notes |
| --- | --- | --- | --- | --- | --- |
| `16.4.0` | Xcode 16.4 GA (16F6) | 15.3.2 | - m4pro.medium<br>  <br>- m4pro.large<br>  <br>- m2pro.medium<br>  <br>- m2pro.large<br>  <br>- macos.m1.medium.gen1<br>  <br>- macos.m1.large.gen1 | [Installed software](https://circle-macos-docs.s3.amazonaws.com/image-manifest/v15338/manifest.txt) | [Release Notes](https://circleci.com/changelog/xcode-16-4-ga-available) |
| `16.3.0` | Xcode 16.3 (16E140) | 15.3.2 | - m4pro.medium<br>  <br>- m4pro.large<br>  <br>- m2pro.medium<br>  <br>- m2pro.large<br>  <br>- macos.m1.medium.gen1<br>  <br>- macos.m1.large.gen1 | [Installed software](https://circle-macos-docs.s3.amazonaws.com/image-manifest/v15328/manifest.txt) | [Release Notes](https://circleci.com/changelog/xcode-16-3-available) |
| `16.2.0` | Xcode 16.2 GA (16C5032a) | 14.6.1 | - m4pro.medium<br>  <br>- m4pro.large<br>  <br>- m2pro.medium<br>  <br>- m2pro.large<br>  <br>- macos.m1.medium.gen1<br>  <br>- macos.m1.large.gen1 | [Installed software](https://circle-macos-docs.s3.amazonaws.com/image-manifest/v15180/manifest.txt) | [Release Notes](https://discuss.circleci.com/t/xcode-16-2-ga-released/52486) |
| `16.1.0` | Xcode 16.1 (16B40) | 14.6.1 | - m4pro.medium<br>  <br>- m4pro.large<br>  <br>- m2pro.medium<br>  <br>- m2pro.large<br>  <br>- macos.m1.medium.gen1<br>  <br>- macos.m1.large.gen1 | [Installed software](https://circle-macos-docs.s3.amazonaws.com/image-manifest/v15121/manifest.txt) | [Release Notes](https://discuss.circleci.com/t/xcode-16-1-ga-released/52229) |
| `16.0.0` | Xcode 16.0 (16A242d) | 14.6.1 | - m4pro.medium<br>  <br>- m4pro.large<br>  <br>- m2pro.medium<br>  <br>- m2pro.large<br>  <br>- macos.m1.medium.gen1<br>  <br>- macos.m1.large.gen1 | [Installed software](https://circle-macos-docs.s3.amazonaws.com/image-manifest/v15048/manifest.txt) | [Release Notes](https://discuss.circleci.com/t/xcode-16-ga-released/51990) |
| `15.4.0` | Xcode 15.4 (15F31d) | 14.3.1 | - m4pro.medium<br>  <br>- m4pro.large<br>  <br>- m2pro.medium<br>  <br>- m2pro.large<br>  <br>- macos.m1.medium.gen1<br>  <br>- macos.m1.large.gen1 | [Installed software](https://circle-macos-docs.s3.amazonaws.com/image-manifest/v14775/manifest.txt) | [Release Notes](https://discuss.circleci.com/t/xcode-15-4-0-ga-released/50897) |
| `15.3.0` | Xcode 15.3 (15E204a) | 14.3.1 | - m4pro.medium<br>  <br>- m4pro.large<br>  <br>- m2pro.medium<br>  <br>- m2pro.large<br>  <br>- macos.m1.medium.gen1<br>  <br>- macos.m1.large.gen1 | [Installed software](https://circle-macos-docs.s3.amazonaws.com/image-manifest/v14490/manifest.txt) | [Release Notes](https://discuss.circleci.com/t/xcode-15-3-ga-released/50717) |
| `15.2.0` | Xcode 15.2 (15C500b) | 14.1 | - m4pro.medium<br>  <br>- m4pro.large<br>  <br>- m2pro.medium<br>  <br>- m2pro.large<br>  <br>- macos.m1.medium.gen1<br>  <br>- macos.m1.large.gen1 | [Installed software](https://circle-macos-docs.s3.amazonaws.com/image-manifest/v14040/manifest.txt) | [Release Notes](https://discuss.circleci.com/t/xcode-15-2-released/50197) |
| `15.1.0` | Xcode 15.1 (15C65) | 14.1 | - m4pro.medium<br>  <br>- m4pro.large<br>  <br>- m2pro.medium<br>  <br>- m2pro.large<br>  <br>- macos.m1.medium.gen1<br>  <br>- macos.m1.large.gen1 | [Installed software](https://circle-macos-docs.s3.amazonaws.com/image-manifest/v13944/manifest.txt) | [Release Notes](https://discuss.circleci.com/t/xcode-15-1-rc-released/50026) |
| `15.0.0` | Xcode 15 (15A240d) | 13.5.1 | - m2pro.medium<br>  <br>- m2pro.large<br>  <br>- macos.m1.medium.gen1<br>  <br>- macos.m1.large.gen1 | [Installed software](https://circle-macos-docs.s3.amazonaws.com/image-manifest/v13456/manifest.txt) | [Release Notes](https://discuss.circleci.com/t/xcode-15-rc-released-important-notice-for-visionos-sdk-users/49278) |
| `14.3.1` | Xcode 14.3.1 (14E300b) | 13.2.1 | - m4pro.medium<br>  <br>- m4pro.large<br>  <br>- m2pro.medium<br>  <br>- m2pro.large<br>  <br>- macos.m1.medium.gen1<br>  <br>- macos.m1.large.gen1 | [Installed software](https://circle-macos-docs.s3.amazonaws.com/image-manifest/v12128/manifest.txt) | [Release Notes](https://discuss.circleci.com/t/xcode-14-3-1-rc-released/48152) |
| `14.2.0` | Xcode 14.2 (14C18) | 12.6.3 | - m2pro.medium<br>  <br>- m2pro.large<br>  <br>- macos.m1.medium.gen1<br>  <br>- macos.m1.large.gen1 | [Installed software](https://circle-macos-docs.s3.amazonaws.com/image-manifest/v11441/manifest.txt) | [Release Notes](https://discuss.circleci.com/t/announcing-apple-silicon-m1-support-now-available/46908) |
| `14.1.0` | Xcode 14.1 (14B47b) | 12.6.1 | - m2pro.medium<br>  <br>- m2pro.large<br>  <br>- macos.m1.medium.gen1<br>  <br>- macos.m1.large.gen1 | [Installed software](https://circle-macos-docs.s3.amazonaws.com/image-manifest/v11763/manifest.txt) | [Release Notes](https://discuss.circleci.com/t/announcing-m1-large-now-available-on-performance-plans/47797/22) |
| `14.0.1` | Xcode 14.0.1 (14A400) | 12.6.1 | - m2pro.medium<br>  <br>- m2pro.large<br>  <br>- macos.m1.medium.gen1<br>  <br>- macos.m1.large.gen1 | [Installed software](https://circle-macos-docs.s3.amazonaws.com/image-manifest/v11770/manifest.txt) | [Release Notes](https://discuss.circleci.com/t/announcing-m1-large-now-available-on-performance-plans/47797/22) |
| `13.4.1` | Xcode 13.4.1 (13F100) | 12.6.1 | - m4pro.medium<br>  <br>- m4pro.large<br>  <br>- m2pro.medium<br>  <br>- m2pro.large<br>  <br>- macos.m1.medium.gen1<br>  <br>- macos.m1.large.gen1 | [Installed software](https://circle-macos-docs.s3.amazonaws.com/image-manifest/v11776/manifest.txt) | [Release Notes](https://discuss.circleci.com/t/announcing-m1-large-now-available-on-performance-plans/47797/22) |

## Getting started

Select a macOS project repository you would like to build from the **Projects** page of the [CircleCI web app](https://app.circleci.com/).

We highly recommend using [Fastlane](https://fastlane.tools/) to build and sign your apps in CircleCI. Fastlane requires minimal configuration in most cases and simplifies the build-test-deploy process.

### Setting up your Xcode project

After setting up the project on CircleCI, you will need to ensure that the scheme you intend to build with Fastlane is marked as "shared" in your Xcode project. In most new projects created by Xcode, the default scheme will already be marked as "shared". To verify this, or to share an existing scheme, complete the following steps:

1. In Xcode, choose Product -> Scheme -> Manage Schemes

2. Select the "Shared" option for the scheme to share, and select **Close**

3. Ensure the `myproject.xcodeproj/xcshareddata/xcschemes` directory is checked into your Git repository and push the changes


Simple projects should run with minimal configuration.

## Using Fastlane

[Fastlane](https://fastlane.tools/) is a set of tools for automating the build and deploy process of mobile apps. We encourage the use of Fastlane on CircleCI as it simplifies the setup and automation of the build, test and deploy process. Additionally, it allows parity between local and CircleCI builds.

### Adding a Gemfile

It is recommended to add a `Gemfile` to your repository to make sure that the same version of Fastlane is used both locally and on CircleCI and that all dependencies are installed. Below is a sample of a simple `Gemfile`:

```ruby
# Gemfile
source "https://rubygems.org"
gem 'fastlane'
```

After you have created a `Gemfile` locally, you will need to run `bundle install` and check both `Gemfile` and `Gemfile.lock` into your project repository.

### Setting up Fastlane for use on CircleCI

When using Fastlane in your CircleCI project, we recommend adding the following to beginning of your `Fastfile`:

```ruby
# fastlane/Fastfile

...
platform :ios do
  before_all do
    setup_circle_ci
  end
  ...
end
```

The `setup_circle_ci` Fastlane action must be in the `before_all` block to perform the following actions:

- Create a new temporary keychain for use with Fastlane Match (see the code signing section for more details).

- Switch Fastlane Match to `readonly` mode to make sure CI does not create new code signing certificates or provisioning profiles.

- Set up log and test result paths to be collectible.


### Example configuration for using Fastlane on CircleCI

A basic Fastlane configuration that can be used on CircleCI is as follows:

```ruby
# fastlane/Fastfile
default_platform :ios

platform :ios do
  before_all do
    setup_circle_ci
  end

  desc "Runs all the tests"
  lane :test do
    scan
  end

  desc "Ad-hoc build"
  lane :adhoc do
    match(type: "adhoc")
    gym(export_method: "ad-hoc")
  end
end
```

This configuration can be used with the following CircleCI configuration file:

```yaml
# .circleci/config.yml
version: 2.1
jobs:
  build-and-test:
    macos:
      xcode: 14.0.1
    environment:
      FL_OUTPUT_DIR: output
      FASTLANE_LANE: test
    steps:
      - checkout
      - run: bundle install
      - run:
          name: Fastlane
          command: bundle exec fastlane $FASTLANE_LANE
      - store_artifacts:
          path: output
      - store_test_results:
          path: output/scan

  adhoc:
    macos:
      xcode: 14.0.1
    environment:
      FL_OUTPUT_DIR: output
      FASTLANE_LANE: adhoc
    steps:
      - checkout
      - run: bundle install
      - run:
          name: Fastlane
          command: bundle exec fastlane $FASTLANE_LANE
      - store_artifacts:
          path: output

workflows:
  build-test-adhoc:
    jobs:
      - build-and-test
      - adhoc:
          filters:
            branches:
              only: development
          requires:
            - build-and-test
```

The environment variable `FL_OUTPUT_DIR` is the artifact directory where Fastlane logs and signed `.ipa` file should be stored. Use this to set the path in the `store_artifacts` step to automatically save logs and build artifacts from Fastlane.

### Code signing with Fastlane Match

We recommend the use of Fastlane Match for signing your iOS applications as it simplifies and automates the process of code signing both locally and in the CircleCI environment.

For more information on how to get started with Fastlane Match, visit the [iOS code signing](https://circleci.com/docs/ios-codesigning/) page.

## Using Ruby

Our Xcode images ship with multiple versions of Ruby installed. The versions we install are the latest stable versions of Ruby, according to [Ruby-Lang.org downloads page](https://www.ruby-lang.org/en/downloads/), at the time the image is built. The versions of Ruby that are installed in each image, along with the default Ruby selected for that image, are listed in the software manifests of each container (see [supported Xcode versions](https://circleci.com/docs/testing-ios/#supported-xcode-versions)).

Installing gems with the system Ruby is not advised due to the restrictive permissions enforced on the system directories. As a general rule, CircleCI advises using one of the alternative Rubies provided by chruby (as configured by default in all images) for jobs.

### Switching Rubies with the macOS orb

Using the official macOS orb (version `2.0.0` and above) is the easiest way to switch Rubies in your jobs. It automatically uses the correct switching command, regardless of which Xcode image is in use.

To get started, include the orb at the top of your configuration:

```yaml
# ...
orbs:
  macos: circleci/macos@2
```

Then, call the `switch-ruby` command with the version number required. For example, to switch to Ruby 2.6:

```yaml
steps:
  # ...
  - macos/switch-ruby:
      version: "3.1"
```

Replace `3.1` with the version you require from the Software Manifest file. You do not need to specify the full Ruby version, `3.1.3` for example, just the major version. This will ensure your configuration does not break when switching to newer images that might have newer patch versions of Ruby.

To switch back to the system default Ruby (the Ruby shipped by Apple with macOS), define the `version` as `system`:

```yaml
steps:
  # ...
  - macos/switch-ruby:
      version: "system"
```

### Switching Rubies manually

For Xcode version `14.2` and higher, add the following to the beginning of your job.

```yaml
steps:
  # ...
  - run:
      name: Set Ruby Version
      command: rbenv global 3.1.3 && rbenv rehash
```

Replace `3.1.3` with the version of Ruby required.

To revert back to the system Ruby, specify `system` as the Ruby version.

For Xcode versions `14.1` and lower, add the following to the beginning of your job.

```yaml
steps:
  # ...
  - run:
      name: Set Ruby Version
      command: sed -i '' 's/^chruby.*/chruby ruby-3.1.3/g' ~/.bash_profile
```

Replace `3.1.3` with the version of Ruby required.

To revert back to the system Ruby, specify `system` as the Ruby version.

### Installing additional Ruby versions

Installing additional Ruby versions consumes a lot of job time. We only recommend doing this if you must use a specific version that is not installed in the image by default.

To run a job with a version of Ruby that is not pre-installed, you must install the required version of Ruby.

For Xcode versions `14.2` and higher, this can be done with the `rbenv install` command, ensuring you pass the version of Ruby required. If a newer version of Ruby is not available, you will need to update the `ruby-build` package ( `brew upgrade ruby-build`) to ensure the latest Ruby version definitions are available.

For Xcode versions `14.1` and lower, we use the [`ruby-install`](https://github.com/postmodern/ruby-install) tool to install the required version. After the install is complete, you can select it using the appropriate technique above.

### Using custom versions of CocoaPods and other Ruby gems

To make sure the version of CocoaPods that you use locally is also used in your CircleCI builds, we suggest creating a Gemfile in your iOS project and adding the CocoaPods version to it:

```ruby
source 'https://rubygems.org'

gem 'cocoapods', '= 1.3.0'
```

Then you can install these using Bundler:

```yaml
steps:
  - restore_cache:
      key: 1-gems-{{ checksum "Gemfile.lock" }}
  - run: bundle check || bundle install --path vendor/bundle --clean
  - save_cache:
      key: 1-gems-{{ checksum "Gemfile.lock" }}
      paths:
        - vendor/bundle
```

You can then ensure you are using those, by prefixing commands with `bundle exec`:

```yaml
# ...
steps:
  - run: bundle exec pod install
```

## Using NodeJS

The Xcode images are supplied with at least one version of NodeJS ready to use.

### Images using Xcode 13 and later

These images have NodeJS installations managed by `nvm` and will always be supplied with the latest `current` and `lts` release as of the time the image was built Additionally, `lts` is set as the default NodeJS version.

Version information for the installed NodeJS versions can be found in [the software manifests for the image](https://circleci.com/docs/testing-ios/#supported-xcode-versions)\], or by running `nvm ls` during a job.

To set the `current` version as the default:

```yaml
# ...
steps:
  - run: nvm alias default node
```

To revert to the `lts` release:

```yaml
# ...
steps:
  - run: nvm alias default --lts
```

To install a specific version of NodeJS and use it:

```yaml
# ...
steps:
  - run: nvm install 12.22.3 && nvm alias default 12.22.3
```

These images are also compatible with the official [CircleCI Node orb](https://circleci.com/developer/orbs/orb/circleci/node), which helps to manage your NodeJS installation along with caching packages.

### Images using Xcode 12.5 and earlier

These images come with at least one version of NodeJS installed directly using `brew`.

Version information for the installed NodeJS versions can be found in the software manifests for the image (see [supported Xcode versions](https://circleci.com/docs/testing-ios/#supported-xcode-versions)).

These images are also compatible with the official [CircleCI Node orb](https://circleci.com/developer/orbs/orb/circleci/node) which helps to manage your NodeJS installation, by installing `nvm`, along with caching packages.

## Using Homebrew

[Homebrew](https://brew.sh/) is pre-installed on CircleCI, so you can simply use `brew install` to add nearly any dependency you require to complete your build. For example:

```yaml
# ...
steps:
  - run:
      name: Install cowsay
      command: brew install cowsay
  - run:
      name: cowsay hi
      command: cowsay Hi!
```

It is also possible to use the `sudo` command if necessary to perform customizations outside of Homebrew.

## Configuring deployment

After the app has been tested and signed, you are ready to configure deployment to your service of choice, such as App Store Connect or TestFlight. For more information on how to deploy to various services, including example Fastlane configurations, check out the [deploying iOS apps guide](https://circleci.com/docs/deploy-ios-applications/).

## Troubleshooting

If you are facing build failures while executing your jobs, check out our [support center knowledge base](https://support.circleci.com/hc/en-us/categories/115001914008-Mobile) for answers to common issues.

## Next steps

- See the [`circleci-demo-ios` GitHub repository](https://github.com/CircleCI-Public/circleci-demo-ios) for a full example of how to build, test, sign and deploy an iOS project using Fastlane on CircleCI.

- See the [iOS code signing](https://circleci.com/docs/ios-codesigning/) page to learn how to configure Fastlane Match for your project.


* * *

#### Suggest an edit to this page

[Make a contribution](https://github.com/circleci/circleci-docs/blob/master/jekyll/_cci2/testing-ios.adoc)[Learn how to contribute](https://github.com/circleci/circleci-docs/blob/master/docs/CONTRIBUTING.md#contributing-to-circleci-docs)

#### Still need help?

[Ask the CircleCI community](https://discuss.circleci.com/)[Join the research community](https://circleci.com/research)[Visit our Support site](https://support.circleci.com/)

reCAPTCHA

Recaptcha requires verification.

[Privacy](https://www.google.com/intl/en/policies/privacy/) \- [Terms](https://www.google.com/intl/en/policies/terms/)

protected by **reCAPTCHA**

[Privacy](https://www.google.com/intl/en/policies/privacy/) \- [Terms](https://www.google.com/intl/en/policies/terms/)

---


## 8. Page Not Found {#section-8}

*Source: [https://circleci.com/docs/android-tutorial/](https://circleci.com/docs/android-tutorial/)*

[Docs](https://circleci.com/docs/)

[Start Building for Free](https://circleci.com/signup/)

[Home](https://circleci.com/developer/) [Docs](https://circleci.com/docs/) [Orbs](https://circleci.com/developer/orbs/) [Images](https://circleci.com/developer/images/)

[CircleCI.com](https://circleci.com/)[Academy](https://circleci.com/training/)[Blog](https://circleci.com/blog/)[Community](https://discuss.circleci.com/)[Support](https://support.circleci.com/hc/en-us/)

404 Error

# Page Not Found

We can't find what you're looking for, but the links below may get you back on track.

Go Back [Go to Homepage](https://circleci.com/docs/)

![](https://circleci.com/docs/background-images/404-background-narrow.svg)

reCAPTCHA

Recaptcha requires verification.

[Privacy](https://www.google.com/intl/en/policies/privacy/) \- [Terms](https://www.google.com/intl/en/policies/terms/)

protected by **reCAPTCHA**

[Privacy](https://www.google.com/intl/en/policies/privacy/) \- [Terms](https://www.google.com/intl/en/policies/terms/)

---


## 9. Test splitting and parallelism {#section-9}

*Source: [https://circleci.com/docs/parallelism-faster-jobs/](https://circleci.com/docs/parallelism-faster-jobs/)*

[Docs](https://circleci.com/docs/)

[Start Building for Free](https://circleci.com/signup/)

[Home](https://circleci.com/developer/) [Docs](https://circleci.com/docs/) [Orbs](https://circleci.com/developer/orbs/) [Images](https://circleci.com/developer/images/)

[CircleCI.com](https://circleci.com/)[Academy](https://circleci.com/training/)[Blog](https://circleci.com/blog/)[Community](https://discuss.circleci.com/)[Support](https://support.circleci.com/hc/en-us/)

# Test splitting and parallelism

[3 months ago](https://github.com/circleci/circleci-docs/commits/master/jekyll/_cci2/parallelism-faster-jobs.adoc)6 min read

Last updated • Read time

Cloud

This document is applicable to CircleCI Cloud

Server v4+

This document is applicable to CircleCI Server v4+

##### On This Page

- [Introduction](https://circleci.com/docs/parallelism-faster-jobs/#introduction)
- [Quickstart](https://circleci.com/docs/parallelism-faster-jobs/#quickstart)
- [Specify parallel environments for a test job](https://circleci.com/docs/parallelism-faster-jobs/#specify-a-jobs-parallelism-level)
- [Use parallelism with self-hosted runners](https://circleci.com/docs/parallelism-faster-jobs/#use-parallelism-with-self-hosted-runners)
- [How test splitting works](https://circleci.com/docs/parallelism-faster-jobs/#how-test-splitting-works)
- [Example using timing-based test splitting](https://circleci.com/docs/parallelism-faster-jobs/#example-using-timing-based-test-splitting)
- [The tests run command](https://circleci.com/docs/parallelism-faster-jobs/#the-tests-run-command)
- [The tests split command](https://circleci.com/docs/parallelism-faster-jobs/#the-tests-split-command)
- [JUnit XML report formatting](https://circleci.com/docs/parallelism-faster-jobs/#junit-xml-reports)
- [Manual allocation](https://circleci.com/docs/parallelism-faster-jobs/#manual-allocation)
- [Other ways to split tests](https://circleci.com/docs/parallelism-faster-jobs/#other-ways-to-split-tests)
- [Next steps](https://circleci.com/docs/parallelism-faster-jobs/#next-steps)

Use parallelism and test splitting to:

- Reduce the time taken for the testing portion of your CI/CD pipeline.

- Specify a number of [executors](https://circleci.com/docs/executor-intro/) across which to split your tests.

- Split your test suite using one of the options provided by the CircleCI CLI: by name, size or by using timing data.


If you are interested to read about concurrent job runs, see the [Concurrency overview](https://circleci.com/docs/concurrency/) page.

## Introduction

Pipelines are often configured so that a set of tests are run each time code is committed. The more tests your project has, the longer it will take for them to complete using a single compute resource. To reduce this time, you can split your tests and run them across multiple, parallel-running execution environments. Test splitting is a great way to speed up the testing portion of your CI/CD pipeline.

CircleCI test splitting lets you intelligently define where splits happen across a test suite:

- By **name**

- By **size**

- Using **timing** data


It is also possible to use the CLI to [manually allocate tests](https://circleci.com/docs/parallelism-faster-jobs/#manual-allocation) across parallel environments.

## Quickstart

The following how-to guide walks you through the steps required to glob your test files, split your tests evenly across parallel containers or VMs, and then run your tests in parallel:

- **How-to**: [Use the CircleCI CLI to split tests](https://circleci.com/docs/use-the-circleci-cli-to-split-tests/)


## Specify parallel environments for a test job

Test suites are conventionally defined at the [job](https://circleci.com/docs/jobs-steps/) level in your `.circleci/config.yml` file. The `parallelism` key specifies how many independent executors are set up to run the job.

To run a job’s steps in multiple, parallel execution environments, set the `parallelism` key to a value greater than `1`. In the example below, `parallelism` is set to `4`, meaning four identical execution environments will be set up for the job, in this case, four Docker containers using the `cimg/base:2023.09` image.

Use the `circleci tests run` command to split _and_ run your tests. Your tests will be split up, and a portion of your tests run in each execution environment. This reduces the overall time taken to run the full test suite. In this example tests will be split up into four, and the split points are calculated based on historic timing data.

```yaml
# ~/.circleci/config.yml
jobs:
  build:
    docker:
      - image: cimg/go:1.18.1
    parallelism: 4
    resource_class: large
    steps:
      - run: go list ./... | circleci tests run --command "xargs gotestsum --junitfile junit.xml --format testname --" --split-by=timings --timings-type=name
```

![Parallelism](https://circleci.com/docs/assets/img/docs/executor_types_plus_parallelism.png)

### Use parallelism with self-hosted runners

To use the parallelism feature with jobs that use [self-hosted runners](https://circleci.com/docs/runner-overview/), ensure that you have at least two self-hosted machine runners associated with the runner resource class that your job will run on. If you set the parallelism value to be greater than the number of active self-hosted runners in a given resource class, the excess parallel tasks that do not have a self-hosted runner on which to execute will queue until a self-hosted runner is available.

If you are using parallelism on [Container Runner](https://circleci.com/docs/container-runner/), you will need to make sure that `agent.maxConcurrentTasks` and your Kubernetes cluster can accommodate the number of parallel tasks you want to run. If you do not have adequate resources, your parallel runs will be subject to queuing.

For more information, see the [Configuration reference](https://circleci.com/docs/configuration-reference/#parallelism) page.

## How test splitting works

CircleCI’s test splitting feature allows you to specify a number of identical execution environments for a job (parallelism), and then split your test suite into an equal number of portions so that the tests can be run in parallel to reduce the length of time taken for your test pipeline. You can split your tests up in a few different ways:

- Alphabetically, by name. This is the default:





```yaml
# ~/.circleci/config.yml
jobs:
    build:
      docker:
      - image: cimg/go:1.18.1
    parallelism: 4
    resource_class: large
    steps:
      - run: go list ./... | circleci tests run --command "xargs gotestsum --junitfile junit.xml --format testname --"
```

- By size:





```yaml
# ~/.circleci/config.yml
jobs:
    build:
      docker:
      - image: cimg/go:1.18.1
    parallelism: 4
    resource_class: large
    steps:
      - run: go list ./... | circleci tests run --command "xargs gotestsum --junitfile junit.xml --format testname --" --split-by=filesize
```

- By using historic timing data:





```yaml
jobs:
    build:
      docker:
      - image: cimg/go:1.18.1
    parallelism: 4
    resource_class: large
    steps:
      - run: go list ./... | circleci tests run --command "xargs gotestsum --junitfile junit.xml --format testname --" --split-by=timings --timings-type=name
```

When using timing-based test splitting, the CLI attempts to auto detect the granularity of the test split (for example, whether to split by file name, or down to class name) based on the input to the split command. You may need to choose a different timing type depending on how your test coverage output is formatted, using the `--timings-type` option. Valid timing types are:

- `name` \- test name

- `classname` class name

- `file` \- file name


### Example using timing-based test splitting

Using **timing-based** test splitting as an example, timing data from the _previous_ test run is used to split a test suite as evenly as possible over a specified number of test environments running in parallel. This delivers the lowest possible test time for the compute power in use.

![Test Splitting](https://circleci.com/docs/assets/img/docs/test_splitting.png)

Timings-based test splitting gives the most accurate split, and is guaranteed to optimize with each test suite run. The most recent timings data is always used to define where splits are made.

As an example, take a Go test suite. Here, all tests run sequentially in a single test environment, a Docker container:

```yaml
jobs:
build:
    docker:
      - image: cimg/go:1.18.1
    resource_class: large
    steps:
      - run: go test
```

To split these tests using timing data:

1. Introduce parallelism to spin up a number of identical test environments (4 in this example)

2. Use the `circleci tests run` command, with the `--split-by=timings` flag to split the tests evenly across all executors.


```yaml
jobs:
build:
    docker:
      - image: cimg/go:1.18.1
    parallelism: 4
    resource_class: large
    steps:
      - run: go list ./... | circleci tests run --command "xargs gotestsum --junitfile junit.xml --format testname --" --split-by=timings --timings-type=name
```

For a more detailed walkthrough, read the [guide to using the CLI to split tests](https://circleci.com/docs/use-the-circleci-cli-to-split-tests/), or follow our [Test splitting tutorial](https://circleci.com/docs/test-splitting-tutorial/).

The first time the tests are run there will be no timing data for the command to use, but on subsequent runs the test time will be optimized.

### The tests run command

Use the `circleci tests run` command to run your tests, split your tests across parallel executors and take advantage of the [rerun failed tests](https://circleci.com/docs/rerun-failed-tests/) options.

The following table show a full list of option flags available when using `circleci tests run`.

| Flag | Type | Description | Required? |
| --- | --- | --- | --- |
| `--command` | string | The command string is the script that will be run for a list of tests determined by the options provided to the plugin | Yes |
| `--index` | uint | index of node can also be set with CIRCLE\_NODE\_INDEX. (default 1) | No |
| `--split-by` | string | how to weight the split, allowed values are `name`, `filesize`, and `timings`. (default `name`) | No |
| `--timings-type` | string | name of the field to use from historical test results when matching against the test names given to the command in order to determine their historical timings, previous status and flakiness. Available values: `classname`, `name`, `file` (default). | No |
| `--total` | uint | number of nodes can also be set with CIRCLE\_NODE\_TOTAL. (default 2) | No |
| `-v`, `--verbose` | — | enable verbose logging output. | No |

### The tests split command

It is also possible to split tests using the `circleci tests split` command. Using the example from above, splitting the Go tests would be done as follows:

```yaml
jobs:
build:
    docker:
      - image: cimg/go:1.18.1
    parallelism: 4
    resource_class: large
    steps:
      - run: go test -v $(go list ./... | circleci tests split --split-by=timings)
```

The `circleci tests split` command has been superseded by `circleci tests run` as this command also gives you access to the [rerun failed tests](https://circleci.com/docs/rerun-failed-tests/) options.

Integrating with some [third party tools](https://circleci.com/docs/parallelism-faster-jobs/#other-ways-to-split-tests) might still require you to use `circleci tests split`. For usage steps see, [Use the CircleCI CLI to split tests](https://circleci.com/docs/use-the-circleci-cli-to-split-tests/#tests-split-examples).

### JUnit XML report formatting

In order to use the test splitting feature, CircleCI requires test results to be uploaded as JUnit XML reports. The following formatting allows CircleCI to parse timing data from test results and use the data for test splitting:

- The `file` attribute, either on the `<testsuite>` or `<testcase>` tag

- The `time` attribute, on the `<testcase>` tag


The following example is a snippet from an XML file with a format that CircleCI can parse:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<testsuites name="Mocha Tests" tests="3" failures="1">
<testsuite tests="3">
    <testcase classname="foo1" name="ASuccessfulTest" time="10" file="src/__tests__/App.test.js" />
    <testcase classname="foo2" name="AnotherSuccessfulTest" time="5" file="src/__tests__/App.test.js" />
    <testcase classname="foo3" name="AFailingTest" time="1.1050" file="src/__tests__/App.test.js">
        <failure type="NotEnoughFoo"> details about failure </failure>
    </testcase>
</testsuite>
</testsuites>
```

## Manual allocation

For full control over how tests are split across parallel executors, CircleCI provides two environment variables that you can use in place of the CLI to configure each container individually.

- `$CIRCLE_NODE_TOTAL` is the total number of parallel containers being used to run your job.

- `$CIRCLE_NODE_INDEX` is the index of the specific container that is currently running.


The CLI looks up the number of available execution environments ( `$CIRCLE_NODE_TOTAL`), along with the current container index ( `$CIRCLE_NODE_INDEX`). Then, it uses deterministic splitting algorithms to split the test files across all available containers.

The number of containers is specified by the [`parallelism` key](https://circleci.com/docs/configuration-reference/#parallelism) in the project configuration file.

The current container index is automatically picked up from the `$CIRCLE_NODE_INDEX` environment variable, but can be manually set by using the `--index` flag.

```shell
cat test_filenames.txt | circleci tests run --command=">index0.txt xargs echo" --index=0 --split-by=name
```

Refer to the [Project values and variables](https://circleci.com/docs/variables/#built-in-environment-variables) page for more details.

## Other ways to split tests

Some third party applications and libraries might help you to split your test suite. These applications are not developed or supported by CircleCI. Check with the owner if you have issues using it with CircleCI. If you are unable to resolve the issue you can search and ask on our forum, [Discuss](https://discuss.circleci.com/).

[Knapsack Pro](https://knapsackpro.com/)

Enables allocating tests dynamically across parallel CI nodes, allowing your test suite execution to run faster. See [CI build time graph examples](https://docs.knapsackpro.com/2018/improve-circleci-parallelisation-for-rspec-minitest-cypress).

[PHPUnit Finder](https://github.com/previousnext/phpunit-finder)

A helper CLI tool that queries `phpunit.xml` files to get a list of test filenames and print them. PHPUnit Finder is useful if you want to split tests to run them in parallel based on timings on CI tools.

[go list](https://golang.org/cmd/go/#hdr-List_packages_or_modules)

Use the built-in Go command `go list ./...` to glob Golang packages. This allows splitting package tests across multiple containers.

```shell
go test -v $(go list ./... | circleci tests split)
```

[Playwright](https://github.com/microsoft/playwright)

A framework for web testing and automation and allows running sharded tests out of the box. For more details see [Playwright docs](https://playwright.dev/docs/ci#circleci).

```yaml
job-name:
  executor: pw-focal-development
  parallelism: 4
  steps:
    - run: SHARD="$((${CIRCLE_NODE_INDEX}+1))"; npx playwright test --shard=${SHARD}/${CIRCLE_NODE_TOTAL}
```

## Next steps

- [Use the CircleCI CLI to split tests](https://circleci.com/docs/use-the-circleci-cli-to-split-tests/)

- [Test splitting to speed up your pipelines](https://circleci.com/docs/test-splitting-tutorial/)

- [Troubleshooting Test Splitting](https://circleci.com/docs/troubleshoot-test-splitting/)

- [Collecting Test Data](https://circleci.com/docs/collect-test-data/)

- [Test Insights](https://circleci.com/docs/insights-tests/)


* * *

#### Suggest an edit to this page

[Make a contribution](https://github.com/circleci/circleci-docs/blob/master/jekyll/_cci2/parallelism-faster-jobs.adoc)[Learn how to contribute](https://github.com/circleci/circleci-docs/blob/master/docs/CONTRIBUTING.md#contributing-to-circleci-docs)

#### Still need help?

[Ask the CircleCI community](https://discuss.circleci.com/)[Join the research community](https://circleci.com/research)[Visit our Support site](https://support.circleci.com/)

reCAPTCHA

Recaptcha requires verification.

[Privacy](https://www.google.com/intl/en/policies/privacy/) \- [Terms](https://www.google.com/intl/en/policies/terms/)

protected by **reCAPTCHA**

[Privacy](https://www.google.com/intl/en/policies/privacy/) \- [Terms](https://www.google.com/intl/en/policies/terms/)

---
